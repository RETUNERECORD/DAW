<!DOCTYPE html>
<html lang="en">
<head>
<title>EDUCATIONS</title>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, user-scalable=no"/>
<meta name="description" content="A free and Open-Source DAW (digital audio workstation)"/>
<meta name="google" content="notranslate"/>
<meta property="og:type" content="website"/>
<meta property="og:title" content="EDUCATIONS"/>
<meta property="og:url" content="/daw/>
<meta property="og:image" content="/assets/og-image.jpg"/>
<meta property="og:image:width" content="800"/>
<meta property="og:image:height" content="400"/>
<meta property="og:description" content="a free and open source DAW (digital audio workstation)"/>
<meta name="theme-color" content="#3a5158"/>
<link rel="manifest" href="manifest.json"/>
<link rel="daw" href="daw/src/"/>
<link rel="src" href="/src/"/>
<link rel="shortcut icon" href="/assets/favicon.png"/>
<style>
@keyframes splashScreen-textAnim{0%{background-color:rgba(var(--gsui-rgb-gain),.2)}to{background-color:transparent}}@keyframes gsuiIcon-spin{0%{transform:rotate(0deg)}to{transform:rotate(360deg)}}@keyframes gsuiDrumrow-startCursor-anim{0%{left:-100%}to{left:100%}}@keyframes gsuiLibrary-sample-loading-anim{0%{background-color:none}to{background-color:var(--gsuiLibrary-sample-hover-bg)}}:root{--gsui-font:"Montserrat", sans-serif;--gsui-font-title:"Oswald", var( --gsui-font );--gsui-font-monospace:"Inconsolata", "consolas", monospace;--gsui-font-number:"Unica One", var( --gsui-font-monospace )}@font-face{font-family:"FontAwesome";font-style:normal;font-weight:400;src:url(/assets/fonts/fa-duotone-900.woff2)}@font-face{font-family:"FontAwesomeBrands";font-style:normal;font-weight:400;src:url(/assets/fonts/fa-brands-400.woff2)}@font-face{font-family:"Oswald";font-style:normal;font-weight:400;src:local("Oswald Regular"),local("Oswald-Regular"),url(/assets/fonts/oswald-400-latin.woff2)format("woff2");unicode-range:u+0000-00ff,u+0131,u+0152-0153,u+02bb-02bc,u+02c6,u+02da,u+02dc,u+2000-206f,u+2074,u+20ac,u+2122,u+2191,u+2193,u+2212,u+2215,u+feff,u+fffd}@font-face{font-family:"Unica One";font-style:normal;font-weight:400;src:local("Unica One"),local("UnicaOne-Regular"),url(/assets/fonts/unica-one-400-latin.woff2)format("woff2");unicode-range:u+0000-00ff,u+0131,u+0152-0153,u+02bb-02bc,u+02c6,u+02da,u+02dc,u+2000-206f,u+2074,u+20ac,u+2122,u+2191,u+2193,u+2212,u+2215,u+feff,u+fffd}@font-face{font-family:"Inconsolata";font-style:normal;font-weight:400;src:local("Inconsolata Regular"),local("Inconsolata-Regular"),url(/assets/fonts/inconsolata-400-latin.woff2)format("woff2");unicode-range:u+0000-00ff,u+0131,u+0152-0153,u+02bb-02bc,u+02c6,u+02da,u+02dc,u+2000-206f,u+2074,u+20ac,u+2122,u+2191,u+2193,u+2212,u+2215,u+feff,u+fffd}@font-face{font-family:"Montserrat";font-style:normal;font-weight:400;src:local("Montserrat Medium"),local("Montserrat-Medium"),url(/assets/fonts/montserrat-500-cyrillic-ext.woff2)format("woff2");unicode-range:u+0460-052f,u+1c80-1c88,u+20b4,u+2de0-2dff,u+a640-a69f,u+fe2e-fe2f}@font-face{font-family:"Montserrat";font-style:normal;font-weight:400;src:local("Montserrat Medium"),local("Montserrat-Medium"),url(/assets/fonts/montserrat-500-cyrillic.woff2)format("woff2");unicode-range:u+0400-045f,u+0490-0491,u+04b0-04b1,u+2116}@font-face{font-family:"Montserrat";font-style:normal;font-weight:400;src:local("Montserrat Medium"),local("Montserrat-Medium"),url(/assets/fonts/montserrat-500-vietnamese.woff2)format("woff2");unicode-range:u+0102-0103,u+0110-0111,u+1ea0-1ef9,u+20ab}@font-face{font-family:"Montserrat";font-style:normal;font-weight:400;src:local("Montserrat Medium"),local("Montserrat-Medium"),url(/assets/fonts/montserrat-500-latin-ext.woff2)format("woff2");unicode-range:u+0100-024f,u+0259,u+1e00-1eff,u+2020,u+20a0-20ab,u+20ad-20cf,u+2113,u+2c60-2c7f,u+a720-a7ff}@font-face{font-family:"Montserrat";font-style:normal;font-weight:400;src:local("Montserrat Medium"),local("Montserrat-Medium"),url(/assets/fonts/montserrat-500-latin.woff2)format("woff2");unicode-range:u+0000-00ff,u+0131,u+0152-0153,u+02bb-02bc,u+02c6,u+02da,u+02dc,u+2000-206f,u+2074,u+20ac,u+2122,u+2191,u+2193,u+2212,u+2215,u+feff,u+fffd}@font-face{font-family:"Montserrat";font-style:normal;font-weight:700;src:local("Montserrat Bold"),local("Montserrat-Bold"),url(/assets/fonts/montserrat-700-cyrillic-ext.woff2)format("woff2");unicode-range:u+0460-052f,u+1c80-1c88,u+20b4,u+2de0-2dff,u+a640-a69f,u+fe2e-fe2f}@font-face{font-family:"Montserrat";font-style:normal;font-weight:700;src:local("Montserrat Bold"),local("Montserrat-Bold"),url(/assets/fonts/montserrat-700-cyrillic.woff2)format("woff2");unicode-range:u+0400-045f,u+0490-0491,u+04b0-04b1,u+2116}@font-face{font-family:"Montserrat";font-style:normal;font-weight:700;src:local("Montserrat Bold"),local("Montserrat-Bold"),url(/assets/fonts/montserrat-700-vietnamese.woff2)format("woff2");unicode-range:u+0102-0103,u+0110-0111,u+1ea0-1ef9,u+20ab}@font-face{font-family:"Montserrat";font-style:normal;font-weight:700;src:local("Montserrat Bold"),local("Montserrat-Bold"),url(/assets/fonts/montserrat-700-latin-ext.woff2)format("woff2");unicode-range:u+0100-024f,u+0259,u+1e00-1eff,u+2020,u+20a0-20ab,u+20ad-20cf,u+2113,u+2c60-2c7f,u+a720-a7ff}@font-face{font-family:"Montserrat";font-style:normal;font-weight:700;src:local("Montserrat Bold"),local("Montserrat-Bold"),url(/assets/fonts/montserrat-700-latin.woff2)format("woff2");unicode-range:u+0000-00ff,u+0131,u+0152-0153,u+02bb-02bc,u+02c6,u+02da,u+02dc,u+2000-206f,u+2074,u+20ac,u+2122,u+2191,u+2193,u+2212,u+2215,u+feff,u+fffd}body,html{height:100%;margin:0;overflow:hidden;font-family:var(--gsui-font);background-color:#333}noscript{z-index:2;display:flex;align-items:center;color:#ddd}#splashScreen,#splashScreen-content{display:flex;flex-direction:column;align-items:center}#splashScreen,noscript{position:absolute;justify-content:center;inset:0;background-color:#333}#splashScreen{z-index:1;color:#fff8;transition:.5s opacity}#splashScreen.started{opacity:0}#splashScreen-content{position:relative;text-align:center}#splashScreen-version{margin-top:10px;font-size:20px;font-family:var(--gsui-font-number)}#splashScreen-version::before{content:"version";font-size:12px;font-family:inherit;margin-right:5px;margin-bottom:200px;opacity:.5}#splashScreen-start{margin-top:48px;padding:.5ch 1ch;border:2px solid;border-radius:8px;outline:0;font:inherit;font-size:14px;color:var(--gsui-col-gain);cursor:pointer;background-color:rgba(var(--gsui-rgb-gain),.2);transition:box-shadow .25s,opacity .5s}#splashScreen-start:disabled{opacity:.25;pointer-events:none}#splashScreen.loaded #splashScreen-start:not(:disabled):focus,#splashScreen.loaded #splashScreen-start:not(:disabled):hover{box-shadow:0 0 24px rgba(var(--gsui-rgb-gain),.3);animation:.25s splashScreen-textAnim linear infinite alternate}#splashScreen:not(.loaded) #splashScreen-start::before{content:"downloading..."}#splashScreen.loaded #splashScreen-start::before{content:"click to start"}#splashScreen.starting #splashScreen-start::before{content:"starting..."}#splashScreen-form{order:10;margin-top:50px;font-size:10px}.splashScreen-form-row{display:flex;align-items:center;gap:.5ch;cursor:pointer}#splashScreen-form input{cursor:pointer}.TextGlitch{position:relative;color:#ccc;line-height:1em;font-size:68px;font-family:"oswald",monospace}.TextGlitch-blended{color:#fff}.TextGlitch-clip{position:relative}.TextGlitch-clip+.TextGlitch-clip{position:absolute;top:0}.TextGlitch:not(.TextGlitch-blended) .TextGlitch-clip+.TextGlitch-clip{display:none}.TextGlitch-word{margin:0;white-space:nowrap}.TextGlitch-blend{position:absolute;top:0;opacity:0;transition:.1s;transition-property:opacity}.TextGlitch-blendA{color:#2af;margin:-.03em 0 0 .03em;mix-blend-mode:darken}.TextGlitch-blendB{color:#f64;margin:.03em 0 0-.03em;mix-blend-mode:color-burn}.TextGlitch-blended .TextGlitch-blend{opacity:.4}body{color-scheme:dark;--gsui-rgb-pan:221, 153, 255;--gsui-rgb-gain:255, 255, 153;--gsui-rgb-time:255, 119, 119;--gsui-rgb-detune:255, 255, 255;--gsui-rgb-unison:255, 153,  85;--gsui-rgb-pattern:85, 170, 204;--gsui-rgb-patternSelected:255, 136, 136;--gsui-rgb-currentTimeCursor:255, 255, 153;--gsui-col-pan:rgb( var( --gsui-rgb-pan ) );--gsui-col-gain:rgb( var( --gsui-rgb-gain ) );--gsui-col-time:rgb( var( --gsui-rgb-time ) );--gsui-col-detune:rgb( var( --gsui-rgb-detune ) );--gsui-col-unison:rgb( var( --gsui-rgb-unison ) );--gsui-col-pattern:rgb( var( --gsui-rgb-pattern ) );--gsui-col-lowpass:#d96;--gsui-col-patternSelected:rgb( var( --gsui-rgb-patternSelected ) );--gsui-col-currentTimeCursor:rgb( var( --gsui-rgb-currentTimeCursor ) );--gsui-head-bg:#3a3a3a;--gsui-items-bg:#474747;--gsui-item-bg:#5c5c5c;--gsui-item-more-bg:#fff2;--gsui-item-bg-disabled:#505050;--gsui-item-bg-selected:#616161;--gsui-toggle-on:#ffa;--gsui-toggle-off:#222;--gsui-slider-bg:#0003;--gsui-slider-bg-opaque:#444;--gsuiSlider-lineBgColor:var( --gsui-slider-bg )}*{scrollbar-width:thin;scrollbar-color:#ddd #222}::-webkit-scrollbar{width:4px;height:4px}::-webkit-scrollbar-track{background-color:#222}::-webkit-scrollbar-thumb{background-color:#aaa}:root{--gsuiIcon-color-after:currentColor;--gsuiIcon-opacity-after:.6}.gsuiIcon{position:relative;display:inline-flex;align-items:center;justify-content:center;font-family:"FontAwesome";font-size:1em;font-style:normal;font-weight:400;font-variant:normal;text-decoration:none;text-rendering:auto;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}.gsuiIconB{font-family:"FontAwesomeBrands"}.gsuiIcon::before{pointer-events:none}.gsuiIcon:not(.gsuiIconB)::before{position:absolute}.gsuiIcon::after{color:var(--gsuiIcon-color-after);opacity:var(--gsuiIcon-opacity-after);pointer-events:none}.gsuiIcon:not([data-spin=on]):not([data-icon]),.gsuiIcon:not([data-spin=on])[data-icon=""],.gsuiIconB::after,gsui-daw:not([logged]) .gsuiDAW-btn[data-action=logout],gsui-daw:not([logged]) .gsuiDAW-btn[data-action=profile],gsui-daw[logged] .gsuiDAW-btn[data-action=login]{display:none}.gsuiIcon.gsuiIcon.gsuiIcon[data-spin=on]{line-height:1}.gsuiIcon.gsuiIcon.gsuiIcon[data-spin=on]::before{content:"?";animation:.7s infinite linear gsuiIcon-spin;opacity:1}.gsuiIcon.gsuiIcon.gsuiIcon[data-spin=on]::after{display:inline-block;content:"??";animation:.7s infinite linear gsuiIcon-spin;opacity:.4}.gsuiIcon[data-icon=github]::before{content:"?"}.gsuiIcon[data-icon=github]::after{content:"??"}.gsuiIcon[data-icon=codepen]::before{content:"?"}.gsuiIcon[data-icon=codepen]::after{content:"??"}.gsuiIcon[data-icon=discord]::before{content:"?"}.gsuiIcon[data-icon=discord]::after{content:"??"}.gsuiIcon[data-icon=patreon]::before{content:"?"}.gsuiIcon[data-icon=patreon]::after{content:"??"}.gsuiIcon[data-icon=twitter]::before{content:"?"}.gsuiIcon[data-icon=twitter]::after{content:"??"}.gsuiIcon[data-icon=youtube]::before{content:"?"}.gsuiIcon[data-icon=youtube]::after{content:"??"}.gsuiIcon[data-icon=facebook]::before{content:"?"}.gsuiIcon[data-icon=facebook]::after{content:"??"}.gsuiIcon[data-icon=wordpress]::before{content:"?"}.gsuiIcon[data-icon=wordpress]::after{content:"??"}.gsuiIcon[data-icon=arrow-left]::before{content:"?"}.gsuiIcon[data-icon=arrow-left]::after{content:"??"}.gsuiIcon[data-icon=arrow-right]::before{content:"?"}.gsuiIcon[data-icon=arrow-right]::after{content:"??"}.gsuiIcon[data-icon=arrows]::before{content:"?"}.gsuiIcon[data-icon=arrows]::after{content:"??"}.gsuiIcon[data-icon=arrows-v]::before{content:"?"}.gsuiIcon[data-icon=arrows-v]::after{content:"??"}.gsuiIcon[data-icon=arrows-h]::before{content:"?"}.gsuiIcon[data-icon=arrows-h]::after{content:"??"}.gsuiIcon[data-icon=arrow-dropdown]::before{content:"?"}.gsuiIcon[data-icon=arrow-dropdown]::after{content:"??"}.gsuiIcon[data-icon=arrow-levelleftdown]::before{content:"?";transform:scale(-1,1)}.gsuiIcon[data-icon=arrow-levelleftdown]::after{content:"??";transform:scale(-1,1)}.gsuiIcon[data-icon=sort]::before{content:"?"}.gsuiIcon[data-icon=sort]::after{content:"??"}.gsuiIcon[data-icon=caret-up]::before{content:"?"}.gsuiIcon[data-icon=caret-up]::after{content:"??"}.gsuiIcon[data-icon=caret-down]::before{content:"?"}.gsuiIcon[data-icon=caret-down]::after{content:"??"}.gsuiIcon[data-icon=caret-left]::before{content:"?"}.gsuiIcon[data-icon=caret-left]::after{content:"??"}.gsuiIcon[data-icon=caret-right]::before{content:"?"}.gsuiIcon[data-icon=caret-right]::after{content:"??"}.gsuiIcon[data-icon=osc-sine]::before{content:"?"}.gsuiIcon[data-icon=osc-sine]::after{content:"??"}.gsuiIcon[data-icon=osc-triangle]::before{content:"?"}.gsuiIcon[data-icon=osc-triangle]::after{content:"??"}.gsuiIcon[data-icon=osc-square]::before{content:"?"}.gsuiIcon[data-icon=osc-square]::after{content:"??"}.gsuiIcon[data-icon=undo]::before{content:"?"}.gsuiIcon[data-icon=undo]::after{content:"??"}.gsuiIcon[data-icon=redo]::before{content:"?"}.gsuiIcon[data-icon=redo]::after{content:"??"}.gsuiIcon[data-icon=sync]::before{content:"?"}.gsuiIcon[data-icon=sync]::after{content:"??"}.gsuiIcon[data-icon=play]::before{content:"?";opacity:.6}.gsuiIcon[data-icon=play]::after{content:"??";opacity:1}.gsuiIcon[data-icon=stop]::before{content:"?";opacity:.6}.gsuiIcon[data-icon=stop]::after{content:"??";opacity:1}.gsuiIcon[data-icon=loop]::before{content:"?"}.gsuiIcon[data-icon=loop]::after{content:"??"}.gsuiIcon[data-icon=pause]::before{content:"?";opacity:.6}.gsuiIcon[data-icon=pause]::after{content:"??";opacity:1}.gsuiIcon[data-icon=eject]::before{content:"?"}.gsuiIcon[data-icon=eject]::after{content:"??"}.gsuiIcon[data-icon=circle]::before{content:"?";opacity:.6}.gsuiIcon[data-icon=circle]::after{content:"??";opacity:1}.gsuiIcon[data-icon=square]::before{content:"?";opacity:.6}.gsuiIcon[data-icon=square]::after{content:"??";opacity:1}.gsuiIcon[data-icon=triangle]::before{content:"?";opacity:.6}.gsuiIcon[data-icon=triangle]::after{content:"??";opacity:1}.gsuiIcon[data-icon=diamond]::before{content:"?";opacity:.6}.gsuiIcon[data-icon=diamond]::after{content:"??";opacity:1}.gsuiIcon[data-icon=heart]::before{content:"?";opacity:.6}.gsuiIcon[data-icon=heart]::after{content:"??";opacity:1}.gsuiIcon[data-icon=hexagon]::before{content:"?";opacity:.6}.gsuiIcon[data-icon=hexagon]::after{content:"??";opacity:1}.gsuiIcon[data-icon=octagon]::before{content:"?";opacity:.6}.gsuiIcon[data-icon=octagon]::after{content:"??";opacity:1}.gsuiIcon[data-icon=mute]::before{content:"?"}.gsuiIcon[data-icon=mute]::after{content:"??"}.gsuiIcon[data-icon=unmute]::before{content:"?"}.gsuiIcon[data-icon=unmute]::after{content:"??"}.gsuiIcon[data-icon=close]::before{content:"?"}.gsuiIcon[data-icon=close]::after{content:"??"}.gsuiIcon[data-icon=restore]::before{content:"?"}.gsuiIcon[data-icon=restore]::after{content:"??"}.gsuiIcon[data-icon=minimize]::before{content:"?"}.gsuiIcon[data-icon=minimize]::after{content:"??";opacity:1}.gsuiIcon[data-icon=maximize]::before{content:"?"}.gsuiIcon[data-icon=maximize]::after{content:"??";opacity:0}.gsuiIcon[data-icon=save]::before{content:"?"}.gsuiIcon[data-icon=save]::after{content:"??";opacity:.4}.gsuiIcon[data-icon=render]::before{content:"?"}.gsuiIcon[data-icon=render]::after{content:"??"}.gsuiIcon[data-icon=upload]::before{content:"?";opacity:0}.gsuiIcon[data-icon=upload]::after{content:"??";opacity:1}.gsuiIcon[data-icon=export]::before{content:"?"}.gsuiIcon[data-icon=export]::after{content:"??"}.gsuiIcon[data-icon=folder-open]::before{content:"?"}.gsuiIcon[data-icon=folder-open]::after{content:"??"}.gsuiIcon[data-icon=folder-tree]::before{content:"?"}.gsuiIcon[data-icon=folder-tree]::after{content:"??"}.gsuiIcon[data-icon=file-buffer]::before{content:"?"}.gsuiIcon[data-icon=file-buffer]::after{content:"??"}.gsuiIcon[data-icon=file-export]::before{content:"?"}.gsuiIcon[data-icon=file-export]::after{content:"??"}.gsuiIcon[data-icon=file-corrupt]::before{content:"?"}.gsuiIcon[data-icon=file-corrupt]::after{content:"??"}.gsuiIcon[data-icon=login]::before{content:"?"}.gsuiIcon[data-icon=login]::after{content:"??"}.gsuiIcon[data-icon=logout]::before{content:"?"}.gsuiIcon[data-icon=logout]::after{content:"??"}.gsuiIcon[data-icon=profile]::before{content:"?"}.gsuiIcon[data-icon=profile]::after{content:"??"}.gsuiIcon[data-icon=musician]::before{content:"?"}.gsuiIcon[data-icon=musician]::after{content:"??"}.gsuiIcon[data-icon=speed]::before{content:"?";opacity:0}.gsuiIcon[data-icon=speed]::after{content:"??";opacity:1}.gsuiIcon[data-icon=clock]::before{content:"?"}.gsuiIcon[data-icon=clock]::after{content:"??";opacity:.3}.gsuiIcon[data-icon=history]::before{content:"?"}.gsuiIcon[data-icon=history]::after{content:"??"}.gsuiIcon[data-icon=keys]::before{content:"?"}.gsuiIcon[data-icon=keys]::after{content:"??"}.gsuiIcon[data-icon=drums]::before{content:"?"}.gsuiIcon[data-icon=drums]::after{content:"??"}.gsuiIcon[data-icon=mixer]::before{content:"?"}.gsuiIcon[data-icon=mixer]::after{content:"??"}.gsuiIcon[data-icon=channels]::before{content:"?";transform:rotate(-90deg)}.gsuiIcon[data-icon=channels]::after{content:"??";transform:rotate(-90deg)}.gsuiIcon[data-icon=music]::before{content:"?"}.gsuiIcon[data-icon=music]::after{content:"??"}.gsuiIcon[data-icon=musics]::before{content:"?"}.gsuiIcon[data-icon=musics]::after{content:"??"}.gsuiIcon[data-icon=effects]::before{content:"?"}.gsuiIcon[data-icon=effects]::after{content:"??"}.gsuiIcon[data-icon=add-effect]::before{content:"?"}.gsuiIcon[data-icon=add-effect]::after{content:"??"}.gsuiIcon[data-icon=waveform]::before{content:"?"}.gsuiIcon[data-icon=waveform]::after{content:"??"}.gsuiIcon[data-icon=oscillator]::before{content:"?"}.gsuiIcon[data-icon=oscillator]::after{content:"??";opacity:1}.gsuiIcon[data-icon=glissando]::before{content:"?"}.gsuiIcon[data-icon=glissando]::after{content:"??"}.gsuiIcon[data-icon=buf-fx]::before{content:"?"}.gsuiIcon[data-icon=buf-fx]::after{content:"??"}.gsuiIcon[data-icon=buf-drum]::before{content:"?"}.gsuiIcon[data-icon=buf-drum]::after{content:"??"}.gsuiIcon[data-icon=buf-loop]::before{content:"?"}.gsuiIcon[data-icon=buf-loop]::after{content:"??"}.gsuiIcon[data-icon=buf-vocal]::before{content:"?"}.gsuiIcon[data-icon=buf-vocal]::after{content:"??"}.gsuiIcon[data-icon=buf-undefined]::before{content:"?"}.gsuiIcon[data-icon=buf-undefined]::after{content:"??";opacity:.2}.gsuiIcon[data-icon=plus]::before{content:"?"}.gsuiIcon[data-icon=plus]::after{content:"??";opacity:.7}.gsuiIcon[data-icon=minus]::before{content:"?"}.gsuiIcon[data-icon=minus]::after{content:"??";opacity:1}.gsuiIcon[data-icon=minus-oct]::before{content:"?"}.gsuiIcon[data-icon=minus-oct]::after{content:"??"}.gsuiIcon[data-icon=check]::before{content:"?"}.gsuiIcon[data-icon=check]::after{content:"??"}.gsuiIcon[data-icon=warning]::before{content:"?"}.gsuiIcon[data-icon=warning]::after{content:"??"}.gsuiIcon[data-icon=redirect]::before{content:"?"}.gsuiIcon[data-icon=redirect]::after{content:"??";opacity:.4}.gsuiIcon[data-icon=pen]::before{content:"?"}.gsuiIcon[data-icon=pen]::after{content:"??"}.gsuiIcon[data-icon=crop]::before{content:"?"}.gsuiIcon[data-icon=crop]::after{content:"??"}.gsuiIcon[data-icon=erase]::before{content:"?"}.gsuiIcon[data-icon=erase]::after{content:"??"}.gsuiIcon[data-icon=list]::before{content:"?"}.gsuiIcon[data-icon=list]::after{content:"??"}.gsuiIcon[data-icon=local]::before{content:"?"}.gsuiIcon[data-icon=local]::after{content:"??";opacity:.2}.gsuiIcon[data-icon=cloud]::before{content:"?";opacity:.2}.gsuiIcon[data-icon=cloud]::after{content:"??";opacity:1}.gsuiIcon[data-icon=cookie]::before{content:"?"}.gsuiIcon[data-icon=cookie]::after{content:"??"}.gsuiIcon[data-icon=link]::before{content:"?"}.gsuiIcon[data-icon=link]::after{content:"??"}.gsuiIcon[data-icon=unlink]::before{content:"?"}.gsuiIcon[data-icon=unlink]::after{content:"??"}.gsuiIcon[data-icon=public]::before{content:"?"}.gsuiIcon[data-icon=public]::after{content:"??";opacity:.4}.gsuiIcon[data-icon=private]::before{content:"?"}.gsuiIcon[data-icon=private]::after{content:"??"}.gsuiIcon[data-icon=grip-h]::before{content:"?"}.gsuiIcon[data-icon=grip-h]::after{content:"??"}.gsuiIcon[data-icon=grip-v]::before{content:"?"}.gsuiIcon[data-icon=grip-v]::after{content:"??"}.gsuiIcon[data-icon=cut]::before{content:"?"}.gsuiIcon[data-icon=cut]::after{content:"??"}.gsuiIcon[data-icon=clone]::before{content:"?"}.gsuiIcon[data-icon=clone]::after{content:"??"}.gsuiIcon[data-icon=slices]::before{content:"?";transform:rotate(-90deg)}.gsuiIcon[data-icon=slices]::after{content:"??";transform:rotate(-90deg)}.gsuiIcon[data-icon=drumcut]{transform:rotate(90deg)}.gsuiIcon[data-icon=drumcut]::before{content:"?"}.gsuiIcon[data-icon=drumcut]::after{content:"??"}.gsuiIcon[data-icon=drumprops]{transform:rotate(-90deg)}.gsuiIcon[data-icon=drumprops]::before{content:"?"}.gsuiIcon[data-icon=drumprops]::after{content:"??"}.gsuiIcon[data-icon=smiley]::before{content:"?";opacity:0}.gsuiIcon[data-icon=smiley]::after{content:"??";opacity:1}.gsuiIcon[data-icon=bug]::before{content:"?"}.gsuiIcon[data-icon=bug]::after{content:"??"}.gsuiIcon[data-icon=mouse]::before{content:"?"}.gsuiIcon[data-icon=mouse]::after{content:"??";opacity:1}.gsuiIcon[data-icon=hand-pointer]::before{content:"?";opacity:0}.gsuiIcon[data-icon=hand-pointer]::after{content:"??";opacity:1}.gsuiIcon[data-icon=magnet]::before{content:"?"}.gsuiIcon[data-icon=magnet]::after{content:"??"}.gsuiIcon[data-icon=tint]::before{content:"?"}.gsuiIcon[data-icon=tint]::after{content:"??"}.gsuiIcon[data-icon=settings]::before{content:"?"}.gsuiIcon[data-icon=settings]::after{content:"??"}.gsuiIcon[data-icon=help]::before{content:"?"}.gsuiIcon[data-icon=help]::after{content:"??"}.gsuiIcon[data-icon=changelog]::before{content:"?"}.gsuiIcon[data-icon=changelog]::after{content:"??"}.gsuiIcon[data-icon=about]::before{content:"?"}.gsuiIcon[data-icon=about]::after{content:"??"}.gsuiIcon[data-icon=keyboard]::before{content:"?"}.gsuiIcon[data-icon=keyboard]::after{content:"??"}gsui-daw{--gsuiDAW-bg:#444;--gsuiDAW-content-bg:#222;--gsuiDAW-color:#fff;--gsuiDAW-playPauseStop-bg:#67a;--gsuiDAW-save-bg:#ba5d5d;--gsuiDAW-currentTime-bg:#0003;--gsuiDAW-currentTime-lineColor:#abd;--gsuiDAW-currentTime-lineBgColor:#222;--gsuiDAW-btn-bg:#ffffff1a;--gsuiDAW-head-winBtn-bg:#222;--gsuiDAW-head-winBtn-open-bg:#ff9;--gsuiDAW-export-color:#ff9;--gsuiDAW-about-color:#ff9;--gsuiDAW-dropdown-shadow:20px 10px #0006;--gsuiDAW-history-bg:#777;--gsuiDAW-history-action-bg:#454750;--gsuiDAW-history-action-color:#ddd;--gsuiDAW-history-action-light-bg:#67a;--gsuiDAW-history-action-lightoff-bg:#1a1a1a;--gsuiDAW-cmps-color:#9ad;--gsuiDAW-cmps-btn-bg:#444;--gsuiDAW-cmps-btn-newCmp-color:#ff9;--gsuiDAW-cmp-cloud-bg:#4c71af;--gsuiDAW-cmp-local-bg:#67a;--gsuiDAW-cmp-text:#fff;--gsuiDAW-cmp-height:42px;--gsuiDAW-cmp-text-size:18px;--gsuiDAW-winBtn-bg:#0004;--gsuiDAW-winBtn-chan-color:#ce93d8;--gsuiDAW-winBtn-synth-color:#a5d6a7;--gsuiDAW-winBtn-slices-color:#e29d8a;--gsuiDAW-winBtn-pattern-color:#81d4fa;--radius:4px;--gap:4px;display:flex;flex-direction:column;position:relative;box-sizing:border-box;width:100%;height:100%;color:var(--gsuiDAW-color);font-size:16px;background-color:var(--gsuiDAW-bg)}.gsuiDAW-head{display:grid;padding:var(--gap);gap:var(--gap);grid-template:"areaUser    areaCtrl    areaHist    areaHelp"28px"areaSave    areaTime    areaWins    areaVers"20px/min-content min-content min-content 1fr}.gsuiDAW-area{display:flex;gap:inherit}.gsuiDAW-resources{display:flex;width:300px;min-width:330px;max-width:700px;border-right:3px solid #555;background-color:#444;transition:margin-left .2s}.gsuiDAW-resources-closed{margin-left:calc(var(--gsuiDAW-panel-margin, 0 ) - 3px)}.gsuiDAW-libraries{flex:1;border:inherit;border-right-width:2px}.gsuiDAW-patterns{flex:1}.gsuiDAW-windows{flex:1;z-index:0;background-color:var(--gsuiDAW-content-bg);background-image:url("data:image/svg+xml,%3Csvg width='6' height='6' viewBox='0 0 6 6' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23000000' fill-opacity='0.2' fill-rule='evenodd'%3E%3Cpath d='M5 0h1L0 6V5zM6 5v1H5z'/%3E%3C/g%3E%3C/svg%3E");background-attachment:local}.gsuiDAW .gsuiDrums,.gsuiDAW .gsuiPatternroll,.gsuiDAW .gsuiPianoroll,.gsuiDAW .gsuiSynthesizer{height:100%;outline:0}.gsuiDAW .gsuiWindow[data-id=mixer] .gsuiWindow-content{overflow-y:hidden}.gsuiDAW-winBtn{height:16px;padding:0 6px;max-width:110px;border:0;outline:0;cursor:pointer;overflow:hidden;border-radius:3px;line-height:1;color:inherit;font-size:10px;font-weight:700;font-family:inherit;white-space:nowrap;text-overflow:ellipsis;background-color:var(--gsuiDAW-winBtn-bg);transition:filter .2s}.gsuiDAW-winBtn:focus,.gsuiDAW-winBtn:hover{filter:brightness(1.1)}.gsuiDAW-winBtn:empty::before{content:"Untitled";font-style:italic}.gsuiDAW-winBtn .gsuiIcon,.gsuiDAW-winBtn span{pointer-events:none}.gsuiDAW-winBtn .gsuiIcon+span{margin-left:4px}.gsuiDAW-winBtn+.gsuiIcon{margin:0 6px;pointer-events:none}.gsuiDAW-winBtn[data-target=channel],.gsuiDAW-winBtn[data-target=synthChannel]{color:var(--gsuiDAW-winBtn-chan-color)}.gsuiDAW-winBtn[data-target=drums],.gsuiDAW-winBtn[data-target=pianoroll]{color:var(--gsuiDAW-winBtn-pattern-color)}.gsuiDAW-winBtn[data-target=synth]{color:var(--gsuiDAW-winBtn-synth-color)}.gsuiDAW-winBtn[data-target=slices]{color:var(--gsuiDAW-winBtn-slices-color)}.gsuiDAW-btn{display:inline-flex;align-items:center;justify-content:center;border:0;padding:0;outline:0;color:inherit;cursor:pointer;font-size:14px;text-decoration:none;border-radius:var(--radius);background:0 0;transition:.2s;transition-property:color,opacity,background-color;user-select:none}.gsuiDAW-btn.gsuiIcon{width:28px}.gsuiDAW-btn:not(.gsuiDAW-btnColor):hover{color:#fff;opacity:1}.gsuiDAW-btnBg{background-color:var(--gsuiDAW-btn-bg)}.gsuiDAW-btnBg:hover{background-color:#fff3}.gsuiDAW-btnColor{color:var(--gsui-color)}.gsuiDAW-btnColor:hover{color:var(--gsuiDAW-bg);background-color:var(--gsui-color)}.gsuiDAW-btns{display:flex;border-radius:var(--radius)}.gsuiDAW-btns .gsuiDAW-btn:first-child{border-top-right-radius:0;border-bottom-right-radius:0}.gsuiDAW-btns .gsuiDAW-btn:last-child{border-top-left-radius:0;border-bottom-left-radius:0}.gsuiDAW-btns .gsuiDAW-btn:not(:first-child):not(:last-child){border-radius:0}.gsuiDAW-cmp{box-sizing:border-box;display:flex;color:var(--gsuiDAW-cmp-text);height:var(--gsuiDAW-cmp-height);font-size:var(--gsuiDAW-cmp-text-size);line-height:var(--gsuiDAW-cmp-height);background-color:var(--gsuiDAW-cmp-bg);filter:brightness(.9)}.gsuiDAW-dropdown-list[data-list=local] .gsuiDAW-cmp{--gsuiDAW-cmp-bg:var( --gsuiDAW-cmp-local-bg )}.gsuiDAW-dropdown-list[data-list=cloud] .gsuiDAW-cmp{--gsuiDAW-cmp-bg:var( --gsuiDAW-cmp-cloud-bg )}.gsuiDAW-cmp:nth-child(odd){filter:brightness(.85)}.gsuiDAW-cmp.gsuiDAW-cmp-loaded{filter:none}.gsuiDAW-cmp-btn{border:0;color:inherit;cursor:pointer;font-size:16px;background:0 0}.gsuiDAW-cmp-btn-light{opacity:.7;padding:0 8px;transition:.2s opacity}.gsuiDAW-cmp-btn-light:focus,.gsuiDAW-cmp-btn-light:hover{opacity:1}.gsuiDAW-cmp-btn[data-action=cmp-save]{width:32px;margin-left:-32px;background-color:var(--gsuiDAW-save-bg);transition:.2s;transition-property:margin-left,color,background-color}gsui-daw:not([saved]) .gsuiDAW-cmp-loaded .gsuiDAW-cmp-btn[data-action=cmp-save]{margin-left:0}.gsuiDAW-cmp-btn[data-action=cmp-save]:hover{color:var(--gsuiDAW-save-bg);background-color:var(--gsuiDAW-cmp-text)}.gsuiDAW-cmp-info{flex:1;display:flex;align-items:flex-start;flex-direction:column;justify-content:space-between;padding:6px 6px 4px;overflow:hidden;text-decoration:none;color:inherit;font-size:13px;line-height:1em;transition:.2s;transition-property:padding-left,opacity;opacity:.7}.gsuiDAW-cmp-info:focus,.gsuiDAW-cmp-info:hover,.gsuiDAW-cmp-loaded .gsuiDAW-cmp-info{opacity:1}.gsuiDAW-cmp-info>div{pointer-events:none;white-space:nowrap;text-overflow:ellipsis;overflow:hidden}.gsuiDAW-cmp-name{max-width:100%;font-weight:700;border-radius:2px;padding-right:.4ch;transition:.2s;transition-property:box-shadow,color,background-color}.gsuiDAW-cmp-info:focus .gsuiDAW-cmp-name,.gsuiDAW-cmp-info:hover .gsuiDAW-cmp-name{color:var(--gsuiDAW-cmp-bg);box-shadow:0 0 0 2px var(--gsuiDAW-cmp-text);background-color:var(--gsuiDAW-cmp-text)}gsui-daw:not([saved]) .gsuiDAW-cmp-loaded .gsuiDAW-cmp-name::before,gsui-daw:not([saved]) .gsuiDAW-currCmp-name::before{content:"*"}.gsuiDAW-cmp-name:empty::after{font-style:italic;content:"Untitled"}.gsuiDAW-cmp-bpm-wrap,.gsuiDAW-cmp-duration-wrap{display:inline-flex;align-items:center;font:14px var(--gsui-font-number)}.gsuiDAW-cmp-duration-wrap{margin-right:10px}.gsuiDAW-cmp-info .gsuiIcon{margin-right:4px;opacity:.4}.gsuiDAW-dropdown{position:absolute;overflow:hidden;display:grid;z-index:1;top:calc(60px + var(--gap));height:320px;grid-template-rows:32px 1fr;box-sizing:border-box;outline:0;border:2px solid #444;border-radius:var(--radius);opacity:0;visibility:hidden;transition:.2s;transition-property:opacity,visibility}.gsuiDAW-dropdown:focus{border-color:#69b}.gsuiDAW-dropdown:focus-within{z-index:2}.gsuiDAW-dropdown-btn:focus+.gsuiDAW-dropdown,.gsuiDAW-dropdown:focus-within{opacity:1;visibility:visible}.gsuiDAW-dropdown-head{display:flex;align-items:center;color:#222;font-size:14px;border-radius:inherit inherit 0 0;background-color:#888;user-select:none}.gsuiDAW-dropdown-icon{margin:0 6px;font-size:16px}.gsuiDAW-dropdown-title{font-weight:700}.gsuiDAW-dropdown-list{position:relative;overflow:auto;background-color:#444}.gsuiDAW-dropdown-backdrop{position:absolute;inset:68px 0 0;opacity:0;background-color:#0004;visibility:hidden;transition:.4s;transition-property:visibility,opacity}.gsuiDAW-dropdown-btn:focus~.gsuiDAW-dropdown-backdrop,.gsuiDAW-dropdown:focus-within+.gsuiDAW-dropdown-backdrop{visibility:visible;opacity:1}.gsuiDAW-dropdown-placeholder{position:absolute;display:none;inset:32px 10px auto;align-items:center;justify-content:center;text-align:center;font-size:12px;font-style:italic;opacity:.5;user-select:none}.gsuiDAW-dropdown-placeholder:only-child{display:flex}.gsuiDAW-areaUser{grid-area:areaUser}.gsuiDAW-title{align-self:center;margin-right:var(--gap);font-size:28px;font-family:var(--gsui-font-title);user-select:none}.gsuiDAW-btn[data-action=profile]{width:32px;border:2px solid #222;box-sizing:border-box;background-size:cover;background-color:#fff4}.gsuiDAW-btn[data-action=login]{opacity:.7}.gsuiDAW-btn[data-action=logout]{font-size:24px;opacity:.7}.gsuiDAW-btn[data-action=login]{font-size:22px}.gsuiDAW-cmps{display:flex}.gsuiDAW-btn[data-action=cmps]{font-size:18px;--gsui-color:var( --gsuiDAW-cmps-color )}.gsuiDAW-cmps .gsuiDAW-dropdown{left:var(--gap);width:480px;grid-template-columns:1fr 1fr;box-shadow:2px var(--gsuiDAW-dropdown-shadow)}.gsuiDAW-dropdown-list[data-list=cloud]{border-left:2px solid #0001}gsui-daw:not([logged]) .gsuiDAW-dropdown-list[data-list=cloud] .gsuiDAW-dropdown-placeholder span:first-child,gsui-daw[logged] .gsuiDAW-dropdown-list[data-list=cloud] .gsuiDAW-dropdown-placeholder span:last-child{display:none}.gsuiDAW-cmps-btn{height:20px;padding:0 8px;margin-left:8px;border:0;outline:0;border-radius:3px;color:var(--gsuiDAW-cmps-btn-newCmp-color);font-size:12px;font-weight:700;font-family:inherit;line-height:1;background-color:var(--gsuiDAW-cmps-btn-bg);cursor:pointer;transition:filter .2s}.gsuiDAW-cmps-btn:focus,.gsuiDAW-cmps-btn:hover{filter:brightness(1.1)}.gsuiDAW-cmps-btn-icon,.gsuiDAW-cmps-btn-text{pointer-events:none}.gsuiDAW-cmps-btn-text{margin-left:4px}gsui-daw:not([logged]) .gsuiDAW-cmps-btn[data-action=cloudNewCmp]{color:#888;pointer-events:none}.gsuiDAW-areaSave{grid-area:areaSave;display:flex;width:260px;background-color:var(--gsuiDAW-playPauseStop-bg)}.gsuiDAW-currCmp-saveBtn{color:#fff;background-color:var(--gsuiDAW-save-bg);transition:.2s;transition-property:margin-left,color,background-color,visibility}gsui-daw[saved] .gsuiDAW-currCmp-saveBtn{visibility:hidden;margin-left:-32px}.gsuiDAW-currCmp-saveBtn:hover{color:var(--gsuiDAW-save-bg);background-color:#fff}.gsuiDAW-currCmp-editBtn{flex:1;display:flex;overflow:hidden;align-items:center;justify-content:start;font-family:inherit;padding:0 4px;font-size:14px}.gsuiDAW-currCmp-localIcon{display:none;margin-right:.3em;pointer-events:none}gsui-daw[saved] .gsuiDAW-currCmp-localIcon{display:inline-block}.gsuiDAW-currCmp-name{overflow:hidden;white-space:nowrap;text-overflow:ellipsis;text-align:left;padding-right:.4ch;pointer-events:none}.gsuiDAW-currCmp-name:empty::after{content:"Untitled";font-style:italic;padding-right:1px;opacity:.8}.gsuiDAW-currCmp-editIcon{width:0;display:inline-block;overflow:hidden;position:relative;pointer-events:none;transition:.1s;transition-property:width,margin-left}.gsuiDAW-currCmp-editBtn:hover .gsuiDAW-currCmp-editIcon{width:1.4ch;margin-left:4px}.gsuiDAW-currCmp-dur{pointer-events:none}.gsuiDAW-currCmp-dur::before{content:"·";margin:4px}.gsuiDAW-areaCtrl{grid-area:areaCtrl}.gsuiDAW-playPauseStop{background-color:var(--gsuiDAW-playPauseStop-bg)}.gsuiDAW-volume{width:6px;--gsuiSlider-lineRadius:4px;--gsuiSlider-lineColor:var( --gsuiDAW-playPauseStop-bg );--gsuiSlider-lineBgColor:#222}.gsuiDAW-volume .gsuiSlider-eventCatcher{left:-12px;right:calc(var(--gap)*-1)}.gsuiDAW-focusBtn{display:flex;position:relative;flex-direction:column;justify-content:space-between;padding:7px 3px 7px 8px}.gsuiDAW-focusBtn span{width:5px;height:5px;border-radius:1px;background-color:currentColor;pointer-events:none;opacity:.4}gsui-daw[focus=down] .gsuiDAW-focusBtn span:last-child,gsui-daw[focus=up] .gsuiDAW-focusBtn span:first-child{opacity:1}.gsuiDAW-btn[data-action=stop]{margin-left:-3px}.gsuiDAW-btn[data-action=reset]{margin-left:-2px}gsui-daw gsui-clock,gsui-daw gsui-spectrum{border-radius:var(--radius)}.gsuiDAW-tempo{white-space:nowrap;background-color:#222}.gsuiDAW-tempo-bpm,.gsuiDAW-tempo-timeDivision{display:flex;font-family:var(--gsui-font-number);pointer-events:none}.gsuiDAW-tempo-timeDivision{align-items:center;flex-direction:column;justify-content:space-between;height:32%;padding:0 6px 0 8px;font-size:12px;line-height:0}.gsuiDAW-tempo-bpm{align-items:baseline;padding-right:7px;font-size:18px}.gsuiDAW-tempo-bpm::after{content:"bpm";margin-left:2px;font-size:12px;opacity:.5}.gsuiDAW-areaTime{grid-area:areaTime;padding:8px;border-radius:var(--radius);background-color:var(--gsuiDAW-currentTime-bg)}.gsuiDAW-areaTime gsui-slider{--gsuiSlider-lineColor:var( --gsuiDAW-currentTime-lineColor );--gsuiSlider-lineBgColor:var( --gsuiDAW-currentTime-lineBgColor )}.gsuiDAW-areaTime .gsuiSlider-eventCatcher{inset:-10px}.gsuiDAW-areaHist{grid-area:areaHist}.gsuiDAW-history{background-color:var(--gsuiDAW-history-bg)}.gsuiDAW-btn[data-action=redo]{margin-left:-4px}.gsuiDAW-btn[data-action=undoMore]{width:auto;padding:0 6px 0 3px}gsui-daw gsui-spectrum{flex:1;width:140px;min-width:48px;background-color:#000}.gsuiDAW-btn[data-action=export]{--gsui-color:var( --gsuiDAW-export-color )}.gsuiDAW-history .gsuiDAW-dropdown{left:450px;width:360px;box-shadow:2px var(--gsuiDAW-dropdown-shadow)}.gsuiDAW-history-action{display:flex;box-sizing:border-box;align-items:center;cursor:pointer;height:30px;padding:0 6px;color:var(--gsuiDAW-history-action-color);font-size:14px;font-family:var(--gsui-font-monospace);user-select:none;background-color:var(--gsuiDAW-history-action-bg);transition:filter .2s}.gsuiDAW-history-action:hover{filter:brightness(1.3)}.gsuiDAW-history-action::before{content:"";display:block;width:6px;height:6px;border-radius:50%;transition:inherit;background-color:var(--gsuiDAW-history-action-light-bg);pointer-events:none}.gsuiDAW-history-action[data-undone]:not(:hover)::before{background-color:var(--gsuiDAW-history-action-lightoff-bg)}.gsuiDAW-history-action-icon{width:1.4ch;margin:0 6px;text-align:center;pointer-events:none}.gsuiDAW-history-action-text{flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;transition-duration:inherit;transition-property:opacity;pointer-events:none}.gsuiDAW-history-action[data-undone] .gsuiDAW-history-action-icon,.gsuiDAW-history-action[data-undone] .gsuiDAW-history-action-text{opacity:.6}.gsuiDAW-areaWins{grid-area:areaWins;white-space:nowrap;gap:0}.gsuiDAW-areaWins .gsuiDAW-btn{flex:1;font-size:11px;background-color:var(--gsuiDAW-head-winBtn-bg)}.gsuiDAW-areaWins .gsuiDAW-btn+.gsuiDAW-btn{margin-left:0;border-left:1px dashed rgba(0,0,0,.2)}.gsuiDAW-areaWins .gsuiDAW-btn[data-open]{color:var(--gsuiDAW-bg);background-color:var(--gsuiDAW-head-winBtn-open-bg)}.gsuiDAW-areaHelp,.gsuiDAW-areaVers{grid-area:areaHelp;justify-content:end}.gsuiDAW-btn[data-action=about]{--gsui-color:var( --gsuiDAW-about-color )}.gsuiDAW-areaVers{grid-area:areaVers}.gsuiDAW-version{font-family:var(--gsui-font-number);opacity:.3}.gsuiDAW-changelog.gsuiIcon{width:auto}.gsuiDAW-changelog{opacity:.3}.gsuiDAW-version:focus,.gsuiDAW-version:hover{opacity:1}.gsuiDAW-popup-auth{width:340px}.gsuiDAW-popup-auth a{font-size:11px}.gsuiDAW-popup-auth-error{margin-top:12px;font-size:12px;color:#ed9a8b}.gsuiDAW-popup-auth-error:empty{display:none}.gsuiDAW-popup-open{width:460px}.gsuiDAW-popup-open .gsuiPopup-row-values{width:200px}.gsuiDAW-popup-about{width:450px;text-align:center}.gsuiDAW-popup-about>div{margin-bottom:16px}.gsuiDAW-popup-about a{color:#ccf;font-weight:700}.gsuiDAW-popup-about-head{display:flex;align-items:baseline;justify-content:center;font-size:18px;gap:4px}.gsuiDAW-popup-about-title{font:32px var(--gsui-font-title)}.gsuiDAW-popup-about-versionNum{opacity:.8;font-family:var(--gsui-font-number)}.gsuiDAW-popup-about-versionCheck{font-size:11px;font-weight:700;opacity:.4;cursor:pointer;transition:.2s opacity}.gsuiDAW-popup-about-links a:hover,.gsuiDAW-popup-about-versionCheck:hover{opacity:1}.gsuiDAW-popup-about-links{display:flex}.gsuiDAW-popup-about-links a{flex:1;padding:20px 0;color:#fff;font-size:36px;font-weight:400;opacity:.5;transition:.4s;transition-property:opacity}.gsuiDAW-popup-about-links a:hover::before{top:-4px;left:4px;text-shadow:-4px 4px 2px rgba(0,0,0,.2)}.gsuiDAW-popup-about-links a::before{position:relative;top:0;left:0;transition:.2s;transition-property:top,left,text-shadow}.gsuiDAW-popup-about-links:hover a:not(:hover){opacity:.3}.gsuiDAW-popup-tempo{width:400px}.gsuiDAW-popup-tempo .gsuiPopup-row-values{width:180px}.gsuiDAW-bpmTap{display:flex;align-self:normal;align-items:center;justify-content:center;cursor:pointer;color:inherit;width:32px;min-width:32px;font-size:18px;border-radius:4px;background-color:#fff2}.gsuiDAW-bpmTap:hover{background-color:#fff3}.gsuiDAW-popup-export{width:500px}.gsuiDAW-popup-export-wrap{display:flex;padding:10px 0}.gsuiDAW-popup-export-progress{flex:1;height:28px}.gsuiDAW-popup-export-btn{padding:0 .8em;border-radius:2px;margin-right:10px;font-size:12px;line-height:28px;font-weight:700;text-decoration:none;background-color:#ff9}.gsuiDAW-popup-export-btn>span{display:none;color:#111}.gsuiDAW-popup-export-btn[data-status="0"] .gsuiDAW-popup-export-btn0,.gsuiDAW-popup-export-btn[data-status="1"] .gsuiDAW-popup-export-btn1,.gsuiDAW-popup-export-btn[data-status="2"] .gsuiDAW-popup-export-btn2{display:inline}.gsuiDAW-popup-export-btn .gsuiIcon{margin-left:.3em}.gsuiDAW-popup-settings{width:480px}.gsuiDAW-popup-settings .gsuiPopup-row-values{width:200px}.gsuiDAW-uiRateFps{font-size:16px;font-family:var(--gsui-font-number);white-space:pre}.gsuiDAW-uiRateFps::after{content:" fps";font-family:var(--gsui-font);font-size:12px;opacity:.6}.gsuiDAW-popup-settings input[name=uiRateFPS]{min-width:0}gsui-dragshield{position:absolute;z-index:2147483647;inset:0;pointer-events:none}.gsuiDragshield-show{pointer-events:auto}gsui-timeline{--gsuiTimeline-bg:#222;--gsuiTimeline-color:#fff;--gsuiTimeline-loop-bg:#656586;--gsuiTimeline-lines-bg:#ffffff07;--gsuiTimeline-cursor-fill:#fff;--gsuiTimeline-loopBorder-bg:#fff;position:relative;display:block;height:100%;color:var(--gsuiTimeline-color);background-color:var(--gsuiTimeline-bg);--gsuiTimeline-beats-offset:0;--gsuiTimeline-beats-incr:1;--gsuiTimeline-beats-per-measure:4}:root{--gsuiTimeline-numbering:1}.gsuiTimeline-beats,.gsuiTimeline-steps{position:absolute;inset:calc(50% - 1px)0 auto;height:2px;pointer-events:none;background-repeat:no-repeat}.gsuiTimeline-beats{top:calc(50% - 2px);height:4px;margin-left:1px;background-image:repeating-linear-gradient(90deg,transparent 0,transparent calc(1em - 2px),currentColor calc(1em - 2px),currentColor calc(1em),transparent calc(1em))}.gsuiTimeline-measures{display:flex;height:100%;counter-reset:beat calc(var(--gsuiTimeline-beats-offset) - var(--gsuiTimeline-beats-incr) + var(--gsuiTimeline-numbering));pointer-events:none}.gsuiTimeline-measure{counter-increment:beat var(--gsuiTimeline-beats-incr);display:inline-block;margin-left:calc(var(--gsuiTimeline-beats-incr)*var(--gsuiTimeline-beats-per-measure)*1em)}.gsuiTimeline-measure:first-child{margin-left:calc(var(--gsuiTimeline-beats-offset)*var(--gsuiTimeline-beats-per-measure)*1em)}.gsuiTimeline-measure::before{content:"";position:absolute;margin-left:-2px;width:4px;height:100%;background-color:var(--gsuiTimeline-bg)}.gsuiTimeline-measure::after{display:flex;content:counter(beat);position:absolute;inset:0 auto;width:52px;margin-left:-26px;align-items:center;justify-content:center;font-size:14px;font-family:var(--gsui-font-number);opacity:var(--gsuiTimeline-measures-opacity, 0 )}.gsuiTimeline-measureBig::after{font-weight:700;opacity:1}.gsuiTimeline-loopLine,.gsuiTimeline-timeLine{position:absolute;inset:0 0 50%;transition:.2s background-color}.gsuiTimeline-draggingLoopBody .gsuiTimeline-loopLine,.gsuiTimeline-draggingLoopHandleA .gsuiTimeline-loopLine,.gsuiTimeline-draggingLoopHandleB .gsuiTimeline-loopLine,.gsuiTimeline-draggingTime .gsuiTimeline-timeLine,.gsuiTimeline-loopLine:hover,.gsuiTimeline-timeLine:hover{background-color:var(--gsuiTimeline-lines-bg)}.gsuiTimeline-timeLine{top:50%;bottom:0}.gsuiTimeline-cursor,.gsuiTimeline-cursorPreview{position:absolute;margin-left:-8px;bottom:1px;fill:var(--gsuiTimeline-cursor-fill);stroke:var(--gsuiTimeline-cursor-fill);stroke-width:2px;stroke-linejoin:round;pointer-events:none}.gsuiTimeline-cursorPreview{opacity:.5}.gsuiTimeline-loop{position:absolute;height:6px;transition:.1s;transition-property:opacity,visibility;opacity:0;visibility:hidden}.gsuiTimeline-looping .gsuiTimeline-loop{opacity:1;visibility:visible}.gsuiTimeline-loopBody{height:100%;transition:filter .2s;background-color:var(--gsuiTimeline-loop-bg)}.gsuiTimeline-draggingLoopBody .gsuiTimeline-loopBody,.gsuiTimeline-loopBody:hover{filter:brightness(1.2)}.gsuiTimeline-loopHandle{position:absolute;inset:0 auto -6px;width:25%;min-width:7px;max-width:12px}.gsuiTimeline-loopHandleA{left:-5px}.gsuiTimeline-loopHandleB{right:-5px}.gsuiTimeline-loopBorder{position:absolute;inset:0 auto;width:2px;transition:.2s;transition-property:bottom,background-color;pointer-events:none}.gsuiTimeline-loopBorderA{left:0}.gsuiTimeline-loopBorderB{right:0}.gsuiTimeline-draggingLoopHandleA .gsuiTimeline-loopBorderA,.gsuiTimeline-draggingLoopHandleB .gsuiTimeline-loopBorderB,.gsuiTimeline-loopHandle:hover+.gsuiTimeline-loopBorder{bottom:-3px;background-color:var(--gsuiTimeline-loopBorder-bg)}gsui-timewindow{--gsuiTimewindow-bg:#456168;--gsuiTimewindow-loop-bg:#0004;--gsuiTimewindow-panel-border:#222;--gsuiTimewindow-currentTime-fill:var( --gsui-col-currentTimeCursor );position:relative;z-index:0;display:flex;align-items:start;width:100%;height:100%;overflow:auto;background-color:var(--gsuiTimewindow-bg);scrollbar-width:none}gsui-drumrows::-webkit-scrollbar,gsui-timewindow::-webkit-scrollbar{display:none}gsui-slicer[disabled],gsui-timewindow[disabled]{overflow:hidden;pointer-events:none;filter:grayscale(1) brightness(.4)}.gsuiTimewindow-main,.gsuiTimewindow-panel{display:flex;min-height:100%;flex-direction:column}.gsuiTimewindow-main{z-index:0}.gsuiTimewindow-panel{position:sticky;z-index:1;left:0;border-right:1px solid var(--gsuiTimewindow-panel-border);background-color:var(--gsui-items-bg)}.gsuiTimewindow-panelUp,.gsuiTimewindow-time{position:sticky;z-index:2;top:0;height:32px}.gsuiTimewindow-panelUp{box-sizing:border-box;display:flex;align-items:center;justify-content:flex-end;padding-right:4px;border-bottom:2px solid #0005;background-color:var(--gsui-head-bg)}.gsuiTimewindow-mainBody,.gsuiTimewindow-panelContent{flex:1}.gsuiTimewindow-mainBody{width:1000000px}.gsuiTimewindow-mainContent{position:relative;z-index:0}.gsuiTimewindow-contentDown,.gsuiTimewindow-panelContentDown{position:sticky;bottom:0;height:96px;overflow:hidden;background-color:var(--gsuiTimewindow-bg);box-shadow:0-1px var(--gsuiTimewindow-panel-border)}.gsuiTimewindow-panelContentDown{background-color:inherit}.gsuiTimewindow-panelExtend{position:absolute}.gsuiTimewindow-panelExtendX{inset:-2px 0 auto;height:6px;cursor:ns-resize}.gsuiTimewindow-panelExtendY{inset:0-2px 0 auto;width:6px;cursor:ew-resize}gsui-timewindow gsui-timeline{--gsuiTimeline-cursor-fill:var( --gsuiTimewindow-currentTime-fill )}.gsuiTimewindow-currentTime,.gsuiTimewindow-loop{position:absolute;z-index:1;inset:0 auto;pointer-events:none}.gsuiTimewindow-currentTime{width:2px;margin-left:-1px;background-color:var(--gsuiTimewindow-currentTime-fill)}gsui-timewindow[currenttime="0"] .gsuiTimewindow-currentTime{display:none}.gsuiTimewindow-loop{opacity:0;transition:.2s opacity;background-color:var(--gsuiTimewindow-loop-bg)}.gsuiTimewindow-looping .gsuiTimewindow-loop{opacity:1}.gsuiTimewindow-loopA{left:0}.gsuiTimewindow-loopB{right:0}.gsuiTimewindow-step{display:flex;align-items:center;border:0;outline:0;padding:4px;border-radius:4px;font-size:inherit;font-family:var(--gsui-font-number);color:inherit;cursor:pointer;background:0 0;user-select:none;opacity:.5;transition:.2s opacity}.gsuiTimewindow-step:focus,.gsuiTimewindow-step:hover{opacity:1}.gsuiTimewindow-stepValue{white-space:nowrap;margin-right:6px}gsui-analyser,gsui-spectrum{display:flex;position:relative;overflow:hidden;background-color:#000}gsui-analyser canvas,gsui-spectrum canvas{position:absolute;width:100%;height:100%;filter:saturate(.5) contrast(.8)}gsui-envelope-graph{transition:color .2s}gsui-envelope-graph svg{width:100%;height:100%;stroke:currentColor;stroke-width:2px}.gsuiEnvelopeGraph-line{fill:transparent}.gsuiEnvelopeGraph-mainLine{stroke-dasharray:12 4;stroke-opacity:.5;fill:currentColor;fill-opacity:.1}gsui-envelope,gsui-lfo{display:grid;height:100%;min-height:76px;box-sizing:border-box;padding:6px;grid-gap:6px;font-family:var(--gsui-font);background-color:var(--gsui-item-bg)}gsui-envelope{--gsuiEnvelope-wave-bg:#0004;--gsuiEnvelope-wave-off:#777;--gsuiEnvelope-ctrls-color:#ff9;grid-template:"attack hold  decay sustain release"28px"graph  graph graph graph   graph  "1fr/1fr 1fr 1fr 1fr 1fr;--gsuiSlider-lineColor:var( --gsuiEnvelope-ctrls-color )}.gsuiEnvelope-prop{display:flex;flex-direction:column}.gsuiEnvelope-propLabel{display:flex;align-self:center;align-items:baseline;height:20px;font-size:12px;opacity:.5;user-select:none}.gsuiEnvelope-propValue::before{content:"·";margin:0 2px}.gsuiEnvelope-propValue{font-family:var(--gsui-font-number)}.gsuiEnvelope-propContent{flex:1;position:relative}.gsuiEnvelope-attack{grid-area:attack}.gsuiEnvelope-hold{grid-area:hold}.gsuiEnvelope-decay{grid-area:decay}.gsuiEnvelope-sustain{grid-area:sustain}.gsuiEnvelope-release{grid-area:release}gsui-envelope .gsuiSlider-eventCatcher{top:-26px;bottom:-6px}.gsuiEnvelope-graph{grid-area:graph;position:relative;overflow:hidden;border-radius:4px;background-color:var(--gsuiEnvelope-wave-bg)}gsui-envelope gsui-envelope-graph{position:absolute;inset:4px 0 0;color:var(--gsuiEnvelope-wave-off)}gsui-envelope[toggle] gsui-envelope-graph{color:var(--gsuiEnvelope-ctrls-color)}gsui-lfo{--gsuiLFO-wave-bg:#0004;--gsuiLFO-wave-off:#777;--gsuiLFO-ctrls-bg:#555;min-width:300px;grid-template:"type delay attack speed amp  "28px"type graph graph  graph graph"1fr/32px 1fr 1fr 1fr 1fr;--gsuiSlider-lineColor:var( --gsuiLFO-ctrls-color );--gsuiLFO-ctrls-color:var( --gsui-col-gain )}.gsuiLFO-prop{display:flex;flex-direction:column}.gsuiLFO-propLabel{display:flex;align-self:center;align-items:baseline;height:20px;font-size:12px;opacity:.5;user-select:none}.gsuiLFO-propValue::before{content:"·";margin:0 2px}.gsuiLFO-propValue{font-family:var(--gsui-font-number)}.gsuiLFO-propContent{flex:1;position:relative}.gsuiLFO-btn{position:relative;cursor:pointer}.gsuiLFO-btnInput{position:absolute;visibility:hidden}.gsuiLFO-btnIcon{position:absolute;inset:0;width:100%;height:100%;display:flex;align-items:center;justify-content:center}.gsuiLFO-delay{grid-area:delay}.gsuiLFO-attack{grid-area:attack}.gsuiLFO-speed{grid-area:speed}.gsuiLFO-amp{grid-area:amp}gsui-lfo .gsuiSlider-eventCatcher{top:-26px;bottom:-6px}.gsuiLFO-graph{grid-area:graph;position:relative;overflow:hidden;border-radius:4px;background-color:var(--gsuiLFO-wave-bg)}.gsuiLFO-ampSigns{position:absolute;inset:0;width:10px;display:flex;pointer-events:none;flex-direction:column}gsui-lfo[toggle] .gsuiLFO-ampSigns{pointer-events:auto}.gsuiLFO-ampSign{flex:1;background-color:var(--gsui-slider-bg-opaque)}gsui-lfo[toggle] .gsuiLFO-ampSign,gsui-lfo[toggle] .gsuiLFO-ampSignIcon,gsui-lfo[toggle] gsui-periodicwave{color:var(--gsuiLFO-ctrls-color)}.gsuiLFO-ampSignIcon{color:var(--gsuiLFO-wave-off);font-size:11px}.gsuiLFO-ampSignRadio:checked+.gsuiLFO-ampSignIcon{color:var(--gsuiLFO-ctrls-bg);background-color:var(--gsuiLFO-wave-off)}gsui-lfo[toggle] .gsuiLFO-ampSignRadio:checked+.gsuiLFO-ampSignIcon,gsui-lfo[toggle] .gsuiLFO-typeRadio:checked+.gsuiLFO-typeSVG{background-color:var(--gsuiLFO-ctrls-color)}.gsuiLFO-wave{position:absolute;inset:0-2px 0 8px;pointer-events:none}.gsuiLFO-wave gsui-periodicwave{position:absolute;top:6px;height:calc(100% - 12px);color:var(--gsuiLFO-wave-off);stroke-width:2px;transition:color .2s}.gsuiLFO-type{grid-area:type}.gsuiLFO-type .gsuiLFO-propContent{display:flex;overflow:hidden;border-radius:4px;flex-direction:column}.gsuiLFO-typeBtn{flex:1;cursor:not-allowed;background-color:var(--gsuiSlider-lineBgColor)}gsui-lfo[toggle] .gsuiLFO-typeBtn{cursor:pointer}.gsuiLFO-typeSVG{fill:none;stroke:var(--gsuiLFO-wave-off);stroke-width:2px;transition:.2s;transition-property:stroke,background-color}gsui-lfo[toggle] .gsuiLFO-typeSVG{stroke:var(--gsuiLFO-ctrls-color)}.gsuiLFO-typeSVG path{transform:scale(.6);transform-origin:center}.gsuiLFO-typeRadio:checked+.gsuiLFO-typeSVG{stroke:var(--gsuiLFO-ctrls-bg);background-color:var(--gsuiLFO-wave-off)}gsui-drumrows{--gsuiDrumrow-pan:var( --gsui-col-pan );--gsuiDrumrow-gain:var( --gsui-col-gain );--gsuiDrumrow-detune:var( --gsui-col-detune );--gsuiDrumrow-border:#0002;--gsuiDrumrow-color:#fff;--gsuiDrumrow-grip-bg:#0001;--gsuiDrumrow-prop-bgHover:#fff2;display:flex;flex-direction:column;font-size:var(--gsuiTimewindow-lineH)}.gsuiDrumrows-drop{display:flex;align-items:center;justify-content:center;order:1;height:1em;pointer-events:none;opacity:0}gsui-drumrows.gsuiDrumrows-dragover>.gsuiDrumrows-drop{opacity:1}.gsuiDrumrows-dropIn{font-size:24px;opacity:.5}.gsuiDrumrow{--grip-w:16px;--toggle-w:20px;--name-h:16px;--propsExpand-w:16px;--delete-w:14px;--slider-w:7px;--props-h:1.5em;position:relative;box-sizing:border-box;height:1em;min-height:1em;border-top:2px solid #ffffff11;border-bottom:2px solid #0000003b;background-color:var(--gsui-item-bg);transition:.2s height,.2s min-height}.gsuiDrumrow-mute{border-color:transparent;background-color:var(--gsui-item-bg-disabled)}.gsuiDrumrow-open{height:calc(1em + 1px + var(--props-h));min-height:calc(1em + 1px + var(--props-h))}.gsuiDrumrow-main{position:absolute;box-sizing:border-box;inset:0 1px auto var(--grip-w);height:1em;min-height:1em}.gsuiDrumrow.gsuiDrumrows-dragover .gsuiDrumrow-main{opacity:0;pointer-events:none}.gsuiDrumrow-props{position:absolute;overflow:hidden;display:flex;align-items:center;justify-content:center;inset:1em 0 0 var(--grip-w);background-color:var(--gsui-item-more-bg)}.gsuiDrumrow-prop{outline:0;font-size:11px;font-weight:700;font-family:inherit;cursor:pointer}.gsuiDrumrow-propPan{--color:var( --gsuiDrumrow-pan )}.gsuiDrumrow-propGain{--color:var( --gsuiDrumrow-gain )}.gsuiDrumrow-propDetune{--color:var( --gsuiDrumrow-detune )}.gsuiDrumrow-prop+.gsuiDrumrow-prop{margin-left:4px}.gsuiDrumrow-propRadio{position:absolute;visibility:hidden}.gsuiDrumrow-propSpan{color:var(--color);padding:2px 4px;border-radius:3px;opacity:0;transition:.1s background-color,.2s opacity}.gsuiDrumrow-propSpanValue{font-size:14px;font-family:var(--gsui-font-number)}.gsuiDrumrow-open .gsuiDrumrow-propSpan{opacity:1}.gsuiDrumrow-propSpan:focus,.gsuiDrumrow-propSpan:hover{background-color:var(--gsuiDrumrow-prop-bgHover)}.gsuiDrumrow-propRadio:checked+.gsuiDrumrow-propSpan{color:var(--gsui-item-bg);background-color:var(--color)}.gsuiDrumrow-grip{position:absolute;width:var(--grip-w);inset:0 auto 0 0;display:flex;align-items:center;justify-content:center;font-size:12px;cursor:grab;background-color:var(--gsuiDrumrow-grip-bg)}.gsuiDrumrow-grip .gsuiIcon{pointer-events:none;opacity:.4}gsui-drumrows gsui-toggle{position:absolute;inset:0 auto auto 0;width:var(--toggle-w);height:var(--name-h)}.gsuiDrumrow-name{position:absolute;inset:0 calc(var(--delete-w) + var(--propsExpand-w) + 6px) auto var(--toggle-w);height:var(--name-h);line-height:var(--name-h);overflow:hidden;white-space:nowrap;text-overflow:ellipsis;font-size:12px;font-weight:700;pointer-events:none}.gsuiDrumrow-nameInfo{font-style:italic;font-weight:400;opacity:.7}.gsuiDrumrow-waveWrap{position:absolute;overflow:hidden;inset:var(--name-h) calc(var(--slider-w)*3 + 8px) 4px 0;pointer-events:none}.gsuiDrumrow-startCursor,.gsuiDrumrow-wave{position:absolute;inset:0 auto auto 0;width:100%;height:100%}.gsuiDrumrow-wave{fill:currentColor;opacity:.5}.gsuiDrumrow-startCursor{border-right:2px solid;background-image:linear-gradient(90deg,transparent 0,currentColor 300%);animation-name:gsuiDrumrow-startCursor-anim;animation-duration:inherit;animation-fill-mode:forwards;animation-timing-function:linear}.gsuiDrumrow-mute .gsuiDrumrow-startCursor{visibility:hidden}.gsuiDrumrow-detune,.gsuiDrumrow-gain,.gsuiDrumrow-pan{position:absolute;inset:var(--name-h) auto 4px;width:var(--slider-w)}.gsuiDrumrow .gsuiSlider-eventCatcher{inset:-2px}.gsuiDrumrow-detune{--gsuiSlider-lineColor:var( --gsuiDrumrow-detune );right:calc(2*var(--slider-w) + 6px)}.gsuiDrumrow-pan{--gsuiSlider-lineColor:var( --gsuiDrumrow-pan );right:calc(var(--slider-w) + 4px)}.gsuiDrumrow-gain{--gsuiSlider-lineColor:var( --gsuiDrumrow-gain );right:2px}.gsuiDrumrow .gsuiDrumrows-drop{position:absolute;inset:0}.gsuiDrumrow.gsuiDrumrows-dragover .gsuiDrumrows-drop{opacity:1}.gsuiDrumrow-btnDelete,.gsuiDrumrow-btnProps{position:absolute;right:0;border:0;outline:0;padding:0;height:var(--name-h);color:inherit;cursor:pointer;font-size:12px;background:0 0;transition:.1s opacity}.gsuiDrumrow-btnDelete{width:var(--delete-w);opacity:.3}.gsuiDrumrow-btnProps{right:calc(var(--delete-w) + 2px);width:var(--propsExpand-w);opacity:.5}.gsuiDrumrow-open .gsuiDrumrow-btnProps{text-shadow:0 0 6px;opacity:.8}.gsuiDrumrow .gsuiDrumrow-btnDelete:focus,.gsuiDrumrow .gsuiDrumrow-btnDelete:hover,.gsuiDrumrow .gsuiDrumrow-btnProps:focus,.gsuiDrumrow .gsuiDrumrow-btnProps:hover{opacity:1}gsui-drums{--gsuiDrums-drum-bg:rgba( var( --gsui-rgb-pattern ), .8 );--gsuiDrums-drum-color:#000;--gsuiDrums-drumprop-bg:#0002;--gsuiDrums-drumprop-color:#0004;--gsuiDrums-drumcut-bg:#48ad;--gsuiDrums-line-border:#2e4145;--gsuiDrums-line-mute-bg:#0003;--gsuiDrums-loop-bg:#000;--gsuiDrums-currentTime-bg:rgba( var( --gsui-rgb-currentTimeCursor ), .07 );--gsuiDrums-drumHover-border:var( --gsui-col-pattern );--gsuiDrums-drumHover-bg:rgba( var( --gsui-rgb-pattern ), .2 );height:100%}gsui-drums .gsuiTimewindow-currentTime{margin-left:0;opacity:.1}gsui-drums,gsui-drums gsui-timewindow[currenttime="0"] .gsuiTimewindow-currentTime{display:block}gsui-drums .gsuiTimewindow-step{display:none}.gsuiDrums-line.gsuiReorder-dragging{opacity:.5;background-color:#0004}.gsuiDrums-line{position:relative;width:1000000px;font-size:var(--gsuiTimewindow-lineH);height:1em;box-sizing:border-box;border-bottom:1px solid var(--gsuiDrums-line-border);transition:.2s height,.1s filter,.1s background-color}.gsuiDrums-lineOpen{height:calc(1em + 1.5em)}.gsuiDrums-line.gsuiDrumrow-mute{filter:brightness(.8) contrast(.8);background-color:var(--gsuiDrums-line-mute-bg)}.gsuiDrums-lineDrums{position:absolute;inset:0;height:1em}.gsuiDrums-lineIn{height:100%;box-sizing:border-box;border-bottom:1px dashed var(--gsuiDrums-line-border);font-size:var(--gsuiTimewindow-pxperbeat);cursor:pointer}.gsuiDrums-lineProps{position:absolute;inset:1em 0 0}.gsuiDrums-drumHover,.gsuiDrums-drumcutHover{position:absolute;z-index:1;background-color:#0002}.gsuiDrums-drumHover{height:66%}.gsuiDrums-drumcutHover{bottom:0;height:34%}.gsuiDrums-drumHoverIn,.gsuiDrums-drumcutHoverIn{box-sizing:border-box;height:100%;margin:0 1px 1px 0;border:2px solid var(--gsuiDrums-drumHover-border);border-radius:4px;background-color:var(--gsuiDrums-drumHover-bg);pointer-events:none}.gsuiDrums-drum,.gsuiDrums-drumcut{position:absolute;width:1em}.gsuiDrums-drum{height:66%}.gsuiDrums-drumcut{bottom:1px;height:calc(34% - 2px)}.gsuiDrums-preview,.gsuiDrums-previewDeleted{opacity:.4}.gsuiDrums-drumIn,.gsuiDrums-drumcutIn{display:flex;align-items:center;flex-direction:column;justify-content:center;height:100%;margin:0 1px 1px 0;border-radius:2px;color:var(--gsuiDrums-drum-color);background-color:var(--gsuiDrums-drum-bg);pointer-events:none}.gsuiDrums-drumcutIn{font-size:10px;background-color:var(--gsuiDrums-drumcut-bg)}.gsuiDrums-drumcutIn .gsuiIcon{opacity:.7}.gsuiDrums-drumProp{position:relative;width:100%;height:3px;background-color:var(--gsuiDrums-drumprop-bg);transition:.1s height}.gsuiDrums-lineOpen[data-prop=detune] .gsuiDrums-drumProp[data-value=detune],.gsuiDrums-lineOpen[data-prop=gain] .gsuiDrums-drumProp[data-value=gain],.gsuiDrums-lineOpen[data-prop=pan] .gsuiDrums-drumProp[data-value=pan]{height:6px}.gsuiDrums-drumProp+.gsuiDrums-drumProp{margin-top:2px}.gsuiDrums-drumPropValue{position:absolute;height:100%;background-color:var(--gsuiDrums-drumprop-color)}gsui-clock{--gsuiClock-bg:#222;display:flex;width:min-content;height:100%;max-height:28px;border-radius:4px;font-size:18px;background-color:var(--gsuiClock-bg)}.gsuiClock-relative{position:relative;height:100%;padding-left:8px;border-top-left-radius:inherit;border-bottom-left-radius:inherit}.gsuiClock-absolute{display:flex;position:absolute;white-space:nowrap;align-items:baseline;padding-top:4px;font-family:var(--gsui-font-number)}.gsuiClock-modes{position:relative;display:flex;margin:0;border:0;outline:0;padding:7px 6px;border-top-right-radius:inherit;border-bottom-right-radius:inherit;cursor:pointer;color:inherit;flex-direction:column;justify-content:space-between;background:0 0}.gsuiClock-modes:focus-visible{box-shadow:0 0 1px 2px #69b}.gsuiClock-mode{width:5px;height:5px;border-radius:1px;background-color:currentColor;opacity:.2}gsui-clock[mode=beat] .gsuiClock-beat,gsui-clock[mode=second] .gsuiClock-second{opacity:.8}.gsuiClock-b::before{content:":";margin:0 .2ch}.gsuiClock-c,.gsuiPopup-content legend{font-size:12px;opacity:.5}.gsuiClock-c::before{content:".";margin:0 .4ch}.gsuiClock-modeText{position:absolute;top:3px;right:0;font-size:8px;font-family:var(--gsui-font);opacity:.25}gsui-clock[mode=beat] .gsuiClock-modeText::before{content:"beat"}gsui-clock[mode=second] .gsuiClock-modeText::before{content:"sec"}gsui-channel{--gsuiChannel-pan-color:var( --gsui-col-pan );--gsuiChannel-gain-color:var( --gsui-col-gain );--gsuiChannel-connect-input-color:#f99;--gsuiChannel-connect-output-color:var( --gsui-col-gain );--gsuiChannel-analyser-bg:#222;--gsuiChannel-name-font:var( --gsui-font );box-sizing:border-box;display:flex;position:relative;align-items:center;flex-direction:column;height:100%;width:52px;min-width:52px;border-left:2px solid #ffffff11;border-right:2px solid #0000003b;background-color:var(--gsuiChannel-bg, var( --gsui-item-bg ) );transition:.2s background-color}gsui-mixer gsui-channel[selected]{background-color:var(--gsui-item-bg-selected);--gsuiChannel-name-weight:bold;--gsuiChannel-name-shadow:inset 0 -2px var( --gsuiChannel-gain-color )}gsui-channel[muted]{--gsuiChannel-bg:var( --gsui-item-bg-disabled );--gsuiChannel-name-opacity:.5;--gsuiChannel-slider-color:#fff5}.gsuiChannel-headBtn{display:flex;position:absolute;align-items:center;justify-content:center;top:2px;right:2px;border:0;padding:0;outline:0;color:inherit;cursor:pointer;font-size:8px;line-height:1em;background:0 0;transition:opacity .2s;opacity:0}gsui-channel:hover .gsuiChannel-headBtn{opacity:.5}gsui-channel .gsuiChannel-headBtn:focus-visible,gsui-channel .gsuiChannel-headBtn:hover{opacity:1}.gsuiChannel-rename{right:14px}.gsuiChannel-delete{font-size:10px}.gsuiChannels-panMain .gsuiChannel-headBtn{display:none}.gsuiChannel-nameWrap{display:flex;align-items:center;justify-content:center;box-sizing:border-box;overflow:hidden;width:100%;border:0;outline:0;padding:3px;color:inherit;height:34px;min-height:34px;font-size:12px;font-family:var(--gsuiChannel-name-font);background-color:transparent;box-shadow:var(--gsuiChannel-name-shadow, none );transition:inherit;transition-property:box-shadow}.gsuiChannel-name{display:block;overflow:hidden;word-wrap:break-word;text-align:center;font-size:10px;font-weight:var(--gsuiChannel-name-weight, normal );padding-right:.15ch;user-select:none;opacity:var(--gsuiChannel-name-opacity, 1 )}.gsuiChannel-analyser{position:relative;overflow:hidden;flex:2;width:inherit;margin-left:0;min-height:16px}gsui-channel gsui-analyser{height:100%;opacity:.8}.gsuiChannel-effects{display:grid;position:absolute;inset:auto 0 0}.gsuiChannel-effect{display:flex;align-items:center;justify-content:center;width:100%;height:12px;border:0;color:inherit;font-family:inherit;font-size:6px;cursor:pointer;border-top:1px solid #222;border-left:2px solid #ffffff08;border-right:2px solid #0002;background-color:#333}.gsuiChannel-effect:focus-visible,.gsuiChannel-effect:hover{background-color:#3a3a3a}.gsuiChannel-effect-name{pointer-events:none;opacity:.3}.gsuiChannel-effect-enable .gsuiChannel-effect-name{opacity:1}gsui-channel gsui-toggle{width:100%;min-height:18px}.gsuiChannel-pan{width:100%;height:24px;min-height:24px;z-index:1;overflow:hidden;--gsuiSlider-lineColor:var( --gsuiChannel-slider-color, var( --gsuiChannel-pan-color ) )}.gsuiChannel-gain{flex:1;width:6px;min-height:32px;margin-top:6px;--gsuiSlider-lineColor:var( --gsuiChannel-slider-color, var( --gsuiChannel-gain-color ) )}.gsuiChannel-gain .gsuiSlider-eventCatcher{left:-12px;right:-12px}.gsuiChannel-connect{width:100%;border:0;padding:0;outline:0;z-index:1;height:16px;min-height:16px;cursor:pointer;font-size:16px;background-color:transparent}.gsuiChannel-connectA{color:var(--gsuiChannel-connect-output-color)}.gsuiChannel-connectB{color:var(--gsuiChannel-connect-input-color)}.gsuiChannel-grip{width:100%;height:18px;display:flex;align-items:center;justify-content:center;font-size:12px;cursor:grab;opacity:.6;background-color:#0002}.gsuiMixer-panMain .gsuiChannel-grip{visibility:hidden;pointer-events:none}gsui-channels{display:flex;z-index:0;height:100%;position:relative;background-color:var(--gsui-items-bg);user-select:none;-webkit-user-select:none}.gsuiChannels-panMain{position:absolute;inset:0 auto 0 0;padding-right:3px}.gsuiChannels-panChannels{position:absolute;overflow:scroll;inset:0 0 0 calc(52px + 3px);display:grid;grid-auto-flow:column;grid-auto-columns:min-content;scrollbar-width:none}.gsuiChannels-panChannels::-webkit-scrollbar{display:none}.gsuiChannels-panChannels::after{order:2147483647;content:".";opacity:0;margin-left:16px}.gsuiChannels-addChan{position:relative;order:2147483646;display:flex;flex-direction:column;gap:1ch;align-items:center;justify-content:center;width:52px;border:0;padding:0;outline:0;font-size:18px;color:inherit;cursor:pointer;border-radius:2px;background:0 0;opacity:.4;transition:.2s opacity}.gsuiChannels-addChan:focus,.gsuiChannels-addChan:hover,.gsuiEffects-addBtn:focus,.gsuiEffects-addBtn:hover{opacity:.6}.gsuiChannels-addChan::before,.gsuiEffects-addBtn::before{content:"";inset:6px;opacity:.4;border:2px dashed;position:absolute}.gsuiChannels-addChan .gsuiIcon:first-child{font-size:24px}.gsuiChannels-addChan .gsuiIcon:last-child{font-size:14px}gsui-curves{display:block;position:relative;height:100%}.gsuiCurves-svg{position:absolute;width:100%;height:100%}.gsuiCurves-markText{fill:currentColor;font-size:10px;opacity:.2}.gsuiCurves-markBg{fill:currentColor;opacity:.03}.gsuiCurves-line{stroke:currentColor;stroke-width:2;stroke-dasharray:4;opacity:.1}.gsuiCurves-curve{fill:none;stroke:currentColor;stroke-width:3}gsui-effects{height:100%;background-color:var(--gsui-items-bg)}.gsuiEffects-list,gsui-effects{display:flex;overflow:auto;flex-direction:column}.gsuiEffects-addBtn{position:relative;order:2147483646;border:0;outline:0;width:100%;min-height:52px;color:inherit;font-size:18px;cursor:pointer;border-radius:2px;background:0 0;opacity:.4;transition:.2s opacity}.gsuiEffects-addSelect{order:2147483647;width:100%;border:0;font:inherit;color:inherit;min-height:calc(24px*2);background-color:#333;transition:.1s;transition-property:height,visibility}.gsuiEffects-addSelect option{box-sizing:border-box;padding:4px;height:24px;font-size:12px}.gsuiEffects-addSelect option:hover{background-color:#fff2}.gsuiEffects-addBtn:not(:focus)+.gsuiEffects-addSelect:not(:focus){height:0;min-height:0;visibility:hidden}.gsuiEffects-fx{background-color:var(--gsuiEffects-fx-head-bg, var( --gsui-item-bg-disabled ) )}.gsuiEffects-fx-enable{--gsuiEffects-fx-head-bg:var( --gsui-item-bg );--gsuiEffects-fx-head-name-opacity:1}.gsuiEffects-fx-head{display:flex;height:36px;box-sizing:border-box;border-bottom:2px solid #0002;font-size:12px}.gsuiEffects-fx:not(.gsuiEffects-fx-expanded)+.gsuiEffects-fx .gsuiEffects-fx-head{border-top:2px solid #fff1}.gsuiEffects-fx.gsuiEffects-fx-expanded+.gsuiEffects-fx .gsuiEffects-fx-head{border-top:2px solid #0001}.gsuiEffects-fx-expand,.gsuiEffects-fx-remove{border:0;padding:0;outline:0;color:inherit;cursor:pointer;background-color:transparent}.gsuiEffects-fx-expand{width:20px}.gsuiEffects-fx-remove{font-size:inherit}.gsuiEffects-fx-grip{display:flex;align-items:center;justify-content:center;width:16px;font-size:12px;cursor:grab;opacity:.6;background-color:#0002}.gsuiEffects-fx-expand,.gsuiEffects-fx-name{opacity:var(--gsuiEffects-fx-head-name-opacity, .5 )}.gsuiEffects-fx-expand{font-size:14px}.gsuiEffects-fx-head gsui-toggle{width:20px}.gsuiEffects-fx-name{flex:1;align-self:center;padding-left:6px}.gsuiEffects-fx-remove{width:32px;opacity:.3;transition:.1s opacity}.gsuiEffects-fx-remove:focus,.gsuiEffects-fx-remove:hover{opacity:1}.gsuiEffects-fx-content{height:0;opacity:0;overflow:hidden;background-color:var(--gsui-item-more-bg);transition:.1s;transition-property:height,opacity}.gsuiEffects-fx-expanded .gsuiEffects-fx-content{opacity:1}.gsuiEffects-fx-content>*{box-shadow:inset 0 0 20px #0000001c}gsui-fx-delay,gsui-fx-filter{box-sizing:border-box;height:100%;padding:8px}gsui-fx-delay{--gsuiFxDelay-slider:dodgerblue;--gsuiFxDelay-graph-bg:#333;display:flex;flex-direction:column;gap:8px;--gsuiSlider-lineColor:var( --gsuiFxDelay-slider )}.gsuiFxDelay-param{display:flex;align-items:center;gap:8px}.gsuiFxDelay-param::before{width:30px;font-size:12px;font-weight:700}.gsuiFxDelay-param[data-prop=time]::before{content:"time"}.gsuiFxDelay-param[data-prop=gain]::before{content:"gain"}.gsuiFxDelay-param[data-prop=pan]::before{content:"pan"}.gsuiFxDelay-param gsui-slider{flex:1;height:10px;min-width:16px}.gsuiFxDelay-param[data-prop=time] gsui-slider{--gsuiSlider-lineColor:var( --gsui-col-time )}.gsuiFxDelay-param[data-prop=gain] gsui-slider{--gsuiSlider-lineColor:var( --gsui-col-gain )}.gsuiFxDelay-param[data-prop=pan] gsui-slider{--gsuiSlider-lineColor:var( --gsui-col-pan )}.gsuiFxDelay-param-value{width:30px;font-size:13px;font-family:var(--gsui-font-number)}.gsuiFxDelay-graph{position:relative;overflow:hidden;flex:1;border-radius:6px;background-color:var(--gsuiFxDelay-graph-bg)}.gsuiFxDelay-graph-lines{position:absolute;inset:0}.gsuiFxDelay-graph-line{position:absolute;top:calc(50% - 1px);width:100%;height:2px;background-color:currentColor;opacity:.2}.gsuiFxDelay-graph-echo,.gsuiFxDelay-graph-source{position:absolute;top:50%;width:10px;height:10px;margin-top:-5px;margin-left:-5px;border-radius:50%;background-color:currentColor}gsui-fx-filter{--gsuiFxFilter-Q:#d7b;--gsuiFxFilter-gain:var( --gsui-col-gain );--gsuiFxFilter-detune:var( --gsui-col-detune );--gsuiFxFilter-frequency:#8c8;display:grid;container:gsuiFxFilter/inline-size;grid-gap:8px;grid-template:"type graph     gain Q     "1fr"type graph     gain detune"1fr".    frequency .    .     "8px/32px 1fr 8px 50px}.gsuiFxFilter-area{display:flex;flex-direction:column}.gsuiFxFilter-area-label{align-self:center;height:20px;font-size:12px;opacity:.5}.gsuiFxFilter-area-content{flex:1;position:relative}.gsuiFxFilter-areaType{grid-area:type}.gsuiFxFilter-areaGraph{grid-area:graph}.gsuiFxFilter-areaGain{grid-area:gain;--gsuiSlider-lineColor:var( --gsuiFxFilter-gain )}.gsuiFxFilter-areaQ{grid-area:Q;--gsuiSlider-lineColor:var( --gsuiFxFilter-Q )}.gsuiFxFilter-areaDetune{grid-area:detune;--gsuiSlider-lineColor:var( --gsuiFxFilter-detune )}.gsuiFxFilter-areaFrequency{grid-area:frequency;--gsuiSlider-lineColor:var( --gsuiFxFilter-frequency )}.gsuiFxFilter-areaDetune gsui-slider,.gsuiFxFilter-areaQ gsui-slider{min-height:40px}.gsuiFxFilter-areaFrequency .gsuiSlider-eventCatcher,.gsuiFxFilter-areaGain .gsuiSlider-eventCatcher{inset:-8px}.gsuiFxFilter-areaGraph .gsuiFxFilter-area-label{align-self:flex-start}.gsuiFxFilter-areaGraph .gsuiFxFilter-area-content{border-radius:4px;background-color:rgba(0,0,0,.5)}gsui-fx-filter .gsuiCurves-curve{color:currentColor;opacity:.25}.gsuiFxFilter-enable .gsuiCurves-curve{color:var(--gsuiFxFilter-frequency);opacity:1}.gsuiFxFilter-areaType .gsuiFxFilter-area-content{display:flex;overflow:hidden;border-radius:4px;flex-direction:column}.gsuiFxFilter-areaType-btn{position:relative;flex:1;border:0;outline:0;padding:0;cursor:pointer;stroke:var(--gsuiFxFilter-gain);stroke-width:1.5px;background-color:var(--gsui-slider-bg)}.gsuiFxFilter-areaType-btn:focus,.gsuiFxFilter-areaType-btn:hover{stroke-width:2px}.gsuiFxFilter-areaType-btnSelected{stroke:#222;background-color:var(--gsuiFxFilter-gain)}.gsuiFxFilter-areaType-btn svg{position:absolute;inset:0;width:100%;height:100%;fill:transparent;stroke:inherit;stroke-width:inherit;pointer-events:none}@container gsuiFxFilter (max-width: 340px){.gsuiCurves-markText{display:none}}gsui-mixer{--gsuiMixer-bg:#444;--gsuiMixer-effects-bg:#404040;--gsuiMixer-effects-border:#555;--gsuiMixer-head-border:#0002;display:flex;height:100%;background-color:var(--gsuiMixer-bg)}.gsuiMixer-channels{display:flex;flex-direction:column;flex:1;min-width:140px}.gsuiMixer-effects{z-index:1;display:flex;flex-direction:column;width:50%;min-width:200px;border-left:2px solid var(--gsuiMixer-effects-border);background-color:var(--gsuiMixer-effects-bg)}gsui-mixer .gsuiPanel-extend{z-index:2}.gsuiMixer-head{box-sizing:border-box;display:flex;align-items:center;gap:6px;height:26px;min-height:26px;padding:2px 6px 0;font-size:10px;border-bottom:2px solid var(--gsuiMixer-head-border);background-color:var(--gsui-head-bg)}.gsuiMixer-head-title{font-weight:700}.gsuiReorder-dragging{opacity:0;transition:none}:root{--gsuiDragline-color:#fff;--gsuiDragline-dotSize:8px;--gsuiDragline-dotRad:50%;--gsuiDragline-lineSize:4px}.gsuiDragline{position:absolute;max-width:0;max-height:0;color:var(--gsuiDragline-color)}.gsuiDragline-dragging,.gsuiDragline-dragging .gsuiDragline-to,.gsuiDragline-main{pointer-events:none}.gsuiDragline-main{position:relative}.gsuiDragline-line{position:absolute;bottom:0;right:0;width:0;height:0;fill:none;stroke:currentColor;stroke-width:var(--gsuiDragline-lineSize);stroke-linecap:round}.gsuiDragline-down .gsuiDragline-line{top:0;bottom:auto}.gsuiDragline-right .gsuiDragline-line{left:0;right:auto}.gsuiDragline-to{position:absolute;width:var(--gsuiDragline-dotSize);height:var(--gsuiDragline-dotSize);margin:calc(var(--gsuiDragline-dotSize)/-2);cursor:pointer;border-radius:var(--gsuiDragline-dotRad);pointer-events:all;background-color:var(--gsuiDragline-color);transition:.2s background-color}.gsuiDragline-down .gsuiDragline-to{bottom:0}.gsuiDragline-right .gsuiDragline-to{right:0}.gsuiDragline-main:not(.gsuiDragline-down) .gsuiDragline-to{top:0}.gsuiDragline-main:not(.gsuiDragline-right) .gsuiDragline-to{left:0}.gsuiDragline-drop{position:relative;max-width:0;max-height:0}.gsuiDragline-drop::before{content:"";position:absolute;width:0;height:0;margin:0;background-color:var(--gsuiDragline-color);transition:.2s all}.gsuiDragline-dropActive::before{width:var(--gsuiDragline-dotSize);height:var(--gsuiDragline-dotSize);margin:calc(var(--gsuiDragline-dotSize)/-2);cursor:pointer;border-radius:var(--gsuiDragline-dotRad)}.gsuiDragline-dropActive:hover::before{transform:scale(2)}gsui-beatlines{--gsui-deg:90deg;--gsui-bPM:4em;--gsui-sPB:.25em;pointer-events:none;background-repeat:no-repeat}gsui-beatlines[vertical]{--gsui-deg:180deg}.gsuiBeatlines-bg,gsui-beatlines{position:absolute;inset:0}.gsuiBeatlines-measures{background-image:repeating-linear-gradient(var(--gsui-deg),#0008,#0008 1px,transparent 1px,transparent calc(var(--gsui-bPM) - 1px),#0008 calc(var(--gsui-bPM) - 1px),#0008 var(--gsui-bPM))}.gsuiBeatlines-steps{background-image:repeating-linear-gradient(var(--gsui-deg),#0002,#0002 .5px,transparent .5px,transparent calc(var(--gsui-sPB) - .5px),#0002 calc(var(--gsui-sPB) - .5px),#0002 var(--gsui-sPB))}.gsuiBeatlines-beats{background-image:repeating-linear-gradient(var(--gsui-deg),#0004,#0004 .5px,transparent .5px,transparent calc(1em - .5px),#0004 calc(1em - .5px),#0004 1em)}gsui-beatlines[coloredbeats] .gsuiBeatlines-beatsBG{background-image:repeating-linear-gradient(var(--gsui-deg),#0001,#0001 1em,transparent 1em,transparent 2em)}.gsuiBlocksManager{--gsuiBlocksManager-timeline-height:32px;--gsuiBlocksManager-selection-bgColor:#b226;--gsuiBlocksManager-selection-borderColor:#f44;--gsuiBlocksManager-blockColor:rgba( var( --gsui-rgb-pattern ), .8 );--gsuiBlocksManager-blockSelectedColor:rgba( var( --gsui-rgb-patternSelected ), .8 )}.gsuiBlocksManager-selection{position:absolute;box-sizing:border-box;top:0;z-index:2;border:2px solid var(--gsuiBlocksManager-selection-borderColor);border-radius:4px;background-color:var(--gsuiBlocksManager-selection-bgColor);transition:.2s;transition-property:opacity,visibility}.gsuiBlocksManager-selection-hidden{opacity:0;visibility:hidden}.gsuiBlocksManager-block{position:absolute;z-index:1;height:100%;background-color:var(--gsuiBlocksManager-blockColor);transition:.1s;transition-property:opacity,background-color}.gsuiBlocksManager-block-selected{--gsuiBlocksManager-blockColor:var( --gsuiBlocksManager-blockSelectedColor )}.gsuiBlocksManager-block-hidden{z-index:0;opacity:.3}.gsuiBlocksManager-block-crop{position:absolute;z-index:2;width:50%;height:100%;max-width:8px;border-radius:inherit;background-color:#000;opacity:0;transition:.1s opacity}.gsuiBlocksManager-block-cropA{left:0;border-top-right-radius:0;border-bottom-right-radius:0}.gsuiBlocksManager-block-cropB{right:0;border-top-left-radius:0;border-bottom-left-radius:0}.gsuiBlocksManager-block.gsui-hover .gsuiBlocksManager-block-crop,.gsuiBlocksManager-block:hover .gsuiBlocksManager-block-crop{opacity:.12}.gsuiBlocksManager-block .gsuiBlocksManager-block-crop.gsui-hover,.gsuiBlocksManager-block .gsuiBlocksManager-block-crop:hover{opacity:.25}gsui-patternroll,gsui-pianoroll{display:flex;height:100%}gsui-patternroll gsui-track{height:var(--gsuiTimewindow-lineH)}.gsuiPatternroll-block{box-sizing:border-box;white-space:nowrap;color:var(--gsuiPatterns-pattern-color);border-radius:1px;border-top:2px solid #ffffff4f;border-bottom:2px solid #0000000d;--gsuiPatterns-pattern-color:#223}.gsui-mute .gsuiPatternroll-block{opacity:.5}.gsuiPatternroll-block-header{position:absolute;inset:3px 3px auto;box-sizing:border-box;z-index:1;display:flex;border-radius:inherit;flex-direction:column;justify-content:center;padding:0 4px;font-size:10px;font-weight:700;background-color:#fff3;pointer-events:none;user-select:none;-webkit-user-select:none}.gsuiPatternroll-block-name{overflow:hidden;text-overflow:ellipsis}.gsuiPatternroll-block-content{position:absolute;inset:18px 0 0;pointer-events:none}.gsuiPatternroll-block[data-missing] .gsuiPatternroll-block-content{display:none}.gsuiPatternroll-block-content svg{position:absolute;top:0;left:0;width:100%;height:100%;opacity:.8;fill:currentColor}.gsui-row-small .gsuiPatternroll-block-header{background-color:inherit;position:absolute;inset:0}.gsui-row-small .gsuiPatternroll-block-content,.gsuiKey-row>div{position:absolute;inset:0}.gsuiPatternroll-block-placeholder{flex:1;display:none;align-items:center;pointer-events:none;font-size:14px;opacity:.5}.gsuiPatternroll-block[data-missing] .gsuiPatternroll-block-placeholder{display:flex}.gsuiPatternroll-block-placeholderIcon{margin:0 8px}.gsuiPatternroll-block-placeholderText{overflow:hidden;text-overflow:ellipsis;user-select:none;-webkit-user-select:none}gsui-pianoroll{--gsuiDragline-dotSize:10px;--gsuiDragline-dotRad:2px;--gsuiDragline-lineSize:3px}gsui-pianoroll:focus{outline:1px solid var(--gsuiBlocksManager-blockColor)}gsui-pianoroll .gsuiTimewindow-rows,gsui-pianoroll gsui-keys{font-size:var(--gsuiTimewindow-lineH)}gsui-pianoroll .gsuiKey-row>div{font-size:var(--gsuiTimewindow-pxperbeat)}gsui-pianoroll .gsuiBlocksManager-block{border-radius:2px}gsui-pianoroll .gsuiTimewindow-panelContentDown{display:flex;align-items:center;justify-content:center}.gsuiPianoroll-slidersSelect{border:0;outline:0;font:inherit;color:inherit;cursor:pointer;font-size:11px;user-select:none;border-radius:4px;background-color:#fff2;scrollbar-width:none;opacity:.5;transition:.1s opacity}.gsuiPianoroll-slidersSelect::-webkit-scrollbar{display:none}.gsuiPianoroll-slidersSelect:focus,.gsuiPianoroll-slidersSelect:hover{opacity:1}.gsuiPianoroll-slidersSelect option{padding:1px 4px}.gsuiPianoroll-slidersSelect option::after{content:attr(data-number);margin-left:1ch;font-size:14px;font-weight:700;font-family:var(--gsui-font-number)}.gsuiPianoroll-slidersSelect option[value^=gainLFO]::after{content:"x"attr(data-number)}.gsuiPianoroll-slidersSelect option:not([data-number])::after{content:""}.gsuiPianoroll-block{--gsuiDragline-color:var( --gsuiBlocksManager-blockColor )}.gsuiPianoroll-block::after{content:attr(data-key);position:absolute;display:flex;align-items:center;justify-content:center;left:0;width:16px;max-width:100%;height:100%;color:#000;font-size:11px;font-weight:700;opacity:.4;pointer-events:none}.gsuiPianoroll-block .gsuiDragline{top:50%;right:0}.gsuiPianoroll-block .gsuiDragline-drop{top:50%;left:0}.gsuiPianoroll-block .gsuiDragline-drop::before{left:0}.gsuiPianoroll-block .gsuiDragline-dropActive::before{left:-4px}.gsuiPianoroll-block:not(:hover):not(.gsui-hover) .gsuiDragline:not(.gsuiDragline-dragging) .gsuiDragline-to{background-color:transparent}.gsuiPianoroll-block.gsui-hover .gsuiDragline:not(.gsuiDragline-linked) .gsuiDragline-to,.gsuiPianoroll-block:hover .gsuiDragline:not(.gsuiDragline-linked) .gsuiDragline-to{transform:translateX(2px)}.gsuiPianoroll-block.gsui-hover .gsuiDragline-linked .gsuiDragline-to,.gsuiPianoroll-block:hover .gsuiDragline-linked .gsuiDragline-to{transform:translateX(-2px)}:root{--gsuiKeys-blackRow-bg:#0000001a;--gsuiKeys-blackRow-hover-bg:#00000026;--gsuiKeys-whiteRow-hover-bg:#ffffff08}gsui-keys{--gsuiKeys-blackKey-gradA:#111;--gsuiKeys-blackKey-gradB:#444;--gsuiKeys-whiteKey-gradA:#888;--gsuiKeys-whiteKey-gradB:#eee;--gsuiKeys-activeKey-gradA:#353b52;--gsuiKeys-activeKey-gradB:#7886bd;--gsuiKeys-rootKey:#c143a4;--gsuiKeys-firstOctave:0;--gsuiKeys-nbOctaves:0;--gsui-gradientDeg:90deg;display:block;position:relative;height:100%;z-index:0;counter-reset:octave calc(var(--gsuiKeys-firstOctave) + var(--gsuiKeys-nbOctaves));user-select:none;-webkit-user-select:none}gsui-keys[orient=vertical]{height:calc(var(--gsuiKeys-nbOctaves)*12em)}gsui-keys[orient=horizontal]{--gsui-gradientDeg:180deg;width:calc(var(--gsuiKeys-nbOctaves)*12em)}.gsuiKey,gsui-keys{background-image:linear-gradient(var(--gsui-gradientDeg),var(--gsuiKeys-whiteKey-gradA),var(--gsuiKeys-whiteKey-gradB))}.gsuiKey .gsuiKey-row{display:none}.gsuiKey-row{position:absolute;box-sizing:border-box;width:100%;height:1em}.gsuiKeyBlack-row{background-color:var(--gsuiKeys-blackRow-bg)}.gsuiKey-row:hover{background-color:var(--gsuiKeys-whiteRow-hover-bg)}.gsuiKeyBlack-row:hover{background-color:var(--gsuiKeys-blackRow-hover-bg)}.gsuiKey-row[data-key="0"],.gsuiKey-row[data-key="5"],gsui-keys[orient=vertical] .gsuiKey[data-key="0"]:not(:last-child),gsui-keys[orient=vertical] .gsuiKey[data-key="5"]{border-bottom:1px solid #0003}gsui-keys[orient=horizontal] .gsuiKey[data-key="0"]:not(:last-child),gsui-keys[orient=horizontal] .gsuiKey[data-key="5"]{border-left:1px solid #0003}.gsuiKey,gsui-oscillator{box-sizing:border-box;position:absolute}gsui-keys[orient=vertical] .gsuiKey{inset:auto 0;top:calc(var(--gsuiKeys-key-id)*1em);height:1.5em}gsui-keys[orient=horizontal] .gsuiKey{inset:0 auto;right:calc(var(--gsuiKeys-key-id)*1em);width:1.5em}.gsuiKeyBlack{position:absolute;z-index:1;background-image:linear-gradient(var(--gsui-gradientDeg),var(--gsuiKeys-blackKey-gradA),var(--gsuiKeys-blackKey-gradB))}gsui-keys[orient=vertical] .gsuiKeyBlack{width:65%;height:1em;border-radius:0 .1em .1em 0}gsui-keys[orient=horizontal] .gsuiKeyBlack{width:1em;height:65%;border-radius:0 0 .1em .1em}.gsuiKey[data-key="0"]{filter:brightness(.9)}.gsuiKey[data-key="0"]::after{counter-increment:octave -1;content:"C"counter(octave);position:absolute;right:.25em;bottom:2px;color:#000;font-size:calc(6px + .25em);font-family:monospace}.gsuiKey-root[data-key="0"]::after{color:var(--gsuiKeys-whiteKey-gradB);padding:0 2px;border-radius:3px;background-color:var(--gsuiKeys-rootKey)}.gsuiKey-root.gsui-active::after{color:var(--gsuiKeys-rootKey);background-color:var(--gsuiKeys-whiteKey-gradB)}gsui-keys[orient=horizontal] .gsuiKey[data-key="0"]::after{left:.35em;right:auto}.gsuiKey.gsui-active{background-image:linear-gradient(var(--gsui-gradientDeg),var(--gsuiKeys-activeKey-gradA),var(--gsuiKeys-activeKey-gradB))}gsui-keys[orient=vertical] .gsuiKey[data-key="2"],gsui-keys[orient=vertical] .gsuiKey[data-key="7"],gsui-keys[orient=vertical] .gsuiKey[data-key="9"]{height:2em}gsui-keys[orient=horizontal] .gsuiKey[data-key="2"],gsui-keys[orient=horizontal] .gsuiKey[data-key="7"],gsui-keys[orient=horizontal] .gsuiKey[data-key="9"]{width:2em}.gsuiKey[data-key="0"],.gsuiKey[data-key="2"],.gsuiKey[data-key="5"],.gsuiKey[data-key="7"],.gsuiKey[data-key="9"]{margin-top:-.5em}gsui-keys[orient=horizontal] .gsuiKey[data-key="0"],gsui-keys[orient=horizontal] .gsuiKey[data-key="2"],gsui-keys[orient=horizontal] .gsuiKey[data-key="5"],gsui-keys[orient=horizontal] .gsuiKey[data-key="7"],gsui-keys[orient=horizontal] .gsuiKey[data-key="9"]{margin-top:0;margin-right:-.5em}gsui-oscillator{--gsuiOscillator-pan:var( --gsui-col-pan );--gsuiOscillator-gain:var( --gsui-col-gain );--gsuiOscillator-pan-a:#faa;--gsuiOscillator-pan-b:#aaf;--gsuiOscillator-detune:var( --gsui-col-detune );--gsuiOscillator-unison:var( --gsui-col-unison );--gsuiOscillator-grip-bg:#0002;--gsuiOscillator-wave-bg:#0006;--gsuiOscillator-wave-option:#444;--gsuiOscillator-wave-optionNative:#333;display:grid;position:relative;height:100%;min-width:260px;min-height:60px;background-color:var(--gsui-item-bg);grid-template:"grip .   .    .   .      .   .      .   .    .   .    ."6px"grip .   wave .   unison .   detune .   pan  .   gain ."1fr"grip .   .    .   .      .   .      .   .    .   .    ."6px/20px 6px 1fr 6px 32px 8px 36px 6px 36px 6px 36px 10px;container-type:inline-size;container-name:gsuiOscillator}@container gsuiOscillator (max-width: 300px){.gsuiOscillator-grip{background-color:#000!important}}.gsuiOscillator-grip{grid-area:grip;display:flex;align-items:center;justify-content:center;font-size:12px;cursor:grab;opacity:.6;background-color:var(--gsuiOscillator-grip-bg)}.gsuiOscillator-prop{display:flex;flex-direction:column;justify-content:center;gap:2px;--gsuiSlider-lineColor:currentColor}.gsuiOscillator-pan{grid-area:pan;color:var(--gsuiOscillator-pan)}.gsuiOscillator-gain{grid-area:gain;color:var(--gsuiOscillator-gain)}.gsuiOscillator-detune{grid-area:detune;color:var(--gsuiOscillator-detune)}.gsuiOscillator-sliderWrap{position:relative;box-sizing:border-box;height:32px;min-height:32px}.gsuiOscillator-prop gsui-slider:first-child .gsuiSlider-eventCatcher{bottom:-18px}.gsuiOscillator-prop gsui-slider+gsui-slider{position:absolute;overflow:hidden;border-radius:50%;top:calc(50% - 8px);left:calc(50% - 8px);width:16px;height:16px}.gsuiOscillator-prop gsui-slider+gsui-slider .gsuiSlider-eventCatcher{border-radius:50%}.gsuiOscillator-sliderValue{display:flex;align-items:center;justify-content:center;font-family:var(--gsui-font-number);font-size:12px;pointer-events:none}.gsuiOscillator-waveWrap{grid-area:wave;display:flex;border-radius:3px;background-color:var(--gsuiOscillator-wave-bg)}.gsuiOscillator-waveWrap-left{flex:1;display:flex;flex-direction:column}.gsuiOscillator-waveWrap-top{display:flex}.gsuiOscillator-wave{flex:1;position:relative}.gsuiOscillator-wave gsui-periodicwave{position:absolute}.gsuiOscillator-wave gsui-periodicwave:first-child{color:var(--gsuiOscillator-pan-a)}.gsuiOscillator-wave gsui-periodicwave:last-child{color:var(--gsuiOscillator-pan-b)}.gsuiOscillator-wave polyline{stroke-opacity:.8}.gsuiOscillator-remove{border:0;padding:0;cursor:pointer;color:inherit;opacity:.5;transition:.1s opacity}.gsuiOscillator-waveBtn{padding:0}.gsuiOscillator-waveBtn,.gsuiOscillator-waveSelect{border:0;outline:0;cursor:pointer;color:inherit;background:0 0;opacity:.5;transition:.1s opacity}.gsuiOscillator-waveBtn{width:14px;font-size:16px;text-align:center}.gsuiOscillator-remove{position:absolute;inset:0 2px auto auto;outline:0;font-size:12px;background:0 0}.gsuiOscillator-remove:focus-visible,.gsuiOscillator-remove:hover,.gsuiOscillator-waveBtn:focus-visible,.gsuiOscillator-waveBtn:hover,.gsuiOscillator-waveSelect:focus-visible,.gsuiOscillator-waveSelect:hover{opacity:1}.gsuiOscillator-waveSelect{flex:1;padding:0 0 0 6px;font-size:12px;font-family:inherit;-moz-appearance:none;-webkit-appearance:none}.gsuiOscillator-waveOpt{background-color:var(--gsuiOscillator-wave-option)}.gsuiOscillator-waveOptNative{background-color:var(--gsuiOscillator-wave-optionNative)}.gsuiOscillator-unisonGraph{overflow:hidden;display:flex;flex-direction:column;align-items:center;width:10px}.gsuiOscillator-unisonGraph-voices{display:flex;flex-direction:column;align-items:center;justify-content:space-between;margin:auto 0;width:100%;min-height:3px;pointer-events:none}.gsuiOscillator-unisonGraph-voice{height:3px;min-width:1px;border-radius:3px;background-color:var(--gsuiOscillator-unison);opacity:.75}.gsuiOscillator-unisonGraph-voice:only-child{margin:auto 0}.gsuiOscillator-unison{grid-area:unison;display:flex;gap:5px;--gsuiSlider-lineColor:var( --gsuiOscillator-unison )}.gsuiOscillator-unison gsui-slider+gsui-slider{width:6px;min-width:6px}.gsuiOscillator-unison gsui-slider .gsuiSlider-eventCatcher{inset:-3px}gsui-periodicwave,gsui-periodicwave svg{width:100%;height:100%}gsui-periodicwave polyline{stroke:currentColor;fill:none}gsui-synthesizer{display:flex;flex-direction:column;overflow:auto;position:relative;box-sizing:border-box;height:100%;scrollbar-width:thin;scrollbar-color:#ddd #222}.gsuiSynthesizer-head{display:flex;align-items:center;box-sizing:border-box;height:24px;font-size:14px;line-height:1em;user-select:none;padding-top:2px;border-bottom:2px solid #0002;background-color:var(--gsui-head-bg)}.gsuiSynthesizer-headTitle{font-size:10px;font-weight:700;line-height:24px}.gsuiSynthesizer-head gsui-toggle{align-self:normal;width:24px}.gsuiSynthesizer-label{width:36px;text-align:center;font-size:10px;opacity:.75}.gsuiSynthesizer-labelUnison{margin-left:auto;width:38px}.gsuiSynthesizer-env,.gsuiSynthesizer-lfo{height:90px;min-height:90px}.gsuiSynthesizer-headOscs{gap:6px;height:24px;padding:2px 10px 0 8px}.gsuiSynthesizer-oscList{flex:1;display:grid;grid-auto-flow:row;grid-auto-rows:min-content;counter-reset:count-osc;background-color:var(--gsui-items-bg)}gsui-synthesizer gsui-oscillator{transition:.2s filter}gsui-synthesizer gsui-oscillator:hover{filter:brightness(1.05)}gsui-synthesizer gsui-oscillator:only-of-type .gsuiOscillator-remove{display:none}.gsuiSynthesizer-newOsc{position:relative;order:2147483647;border:0;height:52px;color:inherit;font-size:18px;cursor:pointer;border-radius:2px;background:0 0;opacity:.4;transition:.2s opacity}.gsuiSynthesizer-newOsc:focus,.gsuiSynthesizer-newOsc:hover{opacity:.6}.gsuiSynthesizer-newOsc::before{position:absolute;content:"";inset:6px;opacity:.4;border:2px dashed}gsui-panel{display:flex;z-index:0;width:100%;height:100%}.gsuiPanel-extend{--w:8px;position:relative;z-index:1}.gsuiPanel-extend[data-axis=x]{min-width:var(--w);left:calc(var(--w)/-2);margin-right:calc(var(--w)*-1);cursor:ew-resize}.gsuiPanel-extend[data-axis=y]{min-height:var(--w);top:calc(var(--w)/-2);margin-bottom:calc(var(--w)*-1);cursor:ns-resize}:root{--gsuiPanels-border:#777;--gsuiPanels-extendColor:#888}.gsuiPanels-x,.gsuiPanels-y{display:flex;height:100%}.gsuiPanels-y{flex-direction:column}.gsuiPanels-x>div:not(.gsuiPanels-extend),.gsuiPanels-y>div:not(.gsuiPanels-extend){position:relative;box-sizing:border-box}.gsuiPanels-x>div+div:not(.gsuiPanels-extend){border-left:4px solid var(--gsuiPanels-border)}.gsuiPanels-y>div+div:not(.gsuiPanels-extend){border-top:4px solid var(--gsuiPanels-border)}.gsuiPanels-extend{position:absolute;top:-2px;left:0;width:100%;height:100%;transition:background-color .2s}.gsuiPanels-extend.gsui-hover,.gsuiPanels-extend:hover{background-color:var(--gsuiPanels-extendColor)}.gsuiPanels-x>div>.gsuiPanels-extend{cursor:col-resize;width:4px;margin-left:-2px}.gsuiPanels-y>div>.gsuiPanels-extend{cursor:row-resize;height:4px;margin-top:-2px}gsui-popup{--gsuiPopup-bg:#555;--gsuiPopup-btn-bg:#999;--gsuiPopup-btnOk-bg:#67a;--gsuiPopup-radius:4px;--gsuiPopup-padding:10px;--gsuiPopup-minWidth:250px;--gsuiPopup-header-bg:#333;--gsuiPopup-header-fontSize:16px;--gsuiPopup-body-fontSize:14px;--gsuiPopup-overlay-bg:#0009;display:flex;position:fixed;align-items:center;justify-content:center;inset:0;z-index:2147483647;color:#fff;background-color:var(--gsuiPopup-overlay-bg);backdrop-filter:grayscale(1) blur(2px)}gsui-popup:not(.gsuiPopup-show){visibility:hidden}.gsuiPopup-window{overflow:hidden;min-width:var(--gsuiPopup-minWidth);border-radius:var(--gsuiPopup-radius);background-color:var(--gsuiPopup-bg);outline:0;box-shadow:0 0 50px #000;transition:margin-top .2s,opacity .5s}gsui-popup:not(.gsuiPopup-show) .gsuiPopup-window{margin-top:-50px;opacity:0}.gsuiPopup-window:focus-within{box-shadow:0 0 1px 2px #69b,0 0 50px #000}#gsuiSlicer-waveDefs,.gsuiPopup-noCancel .gsuiPopup-cancel,.gsuiPopup-noText .gsuiPopup-inputText,gsui-slicer[disabled] .gsuiSlicer-currentTime,gsui-slicer[hidetimes] .gsuiSlicer-currentTime{display:none}.gsuiPopup-head{padding:var(--gsuiPopup-padding);font-size:var(--gsuiPopup-header-fontSize);background-color:var(--gsuiPopup-header-bg)}.gsuiPopup-body{font-size:var(--gsuiPopup-body-fontSize);padding:var(--gsuiPopup-padding)}.gsuiPopup-content:not(:empty)+.gsuiPopup-message,.gsuiPopup-content:not(:empty)~input{display:none}.gsuiPopup-btns input,.gsuiPopup-inputText{border:0;border-radius:4px}.gsuiPopup-btns input{padding:.6em 1.25em}.gsuiPopup-window input,.gsuiPopup-window select{outline:0}.gsuiPopup-window input:focus,.gsuiPopup-window select:focus{box-shadow:0 0 1px 2px #69b}.gsuiPopup-inputText{box-sizing:border-box;padding:8px;width:100%;font-size:14px;height:32px}.gsuiPopup-btns{margin-top:var(--gsuiPopup-padding);text-align:center}.gsuiPopup-btns input{color:#fff;font-weight:700;font-family:inherit;background-color:var(--gsuiPopup-btn-bg);cursor:pointer}.gsuiPopup-btns input+input{margin-left:var(--gsuiPopup-padding)}.gsuiPopup-btns .gsuiPopup-ok{background-color:var(--gsuiPopup-btnOk-bg)}.gsuiPopup-content a{color:inherit;text-decoration:none}.gsuiPopup-content a:not(.gsuiIcon):hover{text-decoration:underline}.gsuiPopup-content fieldset{display:flex;flex-direction:column;border:2px solid #444;border-radius:4px;margin-bottom:10px}.gsuiPopup-content input[type=checkbox],.gsuiPopup-content input[type=radio]{margin:0 8px 0 0}.gsuiPopup-content input[type=range]{min-width:0}.gsuiPopup-row{display:flex;align-items:center;font-size:14px;padding:4px;gap:6px}.gsuiPopup-row+.gsuiPopup-row{margin-top:6px}.gsuiPopup-row-title{flex:1;font-size:13px}.gsuiPopup-row-values,.gsuiPopup-row-values label{display:flex;align-items:center;font-family:var(--gsui-font-monospace);gap:.6ch}.gsuiPopup-row-values label{cursor:pointer}.gsuiScrollShadow{--gsuiScrollShadow-dist:0;--gsuiScrollShadow-x:0;--gsuiScrollShadow-y:0;z-index:1}.gsuiScrollShadow[data-dir=top]{--gsuiScrollShadow-y:1}.gsuiScrollShadow[data-dir=left]{--gsuiScrollShadow-x:1}.gsuiScrollShadow[data-dir=right]{--gsuiScrollShadow-x:-1}.gsuiScrollShadow[data-dir=bottom]{--gsuiScrollShadow-y:-1}.gsuiScrollShadow-shadowed{box-shadow:calc(var(--gsuiScrollShadow-dist)*var(--gsuiScrollShadow-x)) calc(var(--gsuiScrollShadow-dist)*var(--gsuiScrollShadow-y)) calc(var(--gsuiScrollShadow-dist)*2) #0004}gsui-slicer{--gsuiSlicer-bg:#666;--gsuiSlicer-color:#fff;--gsuiSlicer-slicers-bg:#47475c;--gsuiSlicer-source-bg:#334;--gsuiSlicer-source-wave:var( --gsui-col-pattern );--gsuiSlicer-preview-wave-border:#fff2;--gsuiSlicer-preview-wave-hl-bg:#fff1;--gsuiSlicer-slice-bg:#44c4;--gsuiSlicer-slice-hl-bg:#77f4;--gsuiSlicer-slice-border:#32325a;position:relative;display:flex;flex-direction:column;box-sizing:border-box;gap:10px;height:100%;min-width:306px;color:var(--gsuiSlicer-color);background-color:var(--gsuiSlicer-bg);user-select:none;-webkit-tap-highlight-color:transparent}.gsuiSlicer-preview,.gsuiSlicer-slices,.gsuiSlicer-source-head,.gsuiSlicer-source-sample-wrap,.gsuiSlicer-time{border:0 solid #0002;border-left-width:8px;border-right-width:8px}.gsuiSlicer-currentTime{position:absolute;z-index:1;inset:0 auto;width:2px;margin-left:-1px;background-color:var(--gsui-col-currentTimeCursor);pointer-events:none}.gsuiSlicer-source{overflow:hidden;min-height:48px;flex:.35;display:flex;flex-direction:column;background-color:var(--gsuiSlicer-source-bg)}.gsuiSlicer-source-head{display:flex;align-items:center;height:20px;font-size:11px;font-weight:700;padding:0 4px;background-color:#0004}.gsuiSlicer-source-icon{margin-right:6px;font-size:12px;opacity:.4}.gsuiSlicer-source-name{opacity:.4}.gsuiSlicer-source-name:empty::after{content:"no sample loaded...";font-style:italic;opacity:.5}.gsuiSlicer-missingBufferData .gsuiSlicer-source-name::after{content:" (buffer not ready)";font-style:italic;opacity:.5}.gsuiSlicer-source-sample-wrap{flex:1;border-bottom-width:2px}.gsuiSlicer-source-sample{position:relative;overflow:hidden;height:100%;min-height:20px}.gsuiSlicer-source-wave{position:absolute;width:100%;height:100%;fill:var(--gsuiSlicer-source-wave);pointer-events:none}.gsuiSlicer-preview,.gsuiSlicer-time{overflow:hidden;background-color:var(--gsuiSlicer-source-bg)}.gsuiSlicer-time{height:20px;min-height:20px;margin-bottom:-10px}.gsuiSlicer-preview{position:relative;flex:.4;min-height:30px;border-top-width:2px;border-bottom-width:2px}.gsuiSlicer-preview-wave{position:absolute;height:100%;fill:var(--gsuiSlicer-source-wave);border-right:1px dashed var(--gsuiSlicer-preview-wave-border);transition:background-color .5s}.gsuiSlicer-preview-wave-hl{background-color:var(--gsuiSlicer-preview-wave-hl-bg);transition:none}.gsuiSlicer-slices{flex:1;margin-top:-10px;min-height:100px;overflow:hidden;color:#000;border-bottom-width:2px;background-color:var(--gsuiSlicer-slicers-bg)}.gsuiSlicer-slices-scroll{overflow:auto;height:100%}.gsuiSlicer-slices-beatlinesWrap{position:absolute;width:100%;height:100%;pointer-events:none}.gsuiSlicer-slices-in{position:relative;height:100%}.gsuiSlicer-slices-line{position:absolute;width:100%;height:100%;opacity:.2;pointer-events:none}.gsuiSlicer-slices-line line{stroke:currentColor;stroke-width:2px;stroke-dasharray:10 5}.gsuiSlicer-slices-wrap{position:relative;height:100%;cursor:pointer;touch-action:none}.gsuiSlicer-slices-slice{position:absolute;box-sizing:border-box;bottom:0;border:0 solid var(--gsuiSlicer-slice-border);border-width:3px 1px 0;border-radius:2px 2px 0 0;background-color:var(--gsuiSlicer-slice-bg);pointer-events:none;filter:grayscale(.5) opacity(.8);transition:filter .2s,background-color .5s}.gsuiSlicer-loaded .gsuiSlicer-slices-slice{filter:none}.gsuiSlicer-slices-slice-hl{background-color:var(--gsuiSlicer-slice-hl-bg);transition:filter .2s}.gsuiSlicer-menu{display:flex;gap:6px;height:20px;justify-content:space-between;padding:0 8px 8px;font-size:14px}.gsuiSlicer-btn{display:flex;align-items:center;justify-content:center;box-sizing:border-box;gap:6px;border:0;outline:0;padding:0 6px;min-width:32px;border-radius:4px;font-size:inherit;color:inherit;cursor:pointer;white-space:nowrap;background-color:#fff2;user-select:none;opacity:.6;transition:.2s opacity}.gsuiSlicer-btn-toggle{border:2px solid #fff8}.gsuiSlicer-btn-toggle,.gsuiSlicer-btn:focus,.gsuiSlicer-btn:hover{opacity:1}.gsuiSlicer-btn-step{margin-right:auto;font-family:var(--gsui-font-number)}gsui-slider,gsui-slidergroup{display:block;position:relative;height:100%}gsui-slider{width:100%;outline:0;touch-action:none;user-select:none}gsui-slider[disabled]{cursor:not-allowed;--gsuiSlider-lineColor:#fff}gsui-slider[disabled] .gsuiSlider-lineColor,gsui-slider[disabled] .gsuiSlider-svgLineColor{opacity:.25}.gsuiLibraries-body gsui-library,.gsuiSlider-eventCatcher,.gsuiSlider-line{position:absolute;inset:0}.gsuiSlider-circular .gsuiSlider-line,.gsuiSlider-input,.gsuiSlider-linear .gsuiSlider-svg,gsui-slidergroup[currenttime="0"] .gsuiSliderGroup-currentTime{display:none}.gsuiSlider-line{overflow:hidden;border-radius:var(--gsuiSlider-lineRadius, 2px );background-color:var(--gsuiSlider-lineBgColor, #000 )}.gsuiSlider-lineColor{position:absolute;background-color:var(--gsuiSlider-lineColor, #fff )}.gsuiSlider-svg{position:absolute;width:100%;height:100%;pointer-events:none}.gsuiSlider-svgLine,.gsuiSlider-svgLineColor{fill:none;transform-origin:center}.gsuiSlider-svgLine{stroke:var(--gsuiSlider-lineBgColor, #000 )}.gsuiSlider-svgLineColor{stroke:var(--gsuiSlider-lineColor, #fff )}gsui-slidergroup{--gsuiSliderGroup-currentTime-color:var( --gsui-col-currentTimeCursor );--gsuiSliderGroup-defaultValue-color:#0004;--gsuiSliderGroup-slider-width:6px;--gsuiSliderGroup-slider-bg:#0002;--gsuiSliderGroup-slider-color:rgba( var( --gsui-rgb-pattern ), .8 );--gsuiSliderGroup-slider-color-selected:rgba( var( --gsui-rgb-patternSelected ), .8 );--gsuiSliderGroup-loop-color:#0004;overflow:hidden;z-index:0}.gsuiSliderGroup-slidersWrap{position:absolute;width:100%;top:0;bottom:0;overflow:auto;scrollbar-width:none}.gsuiSliderGroup-slidersWrap::-webkit-scrollbar{display:none}.gsuiSliderGroup-sliders{position:absolute;width:1000000px;height:100%;user-select:none}.gsuiSliderGroup-slider{position:absolute;overflow:hidden;top:0;bottom:0;cursor:pointer}.gsuiSliderGroup-slider::before{content:"";position:absolute;height:100%;width:var(--gsuiSliderGroup-slider-width);background-color:var(--gsuiSliderGroup-slider-bg)}.gsuiSliderGroup-slidersSelected .gsuiSliderGroup-slider:not(.gsuiSliderGroup-sliderSelected){pointer-events:none}.gsuiSliderGroup-sliderInner{position:absolute;width:var(--gsuiSliderGroup-slider-width);color:var(--gsuiSliderGroup-slider-color);background-color:currentColor}.gsuiSliderGroup-sliderSelected .gsuiSliderGroup-sliderInner{color:var(--gsuiSliderGroup-slider-color-selected)}.gsuiSliderGroup-sliderInner::after{content:"";position:absolute;box-sizing:border-box;width:1000000px;height:100%;border:0 solid;border-width:1px 0 0}.gsuiSliderGroup-sliderInnerDown::after{border-width:0 0 1px}.gsuiSliderGroup-currentTime,.gsuiSliderGroup-loop{position:absolute;z-index:2147483647;top:0;bottom:0;pointer-events:none}.gsuiSliderGroup-defaultValue{position:absolute;left:0;right:0;border-top:1px dotted var(--gsuiSliderGroup-defaultValue-color);pointer-events:none}.gsuiSliderGroup-currentTime{width:2px;margin-left:-1px;background-color:var(--gsuiSliderGroup-currentTime-color)}.gsuiSliderGroup-loop{background-color:transparent;transition:.2s background-color}.gsuiSliderGroup-loopA{left:0}.gsuiSliderGroup-loopB{right:0}.gsuiSliderGroup-loopOn{background-color:var(--gsuiSliderGroup-loop-color)}gsui-libraries{--gsuiLibraries-head-bg:#666;display:flex;flex-direction:column;height:100%;user-select:none}.gsuiLibraries-head{display:flex;align-items:center;gap:4px;height:24px;min-height:24px;line-height:1;padding:0 6px;font-size:11px;background-color:var(--gsuiLibraries-head-bg);user-select:none}.gsuiLibraries-head-icon,.gsuiLibraries-head-title{font-weight:700;opacity:.7}.gsuiLibraries-libBtns{display:flex;margin-left:8px;border-radius:4px;background-color:#0004;overflow:hidden}.gsuiLibraries-libBtn{display:flex;align-items:center;height:18px;border:0;outline:0;padding:1px 3px 0 6px;font:inherit;font-size:9px;font-weight:700;cursor:pointer;background-color:transparent}.gsuiLibraries-libBtn+.gsuiLibraries-libBtn{padding-left:3px}.gsuiLibraries-libBtn:last-child{padding-right:6px}gsui-libraries:not([lib=default]) .gsuiLibraries-libBtn[data-lib=default],gsui-libraries:not([lib=local]) .gsuiLibraries-libBtn[data-lib=local]{opacity:.3}.gsuiLibraries-body{position:relative;flex:1}gsui-libraries:not([lib=default]) .gsuiLibrary-default,gsui-libraries:not([lib=local]) .gsuiLibrary-local{display:none}.gsuiLibrary-body,gsui-library{display:flex;flex-direction:column}gsui-library{--gsuiLibrary-bg:#233240;--gsuiLibrary-head-bg:#666;--gsuiLibrary-sample-fav:#9af;--gsuiLibrary-sample-hover-bg:#fff1;height:100%;user-select:none}.gsuiLibrary-body{flex:1;z-index:0;position:relative;align-content:flex-start;flex-wrap:wrap;overflow:auto hidden;background-color:var(--gsuiLibrary-bg)}.gsuiLibrary-placeholder{display:none;align-items:center;justify-content:center;box-sizing:border-box;width:100%;height:100%;padding:0 2ch;text-align:center;font-size:12px;font-style:italic;opacity:.4}.gsuiLibrary-placeholder:only-child{display:flex}.gsuiLibrary-sep{z-index:1;box-sizing:border-box;width:100px;height:40px;padding:18px 8px 0 0;counter-reset:smpNum 0}.gsuiLibrary-sep-btn{display:flex;max-width:100%;gap:1ch;cursor:pointer;border:0;padding:4px;font-size:9px;font-weight:700;background:0 0}.gsuiLibrary-sep .gsuiIcon{opacity:.3;pointer-events:none}.gsuiLibrary-sep span{white-space:nowrap;text-overflow:ellipsis;overflow:hidden;padding-right:.1ch;pointer-events:none}.gsuiLibrary-sep span:empty::before{content:"no name";font-style:italic;opacity:.5}.gsuiLibrary-sep-expanded .gsuiIcon{transform:rotate(90deg)}.gsuiLibrary-sample,.gsuiLibrary-sample::after{position:relative;align-items:center;pointer-events:none}.gsuiLibrary-sample{display:flex;overflow:hidden;width:100px;height:20px;margin-top:-20px;cursor:pointer;opacity:0;counter-increment:smpNum 1;transition:margin-top .3s,opacity .3s,background-color .2s}.gsuiLibrary-sample-expanded{margin-top:0;opacity:1;pointer-events:auto}.gsuiLibrary-sample-loading{animation:.2s alternate infinite gsuiLibrary-sample-loading-anim}.gsuiLibrary-sample::after{content:counter(smpNum);display:inline-flex;margin-left:auto;margin-right:5px;padding:1px 3px;border-radius:3px;font-size:9px;font-family:var(--gsui-font-monospace);background-color:var(--gsuiLibrary-bg)}.gsuiLibrary-sample-fav::after{color:var(--gsuiLibrary-bg);font-weight:700;background-color:var(--gsuiLibrary-sample-fav)}.gsuiLibrary-sample-wave{position:absolute;width:100%;height:100%;pointer-events:none}.gsuiLibrary-sample-svg{position:absolute;fill:currentColor;width:100%;height:100%;opacity:.2}.gsuiLibrary-sample-fav .gsuiLibrary-sample-svg{opacity:.4;fill:var(--gsuiLibrary-sample-fav)}.gsuiLibrary-sample:hover .gsuiLibrary-sample-svg{opacity:.4}.gsuiLibrary-sample-fav:hover .gsuiLibrary-sample-svg{opacity:.6}.gsuiLibrary-sample-cursor{display:none;position:absolute;left:0;width:2px;height:100%;margin-left:-1px;background-color:currentColor;transition:0s linear left;pointer-events:none}.gsuiLibrary-sample-cursor::before{position:absolute;content:"";top:0;bottom:0;right:100%;width:10px;background-image:linear-gradient(90deg,transparent,currentColor);opacity:.2}.gsuiLibrary-sample-playing .gsuiLibrary-sample-cursor{display:block}gsui-patterns{--gsuiPatterns-panel-menu-bg:#666;--gsuiPatterns-panel-btnSolid-bg:#444;--gsuiPatterns-newSlicesBtn-color:#e29d8a;--gsuiPatterns-newSynthBtn-color:#a5d6a7;--gsuiPatterns-newDrumsBtn-color:#81d4fa;--gsuiPatterns-synth-bg:#528754;--gsuiPatterns-synth-color:#222;--gsuiPatterns-synth-selected-color:#444;--gsuiPatterns-synth-expand-bg:#0000001a;--gsuiPatterns-synth-selected-bg:#66bb6a;--gsuiPatterns-synth-namehover-color:#7b7;--gsuiPatterns-synth-patterns-bg:#0006;--gsuiPatterns-synth-dest-bg:#0000001a;--gsuiPatterns-synth-placeholder-color:#fff6;--gsuiPatterns-synth-placeholder-bg:#0003;--gsuiPatterns-pattern-bg:#334;--gsuiPatterns-pattern-color:var( --gsui-col-pattern );--gsuiPatterns-pattern-selected-bg:var( --gsui-col-pattern );--gsuiPatterns-pattern-selected-color:#223;--gsuiPatterns-pattern-head-bg:#0003;--gsuiPatterns-pattern-head-selected-bg:#fff3;--gsuiPatterns-pattern-dest-bg:#fff1;--gsuiPatterns-pattern-h:54px;--gsuiPatterns-pattern-head-h:22px;--gsuiPatterns-pattern-grip-w:16px;display:block;height:100%}#gsuiPatterns-infoPopupContent label{display:flex;align-items:center;height:32px;cursor:pointer}#gsuiPatterns-infoPopupContent .gsuiIcon{width:20px;margin-left:.4ch;margin-right:.8ch}#gsuiPatterns-infoPopupContent input[name=bpm]{margin-left:8px;width:8ch}#gsuiPatterns-infoPopupContent input[name=name]{width:214px}#gsuiPatterns-infoPopupContent span+span{margin-left:8px}#gsuiPatterns-infoPopupContent input[value=loop]:not(:checked)~input[name=bpm],#gsuiPatterns-infoPopupContent input[value=loop]:not(:checked)~span:last-of-type{opacity:.4}.gsuiPatterns-panel:first-child{min-height:24px}.gsuiPatterns-panel{display:flex;flex-direction:column;min-height:28px}.gsuiPatterns-panelBuffers,.gsuiPatterns-panelDrums,.gsuiPatterns-panelSlices{height:20%}.gsuiPatterns-panelKeys{height:40%}.gsuiPatterns-panel-menu{display:flex;align-items:center;height:24px;min-height:24px;gap:4px;padding:0 6px;font-size:11px;background-color:var(--gsuiPatterns-panel-menu-bg);user-select:none}.gsuiPatterns-panel-icon,.gsuiPatterns-panel-title{line-height:1;opacity:.7}.gsuiPatterns-panel-title{font-weight:700}.gsuiPatterns-panel-menu .gsuiPatterns-btnSolid{width:16px}.gsuiPatterns-panel-list-wrap{position:relative;flex:1}.gsuiPatterns-panel-list{overflow:auto;position:absolute;inset:0}.gsuiPatterns-panel-list:empty{display:none}.gsuiPatterns-destArrow{margin:0 4px;opacity:.7;pointer-events:none}.gsuiPatterns-btnSolid{display:inline-flex;align-items:center;justify-content:center;overflow:hidden;height:16px;padding:0 6px;border:0;outline:0;cursor:pointer;border-radius:3px;line-height:1;color:inherit;font:inherit;font-weight:700;text-align:start;background-color:var(--gsuiPatterns-panel-btnSolid-bg);transition:filter .2s}.gsuiPatterns-btnSolid:focus,.gsuiPatterns-btnSolid:hover{filter:brightness(1.1)}.gsuiPatterns-btnSolid[data-action=newSlices]{color:var(--gsuiPatterns-newSlicesBtn-color)}.gsuiPatterns-btnSolid[data-action=newSynth]{color:var(--gsuiPatterns-newSynthBtn-color)}.gsuiPatterns-btnSolid[data-action=newDrums]{color:var(--gsuiPatterns-newDrumsBtn-color)}.gsuiPatterns-btnIcon{pointer-events:none}.gsuiPatterns-btnText{margin-left:4px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;pointer-events:none}.gsuiPatterns-placeholder{display:none;overflow:hidden;height:100%;padding:0 10px;text-align:center;align-items:center;justify-content:center;font-size:12px;font-weight:700;opacity:0;transition:.3s;transition-property:opacity;user-select:none}.gsuiPatterns-placeholderToCheck .gsuiPatterns-placeholder:only-child,.gsuiPatterns-placeholderToCheck:empty+.gsuiPatterns-placeholder{display:flex;opacity:.4}.gsuiPatterns-synth{display:flex;flex-direction:column;color:var(--gsuiPatterns-synth-color);border-bottom:0 solid var(--gsuiPatterns-synth-bg);background-color:var(--gsuiPatterns-synth-bg);transition:.2s;transition-property:border-bottom-color,background-color,filter}.gsuiPatterns-synth-expanded{filter:brightness(1.1);border-bottom-width:2px}.gsuiPatterns-synth-selected{--gsuiPatterns-synth-bg:var( --gsuiPatterns-synth-selected-bg );--gsuiPatterns-synth-color:var( --gsuiPatterns-synth-selected-color )}.gsuiPatterns-synth-head{display:flex;height:32px;line-height:32px;font-size:11px;user-select:none}.gsuiPatterns-synth-btn{width:20px;min-width:20px;margin:0;border:0;outline:0;padding:0;opacity:.7;color:inherit;cursor:pointer;background:0 0;transition:.1s;transition-property:background-color,opacity}.gsuiPatterns-synth-btn:focus,.gsuiPatterns-synth-btn:hover{opacity:1}.gsuiPatterns-synth:not(.gsuiPatterns-synth-selected) .gsuiPatterns-synth-btn:hover{color:var(--gsuiPatterns-synth-namehover-color)}.gsuiPatterns-synth-expand{width:16px;min-width:16px;background-color:var(--gsuiPatterns-synth-expand-bg)}.gsuiPatterns-synth-expanded .gsuiPatterns-synth-expand{opacity:1}.gsuiPatterns-synth-info,.gsuiPatterns-synth-name{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.gsuiPatterns-synth-info{flex:1;display:flex;align-items:center;padding-left:6px;font-weight:700}.gsuiPatterns-synth-name{pointer-events:none}.gsuiPatterns-synth-name:empty::before{content:"Untitled";font-style:italic;opacity:.8}.gsuiPatterns-synth-dest{background-color:var(--gsuiPatterns-synth-dest-bg)}.gsuiPatterns-synth-dest:focus,.gsuiPatterns-synth-dest:hover{color:var(--gsuiPatterns-synth-bg);background-color:var(--gsuiPatterns-panel-btnSolid-bg)}.gsuiPatterns-synth-patterns{position:relative;overflow:hidden;min-height:0;background-color:var(--gsuiPatterns-synth-patterns-bg);transition:.3s min-height}.gsuiPatterns-synth-expanded .gsuiPatterns-synth-patterns{overflow-y:auto;min-height:32px}.gsuiPatterns-synth .gsuiPatterns-pattern{margin-top:calc(var(--gsuiPatterns-pattern-h)*-1)}.gsuiPatterns-synth-expanded .gsuiPatterns-pattern{margin-top:0}.gsuiPatterns-synth .gsuiPatterns-placeholder{position:absolute;inset:0}.gsuiPatterns-pattern{overflow:hidden;position:relative;box-sizing:border-box;flex-direction:column;height:var(--gsuiPatterns-pattern-h);color:var(--gsuiPatterns-pattern-color);font-size:11px;border-bottom:2px solid transparent;background-color:var(--gsuiPatterns-pattern-bg);transition:margin-top .3s,background-color .1s}.gsuiPatterns-pattern-selected{--gsuiPatterns-pattern-bg:var( --gsuiPatterns-pattern-selected-bg );--gsuiPatterns-pattern-color:var( --gsuiPatterns-pattern-selected-color );--gsuiPatterns-pattern-head-bg:var( --gsuiPatterns-pattern-head-selected-bg )}.gsuiPatterns-pattern-grip{position:absolute;inset:0;width:calc(var(--gsuiPatterns-pattern-grip-w) - 2px);cursor:grab;text-align:center;line-height:var(--gsuiPatterns-pattern-h);background-color:var(--gsuiPatterns-pattern-head-bg)}.gsuiPatterns-pattern-btn{width:20px;border:0;outline:0;padding:0;opacity:.7;color:inherit;cursor:pointer;background:0 0;transition:.1s opacity}.gsuiPatterns-pattern-btn:focus,.gsuiPatterns-pattern-btn:hover{opacity:1}.gsuiPatterns-pattern-head{display:flex;box-sizing:border-box;position:absolute;inset:0 0 auto var(--gsuiPatterns-pattern-grip-w);height:var(--gsuiPatterns-pattern-head-h);line-height:var(--gsuiPatterns-pattern-head-h);background-color:var(--gsuiPatterns-pattern-head-bg);transition:inherit}.gsuiPatterns-pattern-info{flex:1;display:flex;align-items:center;padding:0 6px;overflow:hidden}.gsuiPatterns-pattern-btnInfo{width:1em;font-size:14px;margin-right:8px}.gsuiPatterns-pattern-name{overflow:hidden;white-space:nowrap;text-overflow:ellipsis;font-weight:700}.gsuiPatterns-pattern-name:empty::after{content:"Untitled";font-style:italic;opacity:.5}.gsuiPatterns-pattern-dest{background-color:var(--gsuiPatterns-pattern-dest-bg)}.gsuiPatterns-pattern-dest:focus,.gsuiPatterns-pattern-dest:hover{color:var(--gsuiPatterns-pattern-bg);background-color:var(--gsuiPatterns-pattern-color)}.gsuiPatterns-pattern-content,.gsuiPatterns-pattern-placeholder{position:absolute;inset:var(--gsuiPatterns-pattern-head-h)0 0 var(--gsuiPatterns-pattern-grip-w);pointer-events:none}.gsuiPatterns-pattern-svg{position:absolute;inset:0;width:100%;height:100%;opacity:.8;fill:currentColor}.gsuiPatterns-pattern-placeholder{display:none;align-items:center;font-size:14px;opacity:.5}.gsuiPatterns-pattern[data-missing] .gsuiPatterns-pattern-placeholder{display:flex}.gsuiPatterns-pattern-placeholderIcon{margin:0 8px}.gsuiPatterns-pattern-placeholderText{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;user-select:none}gsui-toggle{position:relative;display:inline-flex;align-items:center;justify-content:center;font:8px"FontAwesome";outline:0;cursor:pointer;color:var(--gsui-toggle-on);transition:color .1s}gsui-toggle[off]{color:var(--gsui-toggle-off)}gsui-toggle::after,gsui-toggle::before{transition:.2s text-shadow;pointer-events:none}gsui-toggle:focus-visible::after,gsui-toggle:focus-visible::before{text-shadow:0 0 10px var(--gsui-toggle-on)}gsui-toggle::before{position:absolute;content:"?";opacity:.6}gsui-toggle::after{content:"??"}.gsuiTrack-row,gsui-track{transition:.2s background-color}gsui-track{box-sizing:border-box;display:flex;height:100%;border-top:2px solid #ffffff11;border-bottom:2px solid #0000003b;background-color:var(--gsui-item-bg)}.gsuiTrack-row{position:relative;z-index:0;height:var(--gsuiTimewindow-lineH)}gsui-track[mute]{border:0;background-color:var(--gsui-item-bg-disabled)}.gsuiTrack-row::before{content:"";position:absolute;inset:0;border-top:2px solid #ffffff0b;border-bottom:2px solid #00000026}.gsuiTrack-row.gsui-mute{border:0;background-color:#00000012}.gsuiTrack-row>div{position:absolute;inset:0;font-size:var(--gsuiTimewindow-pxperbeat)}.gsuiTrack-row.gsui-mute>div{top:0}gsui-track gsui-toggle{min-width:24px}.gsuiTrack-nameWrap{position:relative;flex:1}.gsuiTrack-name{box-sizing:border-box;position:absolute;inset:0;width:100%;border:0;outline:0;padding-right:10px;font-size:12px;font-weight:700;font-family:inherit;text-overflow:ellipsis;color:inherit;cursor:default;background:0 0;user-select:none}gsui-track[mute] .gsuiTrack-name{opacity:.5}.gsuiTrack-name:focus{font-weight:400}.gsuiTrack-name::placeholder{color:inherit;font-style:italic;font-weight:400;opacity:.3}.gsuiTrack-name:focus::placeholder{color:transparent}gsui-window{--gsuiWindow-bg:#444;--gsuiWindow-color:#222;--gsuiWindow-head-bg:#888;--gsuiWindow-border-color:#444;--gsuiWindow-btn-close-color:#ba5d5d88;--gsuiWindow-focused-border-color:#689acb;--gsuiWindow-radius:2px;--gsuiWindow-head-height:24px;--gsuiWindow-border-width:2px;--gsuiWindow-handler-width:4px;--gsuiWindow-title-opacity:.8;position:absolute;z-index:0;outline:0;border-radius:var(--gsuiWindow-radius);transition:.2s;transition-property:opacity,visibility}gsui-windows{display:block;height:100%;position:relative;overflow:auto;scroll-behavior:smooth}gsui-windows.gsuiWindows-maximized{overflow:hidden}gsui-window:not(.gsuiWindow-show){opacity:0;visibility:hidden;pointer-events:none}gsui-window:focus-within{--gsuiWindow-title-opacity:1;--gsuiWindow-border-color:var( --gsuiWindow-focused-border-color )}.gsuiWindow-maximized{--gsuiWindow-radius:0;inset:0;overflow:hidden}.gsuiWindow-handlers::before,.gsuiWindows-lowGraphics .gsuiWindow-dragging,gsui-window:not(.gsuiWindow-dragging){box-shadow:0 0 0 var(--gsuiWindow-border-width) var(--gsuiWindow-border-color)}.gsuiWindow-handlers{position:absolute;opacity:0;inset:0;margin:calc(var(--gsuiWindow-handler-width)*-1)}.gsuiWindow-handlers::before{content:"";z-index:1;position:absolute;pointer-events:none;border-radius:var(--gsuiWindow-radius);inset:var(--gsuiWindow-handler-width)}.gsuiWindow-dragging .gsuiWindow-handlers{opacity:1}.gsuiWindow-maximized .gsuiWindow-handlers,.gsuiWindow-minimized .gsuiWindow-handler{display:none}.gsuiWindow-handler{position:absolute;width:calc(var(--gsuiWindow-handler-width)*2);height:calc(var(--gsuiWindow-handler-width)*2)}.gsuiWindow-handler[data-dir=nw]{cursor:nw-resize;top:0;left:0}.gsuiWindow-handler[data-dir=ne]{cursor:ne-resize;top:0;right:0}.gsuiWindow-handler[data-dir=sw]{cursor:sw-resize;bottom:0;left:0}.gsuiWindow-handler[data-dir=se]{cursor:se-resize;bottom:0;right:0}.gsuiWindow-handler[data-dir=n]{cursor:n-resize;top:0;width:100%}.gsuiWindow-handler[data-dir=w]{cursor:w-resize;left:0;height:100%}.gsuiWindow-handler[data-dir=e]{cursor:e-resize;right:0;height:100%}.gsuiWindow-handler[data-dir=s]{cursor:s-resize;bottom:0;width:100%}.gsuiWindow-wrap{position:absolute;overflow:hidden;inset:0;border-radius:inherit}.gsuiWindow-head{display:flex;position:absolute;inset:0;height:var(--gsuiWindow-head-height);color:var(--gsuiWindow-color);background-color:var(--gsuiWindow-head-bg);user-select:none;-webkit-user-select:none}.gsuiWindow-dragging .gsuiWindow-head{cursor:move}.gsuiWindow-minimized .gsuiWindow-head{border-radius:inherit}.gsuiWindow-content{position:absolute;overflow:auto;inset:var(--gsuiWindow-head-height)0 0;background-color:var(--gsuiWindow-bg)}.gsuiWindow-minimized .gsuiWindow-content{display:none}.gsuiWindow-icon,.gsuiWindow-title{opacity:var(--gsuiWindow-title-opacity);transition:.2s opacity}.gsuiWindow-icon{border:0;padding:0;outline:0;width:24px;min-width:24px;color:inherit;cursor:inherit;font-size:12px;background:0 0}.gsuiWindow-title{overflow:hidden;white-space:nowrap;text-overflow:ellipsis;font-size:11px;font-weight:700;line-height:var(--gsuiWindow-head-height)}.gsuiWindow-headContent{flex:1;display:flex;align-items:center;padding-left:.5em}.gsuiWindow-headBtns{height:100%;display:flex;margin-left:auto;align-items:center}.gsuiWindow-headBtn{border:0;padding:0;outline:0;width:var(--gsuiWindow-head-height);height:100%;cursor:pointer;color:inherit;font-size:10px;opacity:.6;transition:.2s;transition-property:opacity,background-color;background:0 0}.gsuiWindow-headBtn:focus,.gsuiWindow-headBtn:hover{opacity:1;background-color:rgba(0,0,0,.1)}.gsuiWindow-headBtn[data-icon=close]{font-size:12px}.gsuiWindow-headBtn[data-icon=close]:focus,.gsuiWindow-headBtn[data-icon=close]:hover{background-color:var(--gsuiWindow-btn-close-color)}.gsuiWindow-maximized .gsuiWindow-headBtn[data-icon=maximize],.gsuiWindow-minimized .gsuiWindow-headBtn[data-icon=minimize],gsui-window:not(.gsuiWindow-minimized):not(.gsuiWindow-maximized) .gsuiWindow-headBtn[data-icon=restore]{display:none}
</style>
</head>
<body>
<noscript>GridSound needs JavaScript to run</noscript>
<div id="splashScreen">
	<div id="splashScreen-content">
		<div id="splashScreen-title" class="TextGlitch" inert>
			<div class="TextGlitch-clip">
				<div class="TextGlitch-word">GridSound</div>
				<div class="TextGlitch-word TextGlitch-blend TextGlitch-blendA"></div>
				<div class="TextGlitch-word TextGlitch-blend TextGlitch-blendB"></div>
			</div>
			<div class="TextGlitch-clip">
				<div class="TextGlitch-word"></div>
				<div class="TextGlitch-word TextGlitch-blend TextGlitch-blendA"></div>
				<div class="TextGlitch-word TextGlitch-blend TextGlitch-blendB"></div>
			</div>
			<div class="TextGlitch-clip">
				<div class="TextGlitch-word"></div>
				<div class="TextGlitch-word TextGlitch-blend TextGlitch-blendA"></div>
				<div class="TextGlitch-word TextGlitch-blend TextGlitch-blendB"></div>
			</div>
		</div>
		<div id="splashScreen-version">0.40.1</div>
		<button id="splashScreen-start" disabled></button>
		<div id="splashScreen-form">
			<label class="splashScreen-form-row">
				<input type="checkbox" name="cookies" />
				<span>I authorize GridSound to store cookies on my device.</span>
			</label>
		</div>
	</div>
</div>
<script>function lg( a ) { return a; }</script>
<script>
"use strict";navigator.serviceWorker&&navigator.serviceWorker.register("serviceWorker.js").then((t=>{console.log("Service worker "+(t.installing?"installing":t.waiting?"installed":t.active?"active":""))}),console.log.bind(console,"Service worker registration failed")),window.AudioContext&&window.customElements||(window.top.location="https://gridsound.com/unsupported-browsers");class t{static url="//api.gridsound.com/";static headers=Object.freeze({"Content-Type":"application/json; charset=utf-8"});static user={};static getMe(){return t.#t("GET","getMe.php").then((s=>t.#s(s)))}static getUser(s){return t.#t("GET",`getUser.php?username=${s}`).then((({data:t})=>(t.usernameLow=t.username.toLowerCase(),t)))}static getUserCompositions(s){return t.#t("GET",`getUserCompositions.php?id=${s}`).then((({data:t})=>(t.forEach((t=>t.data=JSON.parse(t.data))),t)))}static getComposition(s){return t.#t("GET",`getComposition.php?id=${s}`).then((({data:t})=>(t.composition.data=JSON.parse(t.composition.data),t)))}static login(s,i){return t.#t("POST","login.php",{email:s,pass:i}).then((s=>t.#s(s)))}static signup(s,i,e){return t.#t("POST","createUser.php",{username:s,email:i,pass:e}).then((s=>t.#s(s)))}static resendConfirmationEmail(){return t.#t("POST","resendConfirmationEmail.php",{email:t.user.email})}static recoverPassword(s){return t.#t("POST","recoverPassword.php",{email:s})}static resetPassword(s,i,e){return t.#t("POST","resetPassword.php",{email:s,code:i,pass:e})}static logout(){return t.#t("POST","logout.php",{confirm:!0}).then((s=>t.#i(s)))}static logoutRefresh(){return t.logout().then((()=>{setTimeout((()=>location.href=location.origin+location.pathname),500)}))}static updateMyInfo(s){return t.#t("POST","updateMyInfo.php",s).then((s=>t.#s(s)))}static saveComposition(s){return t.#t("POST","saveComposition.php",{composition:JSON.stringify(s)})}static deleteComposition(s){return t.#t("POST","deleteComposition.php",{id:s})}static#s(s){const i=s.data;return i.usernameLow=i.username.toLowerCase(),i.emailpublic="1"===i.emailpublic,i.emailchecked="1"===i.emailchecked,Object.assign(t.user,i),i}static#i(s){return Object.keys(t.user).forEach((s=>delete t.user[s])),s}static#t(s,i,e){const n={method:s,headers:t.headers,credentials:"include"};return e&&(n.body=JSON.stringify(e)),fetch(t.url+i,n).then((t=>t.text())).then((t=>{try{return JSON.parse(t)}catch(s){return{ok:!1,code:500,msg:t}}})).then((s=>t.#e(s)))}static#e(s){if(!s.ok)throw s.msg=t.errorCode[s.msg]||s.msg,s;return s}static errorCode={"user:not-connected":"You are not connected","query:bad-format":"The query is incomplete or corrupted","login:fail":"The email/password don't match","pass:too-short":"The password is too short","email:too-long":"The email is too long","email:not-found":"This email is not in the database","email:duplicate":"This email is already used","email:bad-format":"The email is not correct","email:not-verified":"Your email is not verified","username:too-long":"The username is too long","username:too-short":"The username is too short","username:duplicate":"This username is already taken","username:bad-format":"The username can only contains letters, digits and _","password:bad-code":"Can not change the password because the secret code and the email do not match","password:already-recovering":"A recovering email has already been sent to this address less than 1 day ago"}}const s={effects:{}},i={},e=new Map,n={},a={};class h{static#n=Object.freeze({gs:!0,txt:!0,json:!0});cb={};ctx=null;#a=new Map;#h=new Map;#o=new Map;#r=new B;#c=new Map;#l=new R;#u=new I({getChanInput:this.#r.o.bind(this.#r),getChanOutput:this.#r.l.bind(this.#r)});u=Object.seal({p:120,m:1,v:21,k:4,$:4,O:48e3,S:8192,D:!0});#d=Object.seal({C:null,P:null,M:null,A:null,T:null,B:1});#p=Object.seal({j:[],L:0});#g=Object.seal({W:null,F:new Map,I:new Map});#m=Object.seal({K:new N,R:new Map,N:4,G:!1,H:!1,V:null,U:null});#b=Object.seal({_:new L,Y:{},H:!1,G:!1,J:null,V:null,U:null,N:0});#w=Object.seal({X:new E,H:!1,G:!1,V:null,U:null,N:0});#f=Object.seal({K:new N,Z:new Map,R:new Map,tt:null,st:!1,G:!1,it:!0,et:null});#v="composition";#y="keys";#k=this.#$.bind(this);#O=1;#x=null;nt(t){return this.ht(t)}ot(t,s){return this.ht(t).get(s)}rt(){return this.#f.tt.options.saveMode}ct(t){return this.#f.tt[n.patternOpenedByType[t]]}lt(){return this.ctx}ut(){return this.#d.M}dt(){return this.#d.B}gt(){return this.#u}bt(t){return this.#u.wt(t)}ft(){return this.#c}vt(t){return this.#c.get(t)}yt(){return this.#l}kt(){return this.#r}$t(t){return this.#r.o(t)}Ot(t){return this.#r.l(t)}xt(t){return this.St(t)}Dt(t){return this.#g.I.get(this.Ct(t).url||this.Ct(t).hash)}ht(t){return"local"===t?this.#a:this.#h}Pt(){return this.#f.tt}Mt(){return this.#f.tt.name}At(){return this.#f.tt.loopA}Tt(){return this.#f.tt.loopB}Bt(){return this.#f.tt.duration}jt(){return this.#f.tt.id}Lt(){return this.#f.tt.bpm}Et(){return this.#f.tt.bpm/60}Wt(){return this.#f.tt.timedivision}Ft(){return+this.#f.tt.timedivision.split("/")[0]}It(){return+this.#f.tt.timedivision.split("/")[1]}Kt(){return this.#f.tt.blocks}zt(t){return this.#f.tt.blocks[t]}Rt(){return this.#f.tt.buffers}Ct(t){return this.#f.tt.buffers[t]}Nt(){return this.#f.tt.channels}Gt(t){return this.#f.tt.channels[t]}Ht(t){return t?this.#f.tt.slices[t]:this.#f.tt.slices}Vt(){return this.#f.tt.drumrows}Ut(t){return this.#f.tt.drumrows[t]}qt(t){return t?this.#f.tt.drums[t]:this.#f.tt.drums}_t(){return this.#f.tt.effects}Yt(t){return this.#f.tt.effects[t]}Jt(t){return t?this.#f.tt.keys[t]:this.#f.tt.keys}Xt(){return this.#f.tt.patterns}Qt(t){return this.#f.tt.patterns[t]}Zt(){return this.#f.tt.synths}ts(t){return this.#f.tt.synths[t]}ss(){return this.#f.tt.tracks}es(t){return this.#f.tt.tracks[t]}ns(t,s){return this.hs(t)[s]}hs(t){switch(t){case"keys":return this.Jt();case"drums":return this.qt();case"slices":return this.Ht();case"buffer":return this.Rt()}}os(){const t=this.Kt(),s={};return Object.entries(t).forEach((([t,i])=>{i.track in s?s[i.track][t]=i:s[i.track]={[t]:i}})),s}rs(t){const s=this.Qt(t);return"slices"!==s.type?s.duration:s.source?this.Qt(s.source).duration:this.Ft()}constructor(){w.cs(this,this.#f),this.#l.Dt=this.Dt.bind(this),this.#l.ls=this.$t.bind(this),this.#l.us=t=>this.ds("onstartdrum",t),this.#l.ps=t=>this.ds("onstopdrumrow",t),this.#w.X.bs(this.#l),f.cs(this,this.#m),this.ws(60),this.fs(),this.vs(this.u.m)}vs(t){p.ys(this.#d,t)}ks(){return p.$s(this.#d)}Os(){g.xs(this,this.#p)}Ss(t,s){g.Ds(this,this.#p,t,s)}Cs(){return g.Ps(this.#p)}Ms(){return g.As(this,this.#p)}Ts(){return g.Bs(this,this.#p)}js(t,s){o.Ls(this,this.#g,t,s)}Es(){this.#g.F.clear(),this.#g.I.clear()}Ws(){return this.#g.F.size}Fs(t){return o.Is(this,this.#g,t)}Ks(t){return o.Dt(this,this.#g,t)}zs(t){return o.Rs(this,this.#g,t)}Ns(t){return o.Gs(this,this.#g,t)}Hs(){return o.Vs(this.#g)}Us(){this.#o.clear()}St(t){return this.#o.get(t)}qs(t){b.Ls(this,this.#o,t)}_s(t){b.Ys(this,this.#o,t)}Js(t,s){return l.Xs(this.ot(t,s))}Qs(){return u.Xs(this)}Zs(){u.ti(this)}si(){return!this.#f.it}ii(t){return c.ei(this,t)}ni(){return c.ai(this)}hi(t,s){return c.oi(this,t,s)}ri(t,s){return c.ci(this,t,s)}li(t,s){return c.ui(this,t,s)}di(t){return w.pi(this,this.#f,t)}gi(){w.mi(this,this.#f)}bi(){return w.wi(this,this.#f)}fi(){w.vi(this)}yi(){return w.ki(this.#f)}$i(t){w.Oi(this,this.#f,t)}xi(){w.Si(this,this.#f)}Di(){w.Ci(this.#f)}Pi(){w.Mi(this,this.#f)}Ai(t,s){return w.Ls(this,this.#f,t,s)}Ti(t,s,i){this.#r.Ls({channels:{[t]:{[s]:i}}})}Bi(t,s,i){this.#u.ji(t,s,i)}Li(t,s){this.#c.get(t).Ls(s)}Ei(t){y.Ei(this.#b,t)}Wi(t){y.Wi(this.#b,t)}Fi(t,s,i){v.Fi(this,t,s,i)}Ii(t){v.Ii(this,t)}Ki(t){v.Ki(this,t)}zi(t,s){y.Ls(this.#b,t,s)}Ri(t){y.Ni(this,this.#b,t)}Gi(t){y.Hi(this,this.#b,t)}Vi(){return y.ki(this.#b)}Ui(t){y.Oi(this,this.#b,t)}qi(t){this.#b._.scheduler._i(t)}Yi(t,s){y.Ji(this.#b,t,s)}Xi(){y.Qi(this,this.#b)}Zi(){y.Si(this.#b)}te(){y.Ci(this.#b)}se(){y.Mi(this,this.#b)}ie(t){v.Ls(this,this.#w,t)}ee(){return v.ki(this.#w)}ne(t){v.Oi(this,this.#w,t)}ae(t,s){v.Ji(this.#w,t,s)}he(){v.Qi(this,this.#w)}oe(){v.Si(this.#w)}re(){v.Ci(this.#w)}ce(){v.Mi(this,this.#w)}le(t){f.Ls(this,this.#m,t)}ue(){return f.ki(this.#m)}de(t){f.Oi(this,this.#m,t)}pe(t,s){f.Ji(this.#m,t,s)}ge(){f.Qi(this,this.#m)}me(){f.Si(this.#m)}be(){f.Ci(this.#m)}we(){f.Mi(this,this.#m)}fe(t){this.ctx=t,this.#w.X.fe(t),f.fe(this.#m,t),this.#b._.fe(t),this.#l.fe(t),p.fe(this.#d,this.u.D,this.u.S,t),V.ve(),this.#r.fe(t),this.#r.ye(this.ut()),this.#u.fe(t),this.#c.forEach(((s,i)=>{s.fe(t),s.ke.disconnect(),s.ke.connect(this.$t(this.ts(i).dest))}))}fs(){this.Mi(),this.fe(new AudioContext({sampleRate:this.u.O}))}$e(t,...s){const n=e.get(t);if(n){const t=i.Oe(n(this,...s));if(Array.isArray(t))return this.Ss(...t),t[0];if(t)return this.Ai(t,i.xe(this.Pt(),t)),t}else console.error(`DAWCore: undefined action "${t}"`)}ds(t,...s){const i=this.cb[t];return i&&i(...s)}Se(t,s){const i=this.ot(t,s);if(i)return this.#f.st&&this.De(),(this.ot(t,s)?Promise.resolve(i):this.ii({saveMode:t})).then((t=>this.di(t))).then((t=>this.#S(t)))}#S(t){return this.Ce("composition"),this.ds("compositionOpened",t),this.#D(),t}De(){if(this.#f.st){const t=this.ht(this.rt()).get(this.jt());this.Mi(),this.Xi(),this.Ui(0),this.$i(0),this.#C(),this.ds("compositionClosed",t),this.gi(),this.Os(),this.Es(),t.savedAt||this.#P(t)}}Pe(t,s){this.#f.tt&&s===this.jt()&&this.De(),this.#P(this.ht(t).get(s))}#P(t){if(t){const s=t.options.saveMode;this.ht(s).delete(t.id),"local"===s&&r.Me(t.id),this.ds("compositionDeleted",t)}}Ae(){const t=this.#f.et;if(this.bi()){const s=this.Pt(),i=this.jt();"local"===this.rt()?(this.#a.set(i,s),r.Te(i,s),this.ds("compositionSavedStatus",s,!0)):(this.#f.it=!1,this.ds("compositionLoading",s,!0),(this.ds("compositionSavingPromise",s)||Promise.resolve(s)).finally(this.ds.bind(this,"compositionLoading",s,!1)).then((t=>(this.#f.it=!0,this.#h.set(i,s),this.ds("compositionSavedStatus",s,!0),t)),(i=>{throw this.#f.et=t,this.ds("compositionSavedStatus",s,!1),i})))}}Be(t){o.je(this,this.#g,t).then((s=>(this.ds("buffersDropped",s),t))).then((t=>{const s=t.find((t=>t.name.split(".").pop().toLowerCase()in h.#n));return s&&this.ri(s)})).then((t=>t&&this.Se("local",t.id)))}Le(){return this.#v}Ee(){return"composition"===this.#v?this.Bt():this.rs(this.ct(this.#v))}We(){this.Ce("composition"===this.#v?this.#y:"composition","-f")}Ce(t,s){switch(t){case"keys":case"drums":case"slices":if(null!==this.ct(t))return void(this.#v!==t&&this.#M(t,s));case"composition":"composition"!==this.#v&&this.#M("composition",s)}}#M(t,s){"-f"!==s&&this.Fe()||(this.Ci(),this.#v=t,"composition"!==t&&(this.#y=t),this.ds("focusOn",t))}ki(){switch(this.#v){case"keys":return this.Vi();case"drums":return this.ee();case"slices":return this.ue();case"composition":return this.yi()}}Oi(t){switch(this.#v){case"keys":this.Ui(t);break;case"drums":this.ne(t);break;case"slices":this.de(t);break;case"composition":this.$i(t)}}Fe(){return this.#f.G||this.#b.G||this.#w.G||this.#m.G}Ie(){this.Fe()?this.Ci():this.Si()}Si(){switch(this.#v){case"keys":this.Zi();break;case"drums":this.oe();break;case"slices":this.me();break;case"composition":this.xi()}this.ds("play",this.#v)}Ci(){switch(this.#v){case"keys":this.te();break;case"drums":this.re();break;case"slices":this.be();break;case"composition":this.Di()}this.ds("pause",this.#v)}Mi(){switch(this.#v){case"keys":this.se();break;case"drums":this.ce();break;case"slices":this.we();break;case"composition":this.Pi()}this.Hs(),this.ds("stop",this.#v),this.ds("currentTime",this.ki(),this.#v)}Ke(t){t!==this.u.O&&(this.u.O=t,this.fs())}ws(t){this.#O=1e3/t|0}#D(){this.#$()}#C(){clearTimeout(this.#x),cancelAnimationFrame(this.#x)}#$(){const t=this.ks();if(t&&(this.fi(),this.ds("analyserFilled",t)),this.Fe()){const t=this.ki();this.ds("currentTime",t,this.#v)}this.#x=this.#O<20?requestAnimationFrame(this.#k):setTimeout(this.#k,this.#O)}}class o{static#A=["audio/wav","audio/wave","audio/flac","audio/webm","audio/ogg","audio/mpeg","audio/mp3","audio/mp4"];static Ls(t,s,i,e){"buffers"in i&&Object.entries(i.buffers).forEach((([i,n])=>{if(n){if(!o.Ct(s,n)){const e=o.Rs(t,s,n);n.url&&e.then((s=>t.ds("buffersLoaded",i,s)))}}else{const t=e.buffers[i];s.F.delete(t.hash||t.url)}}))}static Ct(t,s){return t.F.get(s.hash||s.url)}static Dt(t,s,i){return s.I.has(i)?Promise.resolve(s.I.get(i)):o.Is(t,s,i)}static Rs(t,s,i){const e={...i};return s.F.set(e.hash||e.url,e),e.url?o.Is(t,s,e.url).then((t=>(e.buffer=t,e.duration=+t.duration.toFixed(4),e))):Promise.resolve(e)}static Is(t,s,i){return fetch(`/??/${i}.wav`).then((t=>t.arrayBuffer())).then((s=>t.lt().decodeAudioData(s))).then((t=>(s.I.set(i,t),t)))}static Gs(t,s,i){const e=s.I.get(i),n=t.lt().createBufferSource();return o.Vs(s),s.W=n,n.buffer=e,n.connect(t.ut()),n.start(),e}static Vs(t){t.W?.stop()}static je(t,s,i){return i.then((t=>o.#T(t))).then((t=>o.#B(s.I,t))).then((s=>o.#j(t.lt(),s))).then((i=>o.#L(t,s.I,i)))}static#T(t){let s;return Promise.all(t.filter((t=>o.#A.includes(t.type))).reduce(((t,e)=>{const n=e.filepath.split("/"),a=(n.pop(),n.pop()||""),h=i.ze(e,"array").then((t=>[i.Re(new Uint8Array(t)),t,e.name]));return a!==s&&(s=a,t.push(a)),t.push(h),t}),[]))}static#B(t,s){return s.filter((s=>!Array.isArray(s)||!t.has(s[0]))).filter(((t,s,i)=>Array.isArray(t)||Array.isArray(i[s+1])))}static#j(t,s){return Promise.all(s.map((s=>Array.isArray(s)?t.decodeAudioData(s[1]).then((t=>[s[0],t,s[2]])):s)))}static#L(t,s,i){const e={};t.ct("slices");return i.forEach((i=>{if(Array.isArray(i)){const n=Object.entries(t.Rt()).find((t=>t[1].hash===i[0]));s.set(i[0],i[1]),n&&(n[1].buffer=i[1],e[n[0]]=n[1],t.ds("buffersLoaded",n[0],n[1]))}})),t._s(e),i}}class r{static Te(t,s){const e=i.Ne(s);d.Ge(e),localStorage.setItem(t,JSON.stringify(e))}static Me(t){localStorage.removeItem(t)}static He(t){return t in localStorage}static Ve(t){try{const s=JSON.parse(localStorage.getItem(t));return t===s.id?s:null}catch(t){return null}}static Ue(){const t=Object.keys(localStorage).reduce(((t,s)=>{const i=r.Ve(s);return i&&t.push(i),t}),[]);return t.sort(((t,s)=>t.savedAt<s.savedAt)),t}}class c{static ai(t){return Promise.all(r.Ue().map((s=>c.ui(t,s))))}static oi(t,s,i){return fetch(s).then((t=>{if(!t.ok)throw`The file is not accessible: ${s}`;return t.json()})).then((s=>c.ui(t,s,i)),(t=>{throw t}))}static ci(t,s,e){return i.ze(s,"text").then((s=>c.#E(t,s,e)))}static ui(t,s,e){const n=i.Ne(s);return n.options=Object.freeze({saveMode:"local",...e}),t.ht(n.options.saveMode).set(n.id,n),t.ds("compositionAdded",n),t.ds("compositionSavedStatus",n,!0),Promise.resolve(n)}static ei(t,e){const n=s.composition(t.u,i.qe());return c.ui(t,n,e)}static#E(t,s,i){return new Promise(((e,n)=>{try{const a=JSON.parse(s);c.ui(t,a,i).then(e,n)}catch(t){n(t)}}))}}class l{static#W=null;static#F=Object.freeze({keys:4,drums:4,synths:5,tracks:3,blocks:3,buffers:3,channels:3,patterns:3,drumrows:3});static Xs(t){if(t){const s=i.Ne(t),e=d.Ge(d._e(s));return{name:`${t.name||"untitled"}.gs`,url:l.#I(e)}}}static#I(t){const s=l.#F,i=/^\t"(\w*)": \{$/u,e=JSON.stringify(t,null,"\t").split("\n");let n,a,h;return l.#W&&URL.revokeObjectURL(l.#W),e.forEach(((t,o)=>{const r=i.exec(t);r&&(h=s[r[1]])&&(n=new RegExp(`^\\t{${h}}`,"u"),a=new RegExp(`^\\t{${h-1}}\\}`,"u")),h&&(e[o]=e[o].replace(n,"~").replace(a,"~}"))})),l.#W=URL.createObjectURL(new Blob([e.join("\n").replace(/\n~/gu," ")]))}}class u{static#W=null;static ti(t){t.ctx instanceof OfflineAudioContext&&t.Pi()}static Xs(t){const s=t.ctx,i=Math.ceil(t.Bt()/t.Et())||1,e=new OfflineAudioContext(2,i*s.sampleRate|0,s.sampleRate);return t.Mi(),u.#W&&URL.revokeObjectURL(u.#W),t.fe(e),t.xi(),e.startRendering().then((i=>{const e=G.Ye(i,{float32:!0}),n=URL.createObjectURL(new Blob([e]));return t.Pi(),t.fe(s),u.#W=n,{url:n,name:`${t.Mt()||"untitled"}.wav`}}))}}class d{static Ge(t){return delete t.options,null!=t.loopA&&null!=t.loopB||(delete t.loopA,delete t.loopB),Object.values(t.drumrows).forEach((t=>{t.toggle&&delete t.toggle})),Object.values(t.tracks).forEach((t=>{t.name||delete t.name,t.toggle&&delete t.toggle})),Object.values(t.blocks).forEach((t=>{t.offset||delete t.offset,t.selected||delete t.selected,t.durationEdited||delete t.durationEdited})),Object.values(t.keys).forEach((t=>{Object.values(t).forEach((t=>{t.offset||delete t.offset,t.selected||delete t.selected,null==t.prev&&delete t.prev,null==t.next&&delete t.next}))})),t}static _e(t){const e=Object.values(t.blocks);let n=0;return t.timedivision||(t.timedivision=t.beatsPerMeasure&&t.beatsPerMeasure?`${t.beatsPerMeasure}/${t.stepsPerBeat}`:"4/4"),delete t.beatsPerMeasure,delete t.stepsPerBeat,Number.isFinite(t.loopA)&&Number.isFinite(t.loopB)?(t.loopA=Math.max(0,t.loopA),t.loopB=Math.max(0,t.loopB),t.loopA===t.loopB&&(t.loopA=t.loopB=null)):t.loopA=t.loopB=null,t.synthOpened=t.synthOpened?`${t.synthOpened}`:null,t.patternKeysOpened=t.patternKeysOpened?`${t.patternKeysOpened}`:null,t.patternDrumsOpened=t.patternDrumsOpened?`${t.patternDrumsOpened}`:null,t.patternBufferOpened=t.patternBufferOpened?`${t.patternBufferOpened}`:null,t.patternSlicesOpened=t.patternSlicesOpened?`${t.patternSlicesOpened}`:null,delete t.patternOpened,t.buffers=t.buffers||{},Object.values(t.buffers).forEach((t=>{delete t.MIME,delete t.type})),t.slices=t.slices||{},t.drumrows=t.drumrows||{},Object.values(t.drumrows).forEach((t=>{t.toggle=!1!==t.toggle,t.detune=t.detune??0})),t.drums=t.drums||{},Object.values(t.drums).forEach((t=>{Object.values(t).forEach((t=>{"gain"in t&&(t.pan=t.pan??0,t.detune=t.detune??0)}))})),t.channels||(t.channels=s.channels(),Object.values(t.synths).forEach((t=>t.dest="main"))),(!t.savedAt||t.savedAt<157455e4)&&t.channels.main.gain>.8&&(t.channels.main.gain=.4),delete t.channels.main.order,t.effects=t.effects||{},Object.values(t.patterns).forEach((s=>{switch("order"in s||(s.order=n),n=Math.max(s.order,n)+1,s.type){case"keys":s.synth=s.synth||"0";break;case"buffer":if(s.bufferType=s.bufferType||null,"loop"===s.bufferType)s.bufferBpm=s.bufferBpm||null;else if(null===s.bufferType)switch(t.buffers[s.buffer].url){case"kick-00.wav":case"clap-00.wav":case"hat-00.wav":case"snare-00.wav":case"hat-open-00.wav":s.bufferType="drum"}}})),Object.values(t.buffers).forEach((t=>{switch(t.url){case"kick-00.wav":t.url="1/kick-017";break;case"clap-00.wav":t.url="1/clap-013";break;case"hat-00.wav":t.url="1/hat-024";break;case"snare-00.wav":t.url="1/openhat-012";break;case"hat-open-00.wav":t.url="1/snare-018"}})),t.synths||(t.synths={0:s.synth()}),Object.values(t.synths).forEach((t=>{delete t.envelopes,t.env=t.env||s.env(),t.lfo=t.lfo||s.lfo(),delete t.env.substain,Object.values(t.oscillators).forEach((t=>{t.detune=Math.min(Math.max(-24,Math.round(t.detune)),24),t.detunefine=Math.min(Math.max(-1,t.detunefine||0),1),t.unisonvoices=Math.min(Math.max(1,Math.round(t.unisonvoices??1)),9),t.unisondetune=Math.min(Math.max(0,t.unisondetune??0),12),t.unisonblend=Math.min(Math.max(0,t.unisonblend??0),1)}))})),Object.values(t.tracks).reduce(((t,s)=>(s.name="string"==typeof s.name?s.name:"",s.order="number"==typeof s.order?s.order:t,s.toggle="boolean"!=typeof s.toggle||s.toggle,s.order+1)),0),e.sort(((t,s)=>t.when-s.when)),t.blocks=e.reduce(((t,s,i)=>(s.offset=s.offset||0,s.selected=!!s.selected,s.durationEdited=!!s.durationEdited,t[i]=s,t)),{}),Object.values(t.keys).forEach((t=>{Object.values(t).forEach((t=>{t.pan=i.Je(t.pan,0,-1,1,2),t.gain=i.Je(t.gain,.8,0,1,2),t.lowpass=i.Je(t.lowpass,1,0,1,2),t.highpass=i.Je(t.highpass,1,0,1,2),t.selected=!!t.selected,t.gainLFOAmp=t.lfoAmp??t.lfoGainAmp??t.gainLFOAmp??1,t.gainLFOSpeed=t.lfoSpeed??t.lfoGainSpeed??t.gainLFOSpeed??1,"number"==typeof t.prev&&(t.prev+=""),"number"==typeof t.next&&(t.next+=""),t.prev=t.prev||null,t.next=t.next||null,delete t.attack,delete t.release,delete t.lfoAmp,delete t.lfoSpeed,delete t.lfoGainAmp,delete t.lfoGainSpeed,delete t.durationEdited,"string"==typeof t.key&&(t.key=48,console.warn(`DAWCoreCompositionFormat: the key ${t.key} should be an integer`))}))})),t}}class p{static ys(t,s){t.B=s,t.C instanceof AudioContext&&(t.P.gain.value=s*s)}static fe(t,s,i,e){p.#K(t),t.C=e,t.P=e.createGain(),t.M=e.createGain(),t.M.connect(t.P).connect(e.destination),e instanceof AudioContext?(p.#z(t,i,s),p.ys(t,t.B)):p.#z(t,i,!1)}static $s(t){if(t.A)return t.A.getByteFrequencyData(t.T),t.T}static#K(t){t.P&&t.P.disconnect(),t.M&&t.M.disconnect(),t.A&&t.A.disconnect(),t.P=t.M=t.A=t.T=null}static#z(t,s,i){if(t.A&&t.A.disconnect(),i){const i=t.C.createAnalyser(),e=s;t.A=i,t.T=new Uint8Array(e/2),i.fftSize=e,i.smoothingTimeConstant=0,t.M.connect(i).connect(t.P)}else t.A=t.T=null,t.M.connect(t.P)}}class g{static xs(t,s){for(;s.j.length;)t.ds("historyDeleteAction",s.j.pop());s.L=0}static Ds(t,s,e,n){const a=s.j,h={redo:e,undo:i.xe(t.Pt(),e)},o=g.#R(h,n);for(h.desc=o.t,h.icon=o.i;a.length>s.L;)t.ds("historyDeleteAction",a.pop());++s.L,h.index=a.push(h),g.#N(t,Object.freeze(h),"redo","historyAddAction")}static Ps(t){return t.j[t.L-1]||null}static As(t,s){return s.L>0&&g.#N(t,s.j[--s.L],"undo","historyUndo")}static Bs(t,s){return s.L<s.j.length&&g.#N(t,s.j[s.L++],"redo","historyRedo")}static#N(t,s,i,e){const n=s[i],a="undo"===i?s.redo:s.undo;return t.ds(e,s),t.Ai(n,a),n}static#R(t,s){const[i,e,...n]=s||[],a=m.Xe(i,e),[h,o]=a?a(...n):["close","undefined"];return a||console.error(`DAWCore: description 404 for "${i}.${e}"`),{i:h,t:o}}}class m{static Xe(t,s){return m.#G.get(t)?.[s]}static#G=new Map([["cmp",{renameComposition:(t,s)=>["pen",`rename compo "${t||"untitled"}" to "${s}"`],changeTempo:(t,s)=>["clock",`new tempo ${t} (${s})`],changeLoop:(t,s)=>["loop",`change loop ${t} -> ${s}`],removeLoop:()=>["loop","remove loop"]}],["tracks",{renameTrack:(t,s)=>["pen",`rename track "${t}" -> "${s}"`],toggleTrack:(t,s)=>[s?"unmute":"mute",`${s?"unmute":"mute"} track "${t}"`],toggleSoloTrack:(t,s)=>[s?"unmute":"mute",""+(s?"unmute all tracks":`mute all tracks except "${t}"`)]}],["blocks",{addBlock:t=>["plus",`add a new ${t} block`],moveBlocks:t=>["arrows",`move ${i.Qe(t,"block")}`],selectBlocks:t=>["mouse",`select ${i.Qe(t,"block")}`],removeBlocks:t=>["erase",`remove ${i.Qe(t,"block")}`],cropEndBlocks:t=>["crop",`crop-end ${i.Qe(t,"block")}`],cropStartBlocks:t=>["crop",`crop-start ${i.Qe(t,"block")}`],unselectBlock:()=>["mouse",`unselect ${i.Qe(1,"block")}`],unselectAllBlocks:t=>["mouse",`unselect ${i.Qe(t,"block")}`],duplicateSelectedBlocks:t=>["plus",`duplicate ${i.Qe(t,"block")}`]}],["synth",{addOscillator:t=>["oscillator",`${t}: add osc`],removeOscillator:t=>["oscillator",`${t}: remove osc`],reorderOscillator:t=>["sort",`${t}: reorder oscs`],changeOscillator:(t,s,i)=>["oscillator",`${t}: change osc ${s} -> ${i}`],toggleEnv:(t,s)=>["osc-sine",`${t}: ${s?"enable":"disable"} envelope`],changeEnv:(t,s,i)=>["osc-sine",`${t}: envelope's ${s} = ${i}`],toggleLFO:(t,s)=>["osc-sine",`${t}: ${s?"enable":"disable"} LFO`],changeLFO:(t,s,i)=>["osc-sine",`${t}: LFO's ${s} = ${i}`]}],["synths",{addSynth:t=>["oscillator",`add new synth "${t}"`],renameSynth:(t,s)=>["pen",`rename synth "${t}" -> "${s}"`],removeSynth:t=>["minus",`remove synth "${t}"`],redirectSynth:(t,s)=>["redirect",`redirect synth "${t}" to chan "${s}"`]}],["channels",{addChannel:t=>["plus",`mixer: new channel "${t}"`],removeChannel:t=>["minus",`mixer: remove "${t}"`],reorderChannel:t=>["sort",`mixer: reorder "${t}"`],renameChannel:(t,s)=>["pen",`mixer: rename "${t}" -> "${s}"`],toggleChannel:(t,s)=>[s?"unmute":"mute",`mixer: ${s?"unmute":"mute"} "${t}"`],changeChannel:(t,s,i)=>["mixer",`mixer: "${t}" ${s}: ${i}`],redirectChannel:(t,s)=>["redirect",`mixer: redirect "${t}" to "${s}"`]}],["patterns",{changePatternBufferInfo:t=>["pen",`edit info of the buffer "${t}"`],addPattern:(t,s)=>["plus",`add new ${t} "${s}"`],addPatternKeys:(t,s)=>["plus",`add new keys "${t}" of synth "${s}"`],addPatternBuffer:t=>["plus",`use "${t}" from the library`],renamePattern:(t,s,i)=>["pen",`rename ${t} "${s}" -> "${i}"`],removePattern:(t,s)=>["minus",`remove ${t} "${s}"`],reorderPattern:(t,s)=>["sort",`reorder ${t} "${s}"`],clonePattern:(t,s,i)=>["clone",`clone ${t} "${i}" to "${s}"`],redirectPatternBuffer:(t,s)=>["redirect",`redirect buffer "${t}" to chan "${s}"`],redirectPatternKeys:(t,s)=>["redirect",`redirect keys "${t}" to synth "${s}"`],redirectPatternSlices:(t,s)=>["redirect",`redirect slices "${t}" to buffer "${s}"`]}],["effects",{addEffect:(t,s)=>["effects",`fx: new ${s} on ${t}`],toggleEffect:(t,s,i)=>[i?"unmute":"mute",`fx: ${i?"unmute":"mute"} ${s} of ${t}`],removeEffect:(t,s)=>["minus",`fx: remove ${s} of ${t}`],changeEffect:(t,s,i)=>["effects",`fx: change ${s}'s ${i} of ${t}`]}],["drumrows",{addDrumrow:t=>["drums",`drumrows: new "${t}"`],removeDrumrow:t=>["drums",`drumrows: remove "${t}"`],reorderDrumrow:t=>["drums",`drumrows: reorder "${t}"`],changeDrumrow:(t,s,i)=>["drums",`drumrows: "${t}" ${s}: ${i}`],changeDrumrowPattern:(t,s)=>["drums",`drumrows: "${t}" -> "${s}"`],toggleDrumrow:(t,s)=>["drums",`drumrows: ${s?"unmute":"mute"} "${t}"`],toggleSoloDrumrow:(t,s)=>["drums","drumrows: "+(s?"unmute all":`mute all except "${t}"`)]}],["slices",{cropSlices:t=>["slices",`crop "${t}"`],changeSlices:t=>["slices",`change "${t}"'s slices`],changeSlicesDuration:(t,s)=>["slices",`"${t}"'s duration: ${s}beat`]}],["drums",{addDrums:(t,s,i)=>["drums",`drums: add ${i} "${s}" in "${t}"`],removeDrums:(t,s,i)=>["drums",`drums: remove ${i} "${s}" in "${t}"`],changeDrumsProps:(t,s,i,e)=>["drums",`drums: set ${i} to ${e} "${s}" in "${t}"`]}],["keys",{addKey:t=>["keys",`add a new key in "${t}"`],moveKeys:(t,s)=>["arrows",`keys: move ${i.Qe(s,"key")} in "${t}"`],removeKeys:(t,s)=>["erase",`keys: remove ${i.Qe(s,"key")} in "${t}"`],selectKeys:(t,s)=>["mouse",`keys: select ${i.Qe(s,"key")} in "${t}"`],cropEndKeys:(t,s)=>["crop",`keys: crop ${i.Qe(s,"key")} in "${t}"`],redirectKey:(t,s)=>["glissando",`${s?"add":"remove"} a glissando in "${t}"`],unselectKey:t=>["mouse",`keys: unselect ${i.Qe(1,"key")} in "${t}"`],unselectAllKeys:(t,s)=>["mouse",`unselect ${i.Qe(s,"key")} in "${t}"`],changeKeysProps:(t,s,e)=>["keys",`keys: change ${i.Qe(e,"key","'s")} ${s} in "${t}"`],cloneSelectedKeys:(t,s)=>["keys",`clone ${i.Qe(s,"key")} in "${t}"`]}]])}class b{static Ls(t,s,i){if("patterns"in i||"slices"in i){const e=new Set;if("patterns"in i&&Object.entries(i.patterns).forEach((([i,n])=>{n?"slices"===t.Qt(i).type&&("source"in n||"cropA"in n||"cropB"in n)&&e.add(i):s.delete(i)})),"slices"in i){const s=Object.entries(t.Xt());Object.keys(i.slices).forEach((t=>{i.slices[t]&&e.add(s.find((s=>s[1].slices===t))[0])}))}e.forEach((i=>{const e=t.Qt(i).source,n=e&&t.Dt(t.Qt(e).buffer);n&&b.#H(s,t,i,n)}))}}static Ys(t,s,i){const e=Object.entries(t.Xt()).reduce(((s,[i,e])=>{if("slices"===e.type&&e.source){const n=t.Qt(e.source).buffer;n in s?s[n][i]=!0:s[n]={[i]:!0}}return s}),{});Object.entries(i).forEach((([i,n])=>{i in e&&Object.keys(e[i]).forEach((i=>b.#H(s,t,i,n.buffer)))}))}static#H(t,s,i,e){const n=s.Qt(i),a=W.Ze(s.lt(),e,0,1,s.Ht(n.slices));t.set(i,a)}}class w{static cs(t,s){s.K.delayStopCallback=4,s.K.currentTime=()=>t.ctx.currentTime,s.K.ondatastart=w.#V.bind(null,t,s),s.K.ondatastop=w.#U.bind(null,s)}static pi(t,s,e){return new Promise(((n,a)=>{const h=i.Ne(e);d._e(h)?(w.mi(t,s),n(h)):a()})).then((i=>{const e={};return s.tt=i,s.st=!0,w.Ls(t,s,i,{keys:{},drums:{},synths:{},blocks:{},slices:{},buffers:{},drumrows:{},channels:{},patterns:{}}),Promise.allSettled([]).then((()=>{t._s(e)})),s.et=null,s.it="cloud"===i.options.saveMode||r.He(i.id)||!i.savedAt,t.ds("compositionSavedStatus",i,s.it),i}))}static mi(t,s){if(s.st){const i=s.K.data;s.st=!1,t.gt().tn(),t.kt().tn(),s.K.Mi(),Object.keys(i).forEach((t=>delete i[t])),t.ft().clear(),t.Us(),t.yt().tn(),s.it=!0,t.ds("compositionSavedStatus",s.tt,!0),s.tt=null}}static wi(t,s){if(!s.it)return s.it=!0,s.et=t.Cs(),s.tt.savedAt=Math.floor(Date.now()/1e3),!0}static vi(t){const s=t.kt(),i=t.ds.bind(t,"channelAnalyserFilled");Object.keys(t.Nt()).forEach((t=>{s.sn(t),i(t,s.nn,s.an)}))}static ki(t){return t.K.hn()}static Oi(t,s,i){s.K.rn(i),t.ds("currentTime",w.ki(s),"composition")}static Si(t,s){s.G||(s.G=!0,w.#q(t,s,w.ki(s)))}static Ci(t){t.G&&(t.G=!1,t.K.Mi())}static Mi(t,s){s.G?(w.Ci(s),w.Oi(t,s,s.tt.loopA||0)):w.Oi(t,s,0)}static Ls(t,s,e,n){const a=s.tt,h=t.Cs()===s.et&&!!a.savedAt;return i.cn(a,e),t.kt().Ls(e),t.js(e,n),t.qs(e),t.le(e),t.yt().Ls(e),t.ie(e),t.gt().Ls(e),w.#_.forEach(((i,a)=>{(a in e||a.some?.((t=>t in e)))&&i(t,s,e,n)})),h!==s.it&&(s.it=h,t.ds("compositionSavedStatus",a,h)),t.ds("compositionChanged",e,n),e}static#q(t,s,i){const e=s.K;t.lt()instanceof OfflineAudioContext?(e.Qi(),e.ln(!1),e.un(0)):(w.#Y(s,s.tt.loopA,s.tt.loopB),e.ln(!0),e.un(0,i))}static#Y(t,s,i){Number.isFinite(s)?t.K.dn(s,i):t.K.dn(0,t.tt.duration||t.tt.beatsPerMeasure)}static#J(t,s,i){t.Z.forEach((([t,e])=>{t===s&&e.Ls(i)}))}static#X(t,s,i,e){s.R.forEach((([s,n])=>{s===i&&(n.disconnect(),n.connect(t.$t(e)))}))}static#V(t,s,i,e,n,a,h){const o=s.tt,r=e[0][1];if(o.tracks[r.track].toggle){const e=r.pattern,c=o.patterns[e];switch(c.type){case"buffer":w.#Q(t,s,i,e,n,a,h,t.Dt(c.buffer),e);break;case"slices":w.#Q(t,s,i,e,n,a,h,t.xt(e),t.Qt(e).source);break;case"keys":{const r=new L;s.Z.set(i,[e,r]),r.scheduler._i(o.bpm),r.fe(t.lt()),r.Ni(t.vt(c.synth)),r.Ls(o.keys[c.keys]),r.pn(n,a,h)}break;case"drums":{const r=new E;s.Z.set(i,[e,r]),r.scheduler._i(o.bpm),r.fe(t.lt()),r.bs(t.yt()),r.Ls(o.drums[c.drums]),r.pn(n,a,h)}}}}static#Q(t,s,i,e,n,a,h,o,r){if(o){const c=t.lt().createBufferSource(),l=t.Qt(r),u=l.bufferBpm?o.duration/(l.duration/t.Et()):1;c.buffer=o,c.playbackRate.value=u,c.connect(t.$t(l.dest)),c.start(n,a*u,h*u),s.R.set(i,[e,c])}}static#U(t,s){const i=t.R.get(s),e=t.Z.get(s);i&&(i[1].stop(),t.R.delete(s)),e&&(e[1].Mi(),t.Z.delete(s))}static#_=new Map([["bpm",(t,s,i)=>{s.K._i(i.bpm),t.ft().forEach((t=>t._i(i.bpm))),t.qi(i.bpm)}],["blocks",(t,s,i)=>{s.K.Ls(i.blocks)}],[["loopA","loopB"],(t,s)=>{"composition"===t.Le()&&s.K.dn(s.tt.loopA||0,s.tt.loopB||s.tt.duration||s.tt.beatsPerMeasure)}],["duration",(t,s)=>{"composition"===t.Le()&&null===s.tt.loopA&&s.K.dn(0,s.tt.duration||s.tt.beatsPerMeasure)}],["tracks",(t,s,i)=>{const e=t.os(),n={};Object.entries(i.tracks).forEach((([t,s])=>{"toggle"in s&&t in e&&(s.toggle?Object.assign(n,e[t]):Object.keys(e[t]).forEach((t=>n[t]=void 0)))})),s.K.Ls(n)}],["synths",(t,s,i,e)=>{Object.entries(i.synths).forEach((([i,n])=>{if(n)if(e.synths[i]){const s=t.vt(i);s.Ls(n),"dest"in n&&(s.ke.disconnect(),s.ke.connect(t.kt().o(n.dest)))}else{const e=new j;e.fe(t.lt()),e._i(s.tt.bpm),e.Ls(n),e.ke.connect(t.kt().o(n.dest)),t.ft().set(i,e)}else t.vt(i).gn(),t.ft().delete(i)}))}],["patterns",(t,s,i)=>{Object.entries(i.patterns).forEach((([i,e])=>{e&&("dest"in e&&"buffer"===s.tt.patterns[i].type&&w.#X(t,s,i,e.dest),i===s.tt.patternKeysOpened&&t.zi(e))}))}],["keys",(t,s,i)=>{const e=Object.entries(s.tt.patterns),n=s.tt.patternKeysOpened;Object.entries(i.keys).forEach((([a,h])=>{e.some((([e,o])=>{if(o.keys===a)return w.#J(s,e,h),e===n&&t.zi(i.patterns&&i.patterns[e],h),!0}))}))}],["patternKeysOpened",(t,s,i)=>{t.Gi(i.patternKeysOpened)}],["synthOpened",(t,s,i)=>{t.Ri(i.synthOpened)}]])}class f{static cs(t,s){s.K.ondatastart=f.#V.bind(null,s.R,t),s.K.ondatastop=f.#U.bind(null,s.R),s.K.Ls({1:{when:0,offset:0,duration:4}})}static fe(t,s){t.K.currentTime=()=>s.currentTime,t.K.ln(!(s instanceof OfflineAudioContext))}static Ls(t,s,i){const e=t.ct("slices");let n,a;if("patternSlicesOpened"in i&&(i.patternSlicesOpened&&(a=!0),t.Ce("slices")),"bpm"in i&&s.K._i(i.bpm),e){if("slices"in i){t.Qt(e).slices in i.slices&&(n=!0)}if("patterns"in i){const h=i.patterns[e],o=t.Qt(e).source,r=i.patterns[o];h&&"source"in h&&(n=!0,a=!0),r?"duration"in r&&(a=!0):o in i.patterns&&t.Fe()&&(t.Mi(),s.K.xs())}}n&&f.#Z(s),a&&f.#tt(s,t.rs(e))}static ki(t){return t.K.hn()}static Oi(t,s,i){s.K.rn(i),t.ds("currentTime",f.ki(s),"slices")}static Ji(t,s,i){t.V=s,t.U=i,t.H=!0,t.K.dn(s,i)}static Qi(t,s){s.V=s.U=null,s.H=!1,s.K.dn(0,s.N||t.Ft())}static Si(t){if(!t.K.started){const s=t.H?t.V:0,i=t.H?t.U:t.N;t.G=!0,t.K.dn(s,i),t.K.un(0,f.ki(t))}}static Ci(t){t.G=!1,t.K.Mi()}static Mi(t,s){s.G=!1,s.K.started?(f.Ci(s),f.Oi(t,s,s.V||0)):f.Oi(t,s,0)}static#tt(t,s){t.N=s,t.K.Ls({1:{duration:s}}),t.H||t.K.dn(0,s)}static#Z(t){f.#st(t.K)}static#st(t){t.started&&t.un(0,t.hn())}static#V(t,s,i,e,n,a,h){const o=s.xt(s.ct("slices")),r=s.Qt(s.ct("slices")),c=s.Qt(r.source);if(o&&c){const e=s.lt().createBufferSource(),r=o.duration/(c.duration/s.Et());e.buffer=o,e.playbackRate.value=r,e.connect(s.$t(c.dest)),e.start(n,a*r,h*r),t.set(i,e)}}static#U(t,s){const i=t.get(s);i&&(i.stop(),t.delete(s))}}class v{static Ls(t,s,i){const e=t.ct("drums");if("bpm"in i&&s.X.scheduler._i(i.bpm),"patternDrumsOpened"in i&&v.#it(t,s,e),"drums"in i&&e){const n=i.drums[t.Qt(e).drums];n&&v.#et(s,i.patterns?.[e],n)}if("patterns"in i){const t=i.patterns[e];v.#et(s,t)}}static ki(t){return t.X.scheduler.hn()}static Oi(t,s,i){s.X.scheduler.rn(i),t.ds("currentTime",v.ki(s),"drums")}static Ji(t,s,i){t.V=s,t.U=i,t.H=!0,t.X.scheduler.dn(s,i)}static Qi(t,s){s.V=s.U=null,s.H=!1,s.X.scheduler.dn(0,s.N||t.Ft())}static Fi(t,s,i,e){t.yt().Ls({drumrows:{[s]:{[i]:e}}})}static Ii(t,s){t.yt().Ii(s)}static Ki(t,s){t.yt().Ki(s),t.ds("onstopdrumrow",s)}static Si(t){if(!t.G){const s=t.H?t.V:0,i=t.H?t.U:t.N;t.G=!0,t.X.scheduler.dn(s,i),t.X.scheduler.un(0,v.ki(t))}}static Ci(t){t.G&&(t.G=!1,t.X.Mi())}static Mi(t,s){s.G?(v.Ci(s),v.Oi(t,s,s.V||0)):v.Oi(t,s,0)}static#et(t,s,i){i&&t.X.Ls(i),s&&"duration"in s&&(t.N=s.duration,!t.H&&t.G&&t.X.scheduler.dn(0,t.N))}static#it(t,s,i){const e=s.G;if(t.Ce("drums"),e&&(t.Mi(),t.Mi()),s.X.scheduler.xs(),i){const n=t.Qt(i);v.#et(s,n,t.qt(n.drums)),e&&t.Si()}}}class y{static Ls(t,s,i){t._.Ls(i),s&&"duration"in s&&(t.N=s.duration,!t.H&&t.G&&t._.scheduler.dn(0,t.N))}static Ni(t,s,i){const e=i?t.vt(i):null,n=s.G;e!==s.J&&(n&&y.Ci(s),s.J=e,s._.Ni(e),n&&y.Si(s))}static Hi(t,s,i){const e=s.G;if(t.Ce("keys"),e&&(t.Mi(),t.Mi()),s._.scheduler.xs(),i){const n=t.Qt(i);y.Ni(t,s,n.synth),y.Ls(s,n,t.Jt(n.keys)),e&&t.Si()}}static ki(t){return t._.scheduler.hn()}static Oi(t,s,i){s._.scheduler.rn(i),t.ds("currentTime",y.ki(s),"keys")}static Ji(t,s,i){t.V=s,t.U=i,t.H=!0,t._.scheduler.dn(s,i)}static Qi(t,s){s.V=s.U=null,s.H=!1,s._.scheduler.dn(0,s.N||t.Ft())}static Ei(t,i){i in t.Y||(t.Y[i]=t.J.mn([[null,s.key({key:i})]],t._.scheduler.currentTime(),0,1/0))}static Wi(t,s){t.Y[s]&&(t.J.bn(t.Y[s]),delete t.Y[s])}static Si(t){if(!t.G){const s=t.H?t.V:0,i=t.H?t.U:t.N;t.G=!0,t._.scheduler.dn(s,i),t._.scheduler.un(0,y.ki(t))}}static Ci(t){t.G&&(t.G=!1,t._.Mi())}static Mi(t,s){s.G?(y.Ci(s),y.Oi(t,s,s.V||0)):y.Oi(t,s,0)}}i.wn=(t,s,e)=>(i.fn(e)&&(s in t?i.vn(t[s],e):t[s]=e),t),i.Je=(t,s,i,e,n)=>{const a=Number.isFinite(+t)?Math.max(i,Math.min(t,e)):s;return"number"==typeof n?+a.toFixed(2):+a},i.xe=(t,s)=>i.yn(t)&&i.yn(s)?Object.freeze(Object.entries(s).reduce(((s,[e,n])=>(t[e]!==n&&(s[e]=i.xe(t[e],n)),s)),{})):t,i.kn=(t,s,i,e,n)=>{n&&Object.entries(n).forEach((([a,h])=>{h?a in t?i(a,h,n):s(a,h,n):a in t&&e(a,n)}))},i.vn=(t,s)=>(s&&Object.entries(s).forEach((([s,e])=>{i.yn(e)?i.yn(t[s])?i.vn(t[s],e):t[s]=i.$n(e):t[s]=e})),t),i.$n=t=>i.yn(t)?Object.entries(t).reduce(((t,[s,e])=>(t[s]=i.$n(e),t)),{}):t,i.Oe=t=>(i.yn(t)&&(Object.freeze(t),Object.values(t).forEach(i.Oe)),t),i.cn=(t,s)=>(s&&Object.entries(s).forEach((([s,e])=>{t[s]!==e&&(void 0===e?delete t[s]:i.yn(e)?i.yn(t[s])?i.cn(t[s],e):t[s]=i.Ne(e):t[s]=e)})),t),i.ze=(t,s)=>new Promise((i=>{const e=new FileReader;switch(e.onload=t=>i(t.target.result),s){case"text":e.readAsText(t);break;case"array":e.readAsArrayBuffer(t)}})),i.Re=t=>{const s=new Uint8Array(19),i=`${t.length}`.padStart(9,"0");let e=0,n=0;for(const i of t)if(s[n]+=i,++n>=19&&(n=0),++e>=1e6)break;return`1-${i}-${Array.from(s).map((t=>t.toString(16).padStart(2,"0"))).join("")}`},i.On=t=>{for(const s in t)return!1;return!0},i.fn=t=>!i.On(t),i.yn=t=>null!==t&&"object"==typeof t,i.Ne=t=>JSON.parse(JSON.stringify(t)),i.xn=(t,s)=>{const e={};return t.forEach((t=>e[t]=i.Sn)),Object.assign(Object.seal(e),s),Object.freeze(e)},i.Sn=()=>{},i.Dn=t=>!t||t===i.Sn,i.Cn=(...t)=>{const s=t.map(i.Pn).reduce(((t,s)=>(t[0]*=s[0],t[1]*=s[1],t)),[1,1]);return i.Mn(...s)},i.Mn=(t,s)=>t>s?s/t-1:t<s?1-t/s:0,i.Pn=t=>t<0?[1,1+t]:t>0?[1-t,1]:[1,1],i.Qe=(t,s,i)=>{const e="s"===s[s.length-1]?s:`${s}${t>1?"s":""}`;return`${t} ${"'s"!==i?e:`${e}'${"s"===e[e.length-1]?"":"s"}`}`},i.An=t=>t?t.trim().replace(/\s+/gu," "):"",i.Tn=(t,s)=>{const e=i.An(t);if(s.indexOf(e)>-1){const t=/-\d+$/u.test(e)?e.substr(0,e.lastIndexOf("-")).trim():e,i=new RegExp(`^${t}-(\\d+)$`,"u");return`${t}-${s.reduce(((t,s)=>{const e=i.exec(s);return e?Math.max(t,+e[1]):t}),1)+1}`}return e},i.qe=()=>{const t=crypto.getRandomValues(new Uint8Array(36)),s=t.reduce(((t,s)=>(t.push((s%16).toString(16)),t)),[]);return s[14]="4",s[19]=(8+t[19]%4).toString(16),s[8]=s[13]=s[18]=s[23]="-",s.join("")},s.composition=(t,i)=>{const e={},n=t.k,a=t.$;for(let i=0;i<t.v;++i)e[i]=s.track({order:i});return{id:i,name:"",bpm:t.p,stepsPerBeat:n,beatsPerMeasure:a,duration:a,loopA:!1,loopB:!1,synthOpened:"0",patternKeysOpened:"0",patternDrumsOpened:"1",patternSlicesOpened:null,patternBufferOpened:null,buffers:{0:{duration:.1529,url:"kick-017"},1:{duration:.256,url:"clap-013"},2:{duration:.0357,url:"hat-024"},3:{duration:.7,url:"openhat-012"},4:{duration:.1151,url:"snare-018"}},patterns:{0:{order:0,type:"keys",name:"keys",keys:"0",synth:"0",duration:a},1:{order:0,type:"drums",name:"drums",drums:"0",duration:a},2:{order:0,type:"buffer",dest:"1",buffer:"0",duration:1,name:"kick-017",bufferType:"drum"},3:{order:1,type:"buffer",dest:"1",buffer:"1",duration:1,name:"clap-013",bufferType:"drum"},4:{order:2,type:"buffer",dest:"1",buffer:"2",duration:1,name:"hat-024",bufferType:"drum"},5:{order:3,type:"buffer",dest:"1",buffer:"3",duration:1,name:"openhat-012",bufferType:"drum"},6:{order:4,type:"buffer",dest:"1",buffer:"4",duration:1,name:"snare-018",bufferType:"drum"}},channels:s.channels(),tracks:e,blocks:{0:s.block({pattern:"0",track:"0",duration:a}),1:s.block({pattern:"1",track:"1",duration:a})},synths:{0:s.synth({dest:"2"})},drumrows:{0:s.drumrow({order:0,pattern:"2"}),1:s.drumrow({order:1,pattern:"3"}),2:s.drumrow({order:2,pattern:"4"}),3:s.drumrow({order:3,pattern:"5"}),4:s.drumrow({order:4,pattern:"6"})},slices:{},drums:{0:{}},keys:{0:{}}}},s.block=t=>Object.assign(Object.seal({pattern:null,duration:0,durationEdited:!1,selected:!1,offset:0,when:0,track:null}),t),s.channel=t=>Object.assign(Object.seal({order:0,toggle:!0,name:"chan",dest:"main",gain:1,pan:0}),t),s.channelMain=t=>Object.assign(Object.seal({toggle:!0,name:"main",gain:.4,pan:0}),t),s.channels=()=>({main:s.channelMain(),1:s.channel({order:0,name:"drums"}),2:s.channel({order:1,name:"synth"}),3:s.channel({order:2,name:"chan 3"}),4:s.channel({order:3,name:"chan 4"})}),s.drum=t=>Object.assign(Object.seal({when:0,row:null,detune:0,gain:.8,pan:0}),t),s.drumcut=t=>Object.assign(Object.seal({when:0,row:null}),t),s.drumrow=t=>Object.assign(Object.seal({order:0,toggle:!0,pattern:null,detune:0,gain:1,pan:0}),t),s.effects.delay=t=>Object.assign(Object.seal({time:.5,gain:.5,pan:-.5}),t),s.effects.filter=t=>Object.assign(Object.seal({type:"lowpass",Q:5,gain:-20,detune:0,frequency:500}),t),s.env=t=>Object.assign(Object.seal({toggle:!0,attack:.04,hold:0,decay:.08,sustain:.75,release:.25}),t),s.key=t=>Object.assign(Object.seal({prev:null,next:null,key:57,when:0,duration:1,gain:.8,gainLFOAmp:1,gainLFOSpeed:1,pan:0,highpass:1,lowpass:1,selected:!1}),t),s.lfo=t=>Object.assign(Object.seal({toggle:!1,type:"sine",delay:0,attack:1,speed:1,amp:1}),t),s.oscillator=t=>Object.assign(Object.seal({order:0,type:"sine",pan:0,gain:1,detune:0,detunefine:0,unisonvoices:1,unisondetune:.2,unisonblend:.33}),t),s.synth=t=>Object.assign(Object.seal({name:"synth",dest:"main",env:s.env(),lfo:s.lfo(),oscillators:{0:s.oscillator({gain:.75}),1:s.oscillator({order:1,gain:.2,detune:-24})}}),t),s.track=t=>Object.assign(Object.seal({name:"",order:0,toggle:!0}),t),a.blocks=class{on=null;data={};#nt=i.kn.bind(null,this.data,this.#at.bind(this),this.#ht.bind(this),this.#ot.bind(this));constructor(t){this.on=i.xn(["addBlock","removeBlock","changeBlockProp","updateBlockViewBox"],t.dataCallbacks),Object.freeze(this)}clear(){Object.keys(this.data).forEach(this.#ot,this)}change(t){this.#nt(t.blocks)}#at(t,s){const i={...s};this.data[t]=i,this.on.addBlock(t,i),this.#ht(t,i)}#ot(t){delete this.data[t],this.on.removeBlock(t)}#ht(t,s){const i=this.data[t],e=this.on.changeBlockProp.bind(null,t);this.#rt(i,e,"when",s.when),this.#rt(i,e,"duration",s.duration),this.#rt(i,e,"offset",s.offset),this.#rt(i,e,"track",s.track),this.#rt(i,e,"selected",s.selected),("offset"in s||"duration"in s)&&this.on.updateBlockViewBox(t,i)}#rt(t,s,i,e){void 0!==e&&(t[i]=e,s(i,e))}},Object.freeze(a.blocks),a.drumrows=class{on=null;data=Object.freeze({patterns:{},drumrows:{}});#ct=i.kn.bind(null,this.data.drumrows,this.#lt.bind(this),this.#ut.bind(this),this.#dt.bind(this));#pt=i.kn.bind(null,this.data.patterns,this.#gt.bind(this),this.#mt.bind(this),this.#bt.bind(this));constructor(t){this.on=i.xn(["addDrumrow","removeDrumrow","changeDrumrow"],t.dataCallbacks),Object.freeze(this)}change({patterns:t,drumrows:s}){t&&this.#pt(t),s&&this.#ct(s)}clear(){Object.keys(this.data.patterns).forEach((t=>delete this.data.patterns[t])),Object.keys(this.data.drumrows).forEach(this.#dt,this)}#gt(t,{type:s,name:i,dest:e,buffer:n,duration:a}){if("buffer"===s){const s=Object.seal({name:i,dest:e,buffer:n,duration:a});this.data.patterns[t]=s,this.#mt(t,s)}}#mt(t,{name:s,duration:i,dest:e}){if(void 0!==s||void 0!==i||void 0!==e){const n=this.data.patterns[t],a=Object.entries(this.data.drumrows).filter((s=>s[1].pattern===t));this.#wt(n,a,"name",s),this.#wt(n,a,"dest",e),this.#wt(n,a,"duration",i)}}#wt(t,s,i,e){void 0!==e&&(t[i]=e,s.forEach((t=>this.on.changeDrumrow(t[0],i,e))))}#bt(t){delete this.data.patterns[t]}#lt(t,s){const i=Object.seal({...s});this.data.drumrows[t]=i,this.on.addDrumrow(t,i),this.#ft(t,i)}#dt(t){delete this.data.drumrows[t],this.on.removeDrumrow(t)}#ut(t,s){const i=this.data.drumrows[t];Object.assign(i,s),this.#ft(t,s)}#ft(t,s){const i=this.data.patterns[s.pattern];this.#vt(t,"order",s.order),this.#vt(t,"toggle",s.toggle),this.#vt(t,"detune",s.detune),this.#vt(t,"pan",s.pan),this.#vt(t,"gain",s.gain),this.#vt(t,"pattern",s.pattern),this.#vt(t,"name",s.pattern&&i.name),this.#vt(t,"duration",s.pattern&&i.duration)}#vt(t,s,i){void 0!==i&&this.on.changeDrumrow(t,s,i)}},Object.freeze(a.drumrows),a.drums=class{on=null;data={};#yt=i.kn.bind(null,this.data,this.#kt.bind(this),this.#$t.bind(this),this.#Ot.bind(this));constructor(t){this.on=i.xn(["addDrum","removeDrum","changeDrum","addDrumcut","removeDrumcut"],t.dataCallbacks),Object.freeze(this)}change(t){this.#yt(t)}clear(){Object.keys(this.data).forEach(this.#Ot,this)}#kt(t,s){const i={...s};this.data[t]=i,"gain"in i?(this.on.addDrum(t,i),this.#$t(t,i)):this.on.addDrumcut(t,i)}#Ot(t){const s="gain"in this.data[t]?this.on.removeDrum:this.on.removeDrumcut;delete this.data[t],s(t)}#$t(t,s){this.#xt(t,"detune",s.detune),this.#xt(t,"gain",s.gain),this.#xt(t,"pan",s.pan)}#xt(t,s,i){void 0!==i&&(this.data[t][s]=i,this.on.changeDrum(t,s,i))}},Object.freeze(a.drums),a.effects=class{on=null;data={};#St=i.kn.bind(null,this.data,this.#Dt.bind(this),this.#Ct.bind(this),this.#Pt.bind(this));values=Object.seal({destFilter:null,resetting:!1});constructor(t){this.on=i.xn(["changeBPM","changeTimedivision","addEffect","removeEffect","changeEffect","connectEffectTo","changeEffectData"],t.dataCallbacks),Object.freeze(this)}clear(){Object.keys(this.data).forEach((t=>this.#Pt(t)))}reset(){const t=Object.entries(this.data);this.values.resetting=!0,t.forEach((t=>this.#Pt(t[0]))),this.values.resetting=!1,t.forEach((t=>this.#Dt(t[0],t[1])))}change(t){t.bpm&&this.on.changeBPM(t.bpm),t.timedivision&&this.on.changeTimedivision(t.timedivision),t.effects&&this.#St(t.effects)}setDestFilter(t){const s=this.values.destFilter;t!==s&&(this.values.destFilter=t,Object.entries(this.data).forEach((([i,e])=>{e.dest===s?this.#Mt(i):e.dest===t&&this.#At(i,e)})))}#Dt(t,s,e){const n=Object.seal(i.Ne(s));this.data[t]=n,this.#Tt(n)&&this.#At(t,n,e)}#At(t,s,e){if(this.on.addEffect(t,s),this.on.changeEffect(t,"toggle",s.toggle),this.on.changeEffect(t,"order",s.order),this.on.changeEffectData(t,s.data),!i.Dn(this.on.connectEffectTo)){const[i,n]=this.#Bt(t,e);this.on.connectEffectTo(s.dest,t,n),this.on.connectEffectTo(s.dest,i,t)}}#Pt(t,s){const i=this.data[t];this.#Tt(i)&&this.#Mt(t,s),delete this.data[t]}#Mt(t,s){if(!this.values.resetting&&!i.Dn(this.on.connectEffectTo)){const[i,e]=this.#Bt(t,s);this.on.connectEffectTo(this.data[t].dest,i,e)}this.on.removeEffect(t)}#Ct(t,s,e){const n=this.data[t],a=this.#Tt(n);if("toggle"in s&&(n.toggle=s.toggle,a&&this.on.changeEffect(t,"toggle",s.toggle)),"data"in s&&(i.cn(n.data,s.data),a&&this.on.changeEffectData(t,s.data)),"order"in s){if(a&&!i.Dn(this.on.connectEffectTo)){const[s,i]=this.#Bt(t,e);this.on.connectEffectTo(n.dest,s,i)}if(n.order=s.order,a&&(this.on.changeEffect(t,"order",s.order),!i.Dn(this.on.connectEffectTo))){const[s,i]=this.#Bt(t,e);this.on.connectEffectTo(n.dest,s,t),this.on.connectEffectTo(n.dest,t,i)}}}#Tt(t){return!this.values.destFilter||t.dest===this.values.destFilter}#Bt(t,s={}){const{dest:i,order:e}=this.data[t];let n=null,a=null,h=-1/0,o=1/0;return Object.entries(this.data).forEach((([r,c])=>{if(r!==t&&c.dest===i){const t=(s[r]||c).order;h<t&&t<e&&(n=r,h=t),e<t&&t<o&&(a=r,o=t)}})),[n,a]}},Object.freeze(a.effects),a.keys=class{on=null;data={};#jt=i.kn.bind(null,this.data,this.#Lt.bind(this),this.#Et.bind(this),this.#Wt.bind(this));static#Ft=Object.freeze(["key","when","duration","gain","gainLFOAmp","gainLFOSpeed","pan","lowpass","highpass","selected","prev","next"]);constructor(t){this.on=i.xn(["addKey","removeKey","changeKeyProp"],t.dataCallbacks),Object.freeze(this)}clear(){Object.keys(this.data).forEach(this.#Wt,this)}change(t){this.#jt(t)}#Lt(t,s){const i={...s};this.data[t]=i,this.on.addKey(t,i),this.#Et(t,i)}#Wt(t){delete this.data[t],this.on.removeKey(t)}#Et(t,s){a.keys.#Ft.forEach(a.keys.#rt.bind(null,this.data[t],this.on.changeKeyProp.bind(null,t),s))}static#rt(t,s,i,e){const n=i[e];void 0!==n&&(t[e]=n,s(e,n))}},Object.freeze(a.keys),a.mixer=class{on=null;data=Object.freeze({channels:{},effects:{}});#It=i.kn.bind(null,this.data.channels,this.#Kt.bind(this),this.#zt.bind(this),this.#Rt.bind(this));#St=i.kn.bind(null,this.data.effects,this.#Dt.bind(this),this.#Ct.bind(this),this.#Pt.bind(this));constructor(t){this.on=i.xn(["addChannel","removeChannel","toggleChannel","renameChannel","reorderChannel","redirectChannel","changePanChannel","changeGainChannel","addEffect","updateEffect","removeEffect"],t.dataCallbacks),Object.freeze(this)}clear(){Object.keys(this.data.effects).forEach((t=>this.#Pt(t))),Object.keys(this.data.channels).forEach((t=>{"main"!==t&&this.#Rt(t)}))}recall(){const t=Object.entries(this.data.channels);t.forEach((t=>this.#Rt(t[0]))),t.forEach((t=>this.#Kt(t[0],t[1])))}change(t){this.#It(t.channels),this.#St(t.effects)}#Kt(t,s){this.data.channels[t]={},this.on.addChannel(t,s),this.#zt(t,s)}#Rt(t){delete this.data.channels[t],this.on.removeChannel(t)}#zt(t,s){Object.assign(this.data.channels[t],s),this.#Nt(t,s.name,this.on.renameChannel),this.#Nt(t,s.order,this.on.reorderChannel),this.#Nt(t,s.toggle,this.on.toggleChannel),this.#Nt(t,s.dest,this.on.redirectChannel),this.#Nt(t,s.pan,this.on.changePanChannel),this.#Nt(t,s.gain,this.on.changeGainChannel)}#Nt(t,s,i){void 0!==s&&i(t,s)}#Dt(t,s){this.data.effects[t]={},this.on.addEffect(s.dest,t,s),this.#Ct(t,s)}#Pt(t){const s=this.data.effects[t].dest;delete this.data.effects[t],s in this.data.channels&&this.on.removeEffect(s,t)}#Ct(t,s){i.vn(this.data.effects[t],s),this.on.updateEffect(this.data.effects[t].dest,t,s)}},Object.freeze(a.mixer),a.synth=class{on=null;data=Object.seal({name:"",env:Object.seal(s.env()),lfo:Object.seal(s.lfo()),oscillators:{}});#Gt=i.kn.bind(null,this.data.oscillators,this.#Ht.bind(this),this.#Vt.bind(this),this.#Ut.bind(this));constructor(t){this.on=i.xn(["addOsc","removeOsc","changeOsc","changeOscProp","updateOscWave","changeLFO","changeLFOProp","updateLFOWave","changeEnv","changeEnvProp","updateEnvWave"],t.dataCallbacks),Object.freeze(this)}clear(){Object.keys(this.data.oscillators).forEach(this.#Ut,this)}recall(){const t=Object.entries(this.data.oscillators);t.forEach((t=>this.on.removeOsc(t[0]))),t.forEach((t=>this.on.addOsc(t[0],t[1])))}change(t){"name"in t&&(this.data.name=t.name),t.env&&this.#qt(t.env),t.lfo&&this.#_t(t.lfo),t.oscillators&&this.#Gt(t.oscillators)}#Ht(t,s){const i={...s};this.data.oscillators[t]=i,this.on.addOsc(t,i),this.#Vt(t,i)}#Ut(t){delete this.data.oscillators[t],this.on.removeOsc(t)}#Vt(t,s){const i=this.data.oscillators[t],e=this.on.changeOscProp.bind(null,t);this.#rt(i,e,"order",s.order),this.#rt(i,e,"type",s.type),this.#rt(i,e,"pan",s.pan),this.#rt(i,e,"gain",s.gain),this.#rt(i,e,"detune",s.detune),this.#rt(i,e,"detunefine",s.detunefine),this.#rt(i,e,"unisonvoices",s.unisonvoices),this.#rt(i,e,"unisondetune",s.unisondetune),this.#rt(i,e,"unisonblend",s.unisonblend),this.on.updateOscWave(t),this.on.changeOsc(t,s)}#qt(t){const s=this.data.env,i=this.on.changeEnvProp;this.#rt(s,i,"toggle",t.toggle),this.#rt(s,i,"attack",t.attack),this.#rt(s,i,"hold",t.hold),this.#rt(s,i,"decay",t.decay),this.#rt(s,i,"sustain",t.sustain),this.#rt(s,i,"release",t.release),this.on.updateEnvWave(),this.on.changeEnv(t)}#_t(t){const s=this.data.lfo,i=this.on.changeLFOProp;this.#rt(s,i,"toggle",t.toggle),this.#rt(s,i,"type",t.type),this.#rt(s,i,"delay",t.delay),this.#rt(s,i,"attack",t.attack),this.#rt(s,i,"speed",t.speed),this.#rt(s,i,"amp",t.amp),this.on.updateLFOWave(),this.on.changeLFO(t)}#rt(t,s,i,e){void 0!==e&&(t[i]=e,s(i,e))}},Object.freeze(a.synth),a.tracks=class{on=null;data={};#Yt=i.kn.bind(null,this.data,this.#Jt.bind(this),this.#Xt.bind(this),this.#Qt.bind(this));constructor(t){this.on=i.xn(["addTrack","removeTrack","toggleTrack","renameTrack","reorderTrack"],t.dataCallbacks),Object.freeze(this)}change(t){this.#Yt(t.tracks)}clear(){Object.keys(this.data).forEach(this.#Qt,this)}#Jt(t,s){this.data[t]={...s},this.on.addTrack(t),this.#Xt(t,s)}#Qt(t){delete this.data[t],this.on.removeTrack(t)}#Xt(t,s){this.#Zt(t,"toggle",s.toggle,this.on.toggleTrack),this.#Zt(t,"name",s.name,this.on.renameTrack),this.#Zt(t,"order",s.order,this.on.reorderTrack)}#Zt(t,s,i,e){void 0!==i&&(this.data[t][s]=i,e(t,i))}},Object.freeze(a.drums),a.slicer=class{data={};#ts=null;#ss=null;#is=null;#es=i.kn.bind(null,this.data,this.#ns.bind(this),this.#as.bind(this),this.#hs.bind(this));constructor(t){this.on=i.xn(["disabled","timedivision","setBuffer","renameBuffer","removeBuffer","changeDuration","addSlice","removeSlice","changeSlice"],t.dataCallbacks),Object.freeze(this)}getPatternId(){return this.#ss}setDAWCore(t){this.#ts=t}clear(){this.#ss=this.#is=null,this.on.disabled(!0),this.on.removeBuffer(),this.on.changeDuration(4),Object.keys(this.data).forEach(this.#hs,this)}change(t){const s=this.#ts;if(t.timedivision&&this.on.timedivision(t.timedivision),"patternSlicesOpened"in t){const i=t.patternSlicesOpened;if(i){const t=s.Qt(i);this.#ss=i,this.#is=t.slices,Object.keys(this.data).forEach(this.#hs,this),this.#os(t.source,s),this.#es(s.Ht(this.#is)),this.on.disabled(!1)}else this.clear()}else if(this.#ss){const i=t.patterns?.[this.#ss];i&&"source"in i?this.#os(i.source,s):this.#rs(t,s),this.#es(t.slices?.[this.#is])}}#rs(t,s){const i=t.patterns?.[s.Qt(this.#ss).source]?.duration;i&&this.on.changeDuration(i)}#os(t,s){if(t){const i=s.Qt(t),e=s.Dt(i.buffer);this.on.setBuffer(e),this.on.renameBuffer(i.name),this.on.changeDuration(i.duration)}else this.on.removeBuffer()}#ns(t,s){const i={...s};this.data[t]=i,this.on.addSlice(t,i)}#hs(t){delete this.data[t],this.on.removeSlice(t)}#as(t,s){Object.assign(this.data[t],s),this.on.changeSlice(t,s)}},Object.freeze(a.slicer),n.patternOpenedByType=Object.freeze({synth:"synthOpened",keys:"patternKeysOpened",drums:"patternDrumsOpened",slices:"patternSlicesOpened",buffer:"patternBufferOpened"}),n.calcNewDuration=(t,s)=>{const i=s.blocks||{},e=s.timedivision?s.timedivision.split("/")[0]:t.Ft(),n=Object.entries(t.Kt()).reduce(((t,[s,e])=>{const n=i[s];if(n||!(s in i)){const s=n?.when??e.when,i=n?.duration??e.duration;return Math.max(t,s+i)}return t}),0),a=Object.entries(i).reduce(((s,[i,e])=>e&&!t.zt(i)?Math.max(s,e.when+e.duration):s),n);return Math.ceil(a/e)*e},n.calcNewKeysDuration=(t,s,i)=>{const e=t.Ft(),n=t.Jt(s),a=Object.entries(n).reduce(((t,[s,e])=>{const n=i[s];if(n||!(s in i)){const s=n?.when??e.when,i=n?.duration??e.duration;return Math.max(t,s+i)}return t}),0),h=Object.entries(i).reduce(((t,[s,i])=>i&&!n[s]?Math.max(t,i.when+i.duration):t),a);return Math.max(1,Math.ceil(h/e))*e},n.createUniqueName=(t,s)=>i.Tn(s,Object.values(t).map((t=>t.name))),n.getDrumrowName=(t,s)=>t.Qt(t.Ut(s).pattern).name,n.getNextIdOf=t=>`${Object.keys(t).reduce(((t,s)=>Math.max(t,+s||0)),0)+1}`,n.getNextOrderOf=t=>Object.values(t).reduce(((t,s)=>Math.max(t,s.order)),-1)+1,n.toggleSolo=(t,s)=>{const i=Object.entries(s),e=i.some((s=>s[0]!==t&&!0===s[1].toggle)),n=i.reduce(((s,[i,n])=>{const a=i===t;return(a&&!n.toggle||!a&&n.toggle===e)&&(s[i]={toggle:!n.toggle}),s}),{});return[!e,n]},n.updatePatternDuration=(t,s,e,a)=>{if(a!==t.Qt(e).duration){const h=Object.entries(t.Kt()).reduce(((t,[s,i])=>(i.pattern!==e||i.durationEdited||(t[s]={duration:a}),t)),{});if(i.vn(s,{patterns:{[e]:{duration:a}}}),i.wn(s,"blocks",h),i.fn(h)){const i=n.calcNewDuration(t,s);i!==t.Bt()&&(s.duration=i)}}},e.set("addBlock",((t,i,e,a)=>{const h={blocks:{[n.getNextIdOf(t.Kt())]:s.block({pattern:i,when:e,track:a,duration:t.rs(i)})}},o=n.calcNewDuration(t,h);return o!==t.Bt()&&(h.duration=o),[h,["blocks","addBlock",t.Qt(i).name]]})),e.set("addChannel",(t=>{const i=t.Nt(),e=n.getNextIdOf(i),a=n.getNextOrderOf(i),h=`chan ${e}`;return[{channels:{[e]:s.channel({order:a,name:h})}},["channels","addChannel",h]]})),e.set("addDrumcuts",((t,s,i,n,a)=>e._addDrums("drumcut",!0,s,i,n,a,t))),e.set("addDrumrow",((t,i)=>{const e=t.Qt(i);if("buffer"===e.type){const a=t.Vt(),h=n.getNextIdOf(a),o=n.getNextOrderOf(a);return[{drumrows:{[h]:s.drumrow({pattern:i,order:o})}},["drumrows","addDrumrow",e.name]]}})),e.set("addDrums",((t,s,i,n,a)=>e._addDrums("drum",!0,s,i,n,a,t))),e._addDrums=(t,i,e,a,h,o,r)=>{const c=1/r.It(),l=Math.round(Math.min(h,o)/c),u=Math.round(Math.max(h,o)/c),d=r.Qt(e),p=r.qt(d.drums),g=r.Ut(a).pattern,m=r.Qt(g),b=Object.entries(p),w=b.reduce(((s,[i,e])=>(e.row===a&&"drum"===t=="gain"in e&&s.set(Math.round(e.when/c),i),s)),new Map),f={},v=+n.getNextIdOf(p),y=s[t];let k=0,$=d.duration;for(let t=l;t<=u;++t){const s=w.get(t);if(s)i||(f[s]=void 0,++k);else if(i){const s=t*c;$=Math.max($,s+.001),f[v+k]=y({when:s,row:a}),++k}}if(k>0&&!i&&($=b.reduce(((t,[s,i])=>s in f?t:Math.max(t,i.when+.001)),0)),k>0){const t=r.Ft(),s=Math.max(1,Math.ceil($/t))*t,a={drums:{[d.drums]:f}};return n.updatePatternDuration(r,a,e,s),[a,["drums",i?"addDrums":"removeDrums",d.name,m.name,k]]}},e.set("addEffect",((t,i,e)=>{const a=t._t(),h=Object.values(a).filter((t=>t.dest===i));return[{effects:{[n.getNextIdOf(a)]:{dest:i,type:e,toggle:!0,order:n.getNextOrderOf(h),data:s.effects[e]()}}},["effects","addEffect",t.Gt(i).name,e]]})),e.set("addKey",((t,i,e,a,h)=>{const o=t.Qt(i),r=t.Jt(o.keys),c={[n.getNextIdOf(r)]:s.key({key:e,when:a,duration:h})},l=n.calcNewKeysDuration(t,o.keys,c),u={keys:{[o.keys]:c}};return Object.entries(r).reduce(((t,[s,i])=>(i.selected&&!(s in t)&&(t[s]={selected:!1}),t)),c),n.updatePatternDuration(t,u,i,l),[u,["keys","addKey",o.name]]})),e.set("addOscillator",((t,i)=>{const e=t.ts(i).oscillators,a=n.getNextIdOf(e),h=s.oscillator();return h.order=n.getNextOrderOf(e),[{synths:{[i]:{oscillators:{[a]:h}}}},["synth","addOscillator",t.ts(i).name]]})),e.set("addPatternBuffer",((t,s,i,e)=>{const a=t.Rt(),h=Object.values(a),[o,r]=i.split(":");if(!h.find((t=>t.url===o||t.hash===o))){const i=t.Xt(),h=t.Nt(),c=n.getNextIdOf(i),l=n.getNextIdOf(a),u=Object.values(i).reduce(((t,s)=>"buffer"!==s.type?t:Math.max(t,s.order)),-1)+1,d="default"===s&&Object.entries(h).find((([t,s])=>"drums"===s.name))?.[0]||"main",p={duration:e.duration},g={order:u,dest:d,type:"buffer",buffer:l,duration:Math.ceil(e.duration*t.Et()),name:r};return"default"===s?(g.bufferType="drum",p.url=o):(p.hash=o,t.zs({...p,buffer:e})),[{buffers:{[l]:p},patterns:{[c]:g}},["patterns","addPatternBuffer",r]]}})),e.set("addPatternDrums",(t=>{const s=t.Xt(),i=n.getNextIdOf(t.qt()),e=n.getNextIdOf(s),a=n.createUniqueName(t.Xt(),"drums");return[{drums:{[i]:{}},patterns:{[e]:{order:Object.values(s).reduce(((t,s)=>"drums"!==s.type?t:Math.max(t,s.order)),-1)+1,type:"drums",name:a,drums:i,duration:t.Ft()}},patternDrumsOpened:e},["patterns","addPattern","drums",a]]})),e.set("addPatternKeys",((t,s)=>{const i=t.Xt(),e=n.getNextIdOf(t.Jt()),a=n.getNextIdOf(i),h=n.createUniqueName(t.Xt(),"keys"),o=t.ts(s).name,r={keys:{[e]:{}},patterns:{[a]:{order:Object.values(i).reduce(((t,i)=>i.synth!==s?t:Math.max(t,i.order)),-1)+1,type:"keys",name:h,keys:e,synth:s,duration:t.Ft()}},patternKeysOpened:a};return s!==t.ct("synth")&&(r.synthOpened=s),[r,["patterns","addPatternKeys",h,o]]})),e.set("addPatternSlices",(t=>{const s=t.Xt(),i=n.getNextIdOf(t.Ht()),e=n.getNextIdOf(s),a=n.createUniqueName(t.Xt(),"slices");return[{slices:{[i]:{0:{x:0,y:0,w:.25},1:{x:.25,y:.25,w:.25},2:{x:.5,y:.5,w:.25},3:{x:.75,y:.75,w:.25}}},patterns:{[e]:{order:Object.values(s).reduce(((t,s)=>"slices"!==s.type?t:Math.max(t,s.order)),-1)+1,type:"slices",name:a,slices:i,source:null}},patternSlicesOpened:e},["patterns","addPattern","slices",a]]})),e.set("addSynth",(t=>{const i=n.getNextIdOf(t.Zt()),e=n.createUniqueName(t.Zt(),"synth"),a={synths:{[i]:s.synth({name:e})},synthOpened:i};return null!=t.ct("keys")&&(a.patternKeysOpened=null),[a,["synths","addSynth",e]]})),e.set("changeChannel",((t,s,i,e)=>[{channels:{[s]:{[i]:e}}},["channels","changeChannel",t.Gt(s).name,i,e]])),e.set("changeDrumrow",((t,s,i,e)=>[{drumrows:{[s]:{[i]:e}}},["drumrows","changeDrumrow",n.getDrumrowName(t,s),i,e]])),e.set("changeDrumrowPattern",((t,s,i)=>{const e=t.Ut(s),a=t.Qt(i);if(e.pattern!==i&&"buffer"===a.type){return[{drumrows:{[s]:{pattern:i}}},["drumrows","changeDrumrowPattern",n.getDrumrowName(t,s),a.name]]}})),e.set("changeDrumsProps",((t,s,i,e)=>{const a=t.Qt(s),h=t.qt(a.drums)[e[0][0]].row,o=n.getDrumrowName(t,h),r=e.reduce(((t,[s,e])=>(t[s]={[i]:e},t)),{});return[{drums:{[a.drums]:r}},["drums","changeDrumsProps",a.name,o,i,e.length]]})),e.set("changeEffect",((t,s,i,e)=>{const n=t.Yt(s);return[{effects:{[s]:{data:{[i]:e}}}},["effects","changeEffect",t.Gt(n.dest).name,n.type,i]]})),e.set("changeEnv",((t,s,i,e)=>[{synths:{[s]:{env:{[i]:e}}}},["synth","changeEnv",t.ts(s).name,i,e]])),e.set("changeKeysProps",((t,s,i,e)=>{const n=t.Qt(s),a=e.reduce(((t,[s,e])=>(t[s]={[i]:e},t)),{});return[{keys:{[n.keys]:a}},["keys","changeKeysProps",n.name,i,e.length]]})),e.set("changeLFO",((t,s,i,e)=>[{synths:{[s]:{lfo:{[i]:e}}}},["synth","changeLFO",t.ts(s).name,i,e]])),e.set("changeLoop",((t,s,i)=>Number.isFinite(s)?[{loopA:s,loopB:i},["cmp","changeLoop",s,i]]:[{loopA:null,loopB:null},["cmp","removeLoop"]])),e.set("changeOscillator",((t,s,i,e,n)=>[{synths:{[s]:{oscillators:{[i]:{[e]:n}}}}},["synth","changeOscillator",t.ts(s).name,e,n]])),e.set("changePatternBufferInfo",((t,s,{name:e,type:a,bpm:h})=>{const o=t.Qt(s),r={},c={};if(e!==o.name&&(c.name=e),a!==o.bufferType&&(c.bufferType=a,"loop"===o.bufferType&&(c.bufferBpm=void 0)),h!==o.bufferBpm&&"loop"===a&&(c.bufferBpm=h),"bufferBpm"in c){const i=t.Ct(o.buffer).duration,e=c.bufferBpm?Math.round(i*(c.bufferBpm/60)):Math.ceil(i*t.Et());n.updatePatternDuration(t,r,s,e),Object.entries(t.Xt()).filter((t=>"slices"===t[1].type&&t[1].source===s)).forEach((s=>n.updatePatternDuration(t,r,s[0],e)))}if(i.fn(c)&&i.vn(r,{patterns:{[s]:c}}),i.fn(r))return[r,["patterns","changePatternBufferInfo",e||o.name]]})),e.set("changePatternSlices",((t,s,i,e)=>{const a={};let h;switch(i){case"cropA":case"cropB":h="cropSlices",a.patterns={[s]:{[i]:e}};break;case"duration":h="changeSlicesDuration",n.updatePatternDuration(t,a,s,e);break;case"slices":h="changeSlices",a.slices={[t.Qt(s).slices]:e}}return[a,["slices",h,t.Qt(s).name,e]]})),e.set("changeTempo",((t,s,e)=>{const a=e!==t.Wt(),h=s!==t.Lt();if(a||h){const o={},r={},c=Object.entries(t.Xt());if(a){const t=e.split("/")[0];o.timedivision=e,c.forEach((([s,i])=>{if("keys"===i.type||"drums"===i.type){const e=Math.max(1,Math.ceil(i.duration/t))*t;e!==i.duration&&(r[s]={duration:e})}}))}if(h&&(o.bpm=s,c.forEach((([i,e])=>{if("buffer"===e.type&&!e.bufferBpm){const n=t.Ct(e.buffer).duration,a=Math.ceil(n*(s/60));a!==e.duration&&(r[i]={duration:a})}}))),i.fn(r)){const s={};if(o.patterns=r,Object.entries(t.Kt()).forEach((([t,i])=>{const e=r[i.pattern];e&&!i.durationEdited&&(s[t]={duration:e.duration})})),i.wn(o,"blocks",s),i.fn(s)){const s=n.calcNewDuration(t,o);s!==t.Bt()&&(o.duration=s)}}return[o,["cmp","changeTempo",s,e]]}})),e.set("clonePattern",((t,s)=>{const a=t.Qt(s),h=a.type,o={...a},r=n.getNextIdOf(t.Xt()),c={patterns:{[r]:o}};if(o.name=n.createUniqueName(t.Xt(),a.name),++o.order,"buffer"!==h){const s=i.Ne(t.ns(h,a[h])),l=n.getNextIdOf(t.hs(h));o[h]=l,c[h]={[l]:s},c[n.patternOpenedByType[h]]=r,Object.entries(t.Xt()).filter(e.clonePattern_filterFn[h].bind(null,o)).forEach((([t,s])=>c.patterns[t]={order:s.order+1}))}return[c,["patterns","clonePattern",o.type,o.name,a.name]]})),e.clonePattern_filterFn=Object.freeze({keys:(t,[,s])=>"keys"===s.type&&s.order>=t.order&&s.synth===t.synth,drums:(t,[,s])=>"drums"===s.type&&s.order>=t.order,slices:(t,[,s])=>"slices"===s.type&&s.order>=t.order}),e.set("cloneSelectedKeys",((t,s,i,e)=>{const a=t.Qt(s),h=t.Jt(a.keys),o=n.getNextIdOf(h),r={},c={keys:{[a.keys]:r}},l=i.reduce(((t,s,i)=>{const n=`${o+i}`,a={...h[s]};return a.when+=e,a.prev=a.next=null,r[s]={selected:!1},r[n]=a,t.set(s,n),t}),new Map),u=n.calcNewKeysDuration(t,a.keys,r);return i.forEach((t=>{const s=h[t].next;if(l.has(s)){const i=l.get(t),e=l.get(s);r[i].next=e,r[e].prev=i}})),n.updatePatternDuration(t,c,s,u),[c,["keys","cloneSelectedKeys",a.name,i.length]]})),e.set("closePattern",((t,s)=>{if(t.ct(s))return{[n.patternOpenedByType[s]]:null}})),e.set("cropEndBlocks",((t,s,i)=>{const e=s.reduce(((s,e)=>(s[e]={duration:t.zt(e).duration+i,durationEdited:!0},s)),{}),a={blocks:e},h=n.calcNewDuration(t,a);return h!==t.Bt()&&(a.duration=h),[a,["blocks","cropEndBlocks",s.length]]})),e.set("cropEndKeys",((t,s,i,e)=>{const a=t.Qt(s),h=t.Jt(a.keys),o=i.reduce(((t,s)=>{const i=h[s],n=i.attack+i.release,a=i.duration+e,o={duration:a};return t[s]=o,a<n&&(o.attack=+(i.attack/n*a).toFixed(3),o.release=+(i.release/n*a).toFixed(3)),t}),{}),r={keys:{[a.keys]:o}},c=n.calcNewKeysDuration(t,a.keys,o);return n.updatePatternDuration(t,r,s,c),[r,["keys","cropEndKeys",a.name,i.length]]})),e.set("cropStartBlocks",((t,s,i)=>[{blocks:s.reduce(((s,e)=>{const n=t.zt(e);return s[e]={when:n.when+i,offset:n.offset+i,duration:n.duration-i,durationEdited:!0},s}),{})},["blocks","cropStartBlocks",s.length]])),e.set("duplicateSelectedBlocks",((t,s)=>{const i=Object.entries(t.Kt()).filter((t=>t[1].selected)),e=+n.getNextIdOf(t.Kt()),a=i.reduce(((t,[i,n],a)=>{const h={...n};return h.when+=s,t[i]={selected:!1},t[e+a]=h,t}),{}),h={blocks:a},o=n.calcNewDuration(t,h);return o!==t.Bt()&&(h.duration=o),[h,["blocks","duplicateSelectedBlocks",i.length]]})),e.set("moveBlocks",((t,s,i,e)=>{const a={},h={blocks:a},o=Object.entries(t.ss()).sort(((t,s)=>t[1].order<s[1].order));if(s.forEach((s=>{const n=t.zt(s),h={};a[s]=h,i&&(h.when=n.when+i),e&&(h.track=o[o.findIndex((t=>t[0]===n.track))+e][0])})),i){const s=n.calcNewDuration(t,h);s!==t.Bt()&&(h.duration=s)}return[h,["blocks","moveBlocks",s.length]]})),e.set("moveKeys",((t,s,i,e,a)=>{const h=t.Qt(s),o=t.Jt(h.keys),r=i.reduce(((t,s)=>{const i=o[s],n={};return t[s]=n,e&&(n.when=i.when+e),a&&(n.key=i.key-a),t}),{}),c={keys:{[h.keys]:r}};if(e){const i=n.calcNewKeysDuration(t,h.keys,r);n.updatePatternDuration(t,c,s,i)}return[c,["keys","moveKeys",h.name,i.length]]})),e.set("openPattern",((t,s)=>{const i=t.Qt(s);if(s!==t.ct(i.type)&&"buffer"!==i.type){const e={[n.patternOpenedByType[i.type]]:s};return"keys"===i.type&&i.synth!==t.ct("synth")&&(e.synthOpened=i.synth),e}})),e.set("openSynth",((t,s)=>{if(s!==t.ct("synth")){const i=Object.entries(t.Xt()).find((t=>t[1].synth===s)),e=i?i[0]:null,n={synthOpened:s};return e!==t.ct("keys")&&(n.patternKeysOpened=e),n}})),e.set("redirectChannel",((t,s,i)=>{if("main"!==s&&s!==i)return[{channels:{[s]:{dest:i}}},["channels","redirectChannel",t.Gt(s).name,t.Gt(i).name]]})),e.set("redirectKey",((t,s,i,e)=>{const n=t.Qt(s),a=t.Jt(n.keys)[i],h={};return e?(h[i]={next:e},h[e]={prev:i},a.next&&(h[a.next]={prev:null})):(h[i]={next:null},h[a.next]={prev:null}),[{keys:{[n.keys]:h}},["keys","redirectKey",n.name,!!e]]})),e.set("redirectPatternBuffer",((t,s,i)=>[{patterns:{[s]:{dest:i}}},["patterns","redirectPatternBuffer",t.Qt(s).name,t.Gt(i).name]])),e.set("redirectPatternKeys",((t,s,i,e)=>{const n={patterns:e};return s===t.ct("keys")&&(n.synthOpened=i),[n,["patterns","redirectPatternKeys",t.Qt(s).name,t.ts(i).name]]})),e.set("redirectPatternSlices",((t,s,i)=>{if(i!==t.Qt(s).source)return[{patterns:{[s]:{source:i}}},["patterns","redirectPatternSlices",t.Qt(s).name,t.Qt(i).name]]})),e.set("redirectSynth",((t,s,i)=>[{synths:{[s]:{dest:i}}},["synths","redirectSynth",t.ts(s).name,t.Gt(i).name]])),e.set("removeBlocks",((t,s)=>{const i=s.reduce(((t,s)=>(t[s]=void 0,t)),{}),e={blocks:i},a=n.calcNewDuration(t,e);let h=0;return Object.entries(t.Kt()).forEach((([t,s])=>{s.selected&&!(t in i)&&(++h,i[t]={selected:!1})})),a!==t.Bt()&&(e.duration=a),[e,s.length?["blocks","removeBlocks",s.length]:["blocks","unselectAllBlocks",h]]})),e.set("removeChannel",((t,s)=>{if("main"!==s){const n=e.removeChannel_redirect,a={dest:"main"},h=n(s,t.Nt(),{[s]:void 0},a),o=n(s,t.Xt(),{},a),r=n(s,t._t(),{},void 0),c=n(s,t.Zt(),{},a),l={channels:h};return i.wn(l,"synths",c),i.wn(l,"effects",r),i.wn(l,"patterns",o),[l,["channels","removeChannel",t.Gt(s).name]]}})),e.removeChannel_redirect=(t,s,i,e)=>Object.entries(s).reduce(((s,i)=>(i[1].dest===t&&(s[i[0]]=e),s)),i),e.set("removeDrumcuts",((t,s,i,n,a)=>e._addDrums("drumcut",!1,s,i,n,a,t))),e.set("removeDrumrow",((t,s)=>{const i=n.getDrumrowName(t,s);return[e._removeDrumrow({},s,t),["drumrows","removeDrumrow",i]]})),e._removeDrumrow=(t,s,e)=>{const a=e.Ft(),h=Object.entries(e.Kt()),o=Object.entries(e.Xt()),r={},c={},l={};if(t.drumrows=t.drumrows||{},t.drumrows[s]=void 0,o.forEach((([n,o])=>{if("drums"===o.type){const u={},d=Object.entries(e.qt(o.drums)).reduce(((i,[e,{row:n,when:a}])=>(n===s&&(u[e]=void 0),n in t.drumrows?i:Math.max(i,a+.001))),0);if(i.fn(u)){const t=Math.max(1,Math.ceil(d/a))*a;r[o.drums]=u,t!==o.duration&&(l[n]={duration:t},h.forEach((([s,i])=>{i.pattern!==n||i.durationEdited||(c[s]={duration:t})})))}}})),i.wn(t,"drums",r),i.wn(t,"blocks",c),i.wn(t,"patterns",l),i.fn(c)){const s=n.calcNewDuration(e,t);s!==e.Bt()&&(t.duration=s)}return t},e.set("removeDrums",((t,s,i,n,a)=>e._addDrums("drum",!1,s,i,n,a,t))),e.set("removeEffect",((t,s)=>{const i=t.Yt(s);return[{effects:{[s]:void 0}},["effects","removeEffect",t.Gt(i.dest).name,i.type]]})),e.set("removeKeys",((t,s,i)=>{const e=t.Qt(s),a=t.Jt(e.keys),h=i.reduce(((t,s)=>{const{prev:i,next:e}=a[s];if(t[s]=void 0,null!==i){const s=t[i];i in t&&void 0===s||(s?s.next=null:t[i]={next:null})}if(null!==e){const s=t[e];e in t&&void 0===s||(s?s.prev=null:t[e]={prev:null})}return t}),{}),o={keys:{[e.keys]:h}},r=n.calcNewKeysDuration(t,e.keys,h),c=Object.entries(a).reduce(((t,[s,i])=>i.selected&&!(s in h)?(h[s]={selected:!1},t+1):t),0);return n.updatePatternDuration(t,o,s,r),[o,i.length?["keys","removeKeys",e.name,i.length]:["keys","unselectAllKeys",e.name,c]]})),e.set("removeOscillator",((t,s,i)=>[{synths:{[s]:{oscillators:{[i]:void 0}}}},["synth","removeOscillator",t.ts(s).name]])),e.set("removePattern",((t,s)=>{const a=t.Qt(s),h=a.type,o={patterns:{[s]:void 0}},r=Object.entries(t.Kt()).reduce(((t,[i,e])=>(e.pattern===s&&(t[i]=void 0),t)),{});if("buffer"===h?(Object.entries(t.Vt()).forEach((n=>{n[1].pattern===s&&i.vn(o,e._removeDrumrow(o,n[0],t))})),Object.entries(t.Xt()).forEach((t=>{"slices"===t[1].type&&t[1].source===s&&(o.patterns[t[0]]={source:null})})),o.buffers={[a.buffer]:void 0}):o[h]={[a[h]]:void 0},i.fn(r)){const i=Object.values(t.Kt()).reduce(((t,i)=>i.pattern===s?t:Math.max(t,i.when+i.duration)),0),e=t.Ft(),n=Math.max(1,Math.ceil(i/e))*e;o.blocks=r,n!==t.Bt()&&(o.duration=n)}if(s===t.ct(h)){const i=Object.entries(t.Xt()).find((([t,i])=>t!==s&&i.type===h&&i.synth===a.synth));o[n.patternOpenedByType[h]]=i?i[0]:null}return[o,["patterns","removePattern",a.type,a.name]]})),e.set("removeSynth",((t,s)=>{const e={},n={},a={},h=Object.entries(t.Kt()),o=Object.entries(t.Xt()),r={synths:{[s]:void 0}};return o.forEach((([t,i])=>{i.synth===s&&(e[i.keys]=a[t]=void 0,h.forEach((([s,i])=>{i.pattern===t&&(n[s]=void 0)})))})),i.wn(r,"keys",e),i.wn(r,"patterns",a),i.wn(r,"blocks",n),s===t.ct("synth")&&(Object.keys(t.Zt()).some((t=>{if(t!==s)return r.synthOpened=t,o.some((([s,i])=>{if(i.synth===t)return r.patternKeysOpened=s,!0}))||(r.patternKeysOpened=null),!0}))||(r.synthOpened=null)),[r,["synths","removeSynth",t.ts(s).name]]})),e.set("renameChannel",((t,s,e)=>{const n=i.An(e),a=t.Gt(s);if("main"!==s&&n&&n!==a.name)return[{channels:{[s]:{name:n}}},["channels","renameChannel",a.name,n]]})),e.set("renameComposition",((t,s)=>{const e=i.An(s),n=t.Mt();if(e&&e!==n)return[{name:e},["cmp","renameComposition",n,e]]})),e.set("renamePattern",((t,s,e)=>{const n=i.An(e),a=t.Qt(s);if(n&&n!==a.name)return[{patterns:{[s]:{name:n}}},["patterns","renamePattern",a.type,a.name,n]]})),e.set("renameSynth",((t,s,e)=>{const n=i.An(e),a=t.ts(s);if(n&&n!==a.name)return[{synths:{[s]:{name:n}}},["synths","renameSynth",a.name,n]]})),e.set("renameTrack",((t,s,e)=>{const n=i.An(e),a=t.es(s);if(n!==a.name)return[{tracks:{[s]:{name:n}}},["tracks","renameTrack",a.name,n]]})),e.set("reorderChannel",((t,s,i)=>[{channels:i},["channels","reorderChannel",t.Gt(s).name]])),e.set("reorderDrumrow",((t,s,i)=>[{drumrows:i},["drumrows","reorderDrumrow",n.getDrumrowName(t,s)]])),e.set("reorderOscillator",((t,s,i)=>[{synths:{[s]:{oscillators:i}}},["synth","reorderOscillator",t.ts(s).name]])),e.set("reorderPattern",((t,s,i)=>{const e=t.Qt(s);return[{patterns:i},["patterns","reorderPattern",e.type,e.name]]})),e.set("selectBlocks",((t,s)=>[{blocks:s.reduce(((t,s)=>(t[s]={selected:!0},t)),{})},["blocks","selectBlocks",s.length]])),e.set("selectKeys",((t,s,i)=>{const e=t.Qt(s),n=i.reduce(((t,s)=>(t[s]={selected:!0},t)),{});return[{keys:{[e.keys]:n}},["keys","selectKeys",e.name,i.length]]})),e.set("toggleChannel",((t,s)=>{const i=t.Gt(s),e=!i.toggle;return[{channels:{[s]:{toggle:e}}},["channels","toggleChannel",i.name,e]]})),e.set("toggleDrumrow",((t,s)=>{const i=n.getDrumrowName(t,s),e=!t.Ut(s).toggle;return[{drumrows:{[s]:{toggle:e}}},["drumrows","toggleDrumrow",i,e]]})),e.set("toggleEffect",((t,s)=>{const i=t.Yt(s),e=!i.toggle;return[{effects:{[s]:{toggle:e}}},["effects","toggleEffect",t.Gt(i.dest).name,i.type,e]]})),e.set("toggleEnv",((t,s)=>{const i=!t.ts(s).env.toggle;return[{synths:{[s]:{env:{toggle:i}}}},["synth","toggleEnv",t.ts(s).name,i]]})),e.set("toggleLFO",((t,s)=>{const i=!t.ts(s).lfo.toggle;return[{synths:{[s]:{lfo:{toggle:i}}}},["synth","toggleLFO",t.ts(s).name,i]]})),e.set("toggleSoloDrumrow",((t,s)=>{const i=n.getDrumrowName(t,s),[e,a]=n.toggleSolo(s,t.Vt());return[{drumrows:a},["drumrows","toggleSoloDrumrow",i,e]]})),e.set("toggleSoloTrack",((t,s)=>{const[i,e]=n.toggleSolo(s,t.ss());return[{tracks:e},["tracks","toggleSoloTrack",t.es(s).name,i]]})),e.set("toggleTrack",((t,s)=>{const i=t.es(s),e=!i.toggle;return[{tracks:{[s]:{toggle:e}}},["tracks","toggleTrack",i.name,e]]})),e.set("unselectAllBlocks",(t=>{let s=0;return[{blocks:Object.entries(t.Kt()).reduce(((t,[i,e])=>(e.selected&&(++s,t[i]={selected:!1}),t)),{})},["blocks","unselectAllBlocks",s]]})),e.set("unselectAllKeys",((t,s)=>{let i=0;const e=t.Qt(s),n=Object.entries(t.Jt(e.keys)).reduce(((t,[s,e])=>(e.selected&&(++i,t[s]={selected:!1}),t)),{});return[{keys:{[e.keys]:n}},["keys","unselectAllKeys",e.name,i]]})),e.set("unselectBlock",((t,s)=>[{blocks:{[s]:{selected:!1}}},["blocks","unselectBlock"]])),e.set("unselectKey",((t,s,i)=>{const e=t.Qt(s);return[{keys:{[e.keys]:{[i]:{selected:!1}}}},["keys","unselectKey",e.name]]}));class k{#ts=new h;#cs=new P;#w=new $;#ls=new O;#us=new M;#ds=new S;#ps=new D;#gs=new C;#ms=new x;#bs=new U;#ws=null;rootElement=Y.Bn("gsui-daw",{version:"0.0.0",volume:this.#ts.dt(),uirate:+localStorage.getItem("uiRefreshRate")||"auto",samplerate:this.#ts.u.O,timelinenumbering:localStorage.getItem("uiTimeNumbering")||"1",windowslowgraphics:!!+(localStorage.getItem("gsuiWindows.lowGraphics")||"0")});#fs=null;#vs=[[!0,!1,"o",()=>this.rootElement.showOpenPopup()],[!0,!1,"s",()=>this.#ts.Ae()],[!0,!0,"n",()=>this.#ys()],[!0,!1,"z",()=>this.#ts.Ms()],[!0,!1,"Z",()=>this.#ts.Ts()],[!1,!1," ",()=>this.#ts.Fe()?this.#ts.Mi():this.#ts.Si()]];static#A=["audio/wav","audio/wave","audio/flac","audio/webm","audio/ogg","audio/mpeg","audio/mp3","audio/mp4"];static#n={gs:!0,txt:!0,json:!0};constructor(){Object.seal(this),this.#ks(),this.#$s(),this.#Os(),this.#bs.jn(this.#ts),this.#bs.Ln(this.#gs.getUIKeys()),this.#xs(),this.#Ss(),this.#Ds(),this.#Cs()}#ks(){document.body.append(this.rootElement,Y.En("gsui-daw-window-main"),Y.En("gsui-daw-window-piano"),Y.En("gsui-daw-window-drums"),Y.En("gsui-daw-window-synth"),Y.En("gsui-daw-window-mixer"),Y.En("gsui-daw-window-slicer")),this.#ws=this.rootElement.querySelector("gsui-windows"),this.#ts.ws(+localStorage.getItem("uiRefreshRate")||60),this.#ws.lowGraphics(!!+(localStorage.getItem("gsuiWindows.lowGraphics")||"0")),Y.Wn(this.rootElement.clock,"mode",localStorage.getItem("gsuiClock.display")||"second"),st.numbering(localStorage.getItem("uiTimeNumbering")||"1"),Pt.numbering(localStorage.getItem("uiTimeNumbering")||"1"),this.#fs=Y.Fn(document.body,{drumsName:"[data-target=drums]",synthName:"[data-target=synth]",slicesName:"[data-target=slices]",pianorollName:"[data-target=pianoroll]",synthChannelBtn:"[data-target=synthChannel]",synthChannelBtnText:"[data-target=synthChannel] span"})}#Ss(){this.#w.setDAWCore(this.#ts),this.#ls.setDAWCore(this.#ts),this.#cs.setDAWCore(this.#ts),this.#us.setDAWCore(this.#ts),this.#ps.setDAWCore(this.#ts),this.#ds.setDAWCore(this.#ts),this.#gs.setDAWCore(this.#ts),this.#ms.setDAWCore(this.#ts),this.rootElement.querySelector(".gsuiDAW-patterns").append(this.#ps.rootElement),this.rootElement.querySelector(".gsuiDAW-libraries").append(this.#ds.rootElement),this.#ws.window("main").contentAppend(this.#ms.rootElement),this.#ws.window("drums").contentAppend(this.#w.rootElement),this.#ws.window("mixer").contentAppend(this.#ls.rootElement),this.#ws.window("piano").contentAppend(this.#gs.rootElement),this.#ws.window("slicer").contentAppend(this.#us.rootElement),this.#w.rootElement.onfocus=()=>this.#ts.Ce("drums"),this.#us.rootElement.onfocus=()=>this.#ts.Ce("slices"),this.#gs.rootElement.onfocus=()=>this.#ts.Ce("keys"),this.#ms.rootElement.onfocus=()=>this.#ts.Ce("composition"),this.#ws.window("main").onfocusin=k.#Ps.bind(null,this.#ms),this.#ws.window("drums").onfocusin=k.#Ps.bind(null,this.#w),this.#ws.window("piano").onfocusin=k.#Ps.bind(null,this.#gs),this.#ws.window("slicer").onfocusin=k.#Ps.bind(null,this.#us),this.#fs.synthName.onclick=this.#Ms.bind(this,"Rename synthesizer","renameSynth","synth"),this.#fs.drumsName.onclick=this.#Ms.bind(this,"Rename pattern","renamePattern","drums"),this.#fs.slicesName.onclick=this.#Ms.bind(this,"Rename pattern","renamePattern","slices"),this.#fs.pianorollName.onclick=this.#Ms.bind(this,"Rename pattern","renamePattern","keys"),this.#fs.synthChannelBtn.onclick=this.#As.bind(this),this.#ds.loadDefaultLibrary(),this.#ps.setLibraries(this.#ds),this.#ms.setSVGForms(this.#ps.svgForms),this.#gs.rootElement.octaves(1,7),this.#w.rootElement.setPxPerBeat(120),this.#w.setWaveforms(this.#ps.svgForms.bufferHD),this.#ws.window("main").open(),this.#ws.window("mixer").open(),this.#cs.loadWaves().then((()=>this.#ws.window("synth").contentAppend(this.#cs.rootElement)))}#Ds(){window.onblur=()=>this.#gs.getUIKeys().midiReleaseAllKeys(),window.onkeyup=this.#Ts.bind(this),window.onkeydown=this.#Bs.bind(this),window.onbeforeunload=this.#js.bind(this),this.rootElement.ondragover=()=>!1,this.rootElement.oncontextmenu=()=>"localhost"===location.host&&void 0,this.rootElement.addEventListener("wheel",k.#Ls,{passive:!1}),this.rootElement.addEventListener("drop",this.#Es.bind(this)),this.#ts.cb.focusOn=this.#Ws.bind(this),this.#ts.cb.currentTime=(t,s)=>{Y.Wn(this.#Fs(s),"currenttime",t),Y.Wn(this.rootElement,"currenttime",t)},this.#ts.cb.buffersLoaded=(t,s)=>this.#Is(t,s),this.#ts.cb.buffersDropped=t=>this.#ds.addLocalSamples(t),this.#ts.cb.compositionAdded=t=>this.rootElement.addComposition(t),this.#ts.cb.compositionOpened=t=>{Y.Wn(this.rootElement,"currentcomposition",`${t.options.saveMode}:${t.id}`),this.#ps.rootElement.expandSynth(t.synthOpened,!0),this.#Ks(t.name)},this.#ts.cb.compositionClosed=this.#zs.bind(this),this.#ts.cb.compositionChanged=this.#Rs.bind(this),this.#ts.cb.compositionDeleted=t=>this.rootElement.deleteComposition(t),this.#ts.cb.compositionLoading=(t,s)=>Y.Wn(this.rootElement,"saving",s),this.#ts.cb.compositionSavedStatus=(t,s)=>{Y.Wn(this.rootElement,"saved",s),this.#Ks(t.name)},this.#ts.cb.compositionSavingPromise=this.#Ns.bind(this),this.#ts.cb.historyUndo=()=>this.rootElement.undo(),this.#ts.cb.historyRedo=()=>this.rootElement.redo(),this.#ts.cb.historyAddAction=t=>this.rootElement.stackAction(t.icon,t.desc),this.#ts.cb.onstartdrum=t=>this.#w.onstartdrum(t),this.#ts.cb.onstopdrumrow=t=>this.#w.onstopdrumrow(t),this.#ts.cb.analyserFilled=t=>this.rootElement.updateSpectrum(t),this.#ts.cb.channelAnalyserFilled=(t,s,i)=>this.#ls.updateAudioData(t,s,i),this.#ts.cb.pause=this.#ts.cb.stop=()=>Y.Wn(this.rootElement,"playing",!1),this.#ts.cb.play=()=>Y.Wn(this.rootElement,"playing",!0),this.rootElement.onSubmitLogin=(s,i)=>(Y.Wn(this.rootElement,"logging",!0),Y.Wn(this.rootElement,"errauth",!1),t.login(s,i).then((s=>(this.#Gs(s),t.getUserCompositions(s.id)))).then((t=>{const s={saveMode:"cloud"};t.forEach((t=>this.#ts.li(t.data,s)))})).catch((t=>{throw Y.Wn(this.rootElement,"errauth",t.msg),t})).finally((()=>Y.Wn(this.rootElement,"logging",!1)))),this.rootElement.onSubmitOpen=(t,s)=>{if(t||s[0])return(t?this.#ts.hi(t):this.#ts.ri(s[0])).then((t=>this.#ts.Se("local",t.id)))},this.rootElement.onExportJSON=(t,s)=>this.#ts.Js(t,s),Y.In(this.rootElement,{gsuiDAW:{switchCompositionLocation:t=>{const[s,i]=t.args;"local"===s?this.#Hs(s,i):this.#Vs(s,i)},settings:t=>{const s=t.args[0];this.#ts.ws("auto"===s.uiRate?60:s.uiRate),this.#ts.Ke(s.sampleRate),this.#ws.lowGraphics(s.windowsLowGraphics),st.numbering(s.timelineNumbering),Pt.numbering(s.timelineNumbering),localStorage.setItem("uiRefreshRate",s.uiRate),localStorage.setItem("gsuiWindows.lowGraphics",+s.windowsLowGraphics),localStorage.setItem("uiTimeNumbering",s.timelineNumbering),Y.Wn(this.rootElement,"uirate",s.uiRate),Y.Wn(this.rootElement,"samplerate",s.sampleRate),Y.Wn(this.rootElement,"timelinenumbering",s.timelineNumbering),Y.Wn(this.rootElement,"windowslowgraphics",s.windowsLowGraphics)},changeDisplayClock(t){const s=t.args[0];localStorage.setItem("gsuiClock.display",s)},export:()=>{const t=60*this.#ts.Bt()/this.#ts.Lt(),s=setInterval((()=>{Y.Wn(this.rootElement,"exporting",this.#ts.lt().currentTime/t)}),100);this.#ts.Qs().then((t=>{clearInterval(s),Y.Wn(this.rootElement,"exporting",1),this.rootElement.readyToDownload(t.url,t.name)}))},abortExport:()=>this.#ts.Zs(),save:()=>this.#ts.Ae(),open:t=>this.#Us(...t.args),delete:t=>this.#qs(...t.args),tempo:t=>{const s=t.args[0];this.#ts.$e("changeTempo",s.bpm,s.timedivision)},logout:()=>{Y.Wn(this.rootElement,"logging",!0),t.logout().finally((()=>Y.Wn(this.rootElement,"logging",!1))).then((()=>{Y.Wn(this.rootElement,"logged",!1),Y.Wn(this.rootElement,"useravatar",!1),Y.Wn(this.rootElement,"username",!1),this.#ts.nt("cloud").forEach((t=>this.#ts.Pe("cloud",t.id))),this.#ts.Pt()||this.#ys()}))},localNewCmp:()=>this.#ys(),cloudNewCmp:()=>this.#_s(),openWindow:t=>this.#ws.window(t.args[0]).open(),closeWindow:t=>this.#ws.window(t.args[0]).close(),focusSwitch:()=>this.#ts.We(),volume:t=>this.#ts.vs(t.args[0]),rename:t=>this.#ts.$e("renameComposition",t.args[0]),currentTimeLive:t=>Y.Wn(this.#Fs().timeline,"currenttime-preview",t.args[0]),currentTime:t=>{const s=this.#Fs().timeline,i=Y.Kn(s,"currenttime-preview");Y.Wn(s,"currenttime-preview",null),this.#ts.Oi(+(i||t.args[0]))},play:()=>this.#ts.Ie(),stop:()=>{switch(this.#ts.Mi(),this.#ds.stop(),document.activeElement){case this.#gs.rootElement:this.#ts.Ce("keys","-f");break;case this.#w.rootElement:this.#ts.Ce("drums","-f");break;case this.#us.rootElement:this.#ts.Ce("slices","-f");break;case this.#ms.rootElement:this.#ts.Ce("composition","-f")}},reset:()=>this.#ts.fs(),undo:()=>this.#ts.Ms(),redo:()=>this.#ts.Ts(),redoN:t=>{let s=t.args[0];if(s<0)for(;s++<0;)this.#ts.Ms();else for(;s-- >0;)this.#ts.Ts()}}})}#Os(){this.#ws.onopen=t=>this.rootElement.toggleWindow(t.dataset.id,!0),this.#ws.onclose=t=>{switch(this.rootElement.toggleWindow(t.dataset.id,!1),t.dataset.id){case"piano":this.#ts.$e("closePattern","keys");break;case"drums":this.#ts.$e("closePattern","drums");break;case"slicer":this.#ts.$e("closePattern","slices")}},this.#Ys("mixer",20,20,266,200,460,300,"mixer","mixer"),this.#Ys("main",500,20,380,180,600,360,"music","composition"),this.#Ys("synth",20,340,340,220,460,460,"oscillator","synth"),this.#Ys("piano",500,400,380,180,600,400,"keys","pianoroll"),this.#Ys("drums",70,450,380,180,900,400,"drums","drums"),this.#Ys("slicer",160,140,306,250,420,360,"slices","slicer")}#Ys(t,s,i,e,n,a,h,o,r){const c=this.#ws.window(t);c.setSize(a,h),c.setMinSize(e,n),c.setTitle(r),c.setPosition(s,i),c.setTitleIcon(o)}#$s(){document.querySelectorAll("div[data-window]").forEach((t=>{const s=this.#ws.createWindow(t.dataset.window),i=s.querySelector(".gsuiWindow-content"),e=Array.from(t.children);if(t.remove(),t.classList.forEach((t=>i.classList.add(t))),e.length){const t=e[0];t.classList.contains("gsuiDAW-winMenu")&&(e.shift(),s.headAppend(...t.children)),s.contentAppend(...e)}}))}getDAWCore(){return this.#ts}newComposition(){this.#ys()}#Ws(t){const s=this.#ts.ki(),i=this.#Fs(t),e="composition"===t;Y.Wn(this.rootElement,"focus",e?"up":"down"),Y.Wn(this.rootElement,"duration",this.#ts.Ee()),Y.Wn(this.rootElement,"currenttime",s),this.#gs.rootElement.classList.toggle("selected","keys"===t),this.#w.rootElement.classList.toggle("selected","drums"===t),this.#us.rootElement.classList.toggle("selected","slices"===t),this.#ms.rootElement.classList.toggle("selected",e),i.focus()}#Fs(t=this.#ts.Le()){switch(t){default:return null;case"keys":return this.#gs.rootElement;case"drums":return this.#w.rootElement;case"slices":return this.#us.rootElement;case"composition":return this.#ms.rootElement}}#Bs(t){this.#Js(t)||t.ctrlKey||t.altKey||t.shiftKey||this.#Xs(!0,t)}#Ts(t){this.#Xs(!1,t)}#Xs(t,s){const i=this.#gs.getUIKeys(),e=i.getMidiKeyFromKeyboard(s);if(!1!==e)return t?i.midiKeyDown(e):i.midiKeyUp(e),!0}#Js(t){return this.#vs.some((([s,i,e,n])=>{if(e===t.key&&(!i||t.altKey)&&s===(t.ctrlKey||t.altKey))return n(),t.preventDefault(),!0}))}#ys(){(this.#ts.si()?Y.zn.confirm("Warning","Are you sure you want to discard unsaved works").then((t=>t&&this.#ts.ii())):this.#ts.ii()).then((t=>t&&this.#ts.Se("local",t.id)))}#_s(){t.user.id?(this.#ts.si()?Y.zn.confirm("Warning","Are you sure you want to discard unsaved works").then((t=>t&&this.#ts.ii({saveMode:"cloud"}))):this.#ts.ii({saveMode:"cloud"})).then((t=>t&&this.#ts.Se("cloud",t.id))):Y.zn.alert("Error","You can not create a new composition in the <b>cloud</b><br/>without being connected")}#js(){if(this.#ts.si())return"Data unsaved"}#Us(t,s){this.#ts.si()?Y.zn.confirm("Warning","Are you sure you want to discard unsaved works").then((i=>i&&this.#ts.Se(t,s))):this.#ts.Se(t,s)}#qs(s,i){const e=this.#ts.ot(s,i);Y.zn.confirm("Warning",`Are you sure you want to delete "${e.name}" ? (no undo possible)`,"Delete").then((e=>{e&&("cloud"===s?t.deleteComposition(i):Promise.resolve()).catch((t=>{if(404!==t.code)throw Y.zn.alert(`Error ${t.code}`,`An error happened while deleting your composition&nbsp;:<br/><code>${t.msg||t}</code>`),t})).then((()=>{i===this.#ts.jt()&&this.#ys(),this.#ts.Pe(s,i)}))}))}static#Ls(t){t.ctrlKey&&t.preventDefault()}static#Ps(t,s){t.rootElement.contains(s.target)||t.rootElement.focus()}#Ms(t,s,i,e){const n=this.#ts.ct(i);n&&Y.zn.prompt(t,"",e.currentTarget.textContent,"Rename").then((t=>this.#ts.$e(s,n,t)))}#As(){const t=this.#ts.ct("synth");t&&et.openSelectChannelPopup(this.#ts.ts(t).dest).then((s=>s&&this.#ts.$e("redirectSynth",t,s)))}#Es(t){t.preventDefault(),this.#ts.Be(Y.Rn(t.dataTransfer.items))}#Qs(t,s){const i="local"===t?"cloud":"local",e=this.#ts.ot(t,s),n=this.#ts.ot(i,s);return n?Y.zn.confirm("Warning",`Are you sure you want to overwrite the <b>${i}</b> composition <i>${n.name||"Untitled"}</i>&nbsp;?`).then((t=>{if(t)return e;throw void 0})):Promise.resolve(e)}#Vs(t,s){this.#Qs(t,s).then((t=>this.#ts.li(t,{saveMode:"local"}))).then((t=>r.Te(t.id,t)))}#Hs(s,i){t.user.id?this.#Qs(s,i).then((t=>this.#Ns(t))).then((t=>this.#ts.li(t,{saveMode:"cloud"}))):Y.zn.alert("Error","You need to be connected to your account before uploading your composition")}#Ns(s){return t.saveComposition(s).then((()=>s),(t=>{throw Y.zn.alert(`Error ${t.code}`,`An error happened while saving your composition&nbsp;:<br/><code>${t.msg||t}</code>`),t}))}#Cs(){return Y.Wn(this.rootElement,"logging",!0),t.getMe().then((s=>(this.#Gs(s),t.getUserCompositions(s.id)))).then((t=>{const s={saveMode:"cloud"};t.forEach((t=>this.#ts.li(t.data,s)))})).catch((t=>{if(401!==t.code)throw t})).finally((()=>Y.Wn(this.rootElement,"logging",!1)))}#Gs(t){return Y.Wn(this.rootElement,"useravatar",t.avatar),Y.Wn(this.rootElement,"username",t.username),Y.Wn(this.rootElement,"logged",!0),t}#Ks(t){const s=t||"GridSound";document.title=this.#ts.si()?`*${s}`:s}#zs(t){this.#Rs({bpm:t.bpm,name:t.name,duration:t.duration},{}),Y.Wn(this.rootElement,"currentcomposition",!1),Y.Wn(this.#ds.rootElement,"lib","default"),this.#cs.clear(),this.#ls.clear(),this.#w.clear(),this.#gs.clear(),this.#ms.clear(),this.#w.rootElement.loop(!1),this.#gs.rootElement.loop(!1),this.#ms.rootElement.loop(!1),this.#fs.drumsName.textContent=this.#fs.synthName.textContent=this.#fs.pianorollName.textContent="",this.#ps.clear(),this.#ds.clear()}#Rs(t){console.log("change",t),this.#ps.change(t),this.#cs.change(t),this.#w.change(t),this.#ls.change(t),this.#us.change(t),this.#gs.change(t),this.#ms.change(t),k.#Zs.forEach(((s,i)=>{i in t&&s.call(this,t)}))}static#Zs=new Map([["channels",function(t){const s=t.channels[this.#ts.ts(this.#ts.ct("synth")).dest];s&&"name"in s&&(this.#fs.synthChannelBtnText.textContent=s.name)}],["synths",function(t){const s=t.synths[this.#ts.ct("synth")];s&&("name"in s&&(this.#fs.synthName.textContent=s.name),"dest"in s&&(this.#fs.synthChannelBtnText.textContent=this.#ts.Gt(s.dest).name))}],["patterns",function(t){Object.entries(t.patterns).forEach((t=>this.#ti(...t)))}],["timedivision",function(t){Y.Wn(this.rootElement,"timedivision",t.timedivision)}],["bpm",function({bpm:t}){Y.Wn(this.rootElement,"bpm",t),this.rootElement.updateComposition(this.#ts.Pt())}],["name",function({name:t}){this.#Ks(t),this.rootElement.updateComposition(this.#ts.Pt()),Y.Wn(this.rootElement,"name",t)}],["duration",function({duration:t}){"composition"===this.#ts.Le()&&Y.Wn(this.rootElement,"duration",t),this.rootElement.updateComposition(this.#ts.Pt())}],["patternSlicesOpened",function(t){if(t.patternSlicesOpened){const s=this.#ts.Qt(t.patternSlicesOpened);this.#fs.slicesName.textContent=s.name,this.#ws.window("slicer").open(),"slices"===this.#ts.Le()&&Y.Wn(this.rootElement,"duration",this.#ts.Qt(s.source)?.duration??this.#ts.Ft())}else this.#fs.slicesName.textContent=""}],["patternDrumsOpened",function(t){if(t.patternDrumsOpened){const s=this.#ts.Qt(t.patternDrumsOpened);this.#fs.drumsName.textContent=s.name,this.#ws.window("drums").open(),"drums"===this.#ts.Le()&&Y.Wn(this.rootElement,"duration",s.duration)}else this.#fs.drumsName.textContent=""}],["synthOpened",function(t){if(t.synthOpened){const s=this.#ts.ts(t.synthOpened);this.#fs.synthName.textContent=s.name,this.#fs.synthChannelBtnText.textContent=this.#ts.Gt(this.#ts.ts(t.synthOpened).dest).name,this.#ws.window("synth").open()}else this.#fs.synthName.textContent="",this.#fs.synthChannelBtnText.textContent=""}],["patternKeysOpened",function({patternKeysOpened:t}){if(t){const s=this.#ts.Qt(t);this.#fs.pianorollName.textContent=s.name,"keys"===this.#ts.Le()&&Y.Wn(this.rootElement,"duration",s.duration),this.#ws.window("piano").open()}else this.#fs.pianorollName.textContent=""}]]);#ti(t,s){if(s){if("duration"in s){const i=this.#ts.Le();"composition"!==i&&t===this.#ts.ct(i)&&Y.Wn(this.rootElement,"duration",s.duration)}if("name"in s){const i=s.name;this.#ms.rootElement.getBlocks().forEach((s=>{s.dataset.pattern===t&&(s.querySelector(".gsuiPatternroll-block-name").textContent=i)})),t===this.#ts.ct("slices")&&(this.#fs.slicesName.textContent=i),t===this.#ts.ct("keys")&&(this.#fs.pianorollName.textContent=i),t===this.#ts.ct("drums")&&(this.#fs.drumsName.textContent=i)}}}#Is(t,s){const i=this.#ts.Qt(this.#ts.ct("slices"));(i?.source&&this.#ts.Qt(i.source).buffer)===t&&this.#us.rootElement.setBuffer(s.buffer),this.#ps.bufferLoaded(t,s.buffer),this.#ms.rootElement.getBlocks().forEach(((s,i)=>{const e=this.#ts.zt(i),n=this.#ts.Qt(e.pattern);if("buffer"===n.type&&n.buffer===t){const t=n.bufferBpm||this.#ts.Lt();Y.Wn(s,"data-missing",!1),this.#ps.svgForms.buffer.setSVGViewbox(s._gsuiSVGform,e.offset,e.duration,t/60)}}))}#si(t,s=!1){!1===s&&console.log("GSLogs: Sysex is not allowed. Some features of your devices may be disabled."),this.#bs.Nn(t)}#ii(t,s=!1){!0===s?navigator.requestMIDIAccess().then(onMIDISuccess,onMIDIFailure):(console.log("GSLogs: Failed to get MIDI access - "+t),console.log("GSLogs: MIDI devices are disabled"))}#xs(){navigator.requestMIDIAccess({sysex:!0}).then((t=>this.#si(t,!0)),(t=>this.#ii(t,!0)))}}Object.freeze(k);class ${#ts=null;#ei=null;#ss=null;#ni=null;rootElement=Y.Bn("gsui-drums");timeline=this.rootElement.timeline;#ai=this.rootElement.drumrows;#hi=new a.drums({dataCallbacks:{addDrum:(t,s)=>this.rootElement.addDrum(t,s),addDrumcut:(t,s)=>this.rootElement.addDrumcut(t,s),changeDrum:(t,s,i)=>this.rootElement.changeDrum(t,s,i),removeDrum:t=>this.rootElement.removeDrum(t),removeDrumcut:t=>this.rootElement.removeDrumcut(t)}});#oi=new a.drumrows({dataCallbacks:{addDrumrow:t=>{this.#ai.add(t,this.rootElement.createDrumrow(t)),this.#ri(t,"gain")},removeDrumrow:t=>this.#ai.remove(t),changeDrumrow:(t,s,i)=>{switch(s){default:this.#ai.change(t,s,i);break;case"pattern":this.#ai.change(t,s,this.#ni.createSVG(i));break;case"duration":{const i=this.#ts.Ut(t).pattern,e=this.#ts.Qt(i).buffer;this.#ai.change(t,s,this.#ts.Ct(e).duration)}}}}});constructor(){Object.seal(this),Y.In(this.rootElement,{gsuiDrumrows:{change:t=>{this.#ts.$e(...t.args)},propFilter:t=>{this.#ri(...t.args)},propFilters:t=>{this.#ci(...t.args)},liveStopDrum:t=>{this.#ts.Ki(...t.args)},liveStartDrum:t=>{this.#ts.Ii(...t.args)},liveChangeDrumrow:t=>{this.#ts.Fi(...t.args)}},gsuiDrums:{change:t=>{const[s,...i]=t.args;this.#ts.$e(s,this.#ss,...i)}},gsuiTimeline:{changeCurrentTime:t=>{this.#ts.ne(t.args[0])},changeLoop:t=>{const[s,i]=t.args;!1!==s?this.#ts.ae(s,i):this.#ts.he()}},gsuiSliderGroup:{change:t=>{this.#ts.$e("changeDrumsProps",this.#ss,...t.args)},input:t=>{this.#ai.setDrumPropValue(t.args[0],t.args[2],t.args[3])},inputEnd:t=>{this.#ai.removeDrumPropValue(...t.args)}}}),Y.Wn(this.rootElement,"disabled",!0)}setDAWCore(t){this.#ts=t}selectPattern(t){if(t!==this.#ss&&(this.#ss=t,this.#ei=null,this.#hi.clear(),Y.Wn(this.rootElement,"disabled",!t),t)){const s=this.#ts.Qt(t),i=this.#ts.qt(s.drums);this.#ei=s.drums,this.#hi.change(i)}}setWaveforms(t){this.#ni=t}onstartdrum(t){this.#ai.playRow(t)}onstopdrumrow(t){this.#ai.stopRow(t)}change(t){const s=t.drums&&t.drums[this.#ei];this.#oi.change(t),t.drumrows&&this.rootElement.drumrows.reorderDrumrows(t.drumrows),"timedivision"in t&&this.rootElement.timedivision(t.timedivision),s&&this.#hi.change(s),"patternDrumsOpened"in t&&this.selectPattern(t.patternDrumsOpened)}clear(){this.selectPattern(null),this.#oi.clear()}#ri(t,s){const i=Object.entries(this.#ts.qt(this.#ei)).filter((([,s])=>s.row===t&&"gain"in s)).map((([t,i])=>[t,i[s]]));this.#ai.setPropFilter(t,s),this.rootElement.setPropValues(t,s,i)}#ci(t){Object.keys(this.#ts.Vt()).forEach((s=>this.#ri(s,t)))}}Object.freeze($);class O{#ts=null;rootElement=Y.Bn("gsui-mixer");#li=this.rootElement.getChannels();#ui=this.rootElement.getEffects();#di="main";#pi=new a.mixer({dataCallbacks:{addChannel:(t,s)=>this.#li.addChannel(t,s),removeChannel:t=>this.#li.removeChannel(t),renameChannel:(t,s)=>this.#li.renameChannel(t,s),redirectChannel:(t,s)=>this.#li.redirectChannel(t,s),toggleChannel:(t,s)=>this.#li.toggleChannel(t,s),reorderChannel:(t,s)=>this.#li.reorderChannel(t,s),changePanChannel:(t,s)=>this.#li.changePanChannel(t,s),changeGainChannel:(t,s)=>this.#li.changeGainChannel(t,s),addEffect:(t,s,i)=>this.#li.Gt(t).Gn(s,i),updateEffect:(t,s,i)=>this.#li.Gt(t).Hn(s,i),removeEffect:(t,s)=>this.#li.Gt(t).Vn(s)}});#gi=new a.effects({dataCallbacks:{changeTimedivision:t=>Y.Wn(this.#ui,"timedivision",t),addEffect:(t,s)=>this.#ui.Gn(t,s),removeEffect:t=>this.#ui.Vn(t),changeEffect:(t,s,i)=>this.#ui.Un(t,s,i),changeEffectData:(t,s)=>this.#mi(t,s)}});constructor(){Object.seal(this),this.#li.oninput=this.#bi.bind(this),this.#li.onchange=this.#wi.bind(this),this.#li.onselectChan=this.#fi.bind(this),this.#li.onselectEffect=this.#vi.bind(this),this.#ui.qn=(t,s,i,...e)=>{if("filter"===s&&"curve"===i)return this.#ts.bt(t)?._n?.(e[0])},Y.In(this.rootElement,{gsuiEffects:{liveChangeEffect:t=>{this.#ts.Bi(...t.args)},addEffect:t=>{t.args.unshift(this.#di),this.#ts.$e("addEffect",...t.args)},default:t=>{this.#ts.$e(t.eventName,...t.args)}}})}setDAWCore(t){this.#ts=t}clear(){this.#gi.clear(),this.#pi.clear(),this.#li.selectChannel("main")}change(t){this.#gi.change(t),this.#pi.change(t),t.effects&&this.#ui.Yn(t.effects),t.channels&&this.#li.reorderChannels(t.channels)}updateAudioData(t,s,i){this.#li.updateAudioData(t,s,i)}#bi(t,s,i){this.#ts.Ti(t,s,i)}#wi(t,...s){this.#ts.$e(t,...s)}#fi(t){this.#di=t,this.#gi.setDestFilter(t)}#vi(t,s){this.#ui.Jn(s)}#mi(t,s){const i=this.#ui.Xn(t).uiFx;Object.entries(s).forEach((t=>Y.Wn(i,...t))),i.Qn?.()}}Object.freeze(O);class x{#ts=null;#yi=null;rootElement=Y.Bn("gsui-patternroll");timeline=this.rootElement.timeline;#ki=new a.tracks({dataCallbacks:{addTrack:t=>this.rootElement.addTrack(t),removeTrack:t=>this.rootElement.removeTrack(t),toggleTrack:(t,s)=>this.rootElement.toggleTrack(t,s),renameTrack:(t,s)=>this.rootElement.renameTrack(t,s),reorderTrack:(t,s)=>this.rootElement.reorderTrack(t,s)}});#$i=new a.blocks({dataCallbacks:{addBlock:(t,s)=>{const i=this.#ts.Qt(s.pattern),e="buffer"!==i.type||!!this.#ts.Dt(i.buffer);this.rootElement.addBlock(t,s,{dataReady:e})},removeBlock:t=>this.rootElement.removeBlock(t),changeBlockProp:(t,s,i)=>this.rootElement.changeBlockProp(t,s,i),updateBlockViewBox:(t,s)=>this.rootElement.updateBlockViewBox(t,s)}});constructor(){Object.seal(this),this.rootElement.setData(this.#$i.data),this.rootElement.setCallbacks({onchange:this.#wi.bind(this),onaddBlock:this.#Oi.bind(this),oneditBlock:this.#xi.bind(this)}),this.rootElement.addEventListener("gsuiEvents",this.#Si.bind(this))}setDAWCore(t){this.#ts=t}setSVGForms(t){this.#yi=t}change(t){this.#ki.change(t),this.#$i.change(t),("loopA"in t||"loopB"in t)&&this.rootElement.loop(this.#ts.At(),this.#ts.Tt()),"timedivision"in t&&this.rootElement.timedivision(t.timedivision),"patterns"in t&&Object.entries(t.patterns).forEach((([t,s])=>{s&&"bufferBpm"in s&&this.#mt(t)}))}clear(){this.#$i.clear(),this.#ki.clear()}#Si(t){const s=t.detail;switch(s.component){case"gsuiTracklist":this.#ts.$e(s.eventName,...s.args);break;case"gsuiTimeline":switch(s.eventName){case"changeLoop":this.#ts.$e("changeLoop",...s.args);break;case"changeCurrentTime":this.#ts.$i(s.args[0])}}t.stopPropagation()}#mt(t){this.rootElement.getBlocks().forEach((s=>{s.dataset.pattern===t&&this.rootElement.updateBlockViewBox(s.dataset.id,this.#$i.data[s.dataset.id])}))}#wi(t,...s){switch(t){case"add":this.#ts.$e("addBlock",...s);break;case"move":this.#ts.$e("moveBlocks",...s);break;case"cropEnd":this.#ts.$e("cropEndBlocks",...s);break;case"cropStart":this.#ts.$e("cropStartBlocks",...s);break;case"duplicate":this.#ts.$e("duplicateSelectedBlocks",...s);break;case"deletion":this.#ts.$e("removeBlocks",...s);break;case"selection":this.#ts.$e("selectBlocks",...s);break;case"unselection":this.#ts.$e("unselectAllBlocks",...s);break;case"unselectionOne":this.#ts.$e("unselectBlock",...s)}}#xi(t,s,i){if(i._gsuiSVGform){const t=this.#ts.Qt(s.pattern),e=t.bufferBpm||this.#ts.Lt();this.#yi[t.type].setSVGViewbox(i._gsuiSVGform,s.offset,s.duration,e/60)}}#Oi(t,s,i){const e=this.#ts.Qt(s.pattern),n=this.#yi[e.type],a=n.createSVG(s.pattern);i._gsuiSVGform=a,i.children[3].append(a),n.setSVGViewbox(a,s.offset,s.duration,this.#ts.Et()),i.ondblclick=()=>this.#ts.$e("openPattern",s.pattern),i.querySelector(".gsuiPatternroll-block-name").textContent=e.name}}Object.freeze(x);class S{rootElement=null;#ts=null;constructor(){this.rootElement=Y.Bn("gsui-libraries"),Y.Wn(this.rootElement.getLibrary("local"),"name","local"),Y.Wn(this.rootElement.getLibrary("default"),"name","default"),Y.In(this.rootElement,{gsuiLibrary:{loadSample:(t,s)=>{const i=Y.Kn(s,"name");this.#Di(i,t.args[0]).then((()=>this.#Ci(i,t.args[0])))},playSample:(t,s)=>{this.#Ci(Y.Kn(s,"name"),t.args[0])},stopSample:()=>{this.#ts.Hs(),this.stop()}}})}setDAWCore(t){this.#ts=t}loadDefaultLibrary(){return Y.Zn("/assets/gsuiLibrarySamples-v1.js").then((()=>{this.rootElement.getLibrary("default").setLibrary(gsuiLibrarySamples)}))}addLocalSamples(t){t.length>0&&(this.rootElement.getLibrary("local").setLibrary(t.map((t=>Array.isArray(t)?[t[0],Kt.getPointsFromBuffer(40,10,t[1]),t[2]]:t))),Y.Wn(this.rootElement,"lib","local"))}stop(){this.rootElement.getLibrary("default").stopSample(),this.rootElement.getLibrary("local").stopSample()}clear(){this.stop(),this.rootElement.getLibrary("default").unloadSamples(),this.rootElement.getLibrary("local").clear()}ta(t,s){this.rootElement.getLibrary("default").bookmarkSample(t,s),this.rootElement.getLibrary("local").bookmarkSample(t,s)}#Di(t,s){switch(t){case"local":return this.rootElement.getLibrary("local").readySample(s),Promise.resolve();case"default":return this.rootElement.getLibrary("default").loadSample(s),this.#ts.Fs(s).then((t=>(this.rootElement.getLibrary("default").readySample(s),t)))}}#Ci(t,s){const i=this.#ts.Ns(s);this.rootElement.getLibrary(t).playSample(s,i.duration)}}Object.freeze(S);class D{#ts=null;#Pi=null;#Mi=null;#Ai=null;#pt=null;#Ti=null;constructor(){const t=Y.Bn("gsui-patterns"),s=Object.freeze({keys:new Rt,drums:new Nt,buffer:new zt,bufferHD:new zt,slices:new Gt});t.onpatternDataTransfer=t=>t.dataset.id,t.onchange=(t,...s)=>{if(e.has(t)){const i=this.#ts;if("removePattern"===t&&i.Fe()){const t=s[0],e=i.Qt(t).type;e===i.Le()&&t===i.ct(e)&&i.Mi()}i.$e(t,...s)}else console.log("GSPatterns.onchange",t,...s)},Y.In(t,{gsuiPatterns:{libraryBufferDropped:t=>{const[s,i]=t.args,[e,n]=i.split(":");this.#ts.Ks(e).then((t=>{const e=this.#ts.$e("addPatternBuffer",s,i,t),n=e&&Object.entries(e.buffers)[0];n&&this.#ts.ds("buffersLoaded",n[0],{...n[1],buffer:t})}))}}}),this.data=Object.freeze({synths:{},patterns:{},channels:{}}),this.rootElement=t,this.svgForms=s,this.#Mi=t,this.#Ai=i.kn.bind(null,this.data.synths,this.#Bi.bind(this),this.#ji.bind(this),this.#Li.bind(this)),this.#pt=i.kn.bind(null,this.data.patterns,this.#Ei.bind(this),this.#mt.bind(this),this.#bt.bind(this)),this.#Ti=i.kn.bind(null,this.data.channels,this.#Wi.bind(this),this.#zt.bind(this),this.#Rt.bind(this)),Object.seal(this),s.bufferHD.hdMode(!0),s.bufferHD.setDefaultViewbox(260,48)}setDAWCore(t){this.#ts=t}setLibraries(t){this.#Pi=t}clear(){Object.keys(this.data.patterns).forEach(this.#bt,this),Object.keys(this.data.synths).forEach(this.#Li,this),this.svgForms.keys.empty(),this.svgForms.drums.empty(),this.svgForms.slices.empty(),this.svgForms.buffer.empty(),this.svgForms.bufferHD.empty()}bufferLoaded(t,s){const i=Object.entries(this.#ts.Xt()).reduce(((t,[s,i])=>(t[i.buffer]=s,t)),{});this.svgForms.buffer.update(i[t],s),this.svgForms.bufferHD.update(i[t],s),this.#Mi.changePattern(i[t],"data-missing",!1)}change(t){this.#Ai(t.synths),this.#pt(t.patterns),this.#Ti(t.channels),(t.keys||t.drums||t.slices||t.drumrows||t.patterns)&&Object.entries(this.#ts.Xt()).forEach((([s,i])=>{const e=t.patterns?.[s];("drums"===i.type&&(e?.duration||t.drums?.[i.drums]||t.drumrows)||"keys"===i.type&&(e?.duration||t.keys?.[i.keys])||"slices"===i.type&&(e?.source||t.patterns?.[i.source]?.duration||t.slices?.[i.slices]))&&this.#Fi(s)})),t.patterns&&this.#Mi.reorderPatterns(t.patterns),"patternSlicesOpened"in t&&this.#Mi.selectPattern("slices",t.patternSlicesOpened),"patternDrumsOpened"in t&&this.#Mi.selectPattern("drums",t.patternDrumsOpened),"patternKeysOpened"in t&&this.#Mi.selectPattern("keys",t.patternKeysOpened),"synthOpened"in t&&this.#Mi.selectSynth(t.synthOpened)}#Fi(t){const s=this.#ts,i=s.Qt(t),e=this.#Mi.getPattern(t);if(e){const n=i.type,a=s.rs(t);switch(n){case"keys":this.svgForms.keys.update(t,s.Jt(i.keys),a);break;case"slices":this.svgForms.slices.update(t,s.Ht(i.slices),a);break;case"drums":this.svgForms.drums.update(t,s.qt(i.drums),s.Vt(),a,s.It());break;case"buffer":{const s=this.#ts.Dt(i.buffer);s&&(this.svgForms.buffer.update(t,s),this.svgForms.bufferHD.update(t,s))}}"buffer"!==n&&this.svgForms[n].setSVGViewbox(e.querySelector("svg"),0,a)}}#Bi(t,s){this.data.synths[t]=i.Ne(s),this.#Mi.addSynth(t),this.#ji(t,s)}#ji(t,s){const i=this.data.synths[t];Object.entries(s).forEach((([s,e])=>{i[s]=e,this.#Mi.changeSynth(t,s,e)})),"dest"in s&&this.#Mi.changeSynth(t,"destName",this.#ts.Gt(s.dest).name)}#Li(t){delete this.data.synths[t],this.#Mi.deleteSynth(t)}#Ei(t,s){const e="buffer"===s.type,n=e&&this.#ts.Dt(s.buffer),a=this.svgForms[e?"bufferHD":s.type];if(this.data.patterns[t]=i.Ne(s),a.add(t),e){const i=this.#ts.Ct(s.buffer),e=i.url||i.hash;this.svgForms.buffer.add(t),n&&(this.svgForms.buffer.update(t,n),a.update(t,n)),this.data.patterns[t].bufferHash=e,this.#Pi.ta(e,!0)}this.#Mi.addPattern(t,s),this.#mt(t,s),this.#Mi.appendPatternSVG(t,a.createSVG(t)),e&&!n&&this.#Mi.changePattern(t,"data-missing",!0)}#mt(t,s){const i=this.data.patterns[t];Object.entries(s).forEach((([s,e])=>{i[s]=e,this.#Mi.changePattern(t,s,e)})),"dest"in s&&this.#Mi.changePattern(t,"destName",this.#ts.Gt(s.dest).name)}#bt(t){const s=this.data.patterns[t];delete this.data.patterns[t],this.svgForms[s.type].delete(t),"buffer"===s.type&&(this.svgForms.bufferHD.delete(t),this.#Pi.ta(s.bufferHash,!1)),this.#Mi.deletePattern(t)}#Wi(t,s){this.data.channels[t]=s.name}#zt(t,s){"name"in s&&this.#Mi.updateChannel(t,s.name)}#Rt(t){delete this.data.channels[t]}}Object.freeze(D);class C{#ts=null;#Ii=null;#ss=null;rootElement=new gt;timeline=this.rootElement.timeline;#Ki=new a.keys({dataCallbacks:{addKey:(t,s)=>this.rootElement.addKey(t,s),removeKey:t=>this.rootElement.removeKey(t),changeKeyProp:(t,s,i)=>this.rootElement.changeKeyProp(t,s,i)}});constructor(){Object.seal(this),Y.In(this.rootElement,{gsuiPianoroll:{changeKeysProps:t=>{this.#ts.$e("changeKeysProps",this.#ss,...t.args)}},gsuiTimeline:{changeCurrentTime:t=>{this.#ts.Ui(t.args[0])},changeLoop:t=>{!1!==t.args[0]?this.#ts.Yi(...t.args):this.#ts.Xi()}},gsuiKeys:{keyUp:t=>{this.#ts.Wi(t.args[0])},keyDown:t=>{this.#ts.Ei(t.args[0])}}}),this.rootElement.setData(this.#Ki.data),this.rootElement.setCallbacks({onchange:this.#wi.bind(this)}),Y.Wn(this.rootElement,"disabled",!0)}setDAWCore(t){this.#ts=t}selectPattern(t){if(t!==this.#ss&&(this.#ss=t,this.#Ii=null,this.#Ki.clear(),this.rootElement.reset(),Y.Wn(this.rootElement,"disabled",!t),t)){const s=this.#ts.Qt(t),i=this.#ts.Jt(s.keys);this.#Ii=s.keys,this.#Ki.change(i),this.rootElement.scrollToKeys()}}change(t){if("timedivision"in t&&this.rootElement.timedivision(t.timedivision),"patternKeysOpened"in t)this.selectPattern(t.patternKeysOpened);else{const s=t.keys&&t.keys[this.#Ii];s&&this.#Ki.change(s)}}clear(){this.selectPattern(null),this.#Ki.clear()}getUIKeys(){return this.rootElement.uiKeys}#wi(t,...s){switch(t){case"add":this.#ts.$e("addKey",this.#ss,...s);break;case"move":this.#ts.$e("moveKeys",this.#ss,...s);break;case"clone":this.#ts.$e("cloneSelectedKeys",this.#ss,...s);break;case"remove":this.#ts.$e("removeKeys",this.#ss,...s);break;case"cropEnd":this.#ts.$e("cropEndKeys",this.#ss,...s);break;case"redirect":this.#ts.$e("redirectKey",this.#ss,...s);break;case"selection":this.#ts.$e("selectKeys",this.#ss,...s);break;case"unselection":this.#ts.$e("unselectAllKeys",this.#ss,...s);break;case"unselectionOne":this.#ts.$e("unselectKey",this.#ss,...s)}}}Object.freeze(C);class P{#ts=null;#zi=null;rootElement=Y.Bn("gsui-synthesizer");#Ri=new a.synth({dataCallbacks:{addOsc:(t,s)=>this.rootElement.addOscillator(t,s),removeOsc:t=>this.rootElement.removeOscillator(t),changeEnvProp:(t,s)=>this.rootElement.changeEnvProp(t,s),changeLFOProp:(t,s)=>this.rootElement.changeLFOProp(t,s),changeOscProp:(t,s,i)=>Y.Wn(this.rootElement.getOscillator(t),s,i),updateEnvWave:()=>this.rootElement.env.updateWave(),updateLFOWave:()=>this.rootElement.lfo.updateWave(),updateOscWave:t=>this.rootElement.getOscillator(t).updateWave()}});constructor(){Object.seal(this),this.rootElement.addEventListener("gsuiEvents",(t=>{const s=t.detail,i=s.args,e=this.#zi,n=this.#ts;switch(s.component){case"gsuiEnvelope":if("change"===s.eventName)n.$e("changeEnv",e,...i);break;case"gsuiLFO":switch(s.eventName){case"change":n.$e("changeLFO",e,...i);break;case"liveChange":n.Li(e,{lfo:{[i[0]]:i[1]}})}break;case"gsuiSynthesizer":switch(s.eventName){case"toggleEnv":n.$e("toggleEnv",e);break;case"toggleLFO":n.$e("toggleLFO",e);break;case"addOscillator":n.$e("addOscillator",e);break;case"reorderOscillator":n.$e("reorderOscillator",e,i[0])}break;case"gsuiOscillator":{const a=t.target.dataset.id;switch(s.eventName){case"remove":n.$e("removeOscillator",e,a);break;case"change":n.$e("changeOscillator",e,a,...i);break;case"liveChange":n.Li(e,{oscillators:{[a]:{[i[0]]:i[1]}}})}}}t.stopPropagation()}))}loadWaves(){return Y.Zn("/assets/gswaPeriodicWavesList-v1.js").then((()=>{const t=V.sa(gswaPeriodicWavesList);this.rootElement.setWaveList(Array.from(t.keys())),t.forEach(((t,s)=>vt.addWave(s,t.real,t.imag)))}))}setDAWCore(t){this.#ts=t}selectSynth(t){t!==this.#zi&&(this.#zi=t,this.#Ri.clear(),t&&this.#Ri.change(this.#ts.ts(t)))}change(t){this.#ts;const s=t.synths&&t.synths[this.#zi];t.timedivision&&(Y.Wn(this.rootElement.env,"timedivision",t.timedivision),Y.Wn(this.rootElement.lfo,"timedivision",t.timedivision)),s&&(this.#Ri.change(s),s.oscillators&&this.rootElement.reorderOscillators(s.oscillators)),"synthOpened"in t&&this.selectSynth(t.synthOpened)}clear(){this.#Ri.clear()}}Object.freeze(P);class M{rootElement=Y.Bn("gsui-slicer");#ts=null;#Ni=new a.slicer({dataCallbacks:{disabled:t=>Y.Wn(this.rootElement,"disabled",t),timedivision:t=>Y.Wn(this.rootElement,"timedivision",t),setBuffer:t=>this.rootElement.setBuffer(t),renameBuffer:t=>this.rootElement.setBufferName(t),removeBuffer:()=>{this.rootElement.removeBuffer(),Y.Wn(this.rootElement,"duration",this.#ts.Ft())},changeDuration:t=>Y.Wn(this.rootElement,"duration",t),addSlice:(t,s)=>this.rootElement.addSlice(t,s),changeSlice:(t,s)=>this.rootElement.changeSlice(t,s),removeSlice:t=>this.rootElement.removeSlice(t)}});constructor(){Object.seal(this),Y.In(this.rootElement,{gsuiSlicer:{dropBuffer:t=>{this.#ts.$e("redirectPatternSlices",this.#Ni.getPatternId(),t.args[0])},changeProp:t=>{this.#ts.$e("changePatternSlices",this.#Ni.getPatternId(),...t.args)}},gsuiTimeline:{changeCurrentTime:t=>{this.#ts.de(t.args[0])},changeLoop:t=>{!1!==t.args[0]?this.#ts.pe(...t.args):this.#ts.ge()}}})}setDAWCore(t){this.#ts=t,this.#Ni.setDAWCore(t)}change(t){this.#Ni.change(t)}clear(){this.#Ni.clear()}}Object.freeze(M);class A{#Gi=null;#Hi=null;#Vi=null;#Ui=null;#qi=null;#_i=Object.seal({toggle:!1,when:0,whenStop:0,offset:0,type:"",delay:0,attack:0,absoluteAmp:0,absoluteSpeed:0,amp:0,speed:0,variations:[]});constructor(t,s){this.#Gi=t,this.#Hi=s,Object.seal(this)}pn(t){const s=this.#_i;s.toggle=t.toggle||!1,s.when=t.when||this.#Gi.currentTime,s.whenStop=t.whenStop?Math.max(t.when+t.delay+t.attack+.1,t.whenStop):0,s.offset=t.offset||0,s.type=t.type||"sine",s.delay=t.delay||0,s.attack=t.attack||0,s.amp="amp"in t?t.amp:1,s.speed="speed"in t?t.speed:1,s.absoluteAmp="absoluteAmp"in t?t.absoluteAmp:1,s.absoluteSpeed="absoluteSpeed"in t?t.absoluteSpeed:4,s.variations=t.variations||[],s.toggle&&!this.#Vi&&this.#q()}ia(){this.#Vi&&(this.#Yi(0),this.#Vi.disconnect(),this.#Ui.disconnect(),this.#qi.disconnect(),this.#Vi=this.#Ui=this.#qi=null)}Ls(t){Object.assign(this.#_i,t),this.#_i.toggle?this.#Vi?this.#N(t):this.#q():this.#Vi&&this.ia()}#q(){const t=this.#_i,s=this.#Gi.createOscillator(),i=this.#Gi.createGain(),e=this.#Gi.createGain();this.#Vi=s,this.#Ui=i,this.#qi=e,this.#Ji(),this.#Xi(),this.#Qi(),this.#Zi(),s.connect(e).connect(i).connect(this.#Hi),s.start(t.when+t.delay-t.offset),t.whenStop>0&&this.#Yi(t.whenStop)}#Yi(t){this.#Vi.frequency.cancelScheduledValues(t),this.#Ui.gain.cancelScheduledValues(t),this.#qi.gain.cancelScheduledValues(t),this.#Vi.stop(t)}#N(t){"type"in t&&this.#Ji(),"absoluteSpeed"in t&&(this.#Vi.frequency.cancelScheduledValues(0),this.#Zi()),"absoluteAmp"in t&&(this.#Ui.gain.cancelScheduledValues(0),this.#Qi()),("when"in t||"offset"in t||"delay"in t||"attack"in t)&&(this.#qi.gain.cancelScheduledValues(0),this.#Xi())}#Ji(){this.#Vi.type=this.#_i.type}#Xi(){const t=this.#_i,s=this.#Gi.currentTime,i=t.when+t.delay-t.offset,e=Math.abs(t.absoluteAmp);s<=i&&t.attack>0?(this.#qi.gain.setValueAtTime(0,s),this.#qi.gain.setValueCurveAtTime(new Float32Array([0,e]),i,t.attack)):this.#qi.gain.setValueAtTime(e,s)}#Qi(){A.#te(this.#_i,"absoluteAmp","amp",this.#Ui.gain,this.#Gi.currentTime)}#Zi(){A.#te(this.#_i,"absoluteSpeed","speed",this.#Vi.frequency,this.#Gi.currentTime)}static#te(t,s,i,e,n){const a=t[s];let h=!1;t.variations.forEach((s=>{const o=t.when-t.offset+s.when,r=s.duration;if(o>n&&r>0){const t=s[i];h||(h=!0,e.setValueAtTime(a*t[0],n)),e.setValueCurveAtTime(new Float32Array([a*t[0],a*t[1]]),o,r)}})),h||e.setValueAtTime(a*t[i],n)}}Object.freeze(A);class T{ctx=null;node=null;data=Object.seal({toggle:!1,when:0,duration:0,...T.#se});static#se=Object.freeze({attack:.01,hold:0,decay:.01,sustain:1,release:.01});constructor(t){Object.seal(this),this.ctx=t,this.node=t.createGain()}pn(t){const s=this.data,i=T.#se;Object.assign(s,t),s.attack=Math.max(i.attack,s.attack),s.decay=Math.max(i.decay,s.decay),s.release=Math.max(i.release,s.release),this.#q()}ia(){this.#Yi()}#q(){const t=this.data,s=this.ctx.currentTime,i=this.node.gain,e=t.when,n=t.duration,a=t.toggle?t:T.#se,h=T.#se.attack,o=a.attack,r=a.hold,c=a.decay,l=a.sustain,u=a.release;i.cancelScheduledValues(0),i.setValueAtTime(0,s),n>=o+r+c?(s<=e?this.#ie(1,e,o):s<e+o?this.#ie(1,s,e+o-s):s<e+o+r?this.#ie(1,s,h):s<e+o+r+c?this.#ie(l,s,e+o+r+c-s):s<e+n-h&&this.#ie(l,s,h),s<e+o+r&&l<1&&i.setValueCurveAtTime(new Float32Array([1,l]),e+o+r,c)):s<=e?this.#ie(l,e,n):s<=e+n?this.#ie(l,s,e+n-s):this.#ie(l,s,h),Number.isFinite(n)&&(s<=e+n?this.#ee(l,e+n,u):s<e+n+u?this.#ee(l,s+h,e+n+u-s):this.#ee(l,s+h,h))}#ie(t,s,i){this.node.gain.setValueCurveAtTime(new Float32Array([0,t]),s,i)}#ee(t,s,i){this.node.gain.setValueCurveAtTime(new Float32Array([t,0]),s,i)}#Yi(){const t=this.data,s=this.ctx.currentTime,i=this.node.gain;i.cancelScheduledValues(0),Number.isFinite(t.duration)?i.setValueAtTime(0,s):(i.setValueAtTime(t.sustain,s),i.setValueCurveAtTime(new Float32Array([t.sustain,0]),s,t.release))}}Object.freeze(T);class B{static fftSize=4096;ctx=null;connectedTo=null;nn=new Uint8Array(B.fftSize/2);an=new Uint8Array(B.fftSize/2);#ne={};#ae=new a.mixer({dataCallbacks:{addChannel:this.#he.bind(this),removeChannel:this.#oe.bind(this),toggleChannel:this.#re.bind(this),redirectChannel:this.#ce.bind(this),changePanChannel:this.#le.bind(this),changeGainChannel:this.#ue.bind(this)}});constructor(){Object.seal(this)}fe(t){this.ea(),this.ctx=t,"main"in this.#ae.data.channels?this.#ae.recall():this.#ae.change({channels:{main:{toggle:!0,name:"main",gain:1,pan:0}}})}Ls(t){this.#ae.change(t)}tn(){this.#ae.clear(),this.#ae.change({channels:{main:{toggle:!0,name:"main",gain:1,pan:0}}})}ye(t){this.ea(),this.#ne.main.output.connect(t),this.connectedTo=t}ea(){this.#ne.main&&(this.#ne.main.output.disconnect(),this.connectedTo=null)}o(t){return this.#ne[t]?.input}l(t){return this.#ne[t]?.pan.getInput()}sn(t){const s=this.#ne[t];s.analyserL.getByteFrequencyData(this.nn),s.analyserR.getByteFrequencyData(this.an)}#he(t){const s=this.ctx,i=new H(s),e=s.createGain(),n=s.createGain(),a=s.createGain(),h=s.createChannelSplitter(2),o=s.createAnalyser(),r=s.createAnalyser();o.fftSize=r.fftSize=B.fftSize,o.smoothingTimeConstant=r.smoothingTimeConstant=0,n.connect(i.getInput()),i.connect(e),e.connect(a),e.connect(h),h.connect(o,0),h.connect(r,1),this.#ne[t]={input:n,pan:i,gain:e,output:a,splitter:h,analyserL:o,analyserR:r,analyserData:new Uint8Array(o.frequencyBinCount)},Object.entries(this.#ae.data.channels).forEach((s=>{s[1].dest===t&&this.#ce(s[0],t)}))}#ce(t,s){this.#ne[t].output.disconnect(),s in this.#ae.data.channels&&this.#ne[t].output.connect(this.o(s))}#re(t,s){this.#ne[t].gain.gain.setValueAtTime(s?this.#ae.data.channels[t].gain:0,this.ctx.currentTime)}#le(t,s){this.#ne[t].pan.setValueAtTime(s,this.ctx.currentTime)}#ue(t,s){this.#ae.data.channels[t].toggle&&this.#ne[t].gain.gain.setValueAtTime(s,this.ctx.currentTime)}#oe(t){const s=this.#ne[t];s.pan.disconnect(),s.gain.disconnect(),s.input.disconnect(),s.output.disconnect(),s.splitter.disconnect(),delete this.#ne[t]}}class j{static#de=Object.freeze(["sine","triangle","sawtooth","square"]);static#pe=0;C=null;ke=null;#ge=24e3;#_i=s.synth();#Gt=i.kn.bind(null,this.#_i.oscillators,this.#Ht.bind(this),this.#me.bind(this),this.#be.bind(this));#we=1;#fe=new Map;constructor(){Object.seal(this)}static#ve(t){return 440*2**((t-57)/12)}fe(t){const s=Object.entries(this.#_i.oscillators);this.gn(),this.C=t,this.#ge=t.sampleRate/2,this.ke=t.createGain(),s.forEach((t=>this.#be(t[0]))),s.forEach((t=>this.#Ht(...t)))}_i(t){this.#we=t/60}Ls(t){t.oscillators&&this.#Gt(t.oscillators),t.env&&this.#ye(t.env),t.lfo&&this.#ke(t.lfo),i.cn(this.#_i,t)}#be(t){this.#fe.forEach((s=>{this.#$e(s.oscNodes.get(t)),s.oscNodes.delete(t)}))}#Ht(t,s){this.#fe.forEach((i=>i.oscNodes.set(t,this.#Oe(i,s,0,this.#_i.env))))}#me(t,s){const i=this.C.currentTime,e=Object.entries(s),n=this.#_i.oscillators[t];this.#fe.forEach((s=>{const a=s.oscNodes.get(t);e.forEach((([t,e])=>{switch(t){case"type":this.#xe(n,a,"type",e,i,0);break;case"pan":a.panNode.pan.setValueAtTime(e,i);break;case"gain":a.gainNode.gain.setValueAtTime(e,i);break;case"detune":this.#xe(n,a,"detune",100*(e+n.detunefine),i,0);break;case"detunefine":this.#xe(n,a,"detune",100*(n.detune+e),i,0);break;case"unisondetune":this.#xe(n,a,"unisondetune",s.midi,i,0);break;case"unisonblend":this.#xe(n,a,"unisonblend",e,i,0)}}))}))}#ye(t){this.#fe.forEach((s=>{const i={...t};"hold"in i&&(i.hold/=this.#we),"decay"in i&&(i.decay/=this.#we),"attack"in i&&(i.attack/=this.#we),"release"in i&&(i.release/=this.#we),s.gainEnvNode.pn(i)}))}#ke(t){const s={...t};"delay"in s&&(s.delay/=this.#we),"attack"in s&&(s.attack/=this.#we),"amp"in s&&(s.absoluteAmp=s.amp,delete s.amp),"speed"in s&&(s.absoluteSpeed=s.speed*this.#we,delete s.speed),this.#fe.forEach((t=>t.gainLFO.Ls(s)))}mn(t,s,i,e){const n=t.filter((([,t])=>(t.when+t.duration)/this.#we>=i)),a=t[0][1].when,h=n[0][1].when,o=i-(h-a)/this.#we;return this.#Se(n,s,o,e)}#Se(t,s,i,e){const n=++j.#pe,a=t[0][1],h=t[t.length-1][1],o=a.when,r=s-i,c=this.C,l=this.#we,u=this.#_i.env,d=this.#_i.lfo,p=this.#_i.oscillators,g=[],m=c.createGain(),b=Object.freeze({when:s,off:i,dur:e,pan:a.pan,midi:a.key,gain:a.gain,lowpass:a.lowpass,highpass:a.highpass,attack:a.attack/l||.005,release:h.release/l||.005,variations:[],oscNodes:new Map,gainEnvNode:new T(c),gainLFO:new A(c,m.gain),gainLFOtarget:m,gainNode:c.createGain(),panNode:c.createStereoPanner(),lowpassNode:c.createBiquadFilter(),highpassNode:c.createBiquadFilter()});return t.length>1&&t.reduce(((t,[,s])=>{if(t){const i=(t.when-o+t.duration)/l,e=(s.when-o)/l-i;b.variations.push({when:i,duration:e,pan:[t.pan,s.pan],midi:[t.key,s.key],gain:[t.gain,s.gain],lowpass:[this.#De(t.lowpass),this.#De(s.lowpass)],highpass:[this.#Ce(t.highpass),this.#Ce(s.highpass)]}),g.push({when:i,duration:e,amp:[t.gainLFOAmp,s.gainLFOAmp],speed:[t.gainLFOSpeed,s.gainLFOSpeed]})}return s}),null),b.lowpassNode.type="lowpass",b.highpassNode.type="highpass",b.panNode.pan.setValueAtTime(b.pan,r),b.gainNode.gain.setValueAtTime(b.gain,r),b.lowpassNode.frequency.setValueAtTime(this.#De(b.lowpass),r),b.highpassNode.frequency.setValueAtTime(this.#Ce(b.highpass),r),b.gainEnvNode.pn({toggle:u.toggle,when:s-i,duration:e+i,attack:u.attack/l,hold:u.hold/l,decay:u.decay/l,sustain:u.sustain,release:u.release/l}),b.gainLFO.pn({toggle:d.toggle,when:s,whenStop:Number.isFinite(e)?s+e+u.release/l:0,offset:i,type:d.type,delay:d.delay/l,attack:d.attack/l,absoluteAmp:d.amp,absoluteSpeed:d.speed*l,amp:a.gainLFOAmp,speed:a.gainLFOSpeed,variations:g}),Object.entries(p).forEach((([t,s],i)=>b.oscNodes.set(t,this.#Oe(b,s,i,u)))),this.#Pe(b),b.gainLFOtarget.connect(b.gainEnvNode.node).connect(b.gainNode).connect(b.panNode).connect(b.lowpassNode).connect(b.highpassNode).connect(this.ke),this.#fe.set(n,b),n}gn(){this.#fe.forEach(((t,s)=>this.bn(s)))}bn(t){const s=this.#fe.get(t);s?Number.isFinite(s.dur)?this.#Me(t):(s.gainEnvNode.ia(),setTimeout(this.#Me.bind(this,t),(this.#_i.env.release+.1)/this.#we*1e3)):console.error("gswaSynth: stopKey id invalid",t)}#Me(t){const s=this.#fe.get(t);s.oscNodes.forEach(this.#$e,this),s.gainLFO.ia(),s.gainEnvNode.ia(),this.#fe.delete(t)}#De(t){return this.#Ae(t,this.#ge,2)}#Ce(t){return this.#Ae(1-t,this.#ge,3)}#Ae(t,s,i){return 0===i?t:Math.expm1(t)**i/(Math.E-1)**i*s}#Pe(t){t.variations.forEach((s=>{const i=t.when-t.off+s.when,e=s.duration;i>this.C.currentTime&&e>0&&(t.oscNodes.forEach(((t,n)=>this.#xe(this.#_i.oscillators[n],t,"frequency",s.midi,i,e))),t.panNode.pan.setValueCurveAtTime(new Float32Array(s.pan),i,e),t.gainNode.gain.setValueCurveAtTime(new Float32Array(s.gain),i,e),t.lowpassNode.frequency.setValueCurveAtTime(new Float32Array(s.lowpass),i,e),t.highpassNode.frequency.setValueCurveAtTime(new Float32Array(s.highpass),i,e))}))}#Oe(t,s,i,e){const n=this.C.currentTime,a=[],h=this.C.createStereoPanner(),o=this.C.createGain(),r=Object.freeze({uniNodes:a,panNode:h,gainNode:o});for(let t=0;t<s.unisonvoices;++t)a.push([this.C.createOscillator(),this.C.createGain()]);return this.#xe(s,r,"type",s.type,n,0),this.#xe(s,r,"detune",100*(s.detune+s.detunefine),n,0),this.#xe(s,r,"frequency",t.midi,n,0),this.#xe(s,r,"unisonblend",s.unisonblend,n,0),h.pan.setValueAtTime(s.pan,n),o.gain.setValueAtTime(s.gain,n),a.forEach((([s,i])=>s.connect(i).connect(h).connect(o).connect(t.gainLFOtarget))),a.forEach((s=>s[0].start(t.when+1e-4*(i+t.midi/4)))),Number.isFinite(t.dur)&&a.forEach((s=>s[0].stop(t.when+t.dur+e.release/this.#we))),r}#$e(t){t.uniNodes.forEach((t=>t[0].stop()))}#xe(t,s,i,e,n,a){const h=s.uniNodes;switch(i){case"type":h.forEach((t=>this.#Te(t[0],e)));break;case"detune":h.forEach((t=>t[0].detune.setValueAtTime(e,n)));break;case"frequency":a?h.forEach(((s,i)=>s[0].frequency.setValueCurveAtTime(j.#Be(t,e,i),n,a))):h.forEach(((s,i)=>s[0].frequency.setValueAtTime(j.#Be(t,e,i),n)));break;case"unisondetune":h.forEach(((s,i)=>{s[0].frequency.cancelScheduledValues(0),s[0].frequency.setValueAtTime(j.#Be(t,e,i),n)}));break;case"unisonblend":h.forEach(((s,i)=>s[1].gain.setValueAtTime(j.#je(t,e,i),n)))}}#Te(t,s){j.#de.indexOf(s)>-1?t.type=s:t.setPeriodicWave(V.Ve(this.C,s))}static#Be(t,s,i){const e=t.unisonvoices>1?t.unisondetune/-2+i*(t.unisondetune/(t.unisonvoices-1)):0;return"number"==typeof s?j.#ve(s+e):new Float32Array([j.#ve(s[0]+e),j.#ve(s[1]+e)])}static#je(t,s,i){const e=1/t.unisonvoices,n=t.unisonvoices%2==0,a=Math.floor(t.unisonvoices/2),h=e+(1-s)*(1-e),o=e+(1-s)*(.5-e),r=(1-(n?2*o:h))/(t.unisonvoices-1-n);return i===a?n?o:h:i===a-1&&n?o:r}}Object.freeze(j);class L{scheduler=new N;#cs=null;#fe=new Map;constructor(){Object.seal(this),this.scheduler.delayStopCallback=4,this.scheduler.ondatastart=this.#Le.bind(this),this.scheduler.ondatastop=this.#Ee.bind(this)}fe(t){this.scheduler.currentTime=()=>t.currentTime,this.scheduler.ln(!(t instanceof OfflineAudioContext))}Ni(t){this.#cs=t}Ls(t){this.scheduler.Ls(t)}pn(t,s,i){this.scheduler.pn(t,s,i)}Mi(){this.scheduler.Mi()}#Le(t,s,i,e,n){this.#fe.set(t,this.#cs.mn(s,i,e,n))}#Ee(t){this.#cs.bn(this.#fe.get(t)),this.#fe.delete(t)}}class E{scheduler=new N;#We=null;#Fe=new Map;constructor(){Object.seal(this),this.scheduler.ondatastart=this.#Ie.bind(this),this.scheduler.ondatastop=this.#Ke.bind(this),this.scheduler.ondatapropchange=this.#ze.bind(this)}fe(t){this.scheduler.currentTime=()=>t.currentTime,this.scheduler.ln(!(t instanceof OfflineAudioContext))}bs(t){this.#We=t}Ls(t){const s=i.$n(t);Object.values(s).forEach((t=>{t&&"when"in t&&(t.duration=this.#We.na(t.row))})),this.scheduler.Ls(s)}pn(t,s,i){this.scheduler.pn(t,s,i)}Mi(){this.scheduler.Mi()}#Ie(t,[[,s]],i,e){"gain"in s?this.#Fe.set(t,this.#We.aa(s,i,e,s.duration)):this.#We.ha(s,i)}#Ke(t){this.#We.oa(this.#Fe.get(t)),this.#Fe.delete(t)}#ze(t,s,i){this.#We.ra(t,s,i)}}class W{static Ze(t,s,i,e,n){const a=i*s.length|0,h=(e-i)*s.length|0,o=t.createBuffer(s.numberOfChannels,h,t.sampleRate);return Object.values(n).forEach((i=>{const e={att:.01*t.sampleRate,rel:.01*t.sampleRate,srcInd:a+(i.x-(i.x-i.y))*h|0,dstInd:i.x*h|0,cpyLen:i.w*h|0};for(let t=0;t<s.numberOfChannels;++t)e.srcArr=s.getChannelData(t),e.dstArr=o.getChannelData(t),W.#Re(e)})),o}static#Re({srcArr:t,srcInd:s,dstArr:i,dstInd:e,cpyLen:n,att:a,rel:h}){for(let o=0;o<n;++o)i[e+o]=s+o<t.length?t[s+o]*W.#Ne(o,n,a,h):0}static#Ne(t,s,i,e){return t<s/2?Math.min(t,i)/i:Math.min(s-1-t,e)/e}}class F{static#Ge=[];static#He=0;static#Ve=20;static ca(){F.#He=F.#Ge.length=0}static la(){const t=Date.now(),s=F.#He;if(F.#He=t,s){const i=6e4/(t-s),e=F.#Ge,n=e.length?e[e.length-1]:0;if(!n||!(i<n/1.5||i>1.5*n))return e.unshift(i)>F.#Ve&&(e.length=F.#Ve),+(e.reduce(((t,s)=>t+s),0)/e.length).toFixed(2);e.length=0}return 0}}class I{ctx=null;#Ue=60;#qe=new Map;#_e=null;#Ye=null;#Je=new a.effects({dataCallbacks:{changeBPM:t=>{this.#Ue=t,this.#qe.forEach((s=>s._i?.(t)))},addEffect:this.#Dt.bind(this),removeEffect:this.#Xe.bind(this),changeEffect:this.#Qe.bind(this),connectEffectTo:this.#Ze.bind(this),changeEffectData:(t,s)=>this.wt(t).Ls(s)}});constructor(t){Object.seal(this),this.#_e=t.getChanInput,this.#Ye=t.getChanOutput}wt(t){return this.#qe.get(t)}fe(t){this.ctx=t,this.#Je.reset()}Ls(t){this.#Je.change(t)}tn(){this.#Je.clear()}ji(t,s,i){this.wt(t).ua(s,i)}#Dt(t,i){const e=I.#tn(i.type);this.#qe.set(t,e),e.fe(this.ctx),e._i?.(this.#Ue),e.Ls(s.effects[i.type]())}static#tn(t){switch(t){case"delay":return new K;case"filter":return new z}}#Xe(t){this.wt(t).da().disconnect(),this.#qe.delete(t)}#Qe(t,s,i){"toggle"===s&&this.wt(t).pa(i)}#Ze(t,s,i){const e=i?this.wt(i).ga():this.#Ye(t),n=s?this.wt(s).da():this.#_e(t);n&&(n.disconnect(),n.connect(e))}}Object.freeze(I);class K{#Gi=null;#we=1;#sn=null;#in=null;#en=null;#nn=null;#an=null;#hn=null;#on=null;#rn=null;#cn=!1;#_i=s.effects.delay();constructor(){Object.seal(this)}ga(){return this.#sn}da(){return this.#in}_i(t){this.#we=t/60,this.#ln("time",this.#_i.time)}fe(t){this.#Gi&&(this.#sn.disconnect(),this.#in.disconnect(),this.#en.disconnect()),this.#Gi=t,this.#sn=t.createGain(),this.#in=t.createGain(),this.#an=t.createGain(),this.#hn=t.createGain(),this.#on=t.createStereoPanner(),this.#rn=t.createStereoPanner(),this.#en=t.createDelay(20),this.#nn=t.createDelay(20),this.pa(this.#cn),this.Ls(this.#_i)}pa(t){this.#cn=t,this.#Gi&&(t?(this.#sn.disconnect(),this.#sn.connect(this.#an).connect(this.#on).connect(this.#en).connect(this.#hn).connect(this.#rn).connect(this.#nn).connect(this.#an),this.#sn.connect(this.#in),this.#en.connect(this.#in),this.#nn.connect(this.#in)):(this.#en.disconnect(),this.#nn.disconnect(),this.#sn.connect(this.#in)))}Ls(t){"time"in t&&this.#ln("time",t.time),"gain"in t&&this.#ln("gain",t.gain),"pan"in t&&this.#ln("pan",t.pan)}ua(t,s){this.#ln(t,s)}#ln(t,s){switch(this.#_i[t]=s,t){case"time":this.#en.delayTime.setValueAtTime(s/this.#we,this.#Gi.currentTime),this.#nn.delayTime.setValueAtTime(s/this.#we,this.#Gi.currentTime);break;case"gain":this.#an.gain.setValueAtTime(s,this.#Gi.currentTime),this.#hn.gain.setValueAtTime(s,this.#Gi.currentTime);break;case"pan":this.#on.pan.setValueAtTime(s,this.#Gi.currentTime),this.#rn.pan.setValueAtTime(-s,this.#Gi.currentTime)}}}Object.freeze(K);class z{#Gi=null;#sn=null;#in=null;#un=null;#cn=!1;#dn=-1;#pn=null;#gn=null;#mn=null;#_i=s.effects.filter();constructor(){Object.seal(this)}ga(){return this.#sn}da(){return this.#in}fe(t){this.#Gi&&(this.#sn.disconnect(),this.#in.disconnect(),this.#un.disconnect()),this.#Gi=t,this.#sn=t.createGain(),this.#in=t.createGain(),this.#un=t.createBiquadFilter(),this.pa(this.#cn),this.Ls(this.#_i)}pa(t){this.#cn=t,this.#Gi&&(t?(this.#sn.disconnect(),this.#sn.connect(this.#un),this.#un.connect(this.#in)):(this.#un.disconnect(),this.#sn.connect(this.#in)))}Ls(t){Object.assign(this.#_i,t),"type"in t&&this.#bn(t.type),"Q"in t&&this.#ln("Q",t.Q),"gain"in t&&this.#ln("gain",t.gain),"detune"in t&&this.#ln("detune",t.detune),"frequency"in t&&this.#ln("frequency",t.frequency)}ua(t,s){this.#ln(t,s)}_n(t){return this.#wn(t),this.#un.getFrequencyResponse(this.#pn,this.#gn,this.#mn),this.#gn}#bn(t){this.#un.type=t}#ln(t,s){this.#un[t].setValueAtTime(s,this.#Gi.currentTime)}#wn(t){if(t!==this.#dn){const s=this.#Gi.sampleRate/2,i=new Float32Array(t);this.#dn=t,this.#pn=i,this.#gn=new Float32Array(t),this.#mn=new Float32Array(t);for(let e=0;e<t;++e)i[e]=s*2**(e/t*11-11)}}}Object.freeze(z);class R{static#pe=0;us=null;ps=null;Dt=i.Sn;ls=i.Sn;#Gi=null;#Fe=new Map;#Je=new a.drumrows({dataCallbacks:{addDrumrow:i.Sn,removeDrumrow:this.#fn.bind(this),changeDrumrow:this.#vn.bind(this)}});constructor(){Object.seal(this)}fe(t){this.ma(),this.#Gi=t}Ls(t){this.#Je.change(t)}tn(){this.#Je.clear()}na(t){const s=this.#Je.data;return s.patterns[s.drumrows[t].pattern].duration}Ii(t){const s={row:t,detune:0,gain:1,pan:0};return this.#yn(s,this.#Gi.currentTime,0,null,!0)}Ki(t){this.#Fe.forEach(((s,i)=>{s.rowId===t&&this.oa(i,"-f")}))}ha(t,s){const i=.001,e=s-i;this.#Fe.forEach((n=>{if(n.absn&&n.rowId===t.row&&n.when<e&&s<n.endAt&&(n.endAt=s,n.gainCut.gain.setValueCurveAtTime(new Float32Array([1,0]),e,i),n.absn.stop(s+i),this.ps)){const t=this.ps.bind(null,n.rowId),s=e-this.#Gi.currentTime;n.startDrumcutTimeoutId=setTimeout(t,1e3*s)}}))}aa(t,s,i,e){return this.#yn(t,s,i,e,!1)}#yn(t,s,e,n,a){const h=this.#Je.data,o=t.row,r=h.drumrows[o],c=h.patterns[r.pattern],l=this.Dt(c.buffer),u=null!==n?n:l?l.duration:0,d=++R.#pe,p={rowId:o,live:a,when:s,dur:u,endAt:s+u,pan:t.pan,gain:t.gain,detune:t.detune};if(l){const n=this.#Gi.createBufferSource(),a=this.#Gi.createGain(),h=this.#Gi.createGain(),d=this.#Gi.createStereoPanner(),g=this.ls(c.dest);if(p.absn=n,p.gainCut=h,p.gainRow=a,p.panRow=d,n.buffer=l,n.detune.setValueAtTime(100*(r.detune+t.detune),this.#Gi.currentTime),a.gain.setValueAtTime(r.toggle?r.gain*t.gain:0,this.#Gi.currentTime),d.pan.setValueAtTime(i.Cn(r.pan,t.pan),this.#Gi.currentTime),n.connect(h).connect(a).connect(d).connect(g),n.start(s,e,u),this.us){const t=1e3*(s-this.#Gi.currentTime);p.startDrumTimeoutId=setTimeout((()=>this.us(o)),t)}}return this.#Fe.set(d,p),this.#Fe.forEach(((t,s)=>{t.when+t.dur<=this.#Gi.currentTime&&this.#kn(s,t)})),d}ma(){this.#Fe.forEach(((t,s)=>this.oa(s,"-f")))}oa(t,s){const i=this.#Fe.get(t);i&&("-f"===s||i.when+i.dur<=this.#Gi.currentTime||i.when>=this.#Gi.currentTime)&&this.#kn(t,i)}#kn(t,s){this.#Fe.delete(t),clearTimeout(s.startDrumTimeoutId),clearTimeout(s.startDrumcutTimeoutId),s.absn&&(s.absn.stop(),s.gainCut.disconnect(),s.gainRow.disconnect(),s.panRow.disconnect(),this.onstopdrum&&this.onstopdrum(s.rowId,t))}ra(t,s,e){const n=this.#Fe.get(+t);if(n){const t=this.#Je.data.drumrows[n.rowId];switch(s){case"detune":n.detune=e,n.absn.detune.setValueAtTime(100*(e+t.detune),this.#Gi.currentTime);break;case"gain":n.gain=e,n.gainRow.gain.setValueAtTime(t.toggle?e*t.gain:0,this.#Gi.currentTime);break;case"pan":n.pan=e,n.panRow.pan.setValueAtTime(i.Cn(e,t.pan),this.#Gi.currentTime)}}}#fn(t){this.#Fe.forEach(((s,i)=>{s.rowId===t&&this.oa(i,"-f")}))}#vn(t,s,e){const n=this.#Je.data.drumrows[t];switch(s){case"toggle":this.#$n(t,(t=>{t.gainRow.gain.setValueAtTime(e?n.gain:0,this.#Gi.currentTime)}));break;case"dest":this.#$n(t,(t=>{t.gainRow.disconnect(),t.gainRow.connect(this.ls(e))}));break;case"detune":this.#$n(t,(t=>{t.absn.detune.setValueAtTime(100*(e+t.detune),this.#Gi.currentTime)}));break;case"gain":this.#$n(t,(t=>{t.gainRow.gain.setValueAtTime(e*t.gain,this.#Gi.currentTime)}));break;case"pan":this.#$n(t,(t=>{t.panRow.pan.setValueAtTime(i.Cn(e,t.pan),this.#Gi.currentTime)}))}}#$n(t,s){this.#Fe.forEach((i=>{i.rowId===t&&i.absn&&s(i)}))}}Object.freeze(R);class N{static#pe=0;data={};bpm=60;bps=1;loopA=null;loopB=null;looping=!1;loopDuration=0;isStreaming=!0;started=!1;duration=0;delayStopCallback=0;currentTime=i.Sn;ondatastart=i.Sn;ondatastop=i.Sn;ondatapropchange=i.Sn;onended=i.Sn;#On=0;#xn=0;#Sn=0;#Dn=0;#Cn=null;#Pn=[];#Mn={};#An={};#Tn=null;#Bn=this.#jn.bind(this);#Je=i.kn.bind(null,this.data,this.#Ln.bind(this),this.#En.bind(this),this.#Wn.bind(this));constructor(){Object.seal(this)}_i(t){if(this.bpm!==t){const s=this.bpm/t,i=this.#Fn()*s;this.bpm=t,this.bps=t/60,this.duration*=s,this.looping?(this.loopA*=s,this.loopB*=s,this.loopDuration=this.loopB-this.loopA,this.#In(this.loopB>i?i:this.loopA)):this.#In(i)}}xs(){this.#Pn.forEach((t=>this.#Wn(t[0]))),this.Qi()}dn(t,s){return this.#Y(t/this.bps,s/this.bps)}#Y(t,s){const i=this.started&&this.#Fn();this.looping=!0,this.loopA=Math.min(t,s),this.loopB=Math.max(t,s),this.loopDuration=this.loopB-this.loopA,this.started&&this.#In(this.loopB>i?i:this.loopA)}Qi(){if(this.looping){const t=this.#Fn();this.looping=!1,this.#In(t)}}rn(t){this.#In(t/this.bps)}#In(t){this.#xn=t,this.started&&this.pn(0,t)}hn(){return this.#Fn()*this.bps}#Fn(){return this.started?this.#Kn(this.currentTime()):this.#xn}#Kn(t){let s=this.#xn+t-this.#Sn;return this.looping&&s>this.loopB-.001&&(s=this.loopA+(s-this.loopA)%this.loopDuration,s>this.loopB-.001&&(s=this.loopA)),s}ln(t=!0){this.isStreaming=t}un(t,s=0,i){return this.pn(t,s/this.bps,Number.isFinite(i)?i/this.bps:i)}pn(t,s=0,i){const e=this.currentTime();this.started&&this.Mi(),this.started=!0,this.#Dn=Number.isFinite(i),this.#Sn=Math.max(e,t),this.#xn=s,this.#On=this.#Dn?i:this.duration-s,this.isStreaming&&!this.looping&&(this.#Cn=setTimeout(this.onended.bind(this),1e3*this.#On)),this.isStreaming?this.#zn():this.#Rn()}Mi(){this.started&&(this.#xn=this.#Fn(),this.started=!1,clearTimeout(this.#Cn),this.#Nn(),Object.keys(this.#An).forEach(this.#Gn,this))}#Hn(){return this.looping?this.loopB:this.#xn+this.#On}#Vn(){const t=Object.values(this.data).reduce(N.#Un,0)/this.bps;t!==this.duration&&(this.duration=t,this.started&&!this.#Dn&&(this.#On=t),!this.looping&&this.#Dn||clearTimeout(this.#Cn),this.started&&this.isStreaming&&!this.looping&&(this.#Cn=setTimeout(this.onended.bind(this),1e3*(t-this.#xn-this.currentTime()+this.#Sn))))}static#Un(t,s){return Math.max(t,s.when+s.duration)}#Rn(){const t=this.#Sn,s=this.#xn,i=s+this.#On;this.#Pn.forEach((e=>this.#qn(t,s,i,i,...e)))}#zn(){this.#Tn||(this.#Tn=setInterval(this.#Bn,100),this.#jn())}#Nn(){this.#Tn&&(clearInterval(this.#Tn),this.#Tn=null)}#jn(){const t=this.currentTime(),s=this.delayStopCallback/this.bps;let i;Object.entries(this.#Mn).forEach((([i,e])=>{e.whenEnd+s<t&&(delete this.#Mn[i],delete this.#An[e.blockId].started[i],this.ondatastop(i))})),this.#Pn.forEach((t=>{this.#_n(t[0])&&(i=!0)})),this.looping||i||this.#Nn()}#Gn(t){const s=this.#An[t];Object.keys(s.started).forEach((t=>{this.ondatastop(t),delete this.#Mn[t],delete s.started[t]})),s.scheduledUntil=0}#_n(t){if(this.started){const s=this.currentTime(),i=s+1,e=this.#An[t];let n=Math.max(s,e.scheduledUntil||0);if(n<i){const s=this.#Hn(),a=this.data[t];do{const i=this.#Kn(n),e=Math.min(i+1,s);n+=this.#qn(n,i,e,s,t,a)}while(this.looping&&n<i);e.scheduledUntil=n}return e.scheduledUntil<=this.#Sn+this.#On}}#qn(t,s,i,e,n,a){if(null==a.prev){const h=this.bps,o=[];let r=a.when/h,c=a.offset/h,l=0;for(let t=n,s=a;s;)o.push([t,s]),l=s.when/h-r+s.duration/h,t=s.next,s=null!=t?this.data[t]:null;if(s<=r+l&&r<i){const i=this.#Sn;if(r+l>e&&(l-=r+l-e),r<s&&(c+=s-r,l-=s-r,r=s),r=t+r-s,r<i&&(c+=i-r,l-=i-r,r=i),l>1e-6){const t=""+ ++N.#pe;this.#An[n].started[t]=this.#Mn[t]={block:a,blockId:n,when:r,whenEnd:r+l},this.ondatastart(t,o,r,c,l)}return e-s}}return i-s}Ls(t){this.#Je(t),this.#Pn=Object.entries(this.data).sort(((t,s)=>t[1].when-s[1].when))}#Wn(t){t in this.data?(delete this.data[t],this.started&&this.#Gn(t),delete this.#An[t],this.#Vn()):console.warn("gswaScheduler: data delete unknown id",t)}#Ln(t,s){this.#An[t]={started:{},scheduledUntil:0},this.data[t]={when:0,offset:0,duration:0,...s},this.#Vn(),this.#_n(t)}#En(t,s){let i=this.data[t],e=t;for(Object.assign(i,s),this.#Vn();i.prev;)e=i.prev,i=this.data[e];this.#Gn(e),this.#_n(e)}}Object.freeze(N);class G{static Ye(t,s){const i=t.numberOfChannels,e=t.sampleRate,n=s&&s.float32?3:1,a=3===n?32:16,h=a/8,o=i*h,r=2===i?G.#Yn(t.getChannelData(0),t.getChannelData(1)):t.getChannelData(0),c=r.length*h,l=new ArrayBuffer(44+c),u=new DataView(l);return G.#Jn(u,0,"RIFF"),u.setUint32(4,36+c,!0),G.#Jn(u,8,"WAVE"),G.#Jn(u,12,"fmt "),u.setUint32(16,16,!0),u.setUint16(20,n,!0),u.setUint16(22,i,!0),u.setUint32(24,e,!0),u.setUint32(28,e*o,!0),u.setUint16(32,o,!0),u.setUint16(34,a,!0),G.#Jn(u,36,"data"),u.setUint32(40,c,!0),(1===n?G.#Xn:G.#Qn)(u,44,r),l}static#Yn(t,s){const i=t.length+s.length,e=new Float32Array(i);for(let n=0,a=0;n<i;++a)e[n++]=t[a],e[n++]=s[a];return e}static#Jn(t,s,i){for(let e=0;e<i.length;++e)t.setUint8(s+e,i.charCodeAt(e))}static#Xn(t,s,i){for(let e=0;e<i.length;++e){const n=Math.max(-1,Math.min(i[e],1));t.setInt16(s+2*e,n<0?32768*n:32767*n,!0)}}static#Qn(t,s,i){for(let e=0;e<i.length;++e)t.setFloat32(s+4*e,i[e],!0)}}class H{#Zn=null;#ta=null;#sa=null;#ia=null;constructor(t){Object.freeze(this),this.#Zn=t.createChannelSplitter(2),this.#ta=t.createGain(),this.#sa=t.createGain(),this.#ia=t.createChannelMerger(2),this.#Zn.connect(this.#ta,0),this.#Zn.connect(this.#sa,1),this.#ta.connect(this.#ia,0,0),this.#sa.connect(this.#ia,0,1)}connect(...t){return this.#ia.connect(...t)}disconnect(...t){return this.#ia.disconnect(...t)}getInput(){return this.#Zn}getValue(){return this.#sa.gain.value-this.#ta.gain.value}setValueAtTime(t,s){this.#ta.gain.setValueAtTime(Math.min(1-t,1),s),this.#sa.gain.setValueAtTime(Math.min(1+t,1),s)}}class V{static ba=new Map;static#ea=new Map;static ve(){V.#ea.clear()}static Ve(t,s){let i=V.#ea.get(s);if(!i){const e=V.ba.get(s);i=t.createPeriodicWave(e.real,e.imag),V.#ea.set(s,i)}return i}static sa(t){return t.forEach((([t,s])=>{const i=s.imag||s.real.map((()=>0)),e=s.real||s.imag.map((()=>0));e[0]=i[0]=0,V.ba.set(t,Object.freeze({real:new Float32Array(e),imag:new Float32Array(i)}))})),V.ba}}class U{#ts=null;#na=null;#aa=new Map;#ha=new Map;Nn(t){this.sysexEnabled=t.sysexEnabled,t.onstatechange=this.#oa.bind(this),this.#ra(t)}jn(t){this.#ts=t}Ln(t){this.#na=t}#ra(t){let s,i;for(let i of t.inputs)s=i[1],s.open();for(let s of t.outputs)i=s[1],i.open()}#oa(t){"connected"===t.port.state&&"open"===t.port.connection?this.#ca(t.port,t.currentTarget.sysexEnabled):"disconnected"===t.port.state&&this.#la(t.port)}#ca(t,s){if("input"!==t.type||this.#aa.has(t.id)){if("output"===t.type&&!this.#ha.has(t.id)){let i=new _(t.id,t.name,t,s);this.#ha.set(t.id,i)}}else{let i=new q(t.id,t.name,t,s);this.#aa.set(t.id,i),this.wa(i)}}#la(t){("input"===t.type?this.#aa:this.#ha).delete(t.id)}wa(t){t.fa(this.#ua.bind(this)),t.va(this.#da.bind(this))}ya(t){t.ka(this.#ua.bind(this)),t.$a(this.#da.bind(this))}#da(t){this.#na.midiKeyUp(t[1])}#ua(t){this.#na.midiKeyDown(t[1])}#pa(){console.log("Inputs");for(const[t,s]of this.#aa)console.log("ID : ",t),console.log("Name : ",s.name);console.log("Outputs");for(const[t,s]of this.#ha)console.log("ID : ",t),console.log("Name : ",s.name)}}class q{constructor(t,s,i,e){this.portID=t,this.name=s,this.input=i,this.sysexEnabled=e,this.input.onmidimessage=this.#ga.bind(this),this.listeners={onNoteOn:[],onNoteOff:[]}}ga(){return this.input}fa(t){this.listeners.onNoteOn.push(t)}va(t){this.listeners.onNoteOff.push(t)}#ga(t){this.sysexEnabled||3===t.data.length?this.#ma(t.data[0],t.data[2])?this.listeners.onNoteOn.forEach((s=>s(t.data))):this.#ba(t.data[0],t.data[2])&&this.listeners.onNoteOff.forEach((s=>s(t.data))):console.log("GSLog : Invalid midi event")}#ma(t,s){return 144===t&&0!==s}#ba(t,s){return 128===t||0===s}}class _{constructor(t,s,i,e){this.portID=t,this.name=s,this.output=i,this.sysexEnabled=e}da(){return this.output}#wa(t){this.output.send(t)}#fa(t,s){s.send(t)}}class Y{static Sn(){}static zn=document.createElement("gsui-popup");static Oa=document.createElement("gsui-dragshield");static xa(t){return Math.sqrt(1-Math.pow(t-1,2))}static Sa(t,s,i){return s<i?Math.max(s,Math.min(t||0,i)):Math.max(i,Math.min(t||0,s))}static Da(t,s){let i=!0;const e=Object.entries(s).reduce(((s,[e,n])=>{const a=t[e],h=a===n?void 0:"object"!=typeof n||null===n?n:"object"!=typeof a||null===a?Object.freeze(JSON.parse(JSON.stringify(n))):Y.Da(a,n);return void 0!==h&&(i=!1,s[e]=h),s}),{});return Object.keys(t).forEach((t=>{t in s||(i=!1,e[t]=void 0)})),i?void 0:Object.freeze(e)}static Zn(t){return new Promise((s=>{const i=Y.Bn("script",{src:t,type:"text/javascript"});i.onload=s,document.head.append(i)}))}static Fn(t,s){return"string"==typeof s?Y.#va(t,s):Object.seal(Array.isArray(s)?Y.#ya(t,s):Y.#ka(t,s))}static#ya(t,s){return s.map((s=>Y.Fn(t,s)))}static#ka(t,s){if(s){const i=Object.entries(s);return i.forEach((s=>s[1]=Y.Fn(t,s[1]))),Object.fromEntries(i)}}static#va(t,s){if(Array.isArray(t)){let i;return Array.prototype.find.call(t,(t=>i=Y.#$a(t,s))),i||null}return Y.#$a(t,s)}static#$a(t,s){return t.matches(s)?t:t.querySelector(s)}static Ca(t,s,i,...e){t.dispatchEvent(new CustomEvent("gsuiEvents",{bubbles:!0,detail:{component:s,eventName:i,args:e}}))}static In(t,s){t.addEventListener("gsuiEvents",(t=>{const i=t.detail,e=s[i.component]||s.default,n=e&&(e[i.eventName]||e.default);n&&!0!==n(i,t.target,t)&&(t.stopPropagation(),t.stopImmediatePropagation())}))}static#Oa=new Map;static Pa(t,s){Y.#Oa.set(t,s)}static Ma(t){return Y.#Oa.has(t)}static En(t,...s){return Y.#Oa.get(t)(...s)}static Bn(t,s,...i){return Y.#xa("http://www.w3.org/1999/xhtml",t,s,i)}static Aa(t,s,...i){return Y.#xa("http://www.w3.org/2000/svg",t,s,i)}static#xa(t,s,i,e){const n=document.createElementNS(t,s);return Y.Wn(n,i),n.append(...e.flat(1).filter((t=>Boolean(t)||Number.isFinite(t)))),n}static Wn(t,s,i){"string"==typeof s?Y.#Sa(t,s,i):s&&Object.entries(s).forEach((s=>Y.#Sa(t,...s)))}static Ta(t,s,i){return Y.#Sa(t,s,i),Y.Kn(t,s)}static#Sa(t,s,i){!1!==i&&null!=i?t.setAttribute(s,!0===i?"":i):t.removeAttribute(s)}static Ba(t,s){return t.hasAttribute(s)}static Kn(t,s){return t.getAttribute(s)}static ja(t,s){const i=t.getAttribute(s),e=+i;return Number.isNaN(e)&&console.error(`GSUI.$getAttributeNum: ${s} is NaN (${i})`),e}static La(t,s){Y.#Da.has(t)?Y.#Da.get(t).push(s):Y.#Da.set(t,[s]),Y.#Ca.observe(t)}static Ea(t,s){const i=Y.#Da.get(t),e=i.indexOf(s);Y.#Ca.unobserve(t),e>-1&&(i.splice(e,1),0===i.length&&Y.#Da.delete(t))}static#Da=new Map;static#Ca=new ResizeObserver((t=>{t.forEach((t=>{Y.#Da.get(t.target).forEach((s=>s(t.contentRect.width,t.contentRect.height)))}))}));static Wa(t){for(;t.lastChild;)t.lastChild.remove()}static Fa(){window.getSelection().removeAllRanges()}static Ia(t,s){Object.entries(s).forEach((([s,i])=>{t.hasAttribute(s)?t.attributeChangedCallback?.(s,null,t.getAttribute(s)):Y.#Sa(t,s,i)}))}static Rn(t){const s=[];return new Promise((i=>{const e=[];for(const i of t){const t=i.webkitGetAsEntry();t&&e.push(Y.#Pa(s,t))}Promise.all(e).then((()=>i(s)))}))}static#Pa(t,s,i=""){return new Promise((e=>{if(s.isFile)s.file((s=>{s.filepath=i+s.name,t.push(s),e(s)}));else if(s.isDirectory){s.createReader().readEntries((n=>{const a=[];for(let e of n)a.push(Y.#Pa(t,e,i+s.name+"/"));e(Promise.all(a))}))}}))}}document.body.prepend(Y.Oa,Y.zn),Y.Pa("gsui-daw",(()=>[Y.Bn("div",{class:"gsuiDAW-head"},Y.Bn("div",{class:"gsuiDAW-area gsuiDAW-areaUser"},Y.Bn("span",{class:"gsuiDAW-title"},"GridSound"),Y.Bn("a",{class:"gsuiDAW-btn","data-action":"profile",href:!0,title:"Cloud profile",target:"_blank",rel:"noopener"}),Y.Bn("button",{class:"gsuiDAW-btn gsuiIcon","data-action":"login","data-icon":"profile",title:"Login to GridSound"}),Y.Bn("button",{class:"gsuiDAW-btn gsuiIcon","data-action":"logout","data-icon":"logout",title:"Logout"}),Y.Bn("div",{class:"gsuiDAW-cmps"},Y.Bn("button",{class:"gsuiDAW-btn gsuiDAW-dropdown-btn gsuiDAW-btnColor gsuiIcon","data-action":"cmps","data-icon":"musics",title:"Create cloud/local compositions"}),Y.En("gsui-daw-cmps"),Y.Bn("div",{class:"gsuiDAW-dropdown-backdrop"}))),Y.Bn("div",{class:"gsuiDAW-area gsuiDAW-areaSave gsuiDAW-btns"},Y.Bn("button",{class:"gsuiDAW-btn gsuiDAW-btnColor gsuiDAW-currCmp-saveBtn gsuiIcon","data-action":"cmp-save",title:"Save composition"}),Y.Bn("button",{class:"gsuiDAW-btn gsuiDAW-currCmp-editBtn","data-action":"cmp-rename",title:"Edit composition's title"},Y.Bn("i",{class:"gsuiDAW-currCmp-localIcon gsuiIcon"}),Y.Bn("span",{class:"gsuiDAW-currCmp-name"}),Y.Bn("i",{class:"gsuiDAW-currCmp-editIcon gsuiIcon","data-icon":"pen"}),Y.Bn("span",{class:"gsuiDAW-currCmp-dur"}))),Y.Bn("div",{class:"gsuiDAW-area gsuiDAW-areaCtrl"},Y.Bn("div",{class:"gsuiDAW-volume",title:"Main app volume (this will not affect the rendering)"},Y.Bn("gsui-slider",{"data-action":"volume",type:"linear-y",min:0,max:1,step:.01,"mousemove-size":150})),Y.Bn("div",{class:"gsuiDAW-btns gsuiDAW-playPauseStop"},Y.Bn("button",{class:"gsuiDAW-btn gsuiDAW-focusBtn","data-action":"focusSwitch","data-dir":"up",title:"Toggle focus between the composition and piano windows"},Y.Bn("span"),Y.Bn("span")),Y.Bn("button",{class:"gsuiDAW-btn gsuiIcon","data-action":"play","data-icon":"play"}),Y.Bn("button",{class:"gsuiDAW-btn gsuiIcon","data-action":"stop","data-icon":"stop"}),Y.Bn("button",{class:"gsuiDAW-btn gsuiIcon","data-action":"reset","data-icon":"sync",title:"Restart the audio engine"})),Y.Bn("gsui-clock"),Y.Bn("button",{class:"gsuiDAW-btn gsuiDAW-tempo","data-action":"tempo",title:"Edit the time signature and BPM"},Y.Bn("div",{class:"gsuiDAW-tempo-timeDivision"},Y.Bn("span",{class:"gsuiDAW-tempo-beatsPerMeasure"}),Y.Bn("span",{class:"gsuiDAW-tempo-stepsPerBeat"})),Y.Bn("span",{class:"gsuiDAW-tempo-bpm"}))),Y.Bn("div",{class:"gsuiDAW-area gsuiDAW-areaTime"},Y.Bn("gsui-slider",{"data-action":"currentTime",type:"linear-x",min:0,step:.01})),Y.Bn("div",{class:"gsuiDAW-area gsuiDAW-areaHist"},Y.Bn("div",{class:"gsuiDAW-btns gsuiDAW-history"},Y.Bn("button",{class:"gsuiDAW-btn gsuiIcon","data-action":"undo","data-icon":"undo",title:"Undo the previous action"}),Y.Bn("button",{class:"gsuiDAW-btn gsuiIcon","data-action":"redo","data-icon":"redo",title:"Redo the last action"}),Y.Bn("button",{class:"gsuiDAW-btn gsuiDAW-dropdown-btn gsuiIcon","data-action":"undoMore","data-icon":"caret-down",title:"Show the actions list"}),Y.En("gsui-daw-history"),Y.Bn("div",{class:"gsuiDAW-dropdown-backdrop"})),Y.Bn("gsui-spectrum"),Y.Bn("button",{class:"gsuiDAW-btn gsuiDAW-btnBg gsuiDAW-btnColor gsuiIcon","data-action":"export","data-icon":"export",title:"Export the composition"}),Y.Bn("button",{class:"gsuiDAW-btn gsuiDAW-btnBg gsuiIcon","data-action":"settings","data-icon":"settings",title:"Settings"})),Y.Bn("div",{class:"gsuiDAW-area gsuiDAW-areaWins gsuiDAW-btns"},Y.Bn("button",{class:"gsuiDAW-btn gsuiIcon","data-action":"window","data-icon":"folder-tree","data-win":"patterns",title:"Open/close the patterns panel","data-open":!0}),Y.Bn("button",{class:"gsuiDAW-btn gsuiIcon","data-action":"window","data-icon":"mixer","data-win":"mixer",title:"Open/close the mixer window"}),Y.Bn("button",{class:"gsuiDAW-btn gsuiIcon","data-action":"window","data-icon":"music","data-win":"main",title:"Open/close the composition window"}),Y.Bn("button",{class:"gsuiDAW-btn gsuiIcon","data-action":"window","data-icon":"oscillator","data-win":"synth",title:"Open/close the synthesizer window"}),Y.Bn("button",{class:"gsuiDAW-btn gsuiIcon","data-action":"window","data-icon":"drums","data-win":"drums",title:"Open/close the drums window"}),Y.Bn("button",{class:"gsuiDAW-btn gsuiIcon","data-action":"window","data-icon":"keys","data-win":"piano",title:"Open/close the piano window"}),Y.Bn("button",{class:"gsuiDAW-btn gsuiIcon","data-action":"window","data-icon":"slices","data-win":"slicer",title:"Open/close the slices window"})),Y.Bn("div",{class:"gsuiDAW-area gsuiDAW-areaHelp"},Y.Bn("a",{class:"gsuiDAW-btn gsuiDAW-btnBg gsuiIcon","data-action":"help","data-icon":"help",title:"Help",href:"https://github.com/gridsound/daw/wiki/help",target:"_blank",rel:"noopener"}),Y.Bn("button",{class:"gsuiDAW-btn gsuiDAW-btnBg gsuiIcon gsuiDAW-btnColor","data-action":"about","data-icon":"about",title:"About"})),Y.Bn("div",{class:"gsuiDAW-area gsuiDAW-areaVers"},Y.Bn("a",{class:"gsuiDAW-btn gsuiDAW-version","data-action":"version",title:"Access older versions",href:"https://github.com/gridsound/daw/wiki/versions",target:"_blank",rel:"noopener"}),Y.Bn("a",{class:"gsuiDAW-btn gsuiDAW-changelog gsuiIcon","data-icon":"changelog",title:"Changelog",href:"https://github.com/gridsound/daw/wiki/changelog",target:"_blank",rel:"noopener"}))),Y.Bn("gsui-panel",{class:"gsuiDAW-body"},Y.Bn("div",{class:"gsuiDAW-resources"},Y.Bn("div",{class:"gsuiDAW-libraries"}),Y.Bn("div",{class:"gsuiDAW-patterns"})),Y.Bn("gsui-windows",{class:"gsuiDAW-windows"}))])),Y.Pa("gsui-daw-cmps",(()=>Y.Bn("div",{class:"gsuiDAW-dropdown",tabindex:0},Y.Bn("div",{class:"gsuiDAW-dropdown-head","data-list":"local"},Y.Bn("i",{class:"gsuiDAW-dropdown-icon gsuiIcon","data-icon":"local"}),Y.Bn("span",{class:"gsuiDAW-dropdown-title"},"local"),Y.En("gsui-daw-cmps-btn",{action:"localNewCmp",icon:"plus",text:"new",title:"Create a new composition on this computer"}),Y.En("gsui-daw-cmps-btn",{action:"localOpenCmp",icon:"folder-open",text:"open",title:"Open a composition on this computer"})),Y.Bn("div",{class:"gsuiDAW-dropdown-head","data-list":"cloud"},Y.Bn("i",{class:"gsuiDAW-dropdown-icon gsuiIcon","data-icon":"cloud"}),Y.Bn("span",{class:"gsuiDAW-dropdown-title"},"cloud"),Y.En("gsui-daw-cmps-btn",{action:"cloudNewCmp",icon:"plus",text:"new",title:"Create a new composition on your cloud profile"})),Y.Bn("div",{class:"gsuiDAW-dropdown-list","data-list":"local"},Y.Bn("div",{class:"gsuiDAW-dropdown-placeholder"},Y.Bn("span",null,"there is no local composition here"))),Y.Bn("div",{class:"gsuiDAW-dropdown-list","data-list":"cloud"},Y.Bn("div",{class:"gsuiDAW-dropdown-placeholder"},Y.Bn("span",null,"you don't have any cloud composition yet"),Y.Bn("span",null,"you are not connected")))))),Y.Pa("gsui-daw-cmps-btn",(({action:t,title:s,icon:i,text:e})=>Y.Bn("button",{class:"gsuiDAW-cmps-btn","data-action":t,title:s},Y.Bn("i",{class:"gsuiDAW-cmps-btn-icon gsuiIcon","data-icon":i}),Y.Bn("span",{class:"gsuiDAW-cmps-btn-text"},e)))),Y.Pa("gsui-daw-cmp",(({id:t,saveMode:s})=>Y.Bn("div",{class:"gsuiDAW-cmp","data-id":t,draggable:"true",tabindex:0},Y.Bn("button",{class:"gsuiDAW-cmp-btn gsuiIcon","data-action":"cmp-save","data-icon":"local"===s?"save":"upload"}),Y.Bn("a",{href:!0,class:"gsuiDAW-cmp-info","data-action":"cmp-open"},Y.Bn("div",{class:"gsuiDAW-cmp-name"}),Y.Bn("div",null,Y.Bn("span",{class:"gsuiDAW-cmp-duration-wrap"},Y.Bn("i",{class:"gsuiIcon","data-icon":"clock"}),Y.Bn("span",{class:"gsuiDAW-cmp-duration"})),Y.Bn("span",{class:"gsuiDAW-cmp-bpm-wrap"},Y.Bn("i",{class:"gsuiIcon","data-icon":"speed"}),Y.Bn("span",{class:"gsuiDAW-cmp-bpm"})))),Y.Bn("a",{href:!0,class:"gsuiDAW-cmp-btn gsuiDAW-cmp-btn-light gsuiIcon","data-action":"cmp-json","data-icon":"file-export",title:"Export to JSON file"}),Y.Bn("button",{class:"gsuiDAW-cmp-btn gsuiDAW-cmp-btn-light gsuiIcon","data-action":"cmp-delete","data-icon":"minus-oct",title:"Delete"})))),Y.Pa("gsui-daw-history",(()=>Y.Bn("div",{class:"gsuiDAW-dropdown",tabindex:0},Y.Bn("div",{class:"gsuiDAW-dropdown-head"},Y.Bn("i",{class:"gsuiDAW-dropdown-icon gsuiIcon","data-icon":"history"}),Y.Bn("span",{class:"gsuiDAW-dropdown-title"},"history")),Y.Bn("div",{class:"gsuiDAW-dropdown-list"},Y.Bn("div",{class:"gsuiDAW-dropdown-placeholder"},Y.Bn("span",null,"there is nothing to undo")))))),Y.Pa("gsui-daw-history-action",(({icon:t,desc:s,index:i})=>Y.Bn("div",{class:"gsuiDAW-history-action","data-action":"historyAction","data-index":i},Y.Bn("i",{class:"gsuiDAW-history-action-icon gsuiIcon","data-icon":t}),Y.Bn("span",{class:"gsuiDAW-history-action-text"},s)))),Y.Pa("gsui-daw-window-main",(()=>Y.Bn("div",{"data-window":"main"}))),Y.Pa("gsui-daw-window-piano",(()=>Y.Bn("div",{"data-window":"piano"},Y.Bn("div",{class:"gsuiDAW-winMenu"},Y.Bn("button",{class:"gsuiDAW-winBtn","data-target":"pianoroll"}))))),Y.Pa("gsui-daw-window-synth",(()=>Y.Bn("div",{"data-window":"synth"},Y.Bn("div",{class:"gsuiDAW-winMenu"},Y.Bn("button",{class:"gsuiDAW-winBtn","data-target":"synth"}),Y.Bn("i",{class:"gsuiIcon","data-icon":"arrow-right"}),Y.Bn("button",{class:"gsuiDAW-winBtn","data-target":"synthChannel"},Y.Bn("i",{class:"gsuiIcon","data-icon":"mixer"}),Y.Bn("span")))))),Y.Pa("gsui-daw-window-mixer",(()=>Y.Bn("div",{"data-window":"mixer"}))),Y.Pa("gsui-daw-window-effects",(()=>Y.Bn("div",{"data-window":"effects"},Y.Bn("div",{class:"gsuiDAW-winMenu"},Y.Bn("button",{class:"gsuiDAW-winBtn","data-target":"channel"}))))),Y.Pa("gsui-daw-window-drums",(()=>Y.Bn("div",{"data-window":"drums"},Y.Bn("div",{class:"gsuiDAW-winMenu"},Y.Bn("button",{class:"gsuiDAW-winBtn","data-target":"drums"}))))),Y.Pa("gsui-daw-window-slicer",(()=>Y.Bn("div",{"data-window":"slicer"},Y.Bn("div",{class:"gsuiDAW-winMenu"},Y.Bn("button",{class:"gsuiDAW-winBtn","data-target":"slices"}))))),Y.Pa("gsui-daw-popup-auth",(()=>Y.Bn("div",{id:"authPopupContent",class:"gsuiDAW-popup-auth"},Y.Bn("fieldset",null,Y.Bn("legend",null,"Sign in"),Y.Bn("div",{class:"gsuiPopup-row"},Y.Bn("div",{class:"gsuiPopup-row-title"},Y.Bn("span",null,"Username"),Y.Bn("br"),Y.Bn("small",null,"(or email)")),Y.Bn("div",{class:"gsuiPopup-row-values"},Y.Bn("input",{class:"gsuiPopup-inputText",required:!0,name:"email",type:"text"}))),Y.Bn("div",{class:"gsuiPopup-row"},Y.Bn("div",{class:"gsuiPopup-row-title"},"Password"),Y.Bn("div",{class:"gsuiPopup-row-values"},Y.Bn("input",{class:"gsuiPopup-inputText",required:!0,name:"password",type:"password"}))),Y.Bn("div",{class:"gsuiDAW-popup-auth-error"})),Y.Bn("a",{target:"_blank",rel:"noopener",href:"https://gridsound.com/#/forgotPassword"},"Forgot password ?"),Y.Bn("br"),Y.Bn("a",{target:"_blank",rel:"noopener",href:"https://gridsound.com/#/auth"},"Create a new account")))),Y.Pa("gsui-daw-popup-open",(()=>Y.Bn("div",{class:"gsuiDAW-popup-open"},Y.Bn("fieldset",null,Y.Bn("legend",null,"Open and load a new composition"),Y.Bn("div",{class:"gsuiPopup-row"},Y.Bn("div",{class:"gsuiPopup-row-title"},"With an URL"),Y.Bn("div",{class:"gsuiPopup-row-values"},Y.Bn("input",{class:"gsuiPopup-inputText",name:"url",type:"url",placeholder:"https://"}))),Y.Bn("div",{class:"gsuiPopup-row"},Y.Bn("div",{class:"gsuiPopup-row-title"},"With a local file",Y.Bn("br"),Y.Bn("small",null,"(Please notice that you can also drop a file into the app)")),Y.Bn("div",{class:"gsuiPopup-row-values"},Y.Bn("input",{name:"file",type:"file"}))))))),Y.Pa("gsui-daw-popup-about",(()=>Y.Bn("div",{class:"gsuiDAW-popup-about"},Y.Bn("div",{class:"gsuiDAW-popup-about-head"},Y.Bn("span",{class:"gsuiDAW-popup-about-title"},"GridSound"),Y.Bn("span",{class:"gsuiDAW-popup-about-versionNum"}),Y.Bn("i",{class:"gsuiIcon"}),Y.Bn("button",{class:"gsuiDAW-popup-about-versionCheck",type:"button"},"check the version")),Y.Bn("div",null,"GridSound is a ",Y.Bn("b",null,"work-in-progress")," free browser-based digital audio workstation following the ",Y.Bn("a",{target:"_blank",rel:"noopener",href:"https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API"},"Web Audio API"),"."),Y.Bn("div",null,"You can create an account (by clicking ",Y.Bn("i",{class:"gsuiIcon","data-icon":"profile"}),") and start uploading your compositions online ",Y.Bn("i",{class:"gsuiIcon","data-icon":"cloud"})),Y.Bn("div",{class:"gsuiDAW-popup-about-links"},Y.Bn("a",{target:"_blank",rel:"noopener",title:"GitHub",class:"gsuiIcon gsuiIconB","data-icon":"github",href:"https://github.com/gridsound"}),Y.Bn("a",{target:"_blank",rel:"noopener",title:"Twitter",class:"gsuiIcon gsuiIconB","data-icon":"twitter",href:"https://twitter.com/gridsound"}),Y.Bn("a",{target:"_blank",rel:"noopener",title:"YouTube",class:"gsuiIcon gsuiIconB","data-icon":"youtube",href:"https://youtube.com/@gridsound"}),Y.Bn("a",{target:"_blank",rel:"noopener",title:"Facebook",class:"gsuiIcon gsuiIconB","data-icon":"facebook",href:"https://facebook.com/gridsound"}),Y.Bn("a",{target:"_blank",rel:"noopener",title:"CodePen",class:"gsuiIcon gsuiIconB","data-icon":"codepen",href:"https://codepen.io/gridsound"}),Y.Bn("a",{target:"_blank",rel:"noopener",title:"Discord",class:"gsuiIcon gsuiIconB","data-icon":"discord",href:"https://discord.gg/NUYxHAg"}))))),Y.Pa("gsui-daw-popup-tempo",(()=>Y.Bn("div",{class:"gsuiDAW-popup-tempo"},Y.Bn("fieldset",null,Y.Bn("legend",null,"Time division / BPM"),Y.Bn("div",{class:"gsuiPopup-row"},Y.Bn("div",{class:"gsuiPopup-row-title"},"Beats per measure"),Y.Bn("div",{class:"gsuiPopup-row-values"},Y.Bn("input",{class:"gsuiPopup-inputText",name:"beatsPerMeasure",type:"number",min:1,max:16}))),Y.Bn("div",{class:"gsuiPopup-row"},Y.Bn("div",{class:"gsuiPopup-row-title"},"Steps per beat"),Y.Bn("div",{class:"gsuiPopup-row-values"},Y.Bn("input",{class:"gsuiPopup-inputText",name:"stepsPerBeat",type:"number",min:1,max:16}))),Y.Bn("div",{class:"gsuiPopup-row"},Y.Bn("div",{class:"gsuiPopup-row-title"},"BPM (Beats Per Minute)"),Y.Bn("div",{class:"gsuiPopup-row-values"},Y.Bn("input",{class:"gsuiPopup-inputText",name:"bpm",type:"number",min:1,max:999.99,step:.01}),Y.Bn("a",{class:"gsuiDAW-bpmTap gsuiIcon","data-icon":"tint"}))))))),Y.Pa("gsui-daw-popup-export",(()=>Y.Bn("div",{class:"gsuiDAW-popup-export"},Y.Bn("fieldset",null,Y.Bn("legend",null,"Render the current composition"),Y.Bn("div",{class:"gsuiDAW-popup-export-wrap"},Y.Bn("a",{href:!0,class:"gsuiDAW-popup-export-btn","data-status":0},Y.Bn("span",{class:"gsuiDAW-popup-export-btn0"},Y.Bn("span",null,"Render"),Y.Bn("i",{class:"gsuiIcon","data-icon":"render"})),Y.Bn("span",{class:"gsuiDAW-popup-export-btn1"},Y.Bn("span",null,"Rendering..."),Y.Bn("i",{class:"gsuiIcon","data-spin":"on"})),Y.Bn("span",{class:"gsuiDAW-popup-export-btn2"},Y.Bn("span",null,"Download WAV file"),Y.Bn("i",{class:"gsuiIcon","data-icon":"export"}))),Y.Bn("progress",{class:"gsuiDAW-popup-export-progress",value:"",max:1})))))),Y.Pa("gsui-daw-popup-settings",(()=>Y.Bn("div",{class:"gsuiDAW-popup-settings"},Y.Bn("fieldset",null,Y.Bn("legend",null,"Audio"),Y.Bn("div",{class:"gsuiPopup-row"},Y.Bn("div",{class:"gsuiPopup-row-title"},"Feedback sample rate"),Y.Bn("div",{class:"gsuiPopup-row-values"},Y.Bn("select",{name:"sampleRate"},Y.Bn("option",{value:8e3},"8 kHz"),Y.Bn("option",{value:11025},"11.025 kHz"),Y.Bn("option",{value:12e3},"12 kHz"),Y.Bn("option",{value:22050},"22.05 kHz"),Y.Bn("option",{value:24e3},"24 kHz"),Y.Bn("option",{value:44100},"44.1 kHz"),Y.Bn("option",{value:48e3,style:"font-weight:bold"},"48 kHz"),Y.Bn("option",{value:88200},"88.2 kHz"),Y.Bn("option",{value:96e3},"96 kHz"))))),Y.Bn("fieldset",null,Y.Bn("legend",null,"UI refresh rate"),Y.Bn("div",{class:"gsuiPopup-row"},Y.Bn("div",{class:"gsuiPopup-row-title"},"Auto"),Y.Bn("div",{class:"gsuiPopup-row-values"},Y.Bn("label",null,Y.Bn("input",{name:"uiRate",type:"radio",value:"auto"}),Y.Bn("span",{class:"gsuiDAW-uiRateFps"},60)))),Y.Bn("div",{class:"gsuiPopup-row"},Y.Bn("div",{class:"gsuiPopup-row-title"},"Manual"),Y.Bn("div",{class:"gsuiPopup-row-values"},Y.Bn("label",null,Y.Bn("input",{name:"uiRate",type:"radio",value:"manual"}),Y.Bn("span",{class:"gsuiDAW-uiRateFps"},40)),Y.Bn("input",{name:"uiRateFPS",type:"range",step:1,min:5,max:40,value:40})))),Y.Bn("fieldset",null,Y.Bn("legend",null,"Windows"),Y.Bn("div",{class:"gsuiPopup-row"},Y.Bn("div",{class:"gsuiPopup-row-title"},"Move/resize mode"),Y.Bn("div",{class:"gsuiPopup-row-values"},Y.Bn("label",null,Y.Bn("input",{name:"windowsLowGraphics",type:"checkbox"}),Y.Bn("span",null,"low graphic"))))),Y.Bn("fieldset",null,Y.Bn("legend",null,"Timeline"),Y.Bn("div",{class:"gsuiPopup-row"},Y.Bn("div",{class:"gsuiPopup-row-title"},"Numbering measures starting at"),Y.Bn("div",{class:"gsuiPopup-row-values"},Y.Bn("select",{name:"timelineNumbering"},Y.Bn("option",{value:0},0),Y.Bn("option",{value:1},1))))))));class J extends HTMLElement{onSubmitLogin=Y.Sn;onSubmitOpen=Y.Sn;onExportJSON=Y.Sn;#Ma={local:new Map,cloud:new Map};#Aa=null;#Ta="local";#Ba=-1;#ja=null;#La=Y.Ca.bind(null,this,"gsuiDAW");#Ea=Y.En("gsui-daw");#Wa=!1;#fs=Y.Fn(this.#Ea,{head:".gsuiDAW-head",bpm:".gsuiDAW-tempo-bpm",bPM:".gsuiDAW-tempo-beatsPerMeasure",sPB:".gsuiDAW-tempo-stepsPerBeat",cmpName:".gsuiDAW-currCmp-name",cmpSave:".gsuiDAW-currCmp-saveBtn",cmpIcon:".gsuiDAW-currCmp-localIcon",cmpDuration:".gsuiDAW-currCmp-dur",play:"[data-action='play']",vers:".gsuiDAW-version",clock:"gsui-clock",spectrum:"gsui-spectrum",volume:".gsuiDAW-volume gsui-slider",currentTime:".gsuiDAW-areaTime gsui-slider",userAvatar:"[data-action='profile']",login:"[data-action='login']",logout:"[data-action='logout']",cmpsLocalList:".gsuiDAW-dropdown-list[data-list='local']",cmpsCloudList:".gsuiDAW-dropdown-list[data-list='cloud']",historyList:".gsuiDAW-history .gsuiDAW-dropdown-list",patternsPanel:".gsuiDAW-resources",winBtns:{patterns:"[data-win='patterns']",mixer:"[data-win='mixer']",main:"[data-win='main']",synth:"[data-win='synth']",drums:"[data-win='drums']",piano:"[data-win='piano']",slicer:"[data-win='slicer']",effects:"[data-win='effects']"}});#Fa={auth:Y.Fn(Y.En("gsui-daw-popup-auth"),{root:".gsuiDAW-popup-auth",error:".gsuiDAW-popup-auth-error"}),open:Y.Fn(Y.En("gsui-daw-popup-open"),{root:".gsuiDAW-popup-open",inputOpenURL:"[name='url']",inputOpenFile:"[name='file']"}),tempo:Y.Fn(Y.En("gsui-daw-popup-tempo"),{root:".gsuiDAW-popup-tempo",beatsPerMeasure:"[name='beatsPerMeasure']",stepsPerBeat:"[name='stepsPerBeat']",bpm:"[name='bpm']",bpmTap:".gsuiDAW-bpmTap"}),about:Y.Fn(Y.En("gsui-daw-popup-about"),{root:".gsuiDAW-popup-about",version:".gsuiDAW-popup-about-versionNum",versionIcon:".gsuiDAW-popup-about-head .gsuiIcon",versionCheck:".gsuiDAW-popup-about-versionCheck"}),export:Y.Fn(Y.En("gsui-daw-popup-export"),{root:".gsuiDAW-popup-export",button:".gsuiDAW-popup-export-btn",progress:".gsuiDAW-popup-export-progress"}),settings:Y.Fn(Y.En("gsui-daw-popup-settings"),{root:".gsuiDAW-popup-settings",sampleRate:"[name='sampleRate']",uiRateRadio:{auto:"[name='uiRate'][value='auto']",manual:"[name='uiRate'][value='manual']"},uiRateManualFPS:"[name='uiRate'][value='manual'] + .gsuiDAW-uiRateFps",uiRateManualRange:"[name='uiRateFPS']",windowsLowGraphics:"[name='windowsLowGraphics']",timelineNumbering:"[name='timelineNumbering']"})};constructor(){super(),this.clock=this.#fs.clock,this.spectrum=this.#fs.spectrum,Object.seal(this),this.clock.onchangeDisplay=t=>this.#La("changeDisplayClock",t),this.spectrum.setResolution(140),this.#ja=this.#fs.historyList.getElementsByClassName("gsuiDAW-history-action"),this.#fs.head.onclick=this.#Ia.bind(this),this.#fs.cmpsCloudList.ondragstart=J.#Ka.bind(null,"cloud"),this.#fs.cmpsLocalList.ondragstart=J.#Ka.bind(null,"local"),this.#fs.cmpsCloudList.ondragover=this.#fs.cmpsLocalList.ondragover=t=>t.preventDefault(),this.#fs.cmpsCloudList.ondrop=this.#fs.cmpsLocalList.ondrop=this.#za.bind(this),this.#Fa.about.versionCheck.onclick=()=>{const t=this.#Fa.about.versionIcon.dataset;t.icon="none",t.spin="on",fetch(`https://gridsound.com/daw/VERSION?${Math.random()}`).then((t=>t.text()),Y.Sn).then((s=>{t.spin="",t.icon=s===Y.Kn(this,"version")?"check":"warning"}))},this.#Fa.tempo.bpmTap.onclick=()=>this.#Fa.tempo.bpm.value=F.la(),this.#Fa.settings.uiRateManualRange.onmousedown=()=>this.#Fa.settings.uiRateRadio.manual.checked=!0,this.#Fa.settings.uiRateManualRange.oninput=t=>{this.#Fa.settings.uiRateManualFPS.textContent=t.target.value.padStart(2,"0")},this.#Fa.export.button.onclick=t=>{const s=t.currentTarget.dataset;"2"!==s.status&&t.preventDefault(),"0"===s.status&&(s.status="1",this.#La("export"))},Y.In(this.#fs.volume,{gsuiSlider:{input:t=>this.#La("volume",t.args[0]),inputStart:Y.Sn,inputEnd:Y.Sn,change:Y.Sn}}),Y.In(this.#fs.currentTime,{gsuiSlider:{inputStart:t=>{this.#Wa=!0,this.#fs.clock.setTime(t.args[0])},inputEnd:()=>{this.#Wa=!1},input:t=>{this.#fs.clock.setTime(t.args[0]),this.#La("currentTimeLive",t.args[0])},change:t=>{this.#La("currentTime",t.args[0])}}})}connectedCallback(){this.#Ea&&(this.append(...this.#Ea),this.#Ea=null,Y.Ia(this,{saved:!0,uirate:"auto",timelinenumbering:0,bpm:60,name:"",duration:10,timedivision:"1/1",currenttime:0,maxtime:1,volume:1,version:"0.0.0"}))}static get observedAttributes(){return["bpm","currentcomposition","currenttime","duration","errauth","exporting","logging","maxtime","name","playing","saving","timedivision","timelinenumbering","useravatar","username","version","volume"]}attributeChangedCallback(t,s,i){if(!this.#Ea&&s!==i)switch(t){case"currentcomposition":i?this.#Ra(...i.split(":")):this.#Na();break;case"errauth":this.#Fa.auth.error.textContent=i;break;case"exporting":this.#Fa.export.progress.value=i;break;case"logging":this.#fs.login.dataset.spin=this.#fs.logout.dataset.spin=null!==i?"on":"";break;case"username":Y.Wn(this.#fs.userAvatar,"href",i&&`https://gridsound.com/#/u/${i}`);break;case"name":this.#fs.cmpName.textContent=i;break;case"playing":this.#fs.play.dataset.icon=null!==i?"pause":"play";break;case"saving":this.#Ma[this.#Ta].get(this.#Aa).save.dataset.spin=this.#fs.cmpSave.dataset.spin=null!==i?"on":"";break;case"duration":this.#Vn();break;case"timelinenumbering":st.numbering(i);break;case"bpm":Y.Wn(this.#fs.clock,"bpm",i),this.#fs.bpm.textContent=i,this.#Vn();break;case"timedivision":Y.Wn(this.#fs.clock,"timedivision",i),this.#fs.bPM.textContent=i.split("/")[0],this.#fs.sPB.textContent=i.split("/")[1];break;case"volume":this.#fs.volume.setValue(i);break;case"currenttime":this.#Wa||(this.#fs.clock.setTime(i),this.#fs.currentTime.setValue(i));break;case"maxtime":Y.Wn(this.#fs.currentTime,"max",i);break;case"useravatar":this.#fs.userAvatar.style.backgroundImage=i?`url("${i}")`:"";break;case"version":this.#fs.vers.textContent=i,this.#Fa.about.version.textContent=i}}updateSpectrum(t){this.#fs.spectrum.draw(t)}#Na(){this.#Aa=null,this.#Ta="local",this.querySelector(".gsuiDAW-cmp-loaded")?.classList?.remove("gsuiDAW-cmp-loaded")}#Ra(t,s){const i=this.#Ma[t].get(s);this.#Na(),i&&(this.#Aa=s,this.#Ta=t,i.root.classList.add("gsuiDAW-cmp-loaded"),i.root.parentNode.prepend(i.root),i.root.parentNode.scrollTop=0,Y.Wn(this.#fs.cmpIcon,"data-icon","local"===t?"local":"cloud"),Y.Wn(this.#fs.cmpSave,"data-icon","local"===t?"save":"upload"))}#Vn(){const t=Y.ja(this,"duration"),[s,i]=st.parseBeatsToSeconds(t,Y.ja(this,"bpm"));this.#fs.cmpDuration.textContent=`${s}:${i}`,Y.Wn(this.#fs.currentTime,"max",t)}showOpenPopup(){this.#Fa.open.inputOpenFile.value=this.#Fa.open.inputOpenURL.value="",Y.zn.custom({title:"Open",element:this.#Fa.open.root,submit:t=>this.onSubmitOpen(t.url,t.file)})}clearCompositions(){this.#Ma.local.forEach((t=>t.root.remove())),this.#Ma.cloud.forEach((t=>t.root.remove()))}addComposition(t){const s=t.options.saveMode;if("local"===s&&this.#Ma.local.has(t.id)||"cloud"===s&&this.#Ma.cloud.has(t.id))this.updateComposition(t);else{const i=Y.En("gsui-daw-cmp",{id:t.id,saveMode:s}),e=Y.Fn(i,{root:".gsuiDAW-cmp",bpm:".gsuiDAW-cmp-bpm",name:".gsuiDAW-cmp-name",save:"[data-action='cmp-save']",duration:".gsuiDAW-cmp-duration"});this.#Ma[s].set(t.id,e),this.updateComposition(t),("local"===s?this.#fs.cmpsLocalList:this.#fs.cmpsCloudList).append(i),`${s}:${t.id}`===Y.Kn(this,"currentcomposition")&&this.#Ra(s,t.id)}}updateComposition(t){const s=this.#Ma[t.options.saveMode].get(t.id),[i,e]=st.parseBeatsToSeconds(t.duration,t.bpm);s.bpm.textContent=t.bpm,s.name.textContent=t.name,s.duration.textContent=`${i}:${e}`}deleteComposition(t){const s=this.#Ma[t.options.saveMode],i=s.get(t.id);i&&(i.root.remove(),s.delete(t.id))}readyToDownload(t,s){Y.Wn(this.#Fa.export.button,"href",t),Y.Wn(this.#Fa.export.button,"download",s),Y.Wn(this.#Fa.export.button,"data-status",2)}static#Ka(t,s){const i=s.target.closest(".gsuiDAW-cmp");s.dataTransfer.setData("text/plain",`${t}:${i.dataset.id}`)}#za(t){const[s,i]=t.dataTransfer.getData("text/plain").split(":");s!==t.currentTarget.dataset.list&&this.#La("switchCompositionLocation",s,i)}toggleWindow(t,s){if(Y.Wn(this.#fs.winBtns[t],"data-open",s),"patterns"===t){const t=this.#fs.patternsPanel;t.style.setProperty("--gsuiDAW-panel-margin",s?"0":`-${getComputedStyle(t).width}`),t.classList.toggle("gsuiDAW-resources-closed",!s)}}clearHistory(){Array.from(this.#ja).forEach((t=>t.remove())),this.#Ba=-1}stackAction(t,s){Array.from(this.#ja).forEach((t=>"undone"in t.dataset&&t.remove())),this.#fs.historyList.append(Y.En("gsui-daw-history-action",{icon:t,desc:s,index:this.#ja.length})),this.#fs.historyList.scroll(0,Number.MAX_SAFE_INTEGER),this.#Ba=this.#ja.length-1}undo(){this.#Ba>=0&&Y.Wn(this.#ja[this.#Ba--],"data-undone",!0)}redo(){this.#Ba<this.#ja.length-1&&Y.Wn(this.#ja[++this.#Ba],"data-undone",!1)}#Ia(t){const s=t.target.dataset;switch(s.action){case"logout":case"localNewCmp":case"cloudNewCmp":case"focusSwitch":case"play":case"stop":case"reset":case"undo":case"redo":this.#La(s.action);break;case"cmp-save":this.#La("save");break;case"cmp-open":t.preventDefault(),this.#La("open",this.#fs.cmpsLocalList.contains(t.target.parentNode)?"local":"cloud",t.target.parentNode.dataset.id);break;case"cmp-json":{const s=this.onExportJSON(this.#fs.cmpsLocalList.contains(t.target.parentNode)?"local":"cloud",t.target.parentNode.dataset.id);s?(Y.Wn(t.target,"href",s.url),Y.Wn(t.target,"download",s.name)):t.preventDefault()}break;case"cmp-delete":this.#La("delete",this.#fs.cmpsLocalList.contains(t.target.parentNode)?"local":"cloud",t.target.parentNode.dataset.id);break;case"cmp-rename":Y.zn.prompt("Composition's title","",Y.Kn(this,"name"),"Rename").then((t=>t&&t!==Y.Kn(this,"name")&&this.#La("rename",t)));break;case"login":Y.zn.custom({ok:"Sign in",title:"Authentication",element:this.#Fa.auth.root,submit:t=>this.onSubmitLogin(t.email,t.password)}).then((()=>{this.#Fa.auth.root.querySelectorAll("input").forEach((t=>t.value=""))}));break;case"localOpenCmp":this.showOpenPopup();break;case"window":"patterns"!==s.win?this.#La(void 0===s.open?"openWindow":"closeWindow",s.win):this.toggleWindow("patterns",""!==s.open);break;case"historyAction":s.index-this.#Ba&&this.#La("redoN",s.index-this.#Ba);break;case"about":Y.zn.custom({title:"About",element:this.#Fa.about.root});break;case"export":Y.Wn(this,"exporting",0),Y.Wn(this.#Fa.export.button,"href",""),Y.Wn(this.#Fa.export.button,"download",""),Y.Wn(this.#Fa.export.button,"data-status",0),Y.zn.custom({title:"Export",element:this.#Fa.export.root}).then((()=>this.#La("abortExport")));break;case"tempo":this.#Fa.tempo.beatsPerMeasure.value=+Y.Kn(this,"timedivision").split("/")[0],this.#Fa.tempo.stepsPerBeat.value=+Y.Kn(this,"timedivision").split("/")[1],this.#Fa.tempo.bpm.value=Y.ja(this,"bpm"),Y.zn.custom({title:"Tempo",element:this.#Fa.tempo.root}).then((t=>{t&&(t.timedivision=`${t.beatsPerMeasure}/${t.stepsPerBeat}`,delete t.beatsPerMeasure,delete t.stepsPerBeat,t.timedivision===Y.Kn(this,"timedivision")&&t.bpm===Y.ja(this,"bpm")||this.#La("tempo",t))}));break;case"settings":this.#Fa.settings.sampleRate.value=Y.ja(this,"samplerate"),this.#Fa.settings.timelineNumbering.value=Y.ja(this,"timelinenumbering"),this.#Fa.settings.windowsLowGraphics.checked=""===Y.Kn(this,"windowslowgraphics"),this.#Fa.settings.uiRateRadio["auto"===Y.Kn(this,"uirate")?"auto":"manual"].checked=!0,"auto"!==Y.Kn(this,"uirate")&&(this.#Fa.settings.uiRateManualFPS.textContent=Y.Kn(this,"uirate").padStart(2,"0"),this.#Fa.settings.uiRateManualRange.value=Y.Kn(this,"uirate")),Y.zn.custom({title:"Settings",element:this.#Fa.settings.root}).then((t=>{t&&("manual"===t.uiRate&&(t.uiRate=t.uiRateFPS),delete t.uiRateFPS,(t.uiRate!==Y.Kn(this,"uirate")&&t.uiRate!==Y.ja(this,"uirate")||t.sampleRate!==Y.ja(this,"samplerate")||t.timelineNumbering!==Y.ja(this,"timelinenumbering")||t.windowsLowGraphics!==(""===Y.Kn(this,"windowslowgraphics")))&&this.#La("settings",t))}));break;case"cmps":case"help":case"undoMore":case"changelog":break;default:s.action&&console.log("untracked action:",s.action)}}}Object.seal(J),customElements.define("gsui-daw",J);class X extends HTMLElement{show(t){t&&(this.style.cursor=t),this.classList.add("gsuiDragshield-show")}hide(){this.style.cursor="",this.classList.remove("gsuiDragshield-show")}}Object.freeze(X),customElements.define("gsui-dragshield",X);class Q extends HTMLElement{#Ga=Y.Aa("polyline",{class:"gsuiEnvelopeGraph-mainLine"});#Ha=Y.Aa("polyline",{class:"gsuiEnvelopeGraph-line"});#Va=Y.Aa("polyline",{class:"gsuiEnvelopeGraph-line"});#Ua=Y.Aa("svg",{preserveAspectRatio:"none"},this.#Ga,this.#Ha,this.#Va);#qa=0;#_a=0;constructor(){super(),this.attack=.25,this.hold=.25,this.decay=.25,this.sustain=.8,this.release=1,this.duration=4,Object.seal(this)}connectedCallback(){this.firstChild||(this.append(this.#Ua),this.resized())}resized(){const t=this.getBoundingClientRect(),s=~~t.width,i=~~t.height;this.#qa=s,this.#_a=i,Y.Wn(this.#Ua,"viewBox",`0 0 ${s} ${i}`),this.draw()}draw(){if(this.firstChild){const t=Q.#Ya(this.#qa,this.#_a,this.duration,this.attack,this.hold,this.decay,this.sustain,this.release);Y.Wn(this.#Ha,"points",t.slice(0,8).join(" ")),Y.Wn(this.#Va,"points",t.slice(-4).join(" ")),Y.Wn(this.#Ga,"points",t.join(" "))}}static#Ya(t,s,i,e,n,a,h,o){const r=t/("auto"!==i?i:e+n+a+1+o),c=r*e,l=c+r*n,u=l+r*a,d=u+r*("auto"===i?1:i-e-n-a-o),p=s*(1-h);return[0,s,c,2,l,2,u,p+2,d,p+2,d+r*o,s]}}Object.freeze(Q),customElements.define("gsui-envelope-graph",Q),Y.Pa("gsui-envelope",(()=>[[["attack","attack","att",0,1,.01],["hold","hold","hold",0,1,.01],["decay","decay","dec",0,1,.01],["sustain","sustain","sus",0,1,.01],["release","release","rel",0,4,.01]].map((([t,s,i,e,n,a])=>Y.Bn("div",{class:`gsuiEnvelope-prop gsuiEnvelope-${t}`,title:s},Y.Bn("div",{class:"gsuiEnvelope-propLabel"},Y.Bn("span",null,i),Y.Bn("div",{class:"gsuiEnvelope-propValue"})),Y.Bn("div",{class:"gsuiEnvelope-propContent"},Y.Bn("gsui-slider",{type:"linear-x",disabled:!0,min:e,max:n,step:a,"mousemove-size":"800","data-prop":t}))))),Y.Bn("div",{class:"gsuiEnvelope-graph"},Y.Bn("gsui-beatlines",{coloredbeats:""}),Y.Bn("gsui-envelope-graph"))].flat(1)));class Z extends HTMLElement{#Ja=4;#Xa=300;#La=Y.Ca.bind(null,this,"gsuiEnvelope");#Qa=this.#Za.bind(this);#Ea=Y.En("gsui-envelope");#fs=Y.Fn(this.#Ea,{beatlines:"gsui-beatlines",graph:"gsui-envelope-graph",sliders:{attack:[".gsuiEnvelope-attack  gsui-slider",".gsuiEnvelope-attack  .gsuiEnvelope-propValue"],hold:[".gsuiEnvelope-hold    gsui-slider",".gsuiEnvelope-hold    .gsuiEnvelope-propValue"],decay:[".gsuiEnvelope-decay   gsui-slider",".gsuiEnvelope-decay   .gsuiEnvelope-propValue"],sustain:[".gsuiEnvelope-sustain gsui-slider",".gsuiEnvelope-sustain .gsuiEnvelope-propValue"],release:[".gsuiEnvelope-release gsui-slider",".gsuiEnvelope-release .gsuiEnvelope-propValue"]}});constructor(){super(),Object.seal(this),Y.In(this,{gsuiSlider:{inputStart:Y.Sn,inputEnd:Y.Sn,input:(t,s)=>{this.#th(s.dataset.prop,t.args[0])},change:(t,s)=>{this.#sh(s.dataset.prop,t.args[0])}}})}connectedCallback(){this.#Ea&&(this.append(...this.#Ea),this.#Ea=null,Y.Ia(this,{toggle:!1,timedivision:"4/4",attack:.1,hold:.1,decay:.1,sustain:.8,release:1}),this.updateWave()),Y.La(this,this.#Qa)}disconnectedCallback(){Y.Ea(this,this.#Qa)}static get observedAttributes(){return["toggle","attack","hold","decay","sustain","release"]}attributeChangedCallback(t,s,i){if(s!==i)switch(t){case"toggle":this.#ih(null!==i);break;case"timedivision":this.#eh(i);break;case"attack":case"hold":case"decay":case"sustain":case"release":this.#ln(t,+i)}}updateWave(t,s){const i=this.#fs.graph;i.attack="attack"===t?s:Y.ja(this,"attack"),i.hold="hold"===t?s:Y.ja(this,"hold"),i.decay="decay"===t?s:Y.ja(this,"decay"),i.sustain="sustain"===t?s:Y.ja(this,"sustain"),i.release="release"===t?s:Y.ja(this,"release"),i.duration=this.#Ja=Math.max(i.attack+i.hold+i.decay+.5+i.release,2),i.draw(),this.#nh()}#ih(t){Y.Wn(this.#fs.sliders.attack[0],"disabled",!t),Y.Wn(this.#fs.sliders.hold[0],"disabled",!t),Y.Wn(this.#fs.sliders.decay[0],"disabled",!t),Y.Wn(this.#fs.sliders.sustain[0],"disabled",!t),Y.Wn(this.#fs.sliders.release[0],"disabled",!t)}#eh(t){Y.Wn(this.#fs.beatlines,"timedivision",t),this.updateWave()}#ln(t,s){const[i,e]=this.#fs.sliders[t];i.setValue(s),e.textContent=s.toFixed(2)}#nh(){Y.Wn(this.#fs.beatlines,"pxperbeat",this.#Xa/this.#Ja)}#Za(){this.#Xa=this.#fs.beatlines.getBoundingClientRect().width,this.#nh(),this.#fs.graph.resized()}#th(t,s){this.#fs.sliders[t][1].textContent=s.toFixed(2),this.updateWave(t,s),this.#La("liveChange",t,s)}#sh(t,s){Y.Wn(this,t,s),this.#La("change",t,s)}}Object.freeze(Z),customElements.define("gsui-envelope",Z),Y.Pa("gsui-lfo",(()=>[Y.Bn("div",{class:"gsuiLFO-graph"},Y.Bn("div",{class:"gsuiLFO-wave"},Y.Bn("gsui-beatlines",{coloredbeats:""}),Y.Bn("gsui-periodicwave")),Y.Bn("div",{class:"gsuiLFO-ampSigns"},Y.Bn("label",{class:"gsuiLFO-btn gsuiLFO-ampSign"},Y.Bn("input",{class:"gsuiLFO-btnInput gsuiLFO-ampSignRadio",name:"gsuiLFO-ampSign",type:"radio",value:"1"}),Y.Bn("i",{class:"gsuiLFO-btnIcon gsuiLFO-ampSignIcon gsuiIcon","data-icon":"caret-up"})),Y.Bn("label",{class:"gsuiLFO-btn gsuiLFO-ampSign"},Y.Bn("input",{class:"gsuiLFO-btnInput gsuiLFO-ampSignRadio",name:"gsuiLFO-ampSign",type:"radio",value:"-1"}),Y.Bn("i",{class:"gsuiLFO-btnIcon gsuiLFO-ampSignIcon gsuiIcon","data-icon":"caret-down"})))),[["delay","delay","del",0,4,.03125],["attack","attack","att",0,4,.03125],["speed","speed","spd",.25,18,.125],["amp","amplitude","amp",.001,1,.001]].map((([t,s,i,e,n,a])=>Y.Bn("div",{class:`gsuiLFO-prop gsuiLFO-${t}`,title:s},Y.Bn("div",{class:"gsuiLFO-propLabel"},Y.Bn("span",null,i),Y.Bn("div",{class:"gsuiLFO-propValue"})),Y.Bn("div",{class:"gsuiLFO-propContent"},Y.Bn("gsui-slider",{type:"linear-x",disabled:!0,min:e,max:n,step:a,"mousemove-size":"800","data-prop":t}))))),Y.Bn("div",{class:"gsuiLFO-prop gsuiLFO-type"},Y.Bn("div",{class:"gsuiLFO-propLabel"},"wave"),Y.Bn("div",{class:"gsuiLFO-propContent"},[["sine","M 1 5 C 1 4 1 1 4 1 C 7 1 7 4 7 5 C 7 6 7 9 10 9 C 13 9 13 6 13 5"],["triangle","M 1 5 L 4 1 L 10 9 L 13 5"],["sawtooth","M 1 5 L 7 1 L 7 9 L 13 5"],["square","M 1 5 L 1 1 L 7 1 L 7 9 L 13 9 L 13 5"]].map((([t,s])=>Y.Bn("label",{class:"gsuiLFO-btn gsuiLFO-typeBtn",title:t},Y.Bn("input",{class:"gsuiLFO-btnInput gsuiLFO-typeRadio",name:"gsuiLFO-type",type:"radio",value:t}),Y.Aa("svg",{class:"gsuiLFO-btnIcon gsuiLFO-typeSVG",viewBox:"0 0 14 10"},Y.Aa("path",{d:s})))))))].flat(1)));class tt extends HTMLElement{#Ja=4;#Xa=300;#ge=24e3;#La=Y.Ca.bind(null,this,"gsuiLFO");#Qa=this.#Za.bind(this);#Ea=Y.En("gsui-lfo");#fs=Y.Fn(this.#Ea,{title:".gsuiLFO-title",beatlines:"gsui-beatlines",wave:"gsui-periodicwave",sliders:{delay:[".gsuiLFO-delay       gsui-slider",".gsuiLFO-delay       .gsuiLFO-propValue"],attack:[".gsuiLFO-attack      gsui-slider",".gsuiLFO-attack      .gsuiLFO-propValue"],speed:[".gsuiLFO-speed       gsui-slider",".gsuiLFO-speed       .gsuiLFO-propValue"],amp:[".gsuiLFO-amp         gsui-slider",".gsuiLFO-amp         .gsuiLFO-propValue"],lowpassfreq:[".gsuiLFO-lowpassfreq gsui-slider",".gsuiLFO-lowpassfreq .gsuiLFO-propValue"]}});constructor(){super(),Object.seal(this),this.onchange=this.#ah.bind(this),Y.In(this,{gsuiSlider:{inputStart:Y.Sn,inputEnd:Y.Sn,input:(t,s)=>{this.#th(s.dataset.prop,t.args[0])},change:(t,s)=>{this.#sh(s.dataset.prop,t.args[0])}}})}connectedCallback(){this.#Ea&&(this.append(...this.#Ea),this.#Ea=null,Y.Ia(this,{toggle:!1,timedivision:"4/4",type:"sine",delay:0,attack:1,speed:1,amp:1}),this.updateWave()),Y.La(this,this.#Qa)}disconnectedCallback(){Y.Ea(this,this.#Qa)}static get observedAttributes(){return["toggle","timedivision","type","delay","attack","speed","amp","lowpassfreq"]}attributeChangedCallback(t,s,i){if(!this.#Ea&&s!==i){const e=+i;switch(t){case"timedivision":Y.Wn(this.#fs.beatlines,"timedivision",i);break;case"toggle":this.#ih(null!==i);break;case"type":this.#bn(i);break;case"delay":case"attack":case"speed":case"lowpassfreq":this.#ln(t,e);break;case"amp":e>0!=s>0&&this.#hh(e),this.#ln("amp",Math.abs(e))}}}updateWave(t,s){const i=this.#fs.wave,e=+Y.Kn(this,"timedivision").split("/")[0];i.type=Y.Kn(this,"type"),i.delay="delay"===t?s:Y.ja(this,"delay"),i.attack="attack"===t?s:Y.ja(this,"attack"),i.frequency="speed"===t?s:Y.ja(this,"speed"),i.amplitude="amp"===t?s:Y.ja(this,"amp"),i.duration=this.#Ja=Math.max(i.delay+i.attack+2,e),i.draw(),i.style.opacity=Math.min(6/i.frequency,1),this.#nh()}#ih(t){this.querySelectorAll(".gsuiLFO-typeRadio").forEach((s=>Y.Wn(s,"disabled",!t))),Y.Wn(this.#fs.sliders.delay[0],"disabled",!t),Y.Wn(this.#fs.sliders.attack[0],"disabled",!t),Y.Wn(this.#fs.sliders.speed[0],"disabled",!t),Y.Wn(this.#fs.sliders.amp[0],"disabled",!t)}#bn(t){this.#fs.wave.type=t,this.querySelector(`.gsuiLFO-typeRadio[value="${t}"]`).checked=!0}#hh(t){this.querySelector(`.gsuiLFO-ampSignRadio[value="${Math.sign(t)||1}"]`).checked=!0}#ln(t,s){const i=this.#fs.sliders[t];i&&(i[0].setValue(s),i[1].textContent=tt.#oh(t,s))}#nh(){Y.Wn(this.#fs.beatlines,"pxPerBeat",this.#Xa/this.#Ja)}static#oh(t,s){return s.toFixed(2)}#Za(){this.#Xa=this.#fs.beatlines.getBoundingClientRect().width,this.#nh(),this.#fs.wave.resized()}#ah(t){switch(t.target.name){case"gsuiLFO-type":Y.Wn(this,"type",t.target.value),this.updateWave(),this.#La("change","type",t.target.value);break;case"gsuiLFO-ampSign":Y.Wn(this,"amp",-Y.ja(this,"amp")),this.updateWave(),this.#La("change","amp",Y.ja(this,"amp"))}}#th(t,s){const i="amp"!==t?s:s*Math.sign(Y.ja(this,"amp"));this.#fs.sliders[t][1].textContent=tt.#oh(t,s),this.updateWave(t,i),this.#La("liveChange",t,i)}#sh(t,s){const i="amp"===t?s*Math.sign(Y.ja(this,"amp")):s;Y.Wn(this,t,i),this.#La("change",t,i)}}Object.freeze(tt),customElements.define("gsui-lfo",tt),Y.Pa("gsui-clock",(()=>[Y.Bn("div",{class:"gsuiClock-relative",inert:!0},Y.Bn("div",{class:"gsuiClock-absolute"},Y.Bn("div",{class:"gsuiClock-a"},"0"),Y.Bn("div",{class:"gsuiClock-b"},"00"),Y.Bn("div",{class:"gsuiClock-c"},"000"),Y.Bn("span",{class:"gsuiClock-modeText"}))),Y.Bn("button",{class:"gsuiClock-modes"},Y.Bn("div",{class:"gsuiClock-mode gsuiClock-beat"}),Y.Bn("div",{class:"gsuiClock-mode gsuiClock-second"}))]));class st extends HTMLElement{#rh=4;#ch=4;#lh=0;#uh=-1;#dh=!1;#ph=[-1,-1,-1];#Ea=Y.En("gsui-clock");#fs=Y.Fn(this.#Ea,{wrapRel:".gsuiClock-relative",modes:".gsuiClock-modes",nodes:[".gsuiClock-a",".gsuiClock-b",".gsuiClock-c"]});constructor(){super(),this.onchangeDisplay=Y.Sn,Object.seal(this),this.#fs.modes.onclick=this.#gh.bind(this)}connectedCallback(){this.#dh=!0,this.#Ea&&(this.append(...this.#Ea),this.#Ea=null,Y.Ia(this,{mode:"second",bpm:60,timedivision:"4/4"})),this.#mh()}disconnectedCallback(){this.#dh=!1}static get observedAttributes(){return["mode","bpm","timedivision"]}attributeChangedCallback(t,s,i){if(!this.#Ea&&s!==i)switch(t){case"mode":case"bpm":this.resetTime();break;case"timedivision":{const t=i.split("/");this.#rh=+t[0],this.#ch=+t[1],this.resetTime()}}}static numberingOff=1;static numbering(t){st.numberingOff=+t,document.querySelectorAll("gsui-clock").forEach((t=>t.resetTime()))}static parseBeatsToSeconds(t,s){const i=t/(s/60);return[""+(i/60|0),(""+(i%60|0)).padStart(2,"0"),(""+(1e3*i%1e3|0)).padStart(3,"0")]}static parseBeatsToBeats(t,s,i){const e=Math.floor(t/s),n=Math.floor((t-e*s)*i),a=t*i-Math.floor(t*i);return[`${e+st.numberingOff}`,`${n+st.numberingOff}`.padStart(2,"0"),(""+(1e3*a%1e3|0)).padStart(3,"0")]}setTime(t){const[s,i,e]="second"===Y.Kn(this,"mode")?st.parseBeatsToSeconds(t,Y.ja(this,"bpm")||60):st.parseBeatsToBeats(t,this.#rh,this.#ch);this.#lh=t,this.#bh(0,s),this.#bh(1,i),this.#bh(2,e),this.#dh&&s.length!==this.#uh&&(this.#uh=s.length,this.#mh())}resetTime(){this.setTime(this.#lh)}#bh(t,s){s!==this.#ph[t]&&(this.#fs.nodes[t].textContent=this.#ph[t]=s)}#mh(){const t=this.#fs.nodes[0].textContent.length;this.#fs.wrapRel.style.width=this.#fs.wrapRel.style.minWidth=4.5+.7*t+"ch"}#gh(){const t="second"===Y.Kn(this,"mode")?"beat":"second";Y.Wn(this,"mode",t),this.onchangeDisplay(t)}}Object.seal(st),customElements.define("gsui-clock",st),Y.Pa("gsui-channel",(()=>[Y.Bn("button",{class:"gsuiChannel-nameWrap"},Y.Bn("span",{class:"gsuiChannel-name"})),Y.Bn("button",{class:"gsuiChannel-headBtn gsuiChannel-rename gsuiIcon","data-icon":"pen",title:"Rename the channel"}),Y.Bn("button",{class:"gsuiChannel-headBtn gsuiChannel-delete gsuiIcon","data-icon":"close",title:"Remove the channel"}),Y.Bn("div",{class:"gsuiChannel-analyser"},Y.Bn("gsui-analyser"),Y.Bn("div",{class:"gsuiChannel-effects"})),Y.Bn("gsui-toggle"),Y.Bn("div",{class:"gsuiChannel-pan"},Y.Bn("gsui-slider",{type:"circular",min:-1,max:1,step:.02,"mousemove-size":800,"stroke-width":3,"data-prop":"pan"})),Y.Bn("div",{class:"gsuiChannel-gain"},Y.Bn("gsui-slider",{type:"linear-y",min:0,max:1,step:.01,"mousemove-size":400,"data-prop":"gain"})),Y.Bn("button",{class:"gsuiChannel-connect"},Y.Bn("i",{class:"gsuiChannel-connectA gsuiIcon","data-icon":"caret-up"}),Y.Bn("i",{class:"gsuiChannel-connectB gsuiIcon","data-icon":"caret-up"})),Y.Bn("div",{class:"gsuiChannel-grip gsuiIcon","data-icon":"grip-h"})])),Y.Pa("gsui-channel-effect",((t,s)=>Y.Bn("button",{class:"gsuiChannel-effect gsuiChannel-effect-enable","data-id":t},Y.Bn("span",{class:"gsuiChannel-effect-name"},s))));class it extends HTMLElement{#La=Y.Ca.bind(null,this,"gsuiChannel");#Ea=Y.En("gsui-channel");#fs=Y.Fn(this.#Ea,{toggle:"gsui-toggle",nameWrap:".gsuiChannel-nameWrap",name:".gsuiChannel-name",analyser:"gsui-analyser",effects:".gsuiChannel-effects",pan:".gsuiChannel-pan gsui-slider",gain:".gsuiChannel-gain gsui-slider",connecta:".gsuiChannel-connectA",connectb:".gsuiChannel-connectB"});analyser=this.#fs.analyser;constructor(){super(),Object.seal(this),this.#fs.nameWrap.onclick=this.#fs.analyser.onclick=()=>{this.#La("selectChannel")},this.#fs.effects.onclick=t=>{t.target.dataset.id&&(this.#La("selectChannel"),this.#La("selectEffect",t.target.dataset.id))},Y.In(this,{gsuiToggle:{toggle:t=>{Y.Wn(this,"muted",!t.args[0]),this.#La("toggle",t.args[0])},toggleSolo:()=>{Y.Wn(this,"muted",!1),this.#La("toggleSolo")}},gsuiSlider:{inputStart:Y.Sn,inputEnd:Y.Sn,input:(t,s)=>{this.#La("liveChange",s.dataset.prop,t.args[0])},change:(t,s)=>{this.#La("change",s.dataset.prop,t.args[0])}}})}connectedCallback(){this.firstChild||(this.append(...this.#Ea),this.#Ea=null,Y.Wn(this,"draggable","true"),Y.Ia(this,{name:"chan",pan:0,gain:1,connecta:"down"}))}static get observedAttributes(){return["name","muted","pan","gain","connecta","connectb"]}attributeChangedCallback(t,s,i){if(!this.#Ea&&s!==i)switch(t){case"name":this.#fs.name.textContent=i;break;case"muted":Y.Wn(this.#fs.toggle,"off",null!==i);break;case"pan":case"gain":this.#fs[t].setValue(i);break;case"connecta":case"connectb":this.#fs[t].dataset.icon=i?`caret-${i}`:""}}Gn(t,s){this.#fs.effects.append(Y.En("gsui-channel-effect",t,s.type))}Vn(t){this.#wh(t).remove()}Hn(t,s){"order"in s&&(this.#wh(t).style.order=s.order),"toggle"in s&&this.#wh(t).classList.toggle("gsuiChannel-effect-enable",s.toggle)}#wh(t){return this.#fs.effects.querySelector(`[data-id="${t}"]`)}}Object.freeze(it),customElements.define("gsui-channel",it),Y.Pa("gsui-channels",(()=>[Y.Bn("div",{class:"gsuiChannels-panMain"}),Y.Bn("div",{class:"gsuiChannels-panChannels"},Y.Bn("button",{class:"gsuiChannels-addChan",title:"Add a channel"},Y.Bn("i",{class:"gsuiIcon","data-icon":"channels"}),Y.Bn("i",{class:"gsuiIcon","data-icon":"plus"})))])),Y.Pa("gsui-channels-selectPopup",(()=>Y.Bn("div",null,Y.Bn("fieldset",null,Y.Bn("legend",null,"Select a channel"),Y.Bn("select",{name:"channel",size:8})))));class et extends HTMLElement{oninput=null;onchange=null;onselectChan=null;onselectEffect=null;#ne={};#fh=null;#vh=10;#yh=50;#Qa=this.#Za.bind(this);#Ea=Y.En("gsui-channels");#fs=Y.Fn(this.#Ea,{pmain:".gsuiChannels-panMain",pchans:".gsuiChannels-panChannels",addBtn:".gsuiChannels-addChan"});static#kh=Y.En("gsui-channels-selectPopup");static#$h=et.#kh.querySelector("select");constructor(){super(),Object.seal(this),this.#fs.addBtn.onclick=()=>this.onchange("addChannel"),Y.In(this,{gsuiChannel:{selectChannel:(t,s)=>this.selectChannel(s.dataset.id),selectEffect:(t,s)=>this.onselectEffect(s.dataset.id,t.args[0]),liveChange:(t,s)=>this.oninput(s.dataset.id,...t.args),change:(t,s)=>this.onchange("changeChannel",s.dataset.id,...t.args),toggle:(t,s)=>this.onchange("toggleChannel",s.dataset.id)}}),new ct({rootElement:this,direction:"row",dataTransferType:"channel",itemSelector:"gsui-channel",handleSelector:".gsuiChannel-grip",parentSelector:".gsuiChannels-panChannels",onchange:t=>{this.onchange("reorderChannel",t.dataset.id,ct.listComputeOrderChange(this.#fs.pchans,{}))}})}connectedCallback(){this.firstChild||(this.append(...this.#Ea),this.#Ea=null),Y.La(this,this.#Qa)}disconnectedCallback(){Y.Ea(this,this.#Qa)}#Za(){const t=Object.values(this.#ne);if(t.length){const{width:s,height:i}=t[0].analyser.getBoundingClientRect();this.#vh=s,this.#yh=i,t.forEach((t=>t.analyser.setResolution(s,i)))}}updateAudioData(t,s,i){this.#ne[t].analyser.draw(s,i)}selectChannel(t){const s=this.#ne[t],i=this.#ne[this.#fh];i&&Y.Wn(i,"selected",!1),Y.Wn(s,"selected",!0),this.#fh=t,this.#Oh(),this.onselectChan?.(t)}static openSelectChannelPopup(t){return new Promise((s=>{et.#$h.value=t,Y.zn.custom({title:"Channels",element:et.#kh,submit(i){s(i.channel!==t?i.channel:null)}})}))}Gt(t){return this.#ne[t]}addChannel(t){const s=Y.Bn("gsui-channel",{"data-id":t}),i=t=>s.querySelector(`.gsuiChannel-${t}`);("main"===t?this.#fs.pmain:this.#fs.pchans).append(s),et.#$h.append(Y.Bn("option",{value:t},name)),this.#ne[t]=s,i("delete").onclick=()=>this.onchange("removeChannel",t),i("connect").onclick=()=>this.onchange("redirectChannel",this.#fh,t),i("rename").onclick=()=>{Y.zn.prompt("Rename channel","",Y.Kn(this.#ne[t],"name")).then((s=>this.onchange("renameChannel",t,s)))},s.analyser.setResolution(this.#vh,this.#yh),this.#fh?this.#Oh():"main"===t&&this.selectChannel(t)}removeChannel(t){const s=this.#ne[t];if(t===this.#fh){const t=this.#xh(s,"nextElementSibling");if(t)this.selectChannel(t.dataset.id);else{const t=this.#xh(s,"previousElementSibling");this.selectChannel(t?t.dataset.id:"main")}}delete this.#ne[t],s.remove(),et.#$h.querySelector(`option[value="${t}"]`).remove()}toggleChannel(t,s){Y.Wn(this.#ne[t],"muted",!s)}changePanChannel(t,s){Y.Wn(this.#ne[t],"pan",s)}changeGainChannel(t,s){Y.Wn(this.#ne[t],"gain",s)}renameChannel(t,s){Y.Wn(this.#ne[t],"name",s),et.#$h.querySelector(`option[value="${t}"]`).textContent=s}reorderChannel(t,s){this.#ne[t].dataset.order=s}reorderChannels(t){ct.listReorder(this.#fs.pchans,t)}redirectChannel(t,s){this.#ne[t].dataset.dest=s,this.#Oh()}#xh(t,s){const i=t[s];return i&&"id"in i.dataset?i:null}#Oh(){const t=this.#fh;if(t){const s=this.#ne[t],i=s.dataset.dest;let e=!1;Object.entries(this.#ne).forEach((([s,n])=>{const a=s===i,h=n.dataset.dest===t;Y.Wn(n,"connecta",a?"up":""),Y.Wn(n,"connectb",h?"down":""),e=e||h})),Y.Wn(s,"connecta","main"!==t?"down":""),Y.Wn(s,"connectb",e?"up":"")}}}Object.freeze(et),customElements.define("gsui-channels",et),Y.Pa("gsui-curves",(()=>Y.Aa("svg",{class:"gsuiCurves-svg",preserveAspectRatio:"none"},Y.Aa("line",{class:"gsuiCurves-line","shape-rendering":"crispEdges"}),Y.Aa("g",{class:"gsuiCurves-marks"}),Y.Aa("g",{class:"gsuiCurves-curves"}))));class nt extends HTMLElement{#Sh=Object.seal([0,0]);#Dh=new Map;#Ch=Object.seal({nyquist:24e3,nbBands:8});#Ea=Y.En("gsui-curves");#fs=Y.Fn(this.#Ea,{svg:"svg",line:".gsuiCurves-line",marks:".gsuiCurves-marks",curves:".gsuiCurves-curves"});constructor(){super(),Object.freeze(this)}connectedCallback(){this.#Ea&&(this.append(this.#Ea),this.#Ea=null)}resized(){const t=this.#fs.svg.getBoundingClientRect(),s=t.width,i=t.height;this.#Sh[0]=s,this.#Sh[1]=i,Y.Wn(this.#fs.svg,"viewBox",`0 0 ${s} ${i}`),this.redraw()}options(t){Object.assign(this.#Ch,t),("nbBands"in t||"nyquist"in t)&&this.#Ph()}setCurve(t,s){const i=this.#fs.curves.querySelector(`[data-id="${t}"]`);s?(this.#Dh.set(t,s),i?Y.Wn(i,"d",this.#Mh(s)):this.#Ah(t,s)):(this.#Dh.delete(t),i.remove())}redraw(){this.#Ph(),this.#Th(),this.#Dh.forEach(((t,s)=>{Y.Wn(this.#fs.curves.querySelector(`[data-id="${s}"]`),"d",this.#Mh(t))}))}getWidth(){return this.#Sh[0]}#Th(){const[t,s]=this.#Sh;Y.Wn(this.#fs.line,{x1:0,x2:t,y1:s/2,y2:s/2})}#Ph(){const[t,s]=this.#Sh,i=this.#Ch.nbBands,e=this.#Ch.nyquist,n=[],a=[];for(let h=0;h<i;++h){const o=h/i*t|0,r=Math.round(e*2**(h/i*11-11));a.push(Y.Aa("text",{class:"gsuiCurves-markText",x:o+3,y:14},r<1e3?r:`${(r/1e3).toFixed(1)}k`)),h%2==0&&n.push(Y.Aa("rect",{class:"gsuiCurves-markBg",x:o,y:0,width:t/i|0,height:s,"shape-rendering":"crispEdges"}))}Y.Wa(this.#fs.marks),this.#fs.marks.append(...n,...a)}#Ah(t,s){this.#fs.curves.append(Y.Aa("path",{class:"gsuiCurves-curve","data-id":t,d:this.#Mh(s)}))}#Mh(t){const s=this.#Sh[0],i=t.length,e=[`M 0 ${this.#Bh(t[0])} `];for(let n=1;n<i;++n)e.push(`L ${n/i*s|0} ${this.#Bh(t[n])} `);return e.join("")}#Bh(t){const s=this.#Sh[1];return s/2-20*Math.log(Math.max(t,1e-4))/Math.LN10*(s/100)}}Object.freeze(nt),customElements.define("gsui-curves",nt),Y.Pa("gsui-effects",(()=>[Y.Bn("button",{class:"gsuiEffects-addBtn",title:"Add an effect"},Y.Bn("i",{class:"gsuiIcon","data-icon":"add-effect"})),Y.Bn("select",{class:"gsuiEffects-addSelect",size:2},Y.Bn("option",{value:"delay"},"Delay (echo)"),Y.Bn("option",{value:"filter"},"Filter"))])),Y.Pa("gsui-effects-fx",(()=>Y.Bn("div",{class:"gsuiEffects-fx",draggable:"true"},Y.Bn("div",{class:"gsuiEffects-fx-head"},Y.Bn("div",{class:"gsuiEffects-fx-grip gsuiIcon","data-icon":"grip-v"}),Y.Bn("button",{class:"gsuiEffects-fx-expand gsuiIcon","data-icon":"caret-right"}),Y.Bn("gsui-toggle",{title:"Toggle this effect"}),Y.Bn("span",{class:"gsuiEffects-fx-name"}),Y.Bn("button",{class:"gsuiEffects-fx-remove gsuiIcon","data-icon":"close",title:"Delete this effect"})),Y.Bn("div",{class:"gsuiEffects-fx-content"}))));class at extends HTMLElement{qn=Y.Sn;#jh=new Map;#La=Y.Ca.bind(null,this,"gsuiEffects");#Ea=Y.En("gsui-effects");#fs=Y.Fn(this.#Ea,{addBtn:".gsuiEffects-addBtn",addSelect:".gsuiEffects-addSelect"});static#Lh=Object.freeze({delay:{cmp:"gsui-fx-delay",name:"Delay",height:140},filter:{cmp:"gsui-fx-filter",name:"Filter",height:160}});constructor(){super(),Object.seal(this),this.#fs.addBtn.onclick=()=>this.#fs.addSelect.value="",this.#fs.addSelect.onchange=this.#Eh.bind(this),this.#fs.addSelect.onkeydown=()=>!1,new ct({rootElement:this,direction:"column",dataTransferType:"effect",itemSelector:".gsuiEffects-fx",handleSelector:".gsuiEffects-fx-grip",parentSelector:"gsui-effects"}),Y.In(this,{gsuiToggle:{toggle:(t,s)=>{this.#La("toggleEffect",s.parentNode.parentNode.dataset.id)}},default:{liveChange:(t,s)=>(t.args.unshift(s.dataset.id),t.component="gsuiEffects",t.eventName="liveChangeEffect",!0),changeProp:(t,s)=>(t.args.unshift(s.dataset.id),t.component="gsuiEffects",t.eventName="changeEffect",!0)}})}connectedCallback(){this.firstChild||(this.append(...this.#Ea),this.#Ea=null)}static get observedAttributes(){return["timedivision"]}attributeChangedCallback(t,s,i){if(s!==i&&"timedivision"===t)this.#jh.forEach((t=>Y.Wn(t.content.firstChild,"timedivision",i)))}Xn(t){return this.#jh.get(t)}Jn(t){const s=this.#jh.get(t).root;this.Ka(t,!s.classList.contains("gsuiEffects-fx-expanded"))}Ka(t,s){const i=this.#jh.get(t),e=i.root.dataset.type;i.root.classList.toggle("gsuiEffects-fx-expanded",s),i.expand.dataset.icon=s?"caret-down":"caret-right",i.content.style.height=`${s?at.#Lh[e].height:0}px`}Gn(t,s){const i=Y.En("gsui-effects-fx"),e=i.querySelector(".gsuiEffects-fx-name"),n=i.querySelector(".gsuiEffects-fx-expand"),a=i.querySelector(".gsuiEffects-fx-remove"),h=i.querySelector(".gsuiEffects-fx-content"),o=at.#Lh[s.type],r=Y.Bn(o.cmp),c=Object.seal({uiFx:r,root:i,expand:n,content:h});n.onclick=()=>this.Jn(t),a.onclick=()=>this.#La("removeEffect",t),"qn"in r&&(r.qn=this.qn.bind(null,t,s.type)),i.dataset.id=r.dataset.id=t,i.dataset.type=s.type,Y.Wn(r,"timedivision",Y.Kn(this,"timedivision")),e.textContent=o.name,h.append(r),this.#jh.set(t,c),this.append(i)}Vn(t){this.#jh.get(t).root.remove(),this.#jh.delete(t)}Un(t,s,i){switch(s){case"toggle":this.#ih(t,i);break;case"order":this.#jh.get(t).root.dataset.order=i}}Yn(t){ct.listReorder(this,t)}#ih(t,s){const i=this.#jh.get(t);i.root.classList.toggle("gsuiEffects-fx-enable",s),i.uiFx.pa(s)}#Eh(){const t=this.#fs.addSelect.value;this.#fs.addSelect.blur(),this.#fs.addSelect.value="",this.#La("addEffect",t)}}Object.freeze(at),customElements.define("gsui-effects",at),Y.Pa("gsui-fx-delay",(()=>[Y.Bn("div",{class:"gsuiFxDelay-param","data-prop":"time"},Y.Bn("gsui-slider",{type:"linear-x",step:.01,min:0,max:2}),Y.Bn("span",{class:"gsuiFxDelay-param-value"})),Y.Bn("div",{class:"gsuiFxDelay-param","data-prop":"gain"},Y.Bn("gsui-slider",{type:"linear-x",step:.01,min:0,max:.95}),Y.Bn("span",{class:"gsuiFxDelay-param-value"})),Y.Bn("div",{class:"gsuiFxDelay-param","data-prop":"pan"},Y.Bn("gsui-slider",{type:"linear-x",step:.01,min:-1,max:1}),Y.Bn("span",{class:"gsuiFxDelay-param-value"})),Y.Bn("div",{class:"gsuiFxDelay-graph"},Y.Bn("div",{class:"gsuiFxDelay-graph-lines"},Y.Bn("gsui-beatlines",{timedivision:"4/4"}),Y.Bn("div",{class:"gsuiFxDelay-graph-line"}),Y.Bn("div",{class:"gsuiFxDelay-graph-source"})),Array.from({length:20},((t,s)=>Y.Bn("div",{class:"gsuiFxDelay-graph-echo"}))))]));class ht extends HTMLElement{#La=Y.Ca.bind(null,this,"gsuiFxDelay");#Qa=this.#Za.bind(this);#Ea=Y.En("gsui-fx-delay");#Wh=0;#fs=Y.Fn(this.#Ea,{beatlines:"gsui-beatlines",sliders:{time:"[data-prop='time'] gsui-slider",gain:"[data-prop='gain'] gsui-slider",pan:"[data-prop='pan'] gsui-slider"},values:{time:"[data-prop='time'] .gsuiFxDelay-param-value",gain:"[data-prop='gain'] .gsuiFxDelay-param-value",pan:"[data-prop='pan'] .gsuiFxDelay-param-value"}});#Fh=this.getElementsByClassName("gsuiFxDelay-graph-echo");constructor(){super(),Object.seal(this),Y.In(this,{gsuiSlider:{inputStart:Y.Sn,inputEnd:Y.Sn,input:(t,s)=>{this.#Ih(s.parentNode.dataset.prop,t.args[0])},change:(t,s)=>{this.#La("changeProp",s.parentNode.dataset.prop,t.args[0])}}})}connectedCallback(){this.#Ea&&(this.append(...this.#Ea),this.#Ea=null,Y.Ia(this,{timedivision:"4/4",time:.25,gain:.7,pan:-.2}),this.#nh(),this.#Kh()),Y.La(this,this.#Qa)}disconnectedCallback(){Y.Ea(this,this.#Qa)}static get observedAttributes(){return["timedivision","time","gain","pan"]}attributeChangedCallback(t,s,i){if(s!==i)switch(t){case"timedivision":Y.Wn(this.#fs.beatlines,"timedivision",i),this.#nh();break;case"time":case"gain":case"pan":this.#fs.sliders[t].setValue(+i),this.#fs.values[t].textContent=(+i).toFixed(2),this.#Kh()}}pa(t){this.classList.toggle("gsuiFxDelay-enable",t)}#Za(){this.#Wh=this.#fs.beatlines.getBoundingClientRect().width,this.#nh()}#nh(){const t=Y.Kn(this,"timedivision").split("/")[0];Y.Wn(this.#fs.beatlines,"pxperbeat",this.#Wh/t)}#Ih(t,s){Y.Wn(this,t,s),this.#La("liveChange",t,s)}#Kh(){const t=Y.ja(this,"time")/4,s=Y.ja(this,"gain"),i=Y.ja(this,"pan");Array.from(this.#Fh).forEach(((e,n)=>{const a=n+1,h=s**a,o=n%2==0?-i:i;e.style.display=h>.01?"block":"none",e.style.opacity=h,e.style.left=a*t*100+"%",e.style.top=100*(o/2+.5)+"%"}))}}Object.freeze(ht),customElements.define("gsui-fx-delay",ht),Y.Pa("gsui-fx-filter",(()=>[Y.Bn("div",{class:"gsuiFxFilter-area gsuiFxFilter-areaType"},Y.Bn("span",{class:"gsuiFxFilter-area-label"},"type"),Y.Bn("div",{class:"gsuiFxFilter-area-content"},Y.En("gsui-fx-filter-type","lowpass","M 1 4 L 12 4 L 15 8"),Y.En("gsui-fx-filter-type","highpass","M 1 8 L 4 4 L 15 4"),Y.En("gsui-fx-filter-type","bandpass","M 1 8 L 8 4 L 15 8"),Y.En("gsui-fx-filter-type","lowshelf","M 1 8 L 4 8 L 6 4 L 15 4"),Y.En("gsui-fx-filter-type","highshelf","M 1 4 L 10 4 L 12 8 L 15 8"),Y.En("gsui-fx-filter-type","peaking","M 1 8 L 7 8 L 8 4 L 9 8 L 15 8"),Y.En("gsui-fx-filter-type","notch","M 1 4 L 7 4 L 8 8 L 9 4 L 15 4"),Y.En("gsui-fx-filter-type","allpass","M 1 6 L 15 6"))),Y.Bn("div",{class:"gsuiFxFilter-area gsuiFxFilter-areaGraph"},Y.Bn("span",{class:"gsuiFxFilter-area-label"},"frequency"),Y.Bn("div",{class:"gsuiFxFilter-area-content"},Y.Bn("gsui-curves"))),Y.Bn("div",{class:"gsuiFxFilter-area gsuiFxFilter-areaFrequency"},Y.Bn("div",{class:"gsuiFxFilter-area-content"},Y.Bn("gsui-slider",{type:"linear-x",min:0,max:1,step:1e-4,"data-prop":"frequency"}))),Y.Bn("div",{class:"gsuiFxFilter-area gsuiFxFilter-areaGain"},Y.Bn("span",{class:"gsuiFxFilter-area-label"},"gain"),Y.Bn("div",{class:"gsuiFxFilter-area-content"},Y.Bn("gsui-slider",{type:"linear-y",min:-50,max:50,step:.1,"mousemove-size":400,"data-prop":"gain"}))),Y.Bn("div",{class:"gsuiFxFilter-area gsuiFxFilter-areaQ"},Y.Bn("span",{class:"gsuiFxFilter-area-label"},"Q"),Y.Bn("div",{class:"gsuiFxFilter-area-content"},Y.Bn("gsui-slider",{type:"circular",min:.001,max:25,step:.001,"mousemove-size":400,"data-prop":"Q"}))),Y.Bn("div",{class:"gsuiFxFilter-area gsuiFxFilter-areaDetune"},Y.Bn("span",{class:"gsuiFxFilter-area-label"},"detune"),Y.Bn("div",{class:"gsuiFxFilter-area-content"},Y.Bn("gsui-slider",{type:"circular",min:-1200,max:1200,step:10,"mousemove-size":400,"data-prop":"detune"})))])),Y.Pa("gsui-fx-filter-type",((t,s)=>Y.Bn("button",{class:"gsuiFxFilter-areaType-btn","data-type":t,title:t},Y.Aa("svg",{viewBox:"0 0 16 12"},Y.Aa("path",{d:s})))));class ot extends HTMLElement{qn=Y.Sn;#ge=24e3;#dh=!1;#zh="lowpass";#Qa=this.#Za.bind(this);#Rh={Q:t=>t,gain:t=>t,detune:t=>t,frequency:t=>this.#ge*2**(11*t-11)};#La=Y.Ca.bind(null,this,"gsuiFxFilter");#Ea=Y.En("gsui-fx-filter");#fs=Y.Fn(this.#Ea,{type:".gsuiFxFilter-areaType .gsuiFxFilter-area-content",graph:".gsuiFxFilter-areaGraph .gsuiFxFilter-area-content",curves:"gsui-curves",sliders:{Q:".gsuiFxFilter-areaQ gsui-slider",gain:".gsuiFxFilter-areaGain gsui-slider",detune:".gsuiFxFilter-areaDetune gsui-slider",frequency:".gsuiFxFilter-areaFrequency gsui-slider"}});static typeGainQ=Object.freeze({lowpass:Object.freeze({gain:!1,q:!0}),highpass:Object.freeze({gain:!1,q:!0}),bandpass:Object.freeze({gain:!1,q:!0}),lowshelf:Object.freeze({gain:!0,q:!1}),highshelf:Object.freeze({gain:!0,q:!1}),peaking:Object.freeze({gain:!0,q:!0}),notch:Object.freeze({gain:!1,q:!0}),allpass:Object.freeze({gain:!1,q:!0})});constructor(){super(),Object.seal(this),this.#fs.type.onclick=this.#Nh.bind(this),Y.In(this,{gsuiSlider:{inputStart:Y.Sn,inputEnd:Y.Sn,input:(t,s)=>{this.#Ih(s.dataset.prop,this.#Rh[s.dataset.prop](t.args[0]))},change:(t,s)=>{this.#La("changeProp",s.dataset.prop,this.#Rh[s.dataset.prop](t.args[0]))}}}),this.#fs.graph.append(this.#fs.curves)}connectedCallback(){this.#dh=!0,this.#Ea&&(this.append(...this.#Ea),this.#Ea=null,this.#Za(),this.Qn()),Y.La(this,this.#Qa)}disconnectedCallback(){this.#dh=!1,Y.Ea(this,this.#Qa)}static get observedAttributes(){return["type","frequency","q","gain","detune"]}attributeChangedCallback(t,s,i){if(s!==i)switch(t){case"type":{const t=ot.typeGainQ[i];this.#Gh(this.#zh,!1),this.#Gh(i,!0),this.#zh=i,Y.Wn(this.#fs.sliders.Q,"disabled",!t.q),Y.Wn(this.#fs.sliders.gain,"disabled",!t.gain)}break;case"q":this.#fs.sliders.Q.setValue(+i);break;case"gain":case"detune":this.#fs.sliders[t].setValue(+i);break;case"frequency":this.#fs.sliders.frequency.setValue((Math.log2(i/this.#ge)+11)/11)}}pa(t){this.classList.toggle("gsuiFxFilter-enable",t),setTimeout((()=>this.Qn()),150)}Qn(){if(this.#dh){const t=this.qn("curve",this.#fs.curves.getWidth());t&&this.#fs.curves.setCurve("0",t)}}#Gh(t,s){this.#fs.type.querySelector(`[data-type="${t}"]`).classList.toggle("gsuiFxFilter-areaType-btnSelected",s)}#Za(){this.#fs.curves.resized()}#Ih(t,s){this.#La("liveChange",t,s),this.Qn()}#Nh(t){const s=t.target.dataset.type;s&&!t.target.classList.contains("gsuiFxFilter-areaType-btnSelected")&&this.#La("changeProp","type",s)}}Object.freeze(ot),customElements.define("gsui-fx-filter",ot),Y.Pa("gsui-mixer",(()=>Y.Bn("gsui-panel",{},Y.Bn("div",{class:"gsuiMixer-channels"},Y.Bn("div",{class:"gsuiMixer-head",inert:!0},Y.Bn("i",{class:"gsuiMixer-head-icon gsuiIcon","data-icon":"channels"}),Y.Bn("span",{class:"gsuiMixer-head-title"},"channels")),Y.Bn("gsui-channels")),Y.Bn("div",{class:"gsuiMixer-effects"},Y.Bn("div",{class:"gsuiMixer-head",inert:!0},Y.Bn("i",{class:"gsuiMixer-head-icon gsuiIcon","data-icon":"effects"}),Y.Bn("span",{class:"gsuiMixer-head-title"},"effects")),Y.Bn("gsui-effects")))));class rt extends HTMLElement{#Ea=Y.En("gsui-mixer");#fs=Y.Fn(this.#Ea,{channels:"gsui-channels",effects:"gsui-effects"});constructor(){super(),Object.seal(this)}connectedCallback(){this.firstChild||(this.append(this.#Ea),this.#Ea=null,new xt({scrolledElem:this.querySelector(".gsuiChannels-panChannels"),leftShadow:this.querySelector(".gsuiChannels-panMain"),rightShadow:this.querySelector(".gsuiMixer-effects")}),new xt({scrolledElem:this.#fs.effects,topShadow:this.querySelector(".gsuiMixer-effects .gsuiMixer-head")}))}getChannels(){return this.#fs.channels}getEffects(){return this.#fs.effects}}Object.freeze(rt),customElements.define("gsui-mixer",rt);class ct{constructor(t={}){const s=t.rootElement;this.rootElement=s,this._dirRow="column"!==t.direction,this._onchange=t.onchange??(()=>console.warn("gsuiReorder: no onchange set")),this._dataTransfer=t.dataTransfer??(()=>""),this._dataTransferType=t.dataTransferType??"text",this._itemSelector=t.itemSelector??"",this._handleSelector=t.handleSelector??"",this._parentSelector=t.parentSelector??"",this._preventDefault=t.preventDefault??!0,this._elClicked=this._elDragged=this._elDragover=this._itemDragover=this._parentDragover=this._elShadowParent=this._elShadowDragged=this._elDraggedParent=null,this._shadowClass="",this._indDragged=0,this._droppedInside=!1,this._ondrop=this._ondrop.bind(this),this._dragoverTime=0,Object.seal(this),s.addEventListener("mousedown",this._onmousedown.bind(this),{passive:!0}),s.addEventListener("dragstart",this._ondragstart.bind(this),{passive:!1}),s.addEventListener("dragover",this._ondragover.bind(this),{passive:!0}),s.addEventListener("dragend",this._ondragend.bind(this),{passive:!0})}setShadowElement(t){this._elShadowParent=t}setShadowChildClass(t){this._shadowClass=`.${t}`}_getIndex(t){return Array.prototype.indexOf.call(t.parentNode.children,t)}_getShadowChild(t){return this._elShadowParent.querySelector(`${this._shadowClass}[data-id="${t}"]`)}_onmousedown(t){this._elClicked=t.target}_ondragstart(t){if(this._elClicked&&this._elClicked.matches(this._handleSelector)){const s=t.target,i=s.dataset.id;document.addEventListener("drop",this._ondrop),this._elClicked=null,this._elDragged=s,this._elDraggedParent=s.parentNode,this._elShadowParent&&(this._elShadowDragged=this._getShadowChild(i)),this._indDragged=this._getIndex(s),t.dataTransfer.effectAllowed="move",t.dataTransfer.setData(this._dataTransferType,this._dataTransfer(s)),setTimeout((()=>{this._elDragged.classList.add("gsuiReorder-dragging"),this._elShadowDragged&&this._elShadowDragged.classList.add("gsuiReorder-dragging")}),20)}else this._preventDefault&&t.preventDefault()}_ondragover(t){const s=Date.now();if(this._elDragged&&s-this._dragoverTime>60){const i=t.target,e=this._elDragged,n=i===this._elDragover?this._itemDragover:i.closest(`${this._parentSelector} ${this._itemSelector}`);if(this._dragoverTime=s,n){const s=n.getBoundingClientRect();this._dirRow&&t.clientX<s.left+s.width/2||!this._dirRow&&t.clientY<s.top+s.height/2?n.previousElementSibling!==e&&(n.before(e),this._elShadowDragged&&this._getShadowChild(n.dataset.id).before(this._elShadowDragged)):n.nextElementSibling!==e&&(n.after(e),this._elShadowDragged&&this._getShadowChild(n.dataset.id).after(this._elShadowDragged))}else{const t=i===this._elDragover?this._parentDragover:i.closest(this._parentSelector);this._parentDragover=t,t&&t.lastElementChild!==e&&(t.append(e),this._elShadowDragged&&this._elShadowParent.append(this._elShadowDragged))}this._elDragover=i,this._itemDragover=n}}_ondrop(t){this._droppedInside=this._elDragged&&t.target.closest(this._parentSelector)}_ondragend(){if(this._elDragged){const t=this._elDragged,s=this._indDragged,i=this._elDraggedParent;if(this._elDragged=this._elDragover=this._itemDragover=null,t.classList.remove("gsuiReorder-dragging"),this._elShadowDragged&&this._elShadowDragged.classList.remove("gsuiReorder-dragging"),document.removeEventListener("drop",this._ondrop),this._droppedInside){const e=this._getIndex(t);this._droppedInside=!1,e===s&&t.parentNode===i||this._onchange(t,s,e,i,t.parentNode)}else t.remove(),0===s?i.prepend(t):i.children[s-1].after(t)}}}ct.listReorder=(t,s)=>{if(!s||Object.values(s).some((t=>t&&"order"in t))){const s=Array.prototype.filter.call(t.children,(t=>"order"in t.dataset)).sort(((t,s)=>t.dataset.order-s.dataset.order));t.append(...s)}},ct.listComputeOrderChange=(t,s)=>{let i=0;return Array.prototype.forEach.call(t.children,(t=>{const e=t.dataset;if("id"in e&&"order"in e){if(+e.order!==i){const t=s[e.id];t?t.order=i:e.id in s||(s[e.id]={order:i})}++i}})),s},Y.Pa("gsui-dragline",(()=>Y.Bn("div",{class:"gsuiDragline"},Y.Bn("div",{class:"gsuiDragline-main"},Y.Aa("svg",{class:"gsuiDragline-line"},Y.Aa("polyline")),Y.Bn("div",{class:"gsuiDragline-to"})))));class lt{onchange=Y.Sn;rootElement=Y.En("gsui-dragline");getDropAreas=null;#Hh=null;#Vh=null;#Uh=null;#qh=null;#_h=null;#fs=Y.Fn(this.rootElement,{main:".gsuiDragline-main",svg:".gsuiDragline-line",polyline:".gsuiDragline-line polyline",to:".gsuiDragline-to"});constructor(){Object.seal(this),this.#fs.to.onmousedown=this.#Yh.bind(this)}linkTo(t){const s=t||null;s!==this.#Hh&&(this.#Hh=s,this.rootElement.classList.toggle("gsuiDragline-linked",!!s),s?this.redraw():this.#Jh())}redraw(){if(this.#Hh){const t=this.#Hh.getBoundingClientRect();this.#Xh(t.left,t.top)}}#Xh(t,s){const i=this.#fs.main.classList,e=this.#fs.main.style,n=this.#fs.svg.style,a=this.rootElement.getBoundingClientRect(),h=t-a.left,o=s-a.top,r=Math.abs(h),c=Math.abs(o),l=Math.max(r,c),u=2*l;i.toggle("gsuiDragline-down",o>0),i.toggle("gsuiDragline-right",h>0),e.top=`${Math.min(o,0)}px`,e.left=`${Math.min(h,0)}px`,e.width=`${r}px`,e.height=`${c}px`,n.width=n.height=`${u}px`,n.margin=-l+"px",Y.Wn(this.#fs.svg,"viewBox",`0 0 ${u} ${u}`),Y.Wn(this.#fs.polyline,"points",`${l},${l} ${l+h},${l+o}`)}#Jh(){const t=this.#fs.main.style,s=this.#fs.svg.style;t.top=t.left=t.width=t.height=s.width=s.height=s.margin="0px"}#Qh(){this.#Zh(),this.#Hh?this.redraw():this.#Jh()}#Zh(){this.rootElement.classList.remove("gsuiDragline-dragging"),this.#Vh.forEach((t=>{t.classList.remove("gsuiDragline-dropActive"),delete t.onmouseup})),document.removeEventListener("mousemove",this.#_h),document.removeEventListener("mouseup",this.#qh),document.removeEventListener("keydown",this.#Uh)}#Yh(t){0===t.button&&(this.#Vh=this.getDropAreas(),this.#Vh.forEach((t=>{t.onmouseup=this.#to.bind(this),t.classList.add("gsuiDragline-dropActive")})),this.rootElement.classList.add("gsuiDragline-dragging"),this.#_h=this.#so.bind(this),this.#qh=this.#io.bind(this),this.#Uh=this.#Bs.bind(this),document.addEventListener("mousemove",this.#_h),document.addEventListener("mouseup",this.#qh),document.addEventListener("keydown",this.#Uh),this.#so(t))}#Bs(t){"Escape"===t.key&&this.#Qh()}#to(t){const s=t.currentTarget;return s!==this.#Hh&&(this.onchange(s,this.#Hh),this.#Hh=s),this.#Zh(),this.redraw(),!1}#io(){this.#Hh&&(this.onchange(null,this.#Hh),this.#Hh=null),this.#Qh()}#so(t){this.#Xh(t.pageX,t.pageY)}}Y.Pa("gsui-beatlines",(()=>[Y.Bn("div",{class:"gsuiBeatlines-bg gsuiBeatlines-measures"}),Y.Bn("div",{class:"gsuiBeatlines-bg gsuiBeatlines-beats"}),Y.Bn("div",{class:"gsuiBeatlines-bg gsuiBeatlines-steps"}),Y.Bn("div",{class:"gsuiBeatlines-bg gsuiBeatlines-beatsBG"})]));class ut extends HTMLElement{connectedCallback(){this.firstChild||(this.append(...Y.En("gsui-beatlines")),Y.Ia(this,{timedivision:"4/4",coloredbeats:!0,pxperbeat:10}))}static get observedAttributes(){return["timedivision","pxperbeat"]}attributeChangedCallback(t,s,i){if(s!==i)switch(t){case"timedivision":this.style.setProperty("--gsui-bPM",`${i.split("/")[0]}em`),this.style.setProperty("--gsui-sPB",1/i.split("/")[1]+"em");break;case"pxperbeat":this.style.fontSize=`${i}px`,this.style.opacity=Math.min(i/48,1)}}}Object.freeze(ut),customElements.define("gsui-beatlines",ut);class dt{static#eo=Object.freeze({move:dt.#no,cropA:dt.#ao,cropB:dt.#ho});static#oo=Object.freeze({crop:dt.#ro,move:dt.#co,deletion:dt.#lo,selection1:dt.#uo,selection2:dt.#do});static#po=Object.freeze({moving:dt.#go,deleting:dt.#mo,"cropping-a":dt.#bo,"cropping-b":dt.#wo,"selecting-1":dt.#fo,"selecting-2":dt.#vo});rootElement=null;timeline=null;#_i=null;#yo=null;#ko=10;#$o=10;#Oo=null;#xo=new Map;#So=new Map;#Do=new Map;#Co=null;#Po=null;#Mo="";#Ao=null;#To=null;#Bo=null;#jo=0;#Lo=0;#Eo=0;#Wo=0;#Fo=0;#Io=0;#Ko=0;#zo=0;#Ro=null;#No=null;#Go=1/0;#Ho=1/0;#Vo=-1/0;#Uo=-1/0;#qo=this.#so.bind(this);#_o=this.#io.bind(this);constructor(t){Object.seal(this),this.rootElement=t.rootElement,this.timeline=t.timeline,this.#yo=t,this.#yo.oneditBlock=t.oneditBlock||Y.Sn,this.#Oo=t.blockDOMChange,this.#Co=t.selectionElement,this.#Po=t.rootElement.getElementsByClassName("gsui-row"),t.rootElement.onkeydown=this.#Bs.bind(this)}getOpts(){return this.#yo}setData(t){this.#_i=t}setFontSize(t){this.#ko=t}setPxPerBeat(t){this.#$o=t}getFontSize(){return this.#ko}getPxPerBeat(){return this.#$o}getRows(){return this.#Po}getBlocks(){return this.#xo}getSelectedBlocks(){return this.#Do}#Yo(){return this.#Po[0].getBoundingClientRect()}getRowByIndex(t){return this.#Po[t]}getRowIndexByRow(t){return Array.prototype.indexOf.call(this.#Po,t)}getRowIndexByPageY(t){const s=Math.floor((t-this.#Yo().top)/this.#ko);return Math.max(0,Math.min(s,this.#Po.length-1))}getWhenByPageX(t){return Math.max(0,(t-this.#Yo().left)/this.#$o)}roundBeat(t){return Math.max(0,this.timeline.beatFloor(t))}#Jo(t){return t.classList.contains("gsuiBlocksManager-block")}#Xo(t){return this.#Jo(t)?t:this.#Jo(t.parentNode)?t.parentNode:this.#Jo(t.parentNode.parentNode)?t.parentNode.parentNode:void 0}#Qo(t){return t.classList.contains("gsuiBlocksManager-block-selected")?this.#Do.forEach(((t,s)=>this.#So.set(s,t))):this.#So.set(t.dataset.id,t),this.#So}#Zo(){return 1/this.timeline.stepsPerBeat*Y.ja(this.timeline,"step")}#Bs(t){const s=this.#So;switch(t.key){case"Delete":case"Backspace":this.#Do.size&&(this.#Do.forEach(((t,i)=>s.set(i,t))),this.#Mo="deleting",this.#io());break;case"b":if(t.ctrlKey||t.altKey){if(this.#Do.size){let t=1/0,i=0;s.clear(),this.#Do.forEach(((e,n)=>{const a=this.#_i[n];t=Math.min(t,a.when),i=Math.max(i,a.when+a.duration),s.set(n,e)})),i=this.timeline.beatCeil(i)-t,this.#yo.managercallDuplicating(s,i),s.clear()}t.preventDefault(),t.stopPropagation()}break;case"a":case"d":if(t.ctrlKey||t.altKey){if("d"===t.key)this.#Do.size>0&&this.#yo.managercallUnselecting();else if(this.#xo.size>this.#Do.size){const t=[];this.#xo.forEach(((s,i)=>{this.#_i[i].selected||t.push(i)})),this.#yo.managercallSelecting(t)}t.preventDefault(),t.stopPropagation()}}}onmousedown(t){const s=this.#Xo(t.currentTarget);if(Y.Fa(),this.#To=s,this.#Bo=t.target,2===t.button)this.#Ao=dt.#oo.deletion,this.#Mo="deleting",s&&(this.#Oo(s,"deleted",!0),this.#So.set(s.dataset.id,s));else if(0===t.button){const i=this.getWhenByPageX(t.pageX);if(this.#jo=t.pageX,this.#Lo=t.pageY,this.#Eo=this.roundBeat(i),this.#zo=this.#Zo(),t.shiftKey)this.#Ao=dt.#oo.selection1,this.#Mo="selecting-1",this.#Wo=this.getRowIndexByPageY(t.pageY);else if(s){const i=dt.#eo[t.target.dataset.action];if(i){const e=this.#Qo(s);s.classList.add("gsui-hover"),t.target.classList.add("gsui-hover"),i.call(this,this.#_i,e,s,t)}}}document.addEventListener("mousemove",this.#qo),document.addEventListener("mouseup",this.#_o)}static#no(t,s,i,e){this.#Ao=dt.#oo.move,this.#Mo="moving",this.#Wo=this.getRowIndexByPageY(e.pageY),s.forEach(((s,i)=>{const e=this.getRowIndexByRow(s.parentNode.parentNode);this.#Go=Math.min(this.#Go,t[i].when),this.#Ho=Math.min(this.#Ho,e),this.#Uo=Math.max(this.#Uo,e)})),this.#Go*=-1,this.#Ho*=-1,this.#Uo=this.#Po.length-1-this.#Uo}static#ao(t,s){this.#Ao=dt.#oo.crop,this.#Mo="cropping-a",this.#Go=this.#Vo=1/0,s.forEach(((s,i)=>{const e=t[i];this.#Go=Math.min(this.#Go,e.offset),this.#Vo=Math.min(this.#Vo,e.duration)})),this.#Go*=-1,this.#Vo=Math.max(0,this.#Vo-this.#zo)}static#ho(t,s){this.#Ao=dt.#oo.crop,this.#Mo="cropping-b",this.#Go=this.#Vo=1/0,s.forEach(((s,i)=>{this.#Go=Math.min(this.#Go,t[i].duration)})),this.#Go=-Math.max(0,this.#Go-this.#zo)}#so(t){if(this.#Ao){"mousemove"===t.type&&(this.#Fo=t.pageX,this.#Io=t.pageY);const s=this.getWhenByPageX(this.#Fo);this.#Ko=this.roundBeat(s),this.#Ao(t)}}static#ro(){const t="cropping-b"===this.#Mo,s=this.#zo*Math.round((this.#Ko-this.#Eo)/this.#zo),i=Math.max(this.#Go,Math.min(s,this.#Vo));i!==this.#Ro&&(this.#Ro=i,this.#So.forEach(((s,e)=>{const n={...this.#_i[e]};t?n.duration+=i:(n.when+=i,n.offset+=i,n.duration-=i,this.#Oo(s,"when",n.when)),this.#Oo(s,"duration",n.duration),this.#yo.oneditBlock(e,n,s)})))}static#co(){const t=Math.max(this.#Go,Math.round((this.#Ko-this.#Eo)/this.#zo)*this.#zo),s=Math.max(this.#Ho,Math.min(this.#Uo,this.getRowIndexByPageY(this.#Io)-this.#Wo));t!==this.#Ro&&(this.#Ro=t,this.#So.forEach(((s,i)=>this.#Oo(s,"when",this.#_i[i].when+t)))),s!==this.#No&&(this.#No=s,this.#So.forEach((t=>this.#Oo(t,"row",s))))}static#lo(t){const s=this.#Xo(t.target);s&&!this.#So.has(s.dataset.id)&&(this.#Oo(s,"deleted",!0),this.#So.set(s.dataset.id,s))}static#uo(){(Math.abs(this.#Fo-this.#jo)>6||Math.abs(this.#Io-this.#Lo)>6)&&(this.#Mo="selecting-2",this.#Co.classList.remove("gsuiBlocksManager-selection-hidden"),this.#Ao=dt.#oo.selection2,this.#Ao())}static#do(){const t=this.#ko,s=this.#Co.style,i=this.getRowIndexByPageY(this.#Io),e=Math.min(this.#Eo,this.#Ko),n=this.#Zo()+Math.abs(this.#Eo-this.#Ko),a=Math.min(this.#Wo,i),h=Math.max(this.#Wo,i),o=this.getRowByIndex(a),r=this.getRowByIndex(h),c=Object.entries(this.#_i).reduce(((t,[s,i])=>{if(!this.#Do.has(s)&&i.when<e+n&&i.when+i.duration>e){const i=this.#xo.get(s),e=o.compareDocumentPosition(i),n=r.compareDocumentPosition(i);(e&Node.DOCUMENT_POSITION_CONTAINED_BY||n&Node.DOCUMENT_POSITION_CONTAINED_BY||e&Node.DOCUMENT_POSITION_FOLLOWING&&n&Node.DOCUMENT_POSITION_PRECEDING)&&(this.#Oo(i,"selected",!0),t.set(s,i))}return t}),new Map);s.top=a*t+"px",s.left=e*this.#$o+"px",s.width=n*this.#$o+"px",s.height=(h-a+1)*t+"px",this.#So.forEach(((t,s)=>this.#Oo(t,"selected",c.has(s)))),this.#So=c}#io(){this.#Mo&&dt.#po[this.#Mo].call(this,this.#So,this.#To),this.#To&&(this.#To.classList.remove("gsui-hover"),this.#Bo.classList.remove("gsui-hover")),this.#Mo="",this.#Ao=this.#To=this.#Bo=null,this.#Ro=this.#No=null,this.#Go=this.#Ho=1/0,this.#Vo=this.#Uo=-1/0,this.#So.clear(),document.removeEventListener("mousemove",this.#qo),document.removeEventListener("mouseup",this.#_o)}static#go(t){(this.#No||Math.abs(this.#Ro)>1e-6)&&this.#yo.managercallMoving(t,this.#Ro,this.#No)}static#mo(t){(t.size||this.#Do.size)&&this.#yo.managercallDeleting(t)}static#bo(t){Math.abs(this.#Ro)>1e-6&&this.#yo.managercallCroppingA(t,this.#Ro)}static#wo(t){Math.abs(this.#Ro)>1e-6&&this.#yo.managercallCroppingB(t,this.#Ro)}static#fo(t,s){s&&(s.classList.contains("gsuiBlocksManager-block-selected")?this.#yo.managercallUnselectingOne(s.dataset.id):this.#yo.managercallSelecting([s.dataset.id]))}static#vo(t){this.#Co.classList.add("gsuiBlocksManager-selection-hidden"),t.size&&this.#yo.managercallSelecting(Array.from(t.keys()))}}Object.freeze(dt),Y.Pa("gsui-patternroll-block",(()=>Y.Bn("div",{class:"gsuiBlocksManager-block gsuiPatternroll-block","data-action":"move"},Y.Bn("div",{class:"gsuiBlocksManager-block-crop gsuiBlocksManager-block-cropA","data-action":"cropA"}),Y.Bn("div",{class:"gsuiBlocksManager-block-crop gsuiBlocksManager-block-cropB","data-action":"cropB"}),Y.Bn("div",{class:"gsuiPatternroll-block-header"},Y.Bn("span",{class:"gsuiPatternroll-block-name"})),Y.Bn("div",{class:"gsuiPatternroll-block-content"}),Y.Bn("div",{class:"gsuiPatternroll-block-placeholder"},Y.Bn("i",{class:"gsuiPatternroll-block-placeholderIcon gsuiIcon","data-icon":"file-corrupt"}),Y.Bn("span",{class:"gsuiPatternroll-block-placeholderText"},"missing data")))));class pt extends HTMLElement{#tr=new Map;#sr=Y.Bn("gsui-tracklist");#ir=Y.Bn("div",{class:"gsuiBlocksManager-selection gsuiBlocksManager-selection-hidden"});#er=Y.Bn("gsui-timewindow",{panelsize:90,panelsizemin:24,panelsizemax:160,lineheight:40,lineheightmin:20,lineheightmax:68,pxperbeat:32,pxperbeatmin:8,pxperbeatmax:160});#nr=new dt({rootElement:this,selectionElement:this.#ir,timeline:this.#er.timeline,blockDOMChange:this.#Oo.bind(this),managercallMoving:(t,s,i)=>this.onchange("move",Array.from(t.keys()),s,i),managercallDeleting:t=>this.onchange("deletion",Array.from(t.keys())),managercallSelecting:t=>this.onchange("selection",t),managercallUnselecting:()=>this.onchange("unselection"),managercallUnselectingOne:t=>this.onchange("unselectionOne",t),managercallDuplicating:(t,s)=>this.onchange("duplicate",s),managercallCroppingA:(t,s)=>this.onchange("cropStart",Array.from(t.keys()),s),managercallCroppingB:(t,s)=>this.onchange("cropEnd",Array.from(t.keys()),s)});constructor(){super(),this.timeline=this.#er.timeline,this.onchange=this.onaddBlock=this.oneditBlock=null,Object.seal(this),Y.In(this,{gsuiTimewindow:{pxperbeat:t=>this.#ar(t.args[0]),lineheight:t=>this.#hr(t.args[0])}}),this.#ar(32),this.#hr(40)}connectedCallback(){this.firstChild||(this.classList.add("gsuiBlocksManager"),Y.Wn(this,"tabindex",-1),this.append(this.#er),this.#er.querySelector(".gsuiTimewindow-panelContent").append(this.#sr),this.#er.querySelector(".gsuiTimewindow-mainContent").append(this.#ir),this.#er.querySelector(".gsuiTimewindow-rows").ondrop=this.#or.bind(this),this.#er.querySelector("gsui-beatlines").removeAttribute("coloredbeats"))}static get observedAttributes(){return["currenttime"]}attributeChangedCallback(t,s,i){if(s!==i&&"currenttime"===t)Y.Wn(this.#er,"currenttime",i)}addTrack(t){const s=this.#sr.addTrack(t).rowElement;s.classList.toggle("gsui-row-small",this.#nr.getFontSize()<=44),s.onmousedown=this.#rr.bind(this),this.#tr.set(s.dataset.id,s),this.#er.querySelector(".gsuiTimewindow-rows").append(s)}removeTrack(t){this.#sr.removeTrack(t)}toggleTrack(t,s){Y.Wn(this.#sr.getTrack(t),"mute",!s)}renameTrack(t,s){Y.Wn(this.#sr.getTrack(t),"name",s)}reorderTrack(t,s){Y.Wn(this.#sr.getTrack(t),"order",s)}addBlock(t,s,{dataReady:i}){const e=Y.En("gsui-patternroll-block");e.dataset.id=t,e.dataset.pattern=s.pattern,e.onmousedown=this.#cr.bind(this,t),Y.Wn(e,"data-missing",!i),this.#nr.getBlocks().set(t,e),this.onaddBlock(t,s,e)}removeBlock(t){this.#nr.getBlocks().get(t).remove(),this.#nr.getBlocks().delete(t),this.#nr.getSelectedBlocks().delete(t)}changeBlockProp(t,s,i){const e=this.#nr.getBlocks().get(t);this.#Oo(e,s,i),"track"===s?e.dataset.track=i:"selected"===s&&(i?this.#nr.getSelectedBlocks().set(t,e):this.#nr.getSelectedBlocks().delete(t))}updateBlockViewBox(t,s){this.oneditBlock(t,s,this.#nr.getBlocks().get(t))}setData(t){this.#nr.setData(t)}setCallbacks(t){this.onchange=t.onchange,this.onaddBlock=t.onaddBlock,this.oneditBlock=t.oneditBlock,this.#nr.getOpts().oneditBlock=t.oneditBlock}getBlocks(){return this.#nr.getBlocks()}timedivision(t){Y.Wn(this.#er,"timedivision",t)}loop(t,s){Y.Wn(this.#er,"loop",Number.isFinite(t)&&`${t}-${s}`)}#Oo(t,s,i){switch(s){case"when":t.style.left=`${i}em`;break;case"duration":t.style.width=`${i}em`;break;case"deleted":t.classList.toggle("gsuiBlocksManager-block-hidden",!!i);break;case"selected":t.classList.toggle("gsuiBlocksManager-block-selected",!!i);break;case"row":this.#Oo(t,"track",this.#lr(t.dataset.track,i));break;case"track":{const s=this.#ur(i);s&&s.firstElementChild.append(t)}}}#ur(t){return this.#tr.get(t)}#lr(t,s){const i=this.#ur(t),e=this.#nr.getRowIndexByRow(i)+s;return this.#nr.getRowByIndex(e).dataset.id}#ar(t){this.#nr.setPxPerBeat(t)}#hr(t){this.#nr.setFontSize(t),Array.from(this.#nr.getRows()).forEach((s=>s.classList.toggle("gsui-row-small",t<=44)))}#rr(t){this.#nr.onmousedown(t),0===t.button&&!t.shiftKey&&this.#nr.getSelectedBlocks().size&&this.onchange("unselection")}#cr(t,s){s.stopPropagation(),this.#nr.onmousedown(s)}#or(t){const s=t.dataTransfer.getData("pattern-buffer")||t.dataTransfer.getData("pattern-slices")||t.dataTransfer.getData("pattern-drums")||t.dataTransfer.getData("pattern-keys");if(s){const i=this.#nr.roundBeat(this.#nr.getWhenByPageX(t.pageX)),e=this.#nr.getRowByIndex(this.#nr.getRowIndexByPageY(t.pageY)).dataset.id;this.onchange("add",s,i,e)}}}Object.freeze(pt),customElements.define("gsui-patternroll",pt),Y.Pa("gsui-pianoroll-block",(()=>Y.Bn("div",{class:"gsuiBlocksManager-block gsuiPianoroll-block","data-action":"move"},Y.Bn("div",{class:"gsuiDragline-drop"}),Y.Bn("div",{class:"gsuiBlocksManager-block-crop gsuiBlocksManager-block-cropB","data-action":"cropB"}))));class gt extends HTMLElement{#dr={};#pr=1;#gr=Y.Bn("gsui-slidergroup",{beatlines:""});#ir=Y.Bn("div",{class:"gsuiBlocksManager-selection gsuiBlocksManager-selection-hidden"});#mr=Y.Bn("select",{class:"gsuiPianoroll-slidersSelect",size:6},Y.Bn("option",{value:"gain",selected:""},"gain"),Y.Bn("option",{value:"pan"},"pan"),Y.Bn("option",{value:"lowpass"},"lowpass"),Y.Bn("option",{value:"highpass"},"highpass"),Y.Bn("option",{value:"gainLFOSpeed"},"gain.lfo.speed"),Y.Bn("option",{value:"gainLFOAmp"},"gain.lfo.amp"));#er=Y.Bn("gsui-timewindow",{panelsize:100,panelsizemin:100,panelsizemax:130,lineheight:20,lineheightmin:12,lineheightmax:32,pxperbeat:64,pxperbeatmin:20,pxperbeatmax:200,downpanel:"",downpanelsize:120,downpanelsizemin:120,downpanelsizemax:160});#nr=new dt({rootElement:this,selectionElement:this.#ir,timeline:this.#er.timeline,blockDOMChange:this.#Oo.bind(this),managercallDuplicating:(t,s)=>this.onchange("clone",Array.from(t.keys()),s),managercallSelecting:t=>this.onchange("selection",t),managercallUnselecting:()=>this.onchange("unselection"),managercallUnselectingOne:t=>this.onchange("unselectionOne",t),managercallMoving:(t,s,i)=>this.onchange("move",Array.from(t.keys()),s,i),managercallCroppingB:(t,s)=>this.onchange("cropEnd",Array.from(t.keys()),s),managercallDeleting:t=>this.onchange("remove",Array.from(t.keys()))});constructor(){super(),this.timeline=this.#er.timeline,this.uiKeys=Y.Bn("gsui-keys"),this.onchange=null,Object.seal(this),Y.In(this,{gsuiTimewindow:{pxperbeat:t=>this.#ar(t.args[0]),lineheight:t=>this.#hr(t.args[0])},gsuiTimeline:{inputLoop:t=>this.#br(!1,...t.args),changeLoop:t=>this.#br(!0,...t.args),changeCurrentTime:t=>this.#wr(t.args[0])},gsuiSliderGroup:{input:t=>this.#fr(t.args[1]),inputEnd:()=>this.#vr(),change:t=>this.#yr(t)}}),this.#mr.onchange=this.#kr.bind(this),this.#ar(64),this.#hr(20),this.#kr(),this.reset()}connectedCallback(){this.firstChild||(this.classList.add("gsuiBlocksManager"),Y.Wn(this,"tabindex",-1),this.append(this.#er),this.#er.querySelector(".gsuiTimewindow-panelContent").append(this.uiKeys),this.#er.querySelector(".gsuiTimewindow-panelContentDown").prepend(this.#mr),this.#er.querySelector(".gsuiTimewindow-contentDown").prepend(this.#gr),this.#er.querySelector(".gsuiTimewindow-mainContent").append(this.#ir),this.scrollToMiddle())}static get observedAttributes(){return["disabled","currenttime"]}attributeChangedCallback(t,s,i){if(s!==i)switch(t){case"disabled":Y.Wn(this.#er,"disabled",i);break;case"currenttime":Y.Wn(this.#er,"currenttime",i),Y.Wn(this.#gr,"currenttime",i)}}reset(){this.#pr=1}setData(t){this.#nr.setData(t)}setCallbacks(t){this.onchange=t.onchange}timedivision(t){Y.Wn(this.#er,"timedivision",t),Y.Wn(this.#gr,"timedivision",t)}loop(t,s){Y.Wn(this.#er,"loop",Number.isFinite(t)&&`${t}-${s}`),Y.Wn(this.#gr,"loopa",t),Y.Wn(this.#gr,"loopb",s)}scrollToMiddle(){this.#er.scrollTop=this.#er.querySelector(".gsuiTimewindow-rows").clientHeight/2}scrollToKeys(){const t=this.#er.querySelector(".gsuiBlocksManager-block");if(t){const s=+t.dataset.keyNote,i=+this.#er.querySelector(".gsui-row").dataset.midi;this.#er.scrollTop=(i-s-3.5)*Y.ja(this.#er,"lineheight")}}octaves(t,s){const i=this.uiKeys.octaves(t,s);Object.keys(this.#dr).forEach((t=>delete this.#dr[t])),i.forEach((t=>{const s=+t.dataset.midi;t.onmousedown=this.#rr.bind(this,s),this.#dr[s]=t})),this.#er.querySelector(".gsuiTimewindow-rows").append(...i),this.#er.querySelector(".gsuiTimewindow-rows").style.height=`${i.length}em`,this.scrollToMiddle(),this.reset()}addKey(t,s){const i=Y.En("gsui-pianoroll-block"),e=new lt;i.dataset.id=t,i.onmousedown=this.#cr.bind(this,t),e.onchange=this.#$r.bind(this,t),i._dragline=e,i._draglineDrop=i.querySelector(".gsuiDragline-drop"),i.append(e.rootElement),e.getDropAreas=this.#Or.bind(this,t),this.#nr.getBlocks().set(t,i),s.selected?this.#nr.getSelectedBlocks().set(t,i):this.#nr.getSelectedBlocks().delete(t),this.#gr.set(t,s.when,s.duration,s[this.#mr.value]),this.#Oo(i,"key",s.key),this.#Oo(i,"when",s.when),this.#Oo(i,"duration",s.duration),this.#Oo(i,"selected",s.selected),this.#Oo(i,"pan",s.pan),this.#Oo(i,"gain",s.gain),this.#Oo(i,"lowpass",s.lowpass),this.#Oo(i,"highpass",s.highpass),this.#Oo(i,"gainLFOSpeed",s.gainLFOSpeed),this.#Oo(i,"gainLFOAmp",s.gainLFOAmp),this.#Oo(i,"prev",s.prev),this.#Oo(i,"next",s.next)}removeKey(t){const s=this.#nr.getBlocks().get(t),i=this.#nr.getBlocks().get(s.dataset.prev);s.remove(),i&&i._dragline.linkTo(null),this.#nr.getBlocks().delete(t),this.#nr.getSelectedBlocks().delete(t),this.#gr.delete(t)}changeKeyProp(t,s,i){const e=this.#nr.getBlocks().get(t);this.#Oo(e,s,i),null===i?delete e.dataset[s]:e.dataset["key"===s?"keyNote":s]=i,"selected"===s&&(i?this.#nr.getSelectedBlocks().set(t,e):this.#nr.getSelectedBlocks().delete(t))}#Oo(t,s,i){switch(s){case"when":t.style.left=`${i}em`,this.#gr.setProp(t.dataset.id,"when",i),this.#xr(t);break;case"duration":t.style.width=`${i}em`,this.#gr.setProp(t.dataset.id,"duration",i),this.#pr=i,this.#xr(t);break;case"deleted":t.classList.toggle("gsuiBlocksManager-block-hidden",!!i);break;case"selected":t.classList.toggle("gsuiBlocksManager-block-selected",!!i),this.#gr.setProp(t.dataset.id,"selected",!!i);break;case"row":this.#Oo(t,"key",t.dataset.keyNote-i);break;case"key":{const s=this.#Sr(i);t.dataset.key=wt.keyNames.en[s.dataset.key],s.firstElementChild.append(t),this.#xr(t)}break;case"prev":{const s=this.#nr.getBlocks().get(i);t.classList.toggle("gsuiPianoroll-block-prevLinked",!!i),s&&s._dragline.linkTo(t._draglineDrop)}break;case"next":{const s=this.#nr.getBlocks().get(i);t.classList.toggle("gsuiPianoroll-block-nextLinked",!!i),t._dragline.linkTo(s&&s._draglineDrop)}break;case"pan":case"gain":case"lowpass":case"highpass":this.#Dr(s,t,i);break;case"gainLFOAmp":case"gainLFOSpeed":this.#Dr(s,t,gt.#Cr(i))}}#Dr(t,s,i){this.#mr.value===t&&this.#gr.setProp(s.dataset.id,"value",i)}#xr(t){const s=this.#nr.getBlocks().get(t.dataset.prev);t._dragline.redraw(),s&&s._dragline.redraw()}#Sr(t){return this.#dr[t]}#ar(t){this.#nr.setPxPerBeat(t),this.#nr.getBlocks().forEach((t=>t._dragline.redraw())),Y.Wn(this.#gr,"pxperbeat",t)}#hr(t){this.#nr.setFontSize(t),Array.from(this.#nr.getRows()).forEach((s=>s.classList.toggle("gsui-row-small",t<=44))),this.#nr.getBlocks().forEach((t=>t._dragline.redraw()))}#wr(t){return Y.Wn(this.#gr,"currenttime",t),!0}#br(t,s,i){return Y.Wn(this.#gr,"loopa",s),Y.Wn(this.#gr,"loopb",i),t}#fr(t){const s=this.#mr.value;Array.prototype.find.call(this.#mr.children,(t=>t.value===s)).dataset.number=(s.startsWith("gainLFO")?gt.#Pr(t):t).toFixed(2)}#vr(){const t=this.#mr.value;delete Array.prototype.find.call(this.#mr.children,(s=>s.value===t)).dataset.number}#yr(t){const s=this.#mr.value;return t.component="gsuiPianoroll",t.eventName="changeKeysProps",s.startsWith("gainLFO")&&t.args[0].forEach((t=>t[1]=gt.#Pr(t[1]))),t.args.unshift(s),!0}static#Pr(t){switch(t){case 6:return 4;case 5:return 3.5;case 4:return 3;case 3:return 2.5;case 2:return 2;case 1:return 1.5;default:return 1;case-1:return.75;case-2:return.5;case-3:return.4;case-4:return.3333;case-5:return.2857;case-6:return.25}}static#Cr(t){return t>=4?6:t>=3.5?5:t>=3?4:t>=2.5?3:t>=2?2:t>=1.5?1:t>=1?0:t>=.75?-1:t>=.5?-2:t>=.4?-3:t>=.3333?-4:t>=.2857?-5:t>=.25?-6:void 0}#cr(t,s){const i=s.currentTarget._dragline.rootElement;s.stopPropagation(),i.contains(s.target)||this.#nr.onmousedown(s)}#rr(t,s){if(this.#nr.onmousedown(s),0===s.button&&!s.shiftKey){const i=this.#nr.roundBeat(this.#nr.getWhenByPageX(s.pageX));this.onchange("add",t,i,this.#pr)}}#kr(){const t=this.#mr.value,s=this.#gr;switch(t){case"pan":s.options({min:-1,max:1,def:0,step:.05});break;case"gain":s.options({min:0,max:1,def:.8,step:.025});break;case"lowpass":case"highpass":s.options({min:0,max:1,def:1,step:.025,exp:3});break;case"gainLFOAmp":case"gainLFOSpeed":s.options({min:-6,max:6,def:0,step:1})}this.#nr.getBlocks().forEach(((s,i)=>{const e=+s.dataset[t],n=t.startsWith("gainLFO")?gt.#Cr(e):e;this.#gr.setProp(i,"value",n)}))}#Or(t){const s=this.#nr.getBlocks().get(t).dataset,i=+s.when+ +s.duration,e=[];return this.#nr.getBlocks().forEach((s=>{const n=s.dataset;+n.when>=i&&(void 0===n.prev||n.prev===t)&&e.push(s.firstElementChild)})),e}#$r(t,s){this.onchange("redirect",t,s?s.parentNode.dataset.id:null)}}Object.freeze(gt),customElements.define("gsui-pianoroll",gt),Y.Pa("gsui-drumrows",(()=>[Y.Bn("div",{class:"gsuiDrumrows-drop"},Y.Bn("div",{class:"gsuiDrumrows-dropIn"},Y.Bn("i",{class:"gsuiIcon","data-icon":"arrow-dropdown"}),Y.Bn("i",{class:"gsuiIcon","data-icon":"arrow-dropdown"}),Y.Bn("i",{class:"gsuiIcon","data-icon":"arrow-dropdown"})))])),Y.Pa("gsui-drumrow",(()=>Y.Bn("form",{class:"gsuiDrumrow",draggable:"true"},Y.Bn("div",{class:"gsuiDrumrow-grip"},Y.Bn("i",{class:"gsuiIcon","data-icon":"grip-v"})),Y.Bn("div",{class:"gsuiDrumrow-main"},Y.Bn("gsui-toggle",{title:"Toggle the drumrow (right click for solo)"}),Y.Bn("button",{type:"button",class:"gsuiIcon gsuiDrumrow-btnProps","data-action":"props","data-icon":"drumprops",title:"Expand props panel"}),Y.Bn("button",{type:"button",class:"gsuiIcon gsuiDrumrow-btnDelete","data-action":"delete","data-icon":"close",title:"Remove the drumrow"}),Y.Bn("span",{class:"gsuiDrumrow-name"}),Y.Bn("div",{class:"gsuiDrumrow-waveWrap"}),Y.Bn("div",{class:"gsuiDrumrow-detune",title:"pitch"},Y.Bn("gsui-slider",{type:"linear-y",min:-12,max:12,step:1,"mousemove-size":400,"data-prop":"detune"})),Y.Bn("div",{class:"gsuiDrumrow-pan",title:"pan"},Y.Bn("gsui-slider",{type:"linear-y",min:-1,max:1,step:.02,"mousemove-size":400,"data-prop":"pan"})),Y.Bn("div",{class:"gsuiDrumrow-gain",title:"gain"},Y.Bn("gsui-slider",{type:"linear-y",min:0,max:1,step:.01,"mousemove-size":400,"data-prop":"gain"}))),Y.Bn("div",{class:"gsuiDrumrow-props"},Y.Bn("label",{class:"gsuiDrumrow-prop gsuiDrumrow-propDetune",tabindex:0},Y.Bn("input",{class:"gsuiDrumrow-propRadio",type:"radio",name:"prop",value:"detune"},"pitch"),Y.Bn("span",{class:"gsuiDrumrow-propSpan"},"pitch")),Y.Bn("label",{class:"gsuiDrumrow-prop gsuiDrumrow-propPan",tabindex:0},Y.Bn("input",{class:"gsuiDrumrow-propRadio",type:"radio",name:"prop",value:"pan"},"pan"),Y.Bn("span",{class:"gsuiDrumrow-propSpan"},"pan")),Y.Bn("label",{class:"gsuiDrumrow-prop gsuiDrumrow-propGain",tabindex:0},Y.Bn("input",{class:"gsuiDrumrow-propRadio",type:"radio",name:"prop",value:"gain"},"gain"),Y.Bn("span",{class:"gsuiDrumrow-propSpan"},"gain"))),Y.Bn("div",{class:"gsuiDrumrows-drop"},Y.Bn("div",{class:"gsuiDrumrows-dropIn"},Y.Bn("i",{class:"gsuiIcon","data-icon":"arrow-dropdown"}),Y.Bn("i",{class:"gsuiIcon","data-icon":"arrow-dropdown"}),Y.Bn("i",{class:"gsuiIcon","data-icon":"arrow-dropdown"}))))));class mt extends HTMLElement{#Mr=new Map;#Ar=new Map;#Tr=null;#Br=null;#jr=null;#Lr=null;#La=Y.Ca.bind(null,this,"gsuiDrumrows");#Er=new ct({rootElement:this,direction:"column",dataTransferType:"drumrow",itemSelector:".gsuiDrumrow",handleSelector:".gsuiDrumrow-grip",parentSelector:"gsui-drumrows",onchange:this.#Wr.bind(this)});constructor(){super(),Object.seal(this),this.ondrop=this.#Fr.bind(this),this.onclick=this.#Ir.bind(this),this.onchange=this.#Kr.bind(this),this.ondragover=this.#zr.bind(this),this.ondragstart=t=>t.stopPropagation(),this.onmousedown=this.#Rr.bind(this),this.oncontextmenu=this.#Nr.bind(this),this.onanimationend=this.#Gr.bind(this),Y.In(this,{gsuiToggle:{toggle:(t,s)=>{const i=s.parentNode.parentNode.dataset.id;this.#ih(i,t.args[0]),this.#La("change","toggleDrumrow",i,t.args[0])},toggleSolo:(t,s)=>{const i=s.parentNode.parentNode.dataset.id;this.#ih(i,!0),this.#La("change","toggleSoloDrumrow",i)}}})}connectedCallback(){this.firstChild||this.append(...Y.En("gsui-drumrows"))}setLinesParent(t,s){this.#jr=t,this.#Er.setShadowElement(t),this.#Er.setShadowChildClass(s)}reorderDrumrows(t){ct.listReorder(this,t),ct.listReorder(this.#jr,t)}playRow(t){this.#Mr.get(t).root.querySelector(".gsuiDrumrow-waveWrap").append(Y.Bn("div",{class:"gsuiDrumrow-startCursor"}))}stopRow(t){this.#Mr.get(t).root.querySelectorAll(".gsuiDrumrow-startCursor").forEach((t=>t.remove()))}setPropFilter(t,s){this.#Mr.get(t).root.querySelector(`.gsuiDrumrow-propRadio[value="${s}"]`).checked=!0}setDrumPropValue(t,s,i){const e=this.#Hr(t,s),n="detune"===s?i:i.toFixed(2),a="gain"!==s?`${i>0?"+":""}${n}`:n;e.classList.add("gsuiDrumrow-propSpanValue"),e.textContent=a}removeDrumPropValue(t,s){const i=this.#Hr(t,s);i.classList.remove("gsuiDrumrow-propSpanValue"),i.textContent="detune"===s?"pitch":s}add(t,s){const i=Y.Fn(Y.En("gsui-drumrow"),{root:".gsuiDrumrow",name:".gsuiDrumrow-name",toggle:"gsui-toggle",detune:".gsuiDrumrow-detune gsui-slider",gain:".gsuiDrumrow-gain gsui-slider",pan:".gsuiDrumrow-pan gsui-slider"});i.root.dataset.id=s.dataset.id=t,this.#Mr.set(t,i),this.#Ar.set(t,s),this.append(i.root),this.#jr.append(s),Y.In(i.root,{gsuiSlider:{change:(s,i)=>this.#Vr(t,i.dataset.prop,s.args[0]),input:(s,i)=>{this.#Ur(t,i.dataset.prop,s.args[0]),this.#La("liveChangeDrumrow",t,i.dataset.prop,s.args[0])},inputStart:Y.Sn,inputEnd:()=>this.#qr(t)}})}remove(t){this.#Mr.get(t).root.remove(),this.#Ar.get(t).remove(),this.#Mr.delete(t),this.#Ar.delete(t)}change(t,s,i){switch(s){case"pan":this.#_r(t,i);break;case"name":this.#Yr(t,i);break;case"gain":this.#Jr(t,i);break;case"order":this.#Xr(t,i);break;case"detune":this.#Qr(t,i);break;case"toggle":this.#ih(t,i);break;case"pattern":this.#et(t,i);break;case"duration":this.#tt(t,i)}}#_r(t,s){this.#Mr.get(t).pan.setValue(s)}#Jr(t,s){this.#Mr.get(t).gain.setValue(s)}#Qr(t,s){this.#Mr.get(t).detune.setValue(s)}#Yr(t,s){const i=this.#Mr.get(t).name;i.dataset.name=i.textContent=s}#ih(t,s){Y.Wn(this.#Mr.get(t).toggle,"off",!s),this.#Mr.get(t).root.classList.toggle("gsuiDrumrow-mute",!s),this.#Ar.get(t).classList.toggle("gsuiDrumrow-mute",!s)}#tt(t,s){this.#Mr.get(t).root.querySelector(".gsuiDrumrow-waveWrap").style.animationDuration=2*s+"s"}#et(t,s){const i=this.#Mr.get(t).root.querySelector(".gsuiDrumrow-waveWrap");Y.Wa(i),s&&(s.classList.add("gsuiDrumrow-wave"),i.append(s))}#Xr(t,s){this.#Mr.get(t).root.dataset.order=this.#Ar.get(t).dataset.order=s}#Ur(t,s,i){const e=this.#Mr.get(t).name,n="pan"===s?`pan: ${i>0?"+":""}${i.toFixed(2)}`:"gain"===s?`gain: ${i.toFixed(2)}`:`pitch: ${i>0?"+":""}${i}`;e.textContent=n,e.classList.add("gsuiDrumrow-nameInfo")}#Zr(t){this.#Mr.get(t).root.classList.toggle("gsuiDrumrow-open"),this.#Ar.get(t).classList.toggle("gsuiDrums-lineOpen")}#Hr(t,s){return this.#Mr.get(t).root.querySelector(`.gsuiDrumrow-propRadio[value="${s}"] + .gsuiDrumrow-propSpan`)}#qr(t){const s=this.#Mr.get(t).name;s.textContent=s.dataset.name,s.classList.remove("gsuiDrumrow-nameInfo")}#Vr(t,s,i){this.#La("change","changeDrumrow",t,s,i)}#Wr(t){const s=ct.listComputeOrderChange(this,{});this.#La("change","reorderDrumrow",t.dataset.id,s)}#Kr(t){const s=t.target.closest(".gsuiDrumrow").dataset.id;this.#La("propFilter",s,t.target.value)}#Ir(t){if(t.target!==this){const s=t.target.closest(".gsuiDrumrow").dataset.id;switch(t.target.dataset.action){case"props":this.#Zr(s);break;case"delete":this.#La("change","removeDrumrow",s)}}}#Rr(t){0!==t.button&&2!==t.button||!t.target.classList.contains("gsuiDrumrow-main")||this.#La(0===t.button?"liveStartDrum":"liveStopDrum",t.target.parentNode.dataset.id)}#Gr(t){t.target.classList.contains("gsuiDrumrow-startCursor")&&t.target.remove()}#Nr(t){t.preventDefault(),t.target.classList.contains("gsuiDrumrow-propSpan")&&this.#La("propFilters",t.target.previousElementSibling.value)}#Fr(t){if(this.#Tr){const s=t.dataTransfer.getData("pattern-buffer");s&&(this.#Tr===1/0?this.#La("change","addDrumrow",s):this.#La("change","changeDrumrowPattern",this.#Tr,s))}this.#tc()}#tc(){this.#Br&&(this.#Br.classList.remove("gsuiDrumrows-dragover"),this.#Br=this.#Tr=null)}#zr(t){if(t.dataTransfer.types.includes("pattern-buffer")){const s=t.target,i="GSUI-DRUMROWS"===s.nodeName,e=i?s:s.closest(".gsuiDrumrow");clearTimeout(this.#Lr),this.#Lr=setTimeout((()=>this.#tc()),125),e!==this.#Br&&(this.#Tr=null,i?this.#Tr=1/0:e&&(this.#Tr=e.dataset.id),this.#Br&&this.#Br.classList.remove("gsuiDrumrows-dragover"),this.#Br=e,e&&e.classList.add("gsuiDrumrows-dragover"))}}}Object.freeze(mt),customElements.define("gsui-drumrows",mt),Y.Pa("gsui-drums-line",(()=>Y.Bn("div",{class:"gsuiDrums-line"},Y.Bn("div",{class:"gsuiDrums-lineDrums"},Y.Bn("div",{class:"gsuiDrums-lineIn"})),Y.Bn("div",{class:"gsuiDrums-lineProps"},Y.Bn("gsui-slidergroup"))))),Y.Pa("gsui-drums-drum",(()=>Y.Bn("div",{class:"gsuiDrums-drum"},Y.Bn("div",{class:"gsuiDrums-drumIn"},["detune","pan","gain"].map((t=>Y.Bn("div",{class:"gsuiDrums-drumProp","data-value":t},Y.Bn("div",{class:"gsuiDrums-drumPropValue"})))))))),Y.Pa("gsui-drums-drumcut",(()=>Y.Bn("div",{class:"gsuiDrums-drumcut"},Y.Bn("div",{class:"gsuiDrums-drumcutIn"},Y.Bn("i",{class:"gsuiIcon","data-icon":"drumcut"})))));class bt extends HTMLElement{#er=Y.Bn("gsui-timewindow",{panelsize:140,panelsizemin:70,panelsizemax:240,lineheight:48,lineheightmin:48,lineheightmax:48,pxperbeatmin:50,pxperbeatmax:160});#sc=0;#ic=0;#ec=4;#$o=80;#nc=this.#$o/this.#ec;#ac="";#hc=null;#oc=0;#rc="";#cc=new Map;#lc=new Map;#uc=new Map;#dc=null;#pc=null;#gc=Y.Bn("div",{class:"gsuiDrums-drumHover"},Y.Bn("div",{class:"gsuiDrums-drumHoverIn"}));#mc=Y.Bn("div",{class:"gsuiDrums-drumcutHover"},Y.Bn("div",{class:"gsuiDrums-drumcutHoverIn"}));#bc=this.#gc;#wc=this.#fc.bind(this);#vc=this.#yc.bind(this);#La=Y.Ca.bind(null,this,"gsuiDrums");constructor(){super(),this.timeline=this.#er.timeline,this.drumrows=Y.Bn("gsui-drumrows"),Object.seal(this),Y.In(this,{gsuiTimewindow:{pxperbeat:t=>{this.setPxPerBeat(t.args[0])}},gsuiSliderGroup:{change:(t,s)=>(t.args.unshift(s.dataset.currentProp),!0),input:(t,s)=>(this.changeDrumProp(t.args[0],s.dataset.currentProp,t.args[1]),t.args=[s.dataset.id,t.args[0],s.dataset.currentProp,t.args[1]],!0),inputEnd:(t,s)=>(t.args=[s.dataset.id,s.dataset.currentProp],!0)}}),Y.Wn(this.#er,"step",1),this.#er.onscroll=this.#kc.bind(this),this.#gc.remove(),this.#mc.remove(),this.#gc.onmousedown=this.#$c.bind(this,"Drums"),this.#mc.onmousedown=this.#$c.bind(this,"Drumcuts")}connectedCallback(){this.firstChild||(Y.Wn(this,"tabindex",-1),this.append(this.#er),this.#er.querySelector(".gsuiTimewindow-panelContent").append(this.drumrows),this.#pc=this.#er.querySelector(".gsuiTimewindow-currentTime"),this.#dc=this.#er.querySelector(".gsuiTimewindow-rows"),this.#dc.onmousemove=this.#vc,this.#dc.onmouseleave=this.#Oc.bind(this),this.drumrows.setLinesParent(this.#dc,"gsuiDrums-line"))}static get observedAttributes(){return["disabled","currenttime"]}attributeChangedCallback(t,s,i){if(s!==i)switch(t){case"disabled":Y.Wn(this.#er,"disabled",i);break;case"currenttime":Y.Wn(this.#er,"currenttime",i)}}loop(t,s){Y.Wn(this.#er,"loop",!1!==t&&`${t}-${s}`)}timedivision(t){const s=t.split("/")[1];this.#ec=s,Y.Wn(this.#er,"timedivision",t),Y.Wn(this.#er,"currenttimestep",1/s),this.setPxPerBeat(this.#$o),this.#gc.style.width=this.#mc.style.width=this.#pc.style.width=1/s+"em"}setFontSize(t){Y.Wn(this.#er,"lineheight",t)}setPxPerBeat(t){this.#$o=t,this.#nc=t/this.#ec,Y.Wn(this.#er,"pxperbeat",t),this.#uc.forEach((s=>Y.Wn(s,"pxperbeat",t)))}setPropValues(t,s,i){const e=this.#uc.get(t);switch(this.#xc(`line[data-id='${t}']`).dataset.prop=s,e.dataset.currentProp=s,s){case"pan":e.options({min:-1,max:1,step:.05,def:0});break;case"gain":e.options({min:0,max:1,step:.025,def:.8});break;case"detune":e.options({min:-12,max:12,step:1,def:0})}i.forEach((t=>e.setProp(t[0],"value",t[1])))}addDrum(t,s){const i=this.#uc.get(s.row);this.#Sc(t,"drum",s,"gsui-drums-drum"),i.set(t,s.when,1/this.#ec,0)}removeDrum(t){const s=this.#cc.get(t)[0];this.#uc.get(s).delete(t),this.#Dc(t)}addDrumcut(t,s){this.#Sc(t,"drumcut",s,"gsui-drums-drumcut")}removeDrumcut(t){this.#Dc(t)}createDrumrow(t){const s=Y.En("gsui-drums-line"),i=s.querySelector("gsui-slidergroup");return Y.Wn(i,"pxperbeat",this.#$o),i.dataset.id=t,this.#uc.set(t,i),s}changeDrum(t,s,i){const e=this.#cc.get(t)[0],n=this.#uc.get(e);this.changeDrumProp(t,s,i),s===n.dataset.currentProp&&n.setProp(t,"value",i)}changeDrumProp(t,s,i){const e=`.gsuiDrums-drumProp[data-value="${s}"] .gsuiDrums-drumPropValue`,n=this.#cc.get(t)[3].querySelector(e).style;switch(s){case"detune":n.left=i>0?"50%":50*(1+i/12)+"%",n.width=50*Math.abs(i/12)+"%";break;case"pan":n.left=i>0?"50%":50*(1+i)+"%",n.width=50*Math.abs(i)+"%";break;case"gain":n.left=0,n.width=100*i+"%"}}#Sc(t,s,i,e){const n=Y.En(e),a=1/this.#ec;n.dataset.id=t,n.style.left=`${i.when}em`,n.style.width=`${a}em`,this.#xc(`line[data-id='${i.row}'] .gsuiDrums-lineIn`).append(n),this.#cc.set(t,[i.row,s,Math.round(i.when/a),n])}#Dc(t){this.#cc.get(t)[3].remove(),this.#cc.delete(t)}#xc(t){return(this.firstChild?this:this.#er).querySelector(`.gsuiDrums-${t}`)}#Cc(t,s){return t.classList.contains(`gsuiDrums-${s}`)}#Pc(t,s,i){const e=Y.En(t);return e.classList.add("gsuiDrums-preview"),e.style.left=`${i}em`,e.style.width=1/this.#ec+"em",this.#xc(`line[data-id='${s}'] .gsuiDrums-lineIn`).append(e),e}#Mc(t,s){const i=this.#hc,e=1/this.#ec,n=Math.round(Math.min(t,s)/e),a=Math.round(Math.max(t,s)/e),h=new Map,o=this.#lc,r=this.#ac.startsWith("add"),c=this.#ac.endsWith("Drums")?"drum":"drumcut",l="drum"===c?"gsui-drums-drum":"gsui-drums-drumcut",u=[];this.#cc.forEach((t=>{t[0]===i&&t[1]===c&&u.push(t)}));for(let t=n;t<=a;++t)h.set(t),o.has(t)||(r?o.set(t,this.#Pc(l,i,t*e)):u.find((s=>{if(s[2]===t)return s[3].classList.add("gsuiDrums-previewDeleted"),o.set(t,s[3]),!0})));o.forEach(((t,s)=>{h.has(s)||(r?t.remove():t.classList.remove("gsuiDrums-previewDeleted"),o.delete(s))}))}#Ac(t){this.#lc.forEach(t?t=>t.remove():t=>t.classList.remove("gsuiDrums-previewDeleted")),this.#lc.clear()}#yc(t){if(t.target!==this.#bc)if(this.#ac)this.#ic=t.pageX,this.#kc();else{const s=t.target,i=this.#Cc(s,"lineIn")?s:this.#Cc(s,"drum")||this.#Cc(s,"drumcut")?s.parentNode:null;if(i){const s=i.getBoundingClientRect(),e=(t.pageY-s.top)/s.height>.66?this.#mc:this.#gc;this.#ic=t.pageX,this.#rc=e===this.#gc?"drum":"drumcut",e!==this.#bc&&(this.#bc&&this.#bc.remove(),this.#bc=e),this.#kc(),this.#bc.parentNode!==i&&i.append(this.#bc)}else this.#bc&&this.#bc.remove()}}#kc(){if(this.#rc){const t=this.#dc.getBoundingClientRect().left,s=((this.#ic-t)/this.#nc|0)/this.#ec;this.#sc=s,this.#bc.style.left=`${s}em`,this.#ac&&this.#Mc(this.#oc,s)}}#Oc(){this.#ac||(this.#rc="",this.#bc.remove())}#$c(t,s){this.#ac||(this.#ac=0===s.button?`add${t}`:`remove${t}`,this.#hc=this.#bc.closest(".gsuiDrums-line").dataset.id,this.#oc=this.#sc,this.#Mc(this.#sc,this.#sc),Y.Fa(),this.#dc.onmousemove=null,document.addEventListener("mousemove",this.#vc),document.addEventListener("mouseup",this.#wc))}#fc(){this.#Ac(this.#ac.startsWith("add")),document.removeEventListener("mousemove",this.#vc),document.removeEventListener("mouseup",this.#wc),this.#dc.onmousemove=this.#vc,this.#La("change",this.#ac,this.#hc,this.#oc,this.#sc),this.#ac=""}}Object.freeze(bt),customElements.define("gsui-drums",bt),Y.Pa("gsui-keys-octave",(()=>[Y.Bn("div",{class:"gsuiKey","data-key":11},Y.Bn("div",{class:"gsui-row gsuiKey-row","data-key":11},Y.Bn("div"))),Y.Bn("div",{class:"gsuiKey gsuiKeyBlack","data-key":10},Y.Bn("div",{class:"gsui-row gsuiKey-row  gsuiKeyBlack-row","data-key":10},Y.Bn("div"))),Y.Bn("div",{class:"gsuiKey","data-key":9},Y.Bn("div",{class:"gsui-row gsuiKey-row","data-key":9},Y.Bn("div"))),Y.Bn("div",{class:"gsuiKey gsuiKeyBlack","data-key":8},Y.Bn("div",{class:"gsui-row gsuiKey-row  gsuiKeyBlack-row","data-key":8},Y.Bn("div"))),Y.Bn("div",{class:"gsuiKey","data-key":7},Y.Bn("div",{class:"gsui-row gsuiKey-row","data-key":7},Y.Bn("div"))),Y.Bn("div",{class:"gsuiKey gsuiKeyBlack","data-key":6},Y.Bn("div",{class:"gsui-row gsuiKey-row  gsuiKeyBlack-row","data-key":6},Y.Bn("div"))),Y.Bn("div",{class:"gsuiKey","data-key":5},Y.Bn("div",{class:"gsui-row gsuiKey-row","data-key":5},Y.Bn("div"))),Y.Bn("div",{class:"gsuiKey","data-key":4},Y.Bn("div",{class:"gsui-row gsuiKey-row","data-key":4},Y.Bn("div"))),Y.Bn("div",{class:"gsuiKey gsuiKeyBlack","data-key":3},Y.Bn("div",{class:"gsui-row gsuiKey-row  gsuiKeyBlack-row","data-key":3},Y.Bn("div"))),Y.Bn("div",{class:"gsuiKey","data-key":2},Y.Bn("div",{class:"gsui-row gsuiKey-row","data-key":2},Y.Bn("div"))),Y.Bn("div",{class:"gsuiKey gsuiKeyBlack","data-key":1},Y.Bn("div",{class:"gsui-row gsuiKey-row  gsuiKeyBlack-row","data-key":1},Y.Bn("div"))),Y.Bn("div",{class:"gsuiKey","data-key":0},Y.Bn("div",{class:"gsui-row gsuiKey-row","data-key":0},Y.Bn("div")))]));class wt extends HTMLElement{static keyNames=Object.freeze({en:Object.freeze(["c","c#","d","d#","e","f","f#","g","g#","a","a#","b"]),fr:Object.freeze(["do","do#","ré","ré#","mi","fa","fa#","sol","sol#","la","la#","si"])});static keyboardToKey={KeyZ:[-1,0],KeyS:[-1,1],KeyX:[-1,2],KeyD:[-1,3],KeyC:[-1,4],KeyV:[-1,5],KeyG:[-1,6],KeyB:[-1,7],KeyH:[-1,8],KeyN:[-1,9],KeyJ:[-1,10],KeyM:[-1,11],Comma:[0,0],KeyL:[0,1],Period:[0,2],Semicolon:[0,3],Slash:[0,4],KeyQ:[0,0],Digit2:[0,1],KeyW:[0,2],Digit3:[0,3],KeyE:[0,4],KeyR:[0,5],Digit5:[0,6],KeyT:[0,7],Digit6:[0,8],KeyY:[0,9],Digit7:[0,10],KeyU:[0,11],KeyI:[1,0],Digit9:[1,1],KeyO:[1,2],Digit0:[1,3],KeyP:[1,4],BracketLeft:[1,5],Equal:[1,6],BracketRight:[1,7]};#Tc=0;#Bc=new Map;#jc=1;#Lc=0;#Ec=0;#Wc=0;#Fc=0;#Ic=0;#Kc=0;#zc=null;#_o=this.#io.bind(this);#qo=this.#so.bind(this);constructor(){super(),Object.seal(this),this.onmousedown=this.#Rc.bind(this),this.oncontextmenu=()=>!1}connectedCallback(){Y.Ia(this,{orient:"vertical",rootoctave:"4"})}static get observedAttributes(){return["orient","rootoctave"]}attributeChangedCallback(t,s,i){if(s!==i&&"rootoctave"===t)this.#Nc(+i)}octaves(t,s){const i=t+s;Array.prototype.forEach.call(this.children,(t=>{t.remove(),t._rowElement.remove()})),this.#Lc=s,this.#Wc=t,this.style.setProperty("--gsuiKeys-firstOctave",t),this.style.setProperty("--gsuiKeys-nbOctaves",s);for(let t=0;t<s;++t)this.append(...Y.En("gsui-keys-octave"));return Array.prototype.reduce.call(this.children,((t,s,i)=>{const e=s.firstElementChild;return s._rowElement=e,e._keyElement=s,s.dataset.midi=e.dataset.midi=t-1,s.style.setProperty("--gsuiKeys-key-id",i),e.style.top=`${i}em`,t-1}),12*i),this.#Nc(this.#Tc),this.querySelectorAll(".gsui-row")}getMidiKeyFromKeyboard(t){const s=wt.keyboardToKey[t.code];return!!s&&12*(this.#Tc+s[0])+s[1]}midiReleaseAllKeys(){this.#Bc.forEach(((t,s)=>this.midiKeyUp(s))),this.#io()}midiKeyDown(t){this.#Gc(this.#Hc(t),!0)}midiKeyUp(t){this.#Gc(this.#Hc(t),!1)}#Hc(t){return this.children[this.children.length-1-(t-12*this.#Wc)]}#Nc(t){this.#Tc=t,this.querySelector(".gsuiKey-root")?.classList.remove("gsuiKey-root"),this.querySelector(`.gsuiKey[data-midi="${12*t}"]`)?.classList.add("gsuiKey-root")}#Vc(){return"vertical"===Y.Kn(this,"orient")}#Uc(t){return 1===t||3===t||5===t||8===t||10===t}#Gc(t,s){if(t){const i=+t.dataset.midi;t.classList.toggle("gsui-active",s),s?(this.#Bc.set(i),Y.Ca(this,"gsuiKeys","keyDown",i,this.#jc)):(this.#Bc.delete(i),Y.Ca(this,"gsuiKeys","keyUp",i,this.#jc))}}#Rc(t){if(this.#Lc)if(2===t.button)Y.Wn(this,"rootoctave",t.target.dataset.midi/12|0);else if(0===t.button){const s=this.#Vc(),i=this.getBoundingClientRect(),e=this.children[1].getBoundingClientRect();this.#Ec=s?i.top:i.left,this.#Fc=s?e.right:e.bottom,this.#Ic=s?e.height:e.width,this.#jc=Math.min(t.layerX/(t.target.clientWidth-1),1),document.addEventListener("mouseup",this.#_o),document.addEventListener("mousemove",this.#qo),this.#so(t)}}#io(){document.removeEventListener("mouseup",this.#_o),document.removeEventListener("mousemove",this.#qo),this.#zc&&(this.#Gc(this.#zc,!1),this.#zc=this.#Kc=null),this.#jc=1}#so(t){const s=this.#Vc(),i=s?t.clientY:t.clientX,e=s?t.clientX:t.clientY,n=(i-this.#Ec)/this.#Ic,a=s?n:12*this.#Lc-n;let h=~~a;if(e>this.#Fc&&this.#Uc(~~(h%12))&&(h+=a-h<.5?-1:1),this.#Kc!==h){const t=this.children[h];t&&(this.#zc&&this.#Gc(this.#zc,!1),this.#zc=t,this.#Kc=h,this.#Gc(t,!0))}}}Object.freeze(wt),customElements.define("gsui-keys",wt),Y.Pa("gsui-oscillator",(()=>[Y.Bn("div",{class:"gsuiOscillator-grip gsuiIcon","data-icon":"grip-v"}),Y.Bn("div",{class:"gsuiOscillator-waveWrap"},Y.Bn("div",{class:"gsuiOscillator-waveWrap-left"},Y.Bn("div",{class:"gsuiOscillator-waveWrap-top"},Y.Bn("button",{class:"gsuiOscillator-waveBtn gsuiOscillator-wavePrev gsuiIcon","data-icon":"caret-left",title:"Previous wave"}),Y.Bn("button",{class:"gsuiOscillator-waveBtn gsuiOscillator-waveNext gsuiIcon","data-icon":"caret-right",title:"Next wave"}),Y.Bn("select",{class:"gsuiOscillator-waveSelect"},["sine","triangle","sawtooth","square"].map((t=>Y.Bn("option",{class:"gsuiOscillator-waveOptNative",value:t},t))))),Y.Bn("div",{class:"gsuiOscillator-wave"},Y.Bn("gsui-periodicwave"),Y.Bn("gsui-periodicwave"))),Y.Bn("div",{class:"gsuiOscillator-unisonGraph"},Y.Bn("div",{class:"gsuiOscillator-unisonGraph-voices"}))),Y.Bn("div",{class:"gsuiOscillator-unison"},Y.Bn("gsui-slider",{type:"linear-y",min:1,max:9,step:1,"mousemove-size":"400","data-prop":"unisonvoices"}),Y.Bn("gsui-slider",{type:"linear-y",min:0,max:2,step:.01,"mousemove-size":"800","data-prop":"unisondetune"}),Y.Bn("gsui-slider",{type:"linear-y",min:0,max:1,step:.001,"mousemove-size":"800","data-prop":"unisonblend"})),[["detune","pitch",-24,24,1],["pan","pan",-1,1,.02],["gain","gain",0,1,.01]].map((([t,s,i,e,n])=>Y.Bn("div",{class:`gsuiOscillator-prop gsuiOscillator-${t}`,title:s},Y.Bn("div",{class:"gsuiOscillator-sliderWrap"},Y.Bn("gsui-slider",{type:"circular",min:i,max:e,step:n,"mousemove-size":"800","data-prop":t}),"detune"!==t?null:Y.Bn("gsui-slider",{type:"circular",min:-1,max:1,step:.01,"mousemove-size":"800","data-prop":"detunefine","stroke-width":3})),Y.Bn("div",{class:"gsuiOscillator-sliderValue"})))),Y.Bn("button",{class:"gsuiOscillator-remove gsuiIcon","data-icon":"close",title:"Remove the oscillator"})].flat(1)));class ft extends HTMLElement{#qc=null;#La=Y.Ca.bind(null,this,"gsuiOscillator");#_c={sine:!0,triangle:!0,sawtooth:!0,square:!0};#Ea=Y.En("gsui-oscillator");#fs=Y.Fn(this.#Ea,{waveSelect:".gsuiOscillator-waveSelect",wavePrev:".gsuiOscillator-wavePrev",waveNext:".gsuiOscillator-waveNext",waves:["gsui-periodicwave:first-child","gsui-periodicwave:last-child"],unisonGraph:".gsuiOscillator-unisonGraph-voices",sliders:{pan:[".gsuiOscillator-pan gsui-slider",".gsuiOscillator-pan .gsuiOscillator-sliderValue"],gain:[".gsuiOscillator-gain gsui-slider",".gsuiOscillator-gain .gsuiOscillator-sliderValue"],detune:[".gsuiOscillator-detune gsui-slider",".gsuiOscillator-detune .gsuiOscillator-sliderValue"],detunefine:[".gsuiOscillator-detune gsui-slider + gsui-slider",".gsuiOscillator-detune .gsuiOscillator-sliderValue"],unisonvoices:["gsui-slider[data-prop='unisonvoices']"],unisondetune:["gsui-slider[data-prop='unisondetune']"],unisonblend:["gsui-slider[data-prop='unisonblend']"]},remove:".gsuiOscillator-remove"});constructor(){super(),Object.seal(this),this.#fs.waves[0].frequency=this.#fs.waves[1].frequency=1,this.#fs.waveSelect.onchange=this.#Yc.bind(this),this.#fs.waveSelect.onkeydown=this.#Jc.bind(this),this.#fs.wavePrev.onclick=this.#Xc.bind(this,-1),this.#fs.waveNext.onclick=this.#Xc.bind(this,1),this.#fs.remove.onclick=()=>this.#La("remove"),Y.In(this,{gsuiSlider:{inputStart:Y.Sn,inputEnd:Y.Sn,input:(t,s)=>{this.#th(s.dataset.prop,t.args[0])},change:(t,s)=>{this.#sh(s.dataset.prop,t.args[0])}}})}connectedCallback(){this.#Ea&&(Y.Wn(this,"draggable","true"),this.append(...this.#Ea),this.#Ea=null,Y.Ia(this,{order:0,type:"sine",detune:0,detunefine:0,gain:1,pan:0,unisonvoices:5,unisondetune:.2,unisonblend:.3}),this.updateWave())}static get observedAttributes(){return["order","type","detune","detunefine","gain","pan","unisonvoices","unisondetune","unisonblend"]}attributeChangedCallback(t,s,i){if(!this.#Ea&&s!==i){const s=+i;switch(t){case"order":this.#Xr(s);break;case"type":this.#bn(i);break;case"unisonvoices":this.#Qc(s),this.#Zc("unisonvoices",s);break;case"unisondetune":this.#tl(s),this.#Zc("unisondetune",s);break;case"unisonblend":this.#sl(s),this.#Zc("unisonblend",s);break;case"detunefine":case"detune":case"gain":case"pan":this.#Zc(t,s)}}}addWaves(t){const s=[];t.sort(),t.forEach((t=>{this.#_c[t]||(this.#_c[t]=!0,s.push(Y.Bn("option",{class:"gsuiOscillator-waveOpt",value:t},t)))})),Element.prototype.append.apply(this.#fs.waveSelect,s),this.updateWave()}updateWave(t,s){const[i,e]=this.#fs.waves,n="gain"===t?s:Y.ja(this,"gain"),a="pan"===t?s:Y.ja(this,"pan");i.type=e.type="type"===t?s:Y.Kn(this,"type"),i.amplitude=Math.min(n*(a<0?1:1-a),.95),e.amplitude=Math.min(n*(a>0?1:1+a),.95),i.draw(),e.draw()}#Xr(t){this.dataset.order=t}#bn(t){this.#fs.waveSelect.value=t}#Zc(t,s){const[i,e]=this.#fs.sliders[t];let n=s;t.startsWith("detune")&&(n=Y.ja(this,"detune")+Y.ja(this,"detunefine")),i.setValue(s),Y.Wn(i,"title",`${t} ${n}`),e&&(e.textContent=n.toFixed(2))}#Qc(t){const s=this.#fs.unisonGraph,i=[];for(let s=0;s<t;++s)i.push(Y.Bn("div",{class:"gsuiOscillator-unisonGraph-voice"}));Y.Wa(s),s.append(...i),this.#sl(Y.ja(this,"unisonblend"))}#tl(t){const s=Y.ja(this.#fs.sliders.unisondetune[0],"max");this.#fs.unisonGraph.style.height=100*Y.xa(t/s)+"%"}#sl(t){const s=this.#fs.unisonGraph.childNodes,i=Math.floor(s.length/2),e=s.length%2==0;s.forEach(((s,n)=>s.style.width=(n===i||e&&n===i-1?100:100*t)+"%"))}#Xc(t){const s=this.#fs.waveSelect,i=s.querySelector(`option[value="${s.value}"]`),e=t<0?i.previousElementSibling:i.nextElementSibling;e&&(s.value=e.value,this.#Yc())}#Yc(){const t=this.#fs.waveSelect.value;clearTimeout(this.#qc),this.updateWave("type",t),this.#La("liveChange","type",t),this.#qc=setTimeout((()=>{t!==Y.Kn(this,"type")&&(Y.Wn(this,"type",t),this.#La("change","type",t))}),700)}#Jc(t){1===t.key.length&&t.preventDefault()}#sh(t,s){Y.Wn(this,t,s),this.#La("change",t,s)}#th(t,s){let i=s;const e=this.#fs.sliders[t][1];switch(t){case"gain":this.updateWave("gain",s);break;case"pan":this.updateWave("pan",s);break;case"unisonvoices":this.#Qc(s);break;case"unisondetune":this.#tl(s);break;case"unisonblend":this.#sl(s);break;case"detune":i+=Y.ja(this,"detunefine");break;case"detunefine":i+=Y.ja(this,"detune")}e&&(e.textContent=i.toFixed(2)),this.#La("liveChange",t,s)}}Object.freeze(ft),customElements.define("gsui-oscillator",ft);class vt extends HTMLElement{#Ua=Y.Aa("svg",{preserveAspectRatio:"none"},Y.Aa("polyline"));static cache={};constructor(){super(),this.type="",this.delay=this.attack=0,this.frequency=this.amplitude=this.duration=1,this.width=this.height=0,Object.seal(this)}connectedCallback(){this.firstChild||(this.append(this.#Ua),this.resized())}resized(){const t=this.getBoundingClientRect(),s=~~t.width,i=~~t.height;this.width=s,this.height=i,Y.Wn(this.#Ua,"viewBox",`0 0 ${s} ${i}`),this.draw()}draw(){if(this.firstChild&&this.type){const t=vt.cache[this.type];t?this.#il(t):console.error(`gsuiPeriodicWave: the wave "${this.type}" is undefined...`)}}#il(t){const s=this.duration,i=this.width,e=this.height/2,n=this.frequency*s,a=.95*-this.amplitude*e,h=i/s*this.delay,o=i/s*this.attack,r=new Float32Array(2*i);for(let s=0;s<i;++s){let c=e;if(s>h){const e=s-h,r=e<o?e/o:1;c+=t[e/i*256*n%256|0]*a*r}r[2*s]=s,r[2*s+1]=c}Y.Wn(this.#Ua.firstChild,"points",r.join(" "))}static getXFromWave(t,s,i){return t.reduce(((t,e,n)=>{const a=2*Math.PI*n*i;return t+e*Math.cos(a)+s[n]*Math.sin(a)}),0)}static addWave(t,s,i){if(!vt.cache[t]){const e=[],n=vt.getXFromWave.bind(null,s,i);for(let t=0;t<256;++t)e.push(n(t/256));vt.cache[t]=e}}}Object.freeze(vt),customElements.define("gsui-periodicwave",vt),Y.Pa("gsui-synthesizer",(()=>[Y.Bn("div",{class:"gsuiSynthesizer-head"},Y.Bn("gsui-toggle",{"data-related":"env",off:!0}),Y.Bn("span",{class:"gsuiSynthesizer-headTitle"},"envelope gain")),Y.Bn("div",{class:"gsuiSynthesizer-env"},Y.Bn("gsui-envelope")),Y.Bn("div",{class:"gsuiSynthesizer-head"},Y.Bn("gsui-toggle",{"data-related":"lfo",off:!0}),Y.Bn("span",{class:"gsuiSynthesizer-headTitle"},"LFO gain")),Y.Bn("div",{class:"gsuiSynthesizer-lfo"},Y.Bn("gsui-lfo")),Y.Bn("div",{class:"gsuiSynthesizer-head gsuiSynthesizer-headOscs"},Y.Bn("span",{class:"gsuiSynthesizer-headTitle"},"oscillators"),Y.Bn("span",{class:"gsuiSynthesizer-label gsuiSynthesizer-labelUnison"},"unison"),Y.Bn("span",{class:"gsuiSynthesizer-label gsuiSynthesizer-labelPitch"},"pitch"),Y.Bn("span",{class:"gsuiSynthesizer-label gsuiSynthesizer-labelPan"},"pan"),Y.Bn("span",{class:"gsuiSynthesizer-label gsuiSynthesizer-labelGain"},"gain")),Y.Bn("div",{class:"gsuiSynthesizer-oscList"},Y.Bn("button",{class:"gsuiSynthesizer-newOsc"},Y.Bn("i",{class:"gsuiIcon","data-icon":"plus"})))]));class yt extends HTMLElement{#el=[];#nl=new Map;#Ea=Y.En("gsui-synthesizer");#fs=Y.Fn(this.#Ea,{toggleEnv:"gsui-toggle[data-related='env']",toggleLFO:"gsui-toggle[data-related='lfo']",env:"gsui-envelope",lfo:"gsui-lfo",oscList:".gsuiSynthesizer-oscList",newOsc:".gsuiSynthesizer-newOsc"});constructor(){super(),this.env=this.#fs.env,this.lfo=this.#fs.lfo,Object.seal(this),this.#fs.newOsc.onclick=this.#al.bind(this),new ct({rootElement:this.#fs.oscList,direction:"column",dataTransferType:"oscillator",itemSelector:"gsui-oscillator",handleSelector:".gsuiOscillator-grip",parentSelector:".gsuiSynthesizer-oscList",onchange:this.#hl.bind(this)}),Y.In(this,{gsuiToggle:{toggle:(t,s)=>{const i="env"===s.dataset.related,e=i?"toggleEnv":"toggleLFO",n=i?this.#fs.env:this.#fs.lfo;Y.Wn(n,"toggle",t.args[0]),Y.Ca(this,"gsuiSynthesizer",e,t.args[0])}}})}connectedCallback(){this.firstChild||(this.append(...this.#Ea),this.#Ea=null)}setWaveList(t){this.#el=t,this.#nl.forEach((s=>s.addWaves(t)))}getOscillator(t){return this.#nl.get(t)}changeEnvProp(t,s){"toggle"===t&&Y.Wn(this.#fs.toggleEnv,"off",!s),Y.Wn(this.#fs.env,t,s)}changeLFOProp(t,s){"toggle"===t&&Y.Wn(this.#fs.toggleLFO,"off",!s),Y.Wn(this.#fs.lfo,t,s)}addOscillator(t){const s=Y.Bn("gsui-oscillator",{"data-id":t});this.#nl.set(t,s),s.addWaves(this.#el),this.#fs.oscList.append(s)}removeOscillator(t){const s=this.#nl.get(t);s&&(s.remove(),this.#nl.delete(t))}reorderOscillators(t){ct.listReorder(this.#fs.oscList,t)}#al(){Y.Ca(this,"gsuiSynthesizer","addOscillator")}#hl(){const t=ct.listComputeOrderChange(this.#fs.oscList,{});Y.Ca(this,"gsuiSynthesizer","reorderOscillator",t)}}Object.freeze(yt),customElements.define("gsui-synthesizer",yt);class kt extends HTMLElement{#ol=0;#rl=0;#cl=null;#ll=null;#ul=!0;constructor(){super(),Object.seal(this)}connectedCallback(){this.init()}init(){2===this.children.length&&(this.#ll=Y.Bn("div",{class:"gsuiPanel-extend"}),this.#ll.onpointerdown=this.#dl.bind(this),this.firstElementChild.after(this.#ll)),this.#pl(),this.#ll.dataset.axis=this.#gl()?"x":"y",this.children.length>0&&(this.#cl.style.width="",this.#cl.style.height="")}#gl(){return this.#ll.clientWidth<this.#ll.clientHeight}#pl(){this.#cl="auto"===getComputedStyle(this.lastElementChild).flexBasis?this.lastElementChild:this.firstElementChild,this.#ul=this.#cl===this.firstElementChild}#dl(t){const s=this.#gl(),i=this.#cl;Y.Fa(),this.#ol=s?t.pageX:t.pageY,this.#rl=s?i.clientWidth:i.clientHeight,this.setPointerCapture(t.pointerId),this.onpointerup=this.#ml.bind(this),this.onpointermove=this.#bl.bind(this),document.body.style.cursor=s?"ew-resize":"ns-resize"}#bl(t){const s=this.#gl(),i=(s?t.pageX:t.pageY)-this.#ol,e=this.#cl.style,n=`${this.#rl+i*(this.#ul?1:-1)}px`;s?e.width=n:e.height=n}#ml(t){const s=this.#gl(),i=this.#cl,e=(s?i.clientWidth:i.clientHeight)/(s?this.clientWidth:this.clientHeight)*100+"%";this.releasePointerCapture(t.pointerId),this.onpointermove=this.onpointerup=null,s?i.style.width=e:i.style.height=e,document.body.style.cursor=""}}Object.freeze(kt),customElements.define("gsui-panel",kt);class $t extends HTMLElement{#wl="";#fl=!1;#ol=0;#vl=null;#yl=null;#kl=null;constructor(){super(),Object.seal(this),this.onpointerdown=this.#$l.bind(this)}connectedCallback(){this.#Ol()}#Ol(){const t=this.children,s=this.#fl?this.clientWidth:this.clientHeight;this.style.overflow="hidden",this.#fl=this.classList.contains("gsuiPanels-x"),this.#wl=this.#fl?"width":"height",this.querySelectorAll(".gsuiPanels-extend").forEach((t=>t.remove())),this.querySelectorAll(".gsuiPanels-last").forEach((t=>t.classList.remove("gsuiPanels-last"))),t[t.length-1].classList.add("gsuiPanels-last"),Array.prototype.map.call(t,(t=>t.getBoundingClientRect()[this.#wl])).forEach(((i,e)=>{t[e].style[this.#wl]=i/s*100+"%",e>0&&t[e].append(Y.Bn("div",{class:"gsuiPanels-extend"}))}))}static#xl(t,s,i,e){return e.reduce(((s,e)=>{let n=s;if(Math.abs(s)>.1){const a=getComputedStyle(e),h=e.getBoundingClientRect()[t],o=parseFloat(a[`min-${t}`])||10,r=parseFloat(a[`max-${t}`])||1/0,c=Math.max(o,Math.min(h+s,r));Math.abs(c-h)>=.1&&(e.style[t]=c/i*100+"%",n-=c-h,e.onresizing&&e.onresizing(e))}return n}),s)}#$l(t){const s=t.target,i=s.parentNode;i.parentNode===this&&s.classList.contains("gsuiPanels-extend")&&(this.#vl=s,this.#ol=this.#fl?t.pageX:t.pageY,this.#yl=Array.prototype.filter.call(this.children,(t=>i.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_PRECEDING)).reverse(),this.#kl=Array.prototype.filter.call(this.children,(t=>i===t||i.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_FOLLOWING)),this.style.cursor=this.#fl?"col-resize":"row-resize",s.classList.add("gsui-hover"),Y.Fa(),this.setPointerCapture(t.pointerId),this.onpointerup=this.#ml.bind(this),this.onpointermove=this.#bl.bind(this))}#ml(t){this.style.cursor="",this.#vl.classList.remove("gsui-hover"),this.releasePointerCapture(t.pointerId),this.onpointermove=this.onpointerup=null}#bl(t){const s=(this.#fl?t.pageX:t.pageY)-this.#ol,i=this.#fl?this.clientWidth:this.clientHeight,e=s-$t.#xl(this.#wl,s,i,this.#yl);this.#ol+=e,Math.abs(e)>0&&$t.#xl(this.#wl,-e,i,this.#kl)}}Object.freeze($t),customElements.define("gsui-panels",$t),Y.Pa("gsui-popup",(()=>Y.Bn("div",{class:"gsuiPopup-window",tabindex:0},Y.Bn("div",{class:"gsuiPopup-head"}),Y.Bn("form",{class:"gsuiPopup-body"},Y.Bn("div",{class:"gsuiPopup-content"}),Y.Bn("div",{class:"gsuiPopup-message"}),Y.Bn("input",{class:"gsuiPopup-inputText",type:"text"}),Y.Bn("div",{class:"gsuiPopup-btns"},Y.Bn("input",{type:"button",class:"gsuiPopup-cancel",value:"Cancel"}),Y.Bn("input",{type:"submit",class:"gsuiPopup-ok",value:"Ok"}))))));class Ot extends HTMLElement{#Sl="";#Dl=!1;#Cl=null;#Pl=null;#Ea=Y.En("gsui-popup");#fs=Y.Fn(this.#Ea,{ok:".gsuiPopup-ok",cnt:".gsuiPopup-content",msg:".gsuiPopup-message",text:".gsuiPopup-inputText",form:".gsuiPopup-body",window:".gsuiPopup-window",header:".gsuiPopup-head",cancel:".gsuiPopup-cancel"});#Ml=this.#fs.window.classList;constructor(){super(),Object.seal(this),this.onclick=this.#fs.cancel.onclick=this.#Al.bind(this),this.#fs.form.onsubmit=this.#Tl.bind(this),this.#fs.window.onkeyup=this.#fs.window.onclick=t=>t.stopPropagation(),this.#fs.window.onkeydown=t=>{t.stopPropagation(),"Escape"===t.key&&this.#Al()}}connectedCallback(){this.firstChild||(this.append(this.#Ea),this.#Ea=null)}alert(t,s,i){return Y.Wa(this.#fs.cnt),this.#Ml.add("gsuiPopup-noText","gsuiPopup-noCancel"),this.#Bl(i,!1),this.#jl("alert",t,s)}confirm(t,s,i,e){return Y.Wa(this.#fs.cnt),this.#Ml.remove("gsuiPopup-noCancel"),this.#Ml.add("gsuiPopup-noText"),this.#Bl(i,e),this.#jl("confirm",t,s)}prompt(t,s,i,e,n){return Y.Wa(this.#fs.cnt),this.#Ml.remove("gsuiPopup-noText","gsuiPopup-noCancel"),this.#Bl(e,n),this.#jl("prompt",t,s,i)}custom(t){return Y.Wa(this.#fs.cnt),this.#Pl=t.submit||null,this.#Ml.remove("gsuiPopup-noText"),this.#Bl(t.ok,t.cancel||!1),t.element?this.#fs.cnt.append(t.element):this.#fs.cnt.append(...t.elements),this.#jl("custom",t.title)}close(){this.#Dl&&this.#Al()}#Bl(t,s){this.#Ml.toggle("gsuiPopup-noCancel",!1===s),this.#fs.cancel.value=s||"Cancel",this.#fs.ok.value=t||"Ok"}#jl(t,s,i,e){return this.#Sl=t,this.#Dl=!0,this.#fs.header.textContent=s,this.#fs.msg.innerHTML=i||"",this.#fs.text.value=arguments.length>3?e:"",this.#fs.window.dataset.type=t,this.classList.add("gsuiPopup-show"),setTimeout((()=>{if("prompt"===t)this.#fs.text.select();else{(("custom"!==t?null:this.#fs.cnt.querySelector("input, select"))||this.#fs.ok).focus()}}),250),new Promise((t=>this.#Cl=t)).then((t=>(this.#Dl=!1,this.classList.remove("gsuiPopup-show"),t)))}#Al(){this.#Cl("confirm"!==this.#Sl&&("prompt"===this.#Sl?null:void 0))}#Tl(){switch(this.#Sl){case"alert":this.#Cl(void 0);break;case"prompt":this.#Cl(this.#fs.text.value);break;case"confirm":this.#Cl(!0);break;case"custom":this.#Ll()}return!1}#El(t){switch(t.type){default:return t.value;case"file":return t.files;case"radio":return t.checked?t.value:null;case"range":case"number":return+t.value;case"checkbox":return t.checked;case"select-one":return Number.isNaN(+t.value)?t.value:+t.value}}#Ll(){const t=this.#Pl,s=Array.from(this.#fs.form).reduce(((t,s)=>{if(s.name){const i=this.#El(s);null!==i&&(t[s.name]=i)}return t}),{});if(t){const i=t(s);!1!==i&&(i&&i.then?i.then((t=>{!1!==t&&this.#Cl(s)})):this.#Cl(s))}else this.#Cl(s)}}Object.freeze(Ot),customElements.define("gsui-popup",Ot);class xt{#Wl=null;#Fl=null;#Il=null;#Kl=null;#zl=null;#Rl=this.#Nl.bind(this);constructor(t){Object.seal(this),this.#Wl=t.scrolledElem,this.#Fl=t.topShadow?[t.topShadow].flat():[],this.#Il=t.leftShadow?[t.leftShadow].flat():[],this.#Kl=t.rightShadow?[t.rightShadow].flat():[],this.#zl=t.bottomShadow?[t.bottomShadow].flat():[],xt.#Gl(this.#Fl,"top"),xt.#Gl(this.#Il,"left"),xt.#Gl(this.#Kl,"right"),xt.#Gl(this.#zl,"bottom"),this.#Wl.addEventListener("scroll",this.#Rl),Y.La(this.#Wl,this.#Rl)}static#Gl(t,s){t.forEach((t=>{t.classList.add("gsuiScrollShadow"),t.dataset.dir=s}))}#Nl(){const t=this.#Wl;xt.#Hl(this.#Fl,t.scrollTop),xt.#Hl(this.#Il,t.scrollLeft),xt.#Hl(this.#Kl,t.scrollWidth-t.clientWidth-t.scrollLeft),xt.#Hl(this.#zl,t.scrollHeight-t.clientHeight-t.scrollTop)}static#Hl(t,s){t.forEach((t=>{t.style.setProperty("--gsuiScrollShadow-dist",`${Math.min(s/5,5)}px`),t.classList.toggle("gsuiScrollShadow-shadowed",s>0)}))}}Y.Pa("gsui-slicer",(()=>[Y.Bn("div",{class:"gsuiSlicer-source"},Y.Bn("div",{class:"gsuiSlicer-source-head"},Y.Bn("i",{class:"gsuiSlicer-source-icon gsuiIcon","data-icon":"waveform"}),Y.Bn("span",{class:"gsuiSlicer-source-name"})),Y.Bn("div",{class:"gsuiSlicer-source-sample-wrap"},Y.Bn("div",{class:"gsuiSlicer-source-sample"},Y.Aa("svg",{class:"gsuiSlicer-source-wave",viewBox:"0 0 1000 64",preserveAspectRatio:"none"},Y.Aa("polyline")),Y.Bn("div",{class:"gsuiSlicer-currentTime gsuiSlicer-source-currentTime"})))),Y.Bn("div",{class:"gsuiSlicer-time"},Y.Bn("gsui-timeline")),Y.Bn("div",{class:"gsuiSlicer-preview"},Y.Bn("div",{class:"gsuiSlicer-currentTime gsuiSlicer-preview-currentTime"})),Y.Bn("div",{class:"gsuiSlicer-slices"},Y.Bn("div",{class:"gsuiSlicer-slices-scroll"},Y.Bn("div",{class:"gsuiSlicer-slices-in"},Y.Bn("div",{class:"gsuiSlicer-slices-beatlinesWrap"},Y.Bn("gsui-beatlines"),Y.Bn("gsui-beatlines",{vertical:!0})),Y.Bn("div",{class:"gsuiSlicer-currentTime gsuiSlicer-slices-currentTime"}),Y.Aa("svg",{class:"gsuiSlicer-slices-line",preserveAspectRatio:"none"},Y.Aa("line")),Y.Bn("div",{class:"gsuiSlicer-slices-wrap"})))),Y.Bn("div",{class:"gsuiSlicer-menu"},Y.Bn("button",{class:"gsuiSlicer-btn gsuiSlicer-btn-step",title:"Magnetism"},Y.Bn("span",{class:"gsuiSlicer-btn-step-value"}),Y.Bn("i",{class:"gsuiIcon","data-icon":"magnet"})),Y.Bn("button",{class:"gsuiSlicer-btn gsuiIcon","data-action":"moveY","data-icon":"hand-pointer",title:"Move slices vertically"}),Y.Bn("button",{class:"gsuiSlicer-btn gsuiIcon","data-action":"reset","data-icon":"slices",title:"Reset slices vertically"}),Y.Bn("button",{class:"gsuiSlicer-btn gsuiIcon","data-action":"split","data-icon":"cut",title:"Cut slices in half"}),Y.Bn("button",{class:"gsuiSlicer-btn gsuiIcon","data-action":"merge","data-icon":"erase",title:"Merge slices together"}))]));class St extends HTMLElement{static#Vl=1e3;static#Ul=64;#Ja=4;#ql="";#m={};#_l=null;#Yl=null;#ec=4;#Jl=0;#Xl=null;#Ql=null;#Zl=null;#tu=null;#Qa=this.#Za.bind(this);#La=Y.Ca.bind(null,this,"gsuiSlicer");#Ea=Y.En("gsui-slicer");#su=Y.Aa("polyline");#fs=Y.Fn(this.#Ea,{sourceCurrentTime:".gsuiSlicer-source-currentTime",slicesCurrentTime:".gsuiSlicer-slices-currentTime",previewCurrentTime:".gsuiSlicer-preview-currentTime",beatlines:["gsui-beatlines:first-child","gsui-beatlines:last-child"],srcName:".gsuiSlicer-source-name",srcWave:".gsuiSlicer-source-wave",diagonalLine:".gsuiSlicer-slices-line",timeline:"gsui-timeline",preview:".gsuiSlicer-preview",slices:".gsuiSlicer-slices-wrap",step:".gsuiSlicer-btn-step",tools:{moveY:".gsuiSlicer-btn[data-action='moveY']",reset:".gsuiSlicer-btn[data-action='reset']",split:".gsuiSlicer-btn[data-action='split']",merge:".gsuiSlicer-btn[data-action='merge']"}});timeline=this.#fs.timeline;constructor(){const t=document.querySelector("#gsuiSlicer-waveDefs defs");super(),Object.seal(this),t?this.#su.dataset.id=1+Array.prototype.reduce.call(t.children,((t,s)=>Math.max(t,s.dataset.id)),0):(document.body.prepend(Y.Aa("svg",{id:"gsuiSlicer-waveDefs"},Y.Aa("defs"))),this.#su.dataset.id=1),this.#su.id=`gsuiSlicer-waveDef-${this.#su.dataset.id}`,this.#fs.slices.oncontextmenu=()=>!1,this.#fs.slices.onpointerdown=this.#iu.bind(this),this.#fs.step.onclick=this.#eu.bind(this),this.#fs.tools.moveY.onclick=this.#fs.tools.reset.onclick=this.#fs.tools.split.onclick=this.#fs.tools.merge.onclick=this.#nu.bind(this),this.ondrop=t=>{const s=t.dataTransfer.getData("pattern-buffer");s&&null===Y.Kn(this,"disabled")&&this.#La("dropBuffer",s)},Y.In(this,{gsuiTimeline:{changeCurrentTime:t=>(Y.Wn(this,"currenttime",t.args[0]),!0)}})}connectedCallback(){this.#Ea&&(Y.Wn(this,"tabindex",-1),this.append(...this.#Ea),this.#Ea=null,Y.Ia(this,{currenttime:0,step:1,duration:4,timedivision:"4/4",hidetimes:!0}),this.#au("moveY")),document.querySelector("#gsuiSlicer-waveDefs defs").append(this.#su),Y.La(this,this.#Qa)}disconnectedCallback(){this.#su.remove(),Y.Ea(this,this.#Qa)}static get observedAttributes(){return["currenttime","duration","step","timedivision"]}attributeChangedCallback(t,s,i){if(!this.#Ea&&s!==i)switch(t){case"timedivision":this.#ec=+i.split("/")[1],Y.Wn(this.#fs.timeline,"timedivision",i),Y.Wn(this.#fs.beatlines[0],"timedivision",i),Y.Wn(this.#fs.beatlines[1],"timedivision",i);break;case"currenttime":this.#hu(+i);break;case"duration":this.#Ja=+i,this.#nh();break;case"step":this.#fs.step.firstChild.textContent=this.#ou(+i)}}getSlicesData(){return this.#ru()}setBufferName(t){this.#fs.srcName.textContent=t}setBuffer(t){this.#_l=t||null,this.classList.toggle("gsuiSlicer-loaded",this.#_l),this.classList.toggle("gsuiSlicer-missingBufferData",!this.#_l),this.#cu(t)}removeBuffer(){this.#_l=null,this.classList.remove("gsuiSlicer-loaded"),this.setBufferName(""),this.#cu(null)}addSlice(t,s){if(!(t in this.#m)){const i=Y.Aa("svg",{class:"gsuiSlicer-preview-wave","data-id":t,preserveAspectRatio:"none"},Y.Aa("use")),e=Y.Bn("div",{class:"gsuiSlicer-slices-slice","data-id":t});this.#Jl=Math.max(this.#Jl,t),i.firstChild.setAttributeNS("http://www.w3.org/1999/xlink","href",`#${this.#su.id}`),this.#m[t]=Object.seal({id:t,svg:i,sli:e,x:0,y:0,w:0}),this.changeSlice(t,s),this.#fs.preview.append(i),this.#fs.slices.append(e)}}changeSlice(t,s){const i=this.#lu(),e=this.#m[t],n=+(s.x??e.x).toFixed(10),a=+(s.y??e.y).toFixed(10),h=+(s.w??e.w).toFixed(10);("x"in s||"w"in s)&&(e.x=n,e.w=h,e.svg.style.left=e.sli.style.left=100*n+"%",e.svg.style.width=e.sli.style.width=100*h+"%"),"y"in s&&(e.y=a,e.sli.style.height=100*(1-a)+"%"),Y.Wn(e.svg,"viewBox",`${(n-(n-a))*St.#Vl} 0 ${h*St.#Vl} ${St.#Ul}`),e.x<=i&&i<e.x+e.w&&this.#uu(e)}removeSlice(t){const s=this.#m[t];s&&(delete this.#m[t],s.svg.remove(),s.sli.remove(),t===this.#Jl&&(this.#Jl=Object.keys(this.#m).reduce(((t,s)=>Math.max(t,s)),0)),s===this.#tu&&this.#uu(null))}#lu(){return Y.ja(this,"currenttime")/Y.ja(this,"duration")}#cu(t){t?(Kt.drawBuffer(this.#su,St.#Vl,St.#Ul,t),Kt.drawBuffer(this.#fs.srcWave.firstChild,St.#Vl,St.#Ul,t)):(this.#su.removeAttribute("points"),this.#fs.srcWave.firstChild.removeAttribute("points"))}#hu(t){const s=this.#lu();Y.Wn(this.#fs.timeline,"currenttime",t),this.#fs.slicesCurrentTime.style.left=100*s+"%",this.#fs.previewCurrentTime.style.left=100*s+"%",Y.Wn(this,"hidetimes",s<=0||s>=.995),this.#du(s)}#du(t){const s=Object.values(this.#m).find((s=>s.x<=t&&t<s.x+s.w)),i=s?Math.min(s.y+(t-s.x),1):t;this.#fs.sourceCurrentTime.style.left=100*i+"%",this.#uu(s)}#uu(t){t!==this.#tu&&(this.#tu&&(this.#tu.sli.classList.remove("gsuiSlicer-slices-slice-hl"),this.#tu.svg.classList.remove("gsuiSlicer-preview-wave-hl")),t&&(t.sli.classList.add("gsuiSlicer-slices-slice-hl"),t.svg.classList.add("gsuiSlicer-preview-wave-hl")),this.#tu=t)}#au(t,s){!1!==s&&(this.#ql=t),this.#fs.tools.moveY.classList.toggle("gsuiSlicer-btn-toggle","moveY"===t),this.#fs.tools.reset.classList.toggle("gsuiSlicer-btn-toggle","reset"===t),this.#fs.tools.merge.classList.toggle("gsuiSlicer-btn-toggle","merge"===t),this.#fs.tools.split.classList.toggle("gsuiSlicer-btn-toggle","split"===t)}#nh(t){Y.Wn(this.#fs.timeline,"pxperbeat",this.#fs.slices.clientWidth/(t||this.#Ja)),Y.Wn(this.#fs.beatlines[0],"pxperbeat",this.#fs.slices.clientWidth/(t||this.#Ja)),Y.Wn(this.#fs.beatlines[1],"pxperbeat",this.#fs.slices.clientHeight/(t||this.#Ja))}#ou(t){return t>=1?"1":t>=.5?"1 / 2":t>=.25?"1 / 4":"1 / 8"}#pu(t){const s=Y.Sa(t/this.#fs.slices.clientWidth,0,.9999);return Object.values(this.#m).find((t=>t.x<=s&&s<t.x+t.w))}#ru(){return Object.values(this.#m).reduce(((t,s)=>(t[s.id]={x:s.x,y:s.y,w:s.w},t)),{})}#Za(){const t=this.#fs.diagonalLine,s=t.clientWidth,i=t.clientHeight;Y.Wn(t,"viewBox",`0 0 ${s} ${i}`),Y.Wn(t.firstChild,"x2",s),Y.Wn(t.firstChild,"y2",i),this.#nh()}#eu(){const t=Y.ja(this,"step"),s=t>=1?2:t>=.5?4:t>=.25?8:1;Y.Wn(this,"step",1/s)}#nu(t){this.#au(t.target.dataset.action)}#iu(t){if((0===t.button||2===t.button)&&(this.#Yl="reset"===this.#ql||2===t.button?this.#gu.bind(this):"moveY"===this.#ql&&0===t.button?this.#mu.bind(this):"split"===this.#ql&&0===t.button?this.#bu.bind(this):"merge"===this.#ql&&0===t.button?this.#wu.bind(this):null,this.#Yl)){const s=this.#pu(t.offsetX);Y.Fa(),this.#Xl=this.#ru(),this.#fs.slices.setPointerCapture(t.pointerId),this.#fs.slices.onpointerup=this.#fu.bind(this),this.#fs.slices.onpointermove=this.#vu.bind(this),this.#Ql={},this.#Zl=s.id,this.#vu(t),2===t.button&&this.#au("reset",!1)}}#fu(t){const s=Y.Da(this.#Xl,this.#ru());this.#fs.slices.releasePointerCapture(t.pointerId),this.#fs.slices.onpointermove=this.#fs.slices.onpointerup=this.#Ql=this.#Zl=this.#Xl=null,this.#au(this.#ql),s&&this.#La("changeProp","slices",s)}#vu(t){const s=this.#pu(t.offsetX),i=this.#m[this.#Zl],e=Math.min(i.x,s.x),n=Math.max(i.x,s.x),a=Object.values(this.#m).filter((t=>e<=t.x&&t.x<=n)),h=this.#Yl(a,s,t);this.#Zl=h??s.id}#mu(t,s,i){const e=Y.ja(this,"duration"),n=Y.ja(this,"step"),a=Y.Sa(i.offsetY/this.#fs.slices.clientHeight,0,1),h=Math.floor(a*e*this.#ec/n)*n/e/this.#ec;t.forEach((t=>{t.y!==h&&this.changeSlice(t.id,{y:h})}))}#gu(t){t.forEach((t=>{t.y!==t.x&&this.changeSlice(t.id,{y:t.x})}))}#bu(t){t.forEach((t=>{if(!(t.id in this.#Ql)&&t.w>1/128){const s=t.w/2,i=this.#Jl+1,e={x:t.x+s,y:t.y,w:s};this.#Ql[i]=this.#Ql[t.id]=!0,this.changeSlice(t.id,{w:s}),this.addSlice(i,e)}}))}#wu(t,s){if(s.id!==this.#Zl){const s=t.reduce(((t,s)=>t.x<s.x?t:s));return this.changeSlice(s.id,{w:t.reduce(((t,s)=>t+s.w),0)}),t.forEach((t=>{t.id!==s.id&&this.removeSlice(t.id)})),s.id}}}Object.freeze(St),customElements.define("gsui-slicer",St),Y.Pa("gsui-slider",(()=>[Y.Bn("input",{type:"range",class:"gsuiSlider-input"}),Y.Bn("div",{class:"gsuiSlider-line"},Y.Bn("div",{class:"gsuiSlider-lineColor"})),Y.Aa("svg",{class:"gsuiSlider-svg"},Y.Aa("circle",{class:"gsuiSlider-svgLine"}),Y.Aa("circle",{class:"gsuiSlider-svgLineColor"})),Y.Bn("div",{class:"gsuiSlider-eventCatcher"})]));class Dt extends HTMLElement{#yu=0;#ku=100;#$u=1;#Ou=!1;#xu=0;#Su=4;#Du="";#Cu=!1;#Pu=!1;#Mu=null;#Au=!1;#Tu=0;#Bu=0;#ju=0;#La=Y.Ca.bind(null,this,"gsuiSlider");#Ea=Y.En("gsui-slider");#fs=Y.Fn(this.#Ea,{input:".gsuiSlider-input",line:".gsuiSlider-line",lineColor:".gsuiSlider-lineColor",svg:".gsuiSlider-svg",svgLine:".gsuiSlider-svgLine",svgLineColor:".gsuiSlider-svgLineColor"});static focused=null;constructor(){super(),this.value="",this.width=this.height=0,Object.seal(this),this.onwheel=this.#Ls.bind(this),this.onblur=this.#Lu.bind(this),this.onpointerdown=this.#$l.bind(this),this.onpointerleave=this.#Eu.bind(this)}connectedCallback(){if(this.#Ea){const t=this.getBoundingClientRect();this.append(...this.#Ea),this.width=t.width,this.height=t.height,this.#Ea=null,this.#Au=!0,this.#Wu(),this.#Fu(),Y.Wn(this,"tabindex","0")}}static get observedAttributes(){return["value","type","min","max","step","scroll-step","wheel-change","mousemove-size","stroke-width"]}attributeChangedCallback(t,s,i){if(s!==i){let s;switch(t){case"value":this.setValue(i);break;case"type":this.#Ji(i),this.#Wu(),s=!0;break;case"min":this.#fs.input.min=this.#yu=+i,s=!0;break;case"max":this.#fs.input.max=this.#ku=+i,s=!0;break;case"step":this.#fs.input.step=+i,s=!0;break;case"scroll-step":this.#$u=+i;break;case"wheel-change":this.#Ou="string"==typeof i;break;case"mousemove-size":this.#xu=+i;break;case"stroke-width":this.#Su=+i,this.#Wu()}s&&(this.#Du=this.#Iu(),this.#Fu())}}setValue(t,s){if(!this.onpointermove||s){const i=this.#Iu(),e=(this.#fs.input.value=t,this.#Iu());e!==i&&(this.#Fu(),s&&this.#La("input",+e)),s||(this.#Du=e)}}#Ji(t){const s=this.#fs.lineColor.style,i="circular"===t,e="linear-x"===t;this.#Cu=i,this.#Pu=e,this.classList.toggle("gsuiSlider-circular",i),this.classList.toggle("gsuiSlider-linear",!i),i||(e?(s.left=s.width="",s.top="0",s.height="100%"):(s.top=s.height="",s.left="0",s.width="100%"))}#Wu(){if(this.#Cu&&this.width&&this.height){const t=Math.min(this.width,this.height),s=t/2,i=~~((t-this.#Su)/2);Y.Wn(this.#fs.svg,"viewBox",`0 0 ${t} ${t}`),Y.Wn(this.#fs.svgLine,{r:i,cx:s,cy:s}),Y.Wn(this.#fs.svgLineColor,{r:i,cx:s,cy:s}),this.#fs.svgLine.style.strokeWidth=this.#fs.svgLineColor.style.strokeWidth=this.#Su,this.#ju=2*i*Math.PI}}#Iu(){const t=this.#fs.input.value;return Math.abs(+t)<1e-6?"0":t}#Ku(){return this.#ku-this.#yu}#zu(){return this.#xu||(this.#Cu?this.#ju:this.#Pu?this.#fs.line.getBoundingClientRect().width:this.#fs.line.getBoundingClientRect().height)}#Fu(){if(this.value=+this.#Iu(),this.#Au){const t=this.#Ku(),s=(this.value-this.#yu)/t,i=-this.#yu/t,e=Math.abs(s-i),n=Math.min(s,i);if(this.#Cu){const t=this.#fs.svgLineColor.style;t.transform=`rotate(${90+360*n}deg)`,t.strokeDasharray=e*this.#ju+", 999999"}else{const t=this.#fs.lineColor.style;this.#Pu?(t.left=100*n+"%",t.width=100*e+"%"):(t.bottom=100*n+"%",t.height=100*e+"%")}}}#wi(){const t=this.#Iu();this.#Du!==t&&(Y.Wn(this,"value",t),this.#La("change",+t),this.#Du=t)}#Ls(t){if(!Y.Ba(this,"disabled")&&this.#Ou){const s=t.deltaY>0?-1:1;return this.setValue(+this.#Iu()+this.#$u*s,!0),!1}}#$l(t){Y.Ba(this,"disabled")||(this.#Tu=this.#Ku()/this.#zu(),this.#Bu=0,this.#Mu=t.pointerId,this.setPointerCapture(t.pointerId),this.onpointermove=this.#bl.bind(this),this.onpointerup=this.#ml.bind(this),this.focus(),this.requestPointerLock(),this.#La("inputStart",this.value))}#bl(t){const s=this.#Ku()/5,i=this.#Cu||!this.#Pu?-t.movementY:t.movementX,e=+this.#Du+(this.#Bu+i)*this.#Tu;this.#yu-s<e&&e<this.#ku+s&&(this.#Bu+=i),this.setValue(e,!0)}#ml(){document.exitPointerLock(),this.#Mu&&(this.releasePointerCapture(this.#Mu),this.#Mu=null),this.onpointermove=this.onpointerup=null,this.#wi(),this.#La("inputEnd",this.value)}#Lu(){this.onpointermove&&this.#ml()}#Eu(){this.#wi()}}Object.seal(Dt),customElements.define("gsui-slider",Dt),Y.Pa("gsui-slidergroup",(()=>Y.Bn("div",{class:"gsuiSliderGroup-slidersWrap"},Y.Bn("div",{class:"gsuiSliderGroup-sliders"},Y.Bn("gsui-beatlines",{coloredbeats:""}),Y.Bn("div",{class:"gsuiSliderGroup-currentTime"}),Y.Bn("div",{class:"gsuiSliderGroup-defaultValue"}),Y.Bn("div",{class:"gsuiSliderGroup-loop gsuiSliderGroup-loopA"}),Y.Bn("div",{class:"gsuiSliderGroup-loop gsuiSliderGroup-loopB"}))))),Y.Pa("gsui-slidergroup-slider",(()=>Y.Bn("div",{class:"gsuiSliderGroup-slider"},Y.Bn("div",{class:"gsuiSliderGroup-sliderInner"}))));class Ct extends HTMLElement{#yu=0;#ku=0;#Ru=0;#Nu=0;#Gu=0;#Hu=new Map;#Vu=new Map;#Uu=new Map;#qu=null;#qh=null;#_h=null;#_u=Object.freeze({when:this.#Yu.bind(this),value:this.#Ju.bind(this),duration:this.#Xu.bind(this),selected:this.#Qu.bind(this)});#Ea=Y.En("gsui-slidergroup");#fs=Y.Fn(this.#Ea,{slidersParent:".gsuiSliderGroup-sliders",defValue:".gsuiSliderGroup-defaultValue",beatlines:"gsui-beatlines",currentTime:".gsuiSliderGroup-currentTime",loopA:".gsuiSliderGroup-loopA",loopB:".gsuiSliderGroup-loopB"});scrollElement=this.#Ea;constructor(){super(),Object.seal(this),this.#Ea.oncontextmenu=()=>!1}connectedCallback(){if(!this.firstChild){const t=this.hasAttribute("beatlines");t||(this.#fs.beatlines.remove(),this.#fs.currentTime.remove(),this.#fs.loopA.remove(),this.#fs.loopB.remove(),this.#fs.beatlines=this.#fs.currentTime=this.#fs.loopA=this.#fs.loopB=null),this.append(this.scrollElement),this.#nh(),this.#fs.slidersParent.onmousedown=this.#Zu.bind(this),Y.Ia(this,{pxperbeat:64}),t&&Y.Ia(this,{currenttime:0,timedivision:"4/4"})}}static get observedAttributes(){return["timedivision","pxperbeat","currenttime","loopa","loopb"]}attributeChangedCallback(t,s,i){if(s!==i)switch(t){case"timedivision":Y.Wn(this.#fs.beatlines,"timedivision",i);break;case"pxperbeat":this.#nh();break;case"currenttime":this.#fs.currentTime.style.left=`${i}em`;break;case"loopa":this.#fs.loopA.classList.toggle("gsuiSliderGroup-loopOn",i),i&&(this.#fs.loopA.style.width=`${i}em`);break;case"loopb":this.#fs.loopB.classList.toggle("gsuiSliderGroup-loopOn",i),i&&(this.#fs.loopB.style.left=`${i}em`)}}empty(){this.#Hu.forEach((t=>t.element.remove())),this.#Hu.clear(),this.#Vu.clear(),this.#Uu.clear()}options({min:t,max:s,step:i,def:e}){this.#yu=t,this.#ku=s,this.#Nu=i,this.#Ru=e??s,this.#fs.defValue.style.top=100-(this.#Ru-t)/(s-t)*100+"%"}delete(t){this.#Hu.get(t).element.remove(),this.#Hu.delete(t),this.#Vu.delete(t),this.#td()}set(t,s,i,e){const n=Y.En("gsui-slidergroup-slider"),a=Object.seal({element:n,when:s,duration:i,value:e,selected:!1});n.dataset.id=t,this.#Hu.set(t,a),this.#Yu(a,s),this.#Ju(a,e),this.#Xu(a,i),this.#fs.slidersParent.append(n)}setProp(t,s,i){const e=this.#Hu.get(t);e&&(e[s]=i,this.#_u[s](e,i))}#sd(t){return+(Math.round(t/this.#Nu)*this.#Nu).toFixed(8)}#nh(){const t=Y.ja(this,"pxperbeat");this.#fs.slidersParent.style.fontSize=`${t}px`,this.#fs.beatlines&&Y.Wn(this.#fs.beatlines,"pxperbeat",t)}#Yu(t,s){t.element.style.left=`${s}em`,t.element.style.zIndex=Math.floor(100*s)}#Xu(t,s){t.element.style.width=`${s}em`}#Qu(t,s){if(s!==this.#Vu.has(t.element.dataset.id)){const i=+t.element.style.zIndex;s?this.#Vu.set(t.element.dataset.id,t):this.#Vu.delete(t.element.dataset.id),t.element.classList.toggle("gsuiSliderGroup-sliderSelected",!!s),t.element.style.zIndex=i+(s?1e3:-1e3),this.#td()}}#td(){this.#fs.slidersParent.classList.toggle("gsuiSliderGroup-slidersSelected",this.#Vu.size>0)}#Ju(t,s){const i=t.element.firstElementChild,e=i.style,n=this.#ku,a=this.#yu,h=Number.isFinite(s)?s:this.#Ru,o=a>=0==n>=0,r=Math.abs(h-(o?a:0))/(n-a)*100,c=o?0:Math.abs(a)/(n-a)*100;e.height=`${r}%`,i.classList.toggle("gsuiSliderGroup-sliderInnerDown",h<0)?(e.top=100-c+"%",e.bottom="auto"):(e.top="auto",e.bottom=`${c}%`)}#Zu(t){this.#qh||0!==t.button&&2!==t.button||(this.#qu=this.#fs.slidersParent.getBoundingClientRect(),this.#Gu=t.button,this.#Uu.clear(),this.#Hu.forEach(((t,s)=>this.#Uu.set(s,t.value))),this.#qh=this.#id.bind(this),this.#_h=this.#ed.bind(this),document.addEventListener("mouseup",this.#qh),document.addEventListener("mousemove",this.#_h),Y.Fa(),Y.Oa.show("pointer"),this.#ed(t))}#ed(t){const s=this.#Vu.size>0?this.#Vu:this.#Hu,i=t.pageX-this.#qu.left,e=t.pageY-this.#qu.top,n=this.#yu,a=this.#ku,h=i/Y.ja(this,"pxperbeat"),o=2===this.#Gu?this.#Ru:this.#sd(n+(a-n)*(1-Math.min(Math.max(0,e/this.#qu.height),1)));let r=0;s.forEach((t=>{t.when<=h&&r<=h&&(r=t.when)})),s.forEach((t=>{r<=t.when&&t.when<=h&&h<=t.when+t.duration&&(t.value=o,this.#Ju(t,o),Y.Ca(this,"gsuiSliderGroup","input",t.element.dataset.id,o))}))}#id(){const t=[];Y.Oa.hide(),document.removeEventListener("mouseup",this.#qh),document.removeEventListener("mousemove",this.#_h),this.#qh=this.#_h=null,this.#Hu.forEach(((s,i)=>{s.value!==this.#Uu.get(i)&&t.push([i,s.value])})),t.length&&Y.Ca(this,"gsuiSliderGroup","change",t),Y.Ca(this,"gsuiSliderGroup","inputEnd")}}Object.freeze(Ct),customElements.define("gsui-slidergroup",Ct),Y.Pa("gsui-timeline",(()=>[Y.Bn("div",{class:"gsuiTimeline-steps"}),Y.Bn("div",{class:"gsuiTimeline-beats"}),Y.Bn("div",{class:"gsuiTimeline-measures"}),Y.Bn("div",{class:"gsuiTimeline-loopLine"},Y.Bn("div",{class:"gsuiTimeline-loop"},Y.Bn("div",{class:"gsuiTimeline-loopBody"}),Y.Bn("div",{class:"gsuiTimeline-loopHandle gsuiTimeline-loopHandleA"}),Y.Bn("div",{class:"gsuiTimeline-loopBorder gsuiTimeline-loopBorderA"}),Y.Bn("div",{class:"gsuiTimeline-loopHandle gsuiTimeline-loopHandleB"}),Y.Bn("div",{class:"gsuiTimeline-loopBorder gsuiTimeline-loopBorderB"}))),Y.Bn("div",{class:"gsuiTimeline-timeLine"},Y.Aa("svg",{class:"gsuiTimeline-cursor",width:"16",height:"10"},Y.Aa("polygon",{points:"2,2 8,8 14,2"})),Y.Aa("svg",{class:"gsuiTimeline-cursorPreview",width:"16",height:"10"},Y.Aa("polygon",{points:"2,2 8,8 14,2"})))]));class Pt extends HTMLElement{#Mo="";#Nu=1;#nd=null;#ad=null;#hd="";#od=!1;#rd=0;#cd=0;#ld=0;#ud=0;#dd=0;#La=Y.Ca.bind(null,this,"gsuiTimeline");#Rl=this.#Nl.bind(this);#Qa=this.#Za.bind(this);#_o=this.#io.bind(this);#qo=this.#so.bind(this);#Ea=Y.En("gsui-timeline");#fs=Y.Fn(this.#Ea,{steps:".gsuiTimeline-steps",beats:".gsuiTimeline-beats",measures:".gsuiTimeline-measures",loop:".gsuiTimeline-loop",timeLine:".gsuiTimeline-timeLine",cursor:".gsuiTimeline-cursor",cursorPreview:".gsuiTimeline-cursorPreview"});constructor(){super(),this.beatsPerMeasure=4,this.stepsPerBeat=4,this.pxPerBeat=10,this.pxPerMeasure=this.beatsPerMeasure*this.pxPerBeat,this.loopA=this.loopB=0,this.looping=!1,Object.seal(this),this.#fs.cursorPreview.remove(),this.onmousedown=this.#Rc.bind(this)}static numbering(t){document.body.style.setProperty("--gsuiTimeline-numbering",+t)}connectedCallback(){this.firstChild||(this.append(...this.#Ea),this.#Ea=null,Y.Ia(this,{step:1,currenttime:0})),this.#ad=this.#pd(this.parentNode),this.#ad.addEventListener("scroll",this.#Rl),Y.La(this.#ad,this.#Qa),this.#gd(),this.#md(),this.#bd()}disconnectedCallback(){this.#ad.removeEventListener("scroll",this.#Rl),Y.Ea(this.#ad,this.#Qa)}static get observedAttributes(){return["step","timedivision","pxperbeat","loop","currenttime","currenttime-preview"]}attributeChangedCallback(t,s,i){if(s!==i)switch(t){case"step":this.#Nu=+i;break;case"loop":this.#wd(i);break;case"pxperbeat":this.#fd(+i);break;case"currenttime":this.#vd(+i);break;case"timedivision":this.#eh(i);break;case"currenttime-preview":this.#yd(null===i?null:+i)}}#fd(t){const s=Math.max(0,Math.min((t-32)/256,.5)),i=Math.max(0,Math.min((t-20)/40,.6)),e=Math.max(0,Math.min((t-6)/20,.7));this.pxPerBeat=t,this.pxPerMeasure=this.beatsPerMeasure*t,this.#od=t<6,this.style.fontSize=`${t}px`,this.style.setProperty("--gsuiTimeline-beats-incr",this.#od?this.beatsPerMeasure:1),this.style.setProperty("--gsuiTimeline-measures-opacity",e),this.#fs.steps.style.opacity=s,this.#fs.beats.style.opacity=i,this.#ad&&(this.#gd(),this.#md(),this.#bd())}#eh(t){const[s,i]=t.split("/");this.beatsPerMeasure=+s,this.stepsPerBeat=+i,this.pxPerMeasure=this.beatsPerMeasure*this.pxPerBeat,this.style.setProperty("--gsuiTimeline-beats-per-measure",this.beatsPerMeasure),this.#kd(),this.#ad&&(this.#md(),this.#bd())}#wd(t){const[s,i]=(t||"0-0").split("-");this.looping=!!t,this.loopA=+s,this.loopB=+i,this.#$d()}#vd(t){this.#fs.cursor.style.left=`${t}em`}#yd(t){if(null===t)this.#fs.cursorPreview.remove();else{const s=this.beatRound(t);t.toFixed(3)!==s.toFixed(3)?Y.Wn(this,"currenttime-preview",s):(this.#fs.cursorPreview.style.left=`${t}em`,this.#fs.cursorPreview.parentNode||this.#fs.timeLine.append(this.#fs.cursorPreview))}}beatCeil(t){return this.#Od(Math.ceil,t)}beatRound(t){return this.#Od(Math.round,t)}beatFloor(t){return this.#Od(Math.floor,t)}#Od(t,s){const i=1/this.stepsPerBeat*this.#Nu;return t(s/i)*i}#pd(t){const s=getComputedStyle(t).overflowX;return"auto"===s||"scroll"===s||t===document.body?t:this.#pd(t.parentNode)}#xd(t){this.classList.remove(`gsuiTimeline-${this.#Mo}`),this.classList.toggle(`gsuiTimeline-${t}`,!!t),this.#Mo=t}#Sd(t){const s=this.#fs.timeLine.getBoundingClientRect().x;return Math.max(0,this.beatRound((t-s)/this.pxPerBeat))}#kd(){const t=this.stepsPerBeat,s=[];for(let i=1;i<t;++i)s.push(`transparent calc( ${i/t}em - 1px )`,`currentColor calc( ${i/t}em - 1px )`,`currentColor calc( ${i/t}em + 1px )`,`transparent calc( ${i/t}em + 1px )`);this.#fs.steps.style.backgroundImage=`\n\t\t\trepeating-linear-gradient(90deg, transparent 0em,\n\t\t\t\t${s.join(",")},\n\t\t\t\ttransparent calc( 1em )\n\t\t\t)\n\t\t`}#gd(){const t=Math.floor(this.#ad.scrollLeft/this.pxPerMeasure),s=this.#od?Math.floor(t/this.beatsPerMeasure)*this.beatsPerMeasure:t,i=s!==this.#nd;return i&&(this.#nd=s,this.style.setProperty("--gsuiTimeline-beats-offset",s)),i}#md(){const t=this.#fs.measures,s=this.pxPerMeasure*(this.#od?this.beatsPerMeasure:1),i=Math.ceil(this.#ad.clientWidth/s)+1;if(i<0||i>500)return console.warn("gsuiTimeline: anormal number of nodes to create",i);if(t.children.length>i)for(;t.children.length>i;)t.lastChild.remove();else for(;t.children.length<i;)t.append(Y.Bn("span",{class:"gsuiTimeline-measure"}))}#bd(){Array.prototype.forEach.call(this.#fs.measures.children,((t,s)=>{t.classList.toggle("gsuiTimeline-measureBig",this.#od||(this.#nd+s)%this.beatsPerMeasure==0)}))}#$d(){this.classList.toggle("gsuiTimeline-looping",this.looping),this.looping&&(this.#fs.loop.style.left=`${this.loopA}em`,this.#fs.loop.style.width=this.loopB-this.loopA+"em")}#Nl(){this.#gd()&&!this.#od&&this.#bd()}#Za(){this.#md(),this.#bd()}#Rc(t){const s=t.target.classList.contains("gsuiTimeline-loopLine");s&&Date.now()-this.#rd>500?this.#rd=Date.now():(this.#xd(t.target===this.#fs.cursor.parentNode?"draggingTime":t.target.classList.contains("gsuiTimeline-loopBody")?"draggingLoopBody":t.target.classList.contains("gsuiTimeline-loopHandleA")?"draggingLoopHandleA":t.target.classList.contains("gsuiTimeline-loopHandleB")||s?"draggingLoopHandleB":""),this.#Mo&&(this.#cd=null,this.#ld=this.#Sd(t.pageX),s?(this.loopA=this.loopB=this.#ld,this.#La("inputLoopStart")):this.#La("inputCurrentTimeStart"),this.#hd=Y.Kn(this,"loop"),this.#ud=this.loopA,this.#dd=this.loopB,document.addEventListener("mousemove",this.#qo),document.addEventListener("mouseup",this.#_o),Y.Fa(),this.#so(t)))}#so(t){const s=this.#Sd(t.pageX),i=s-this.#ld;if(i!==this.#cd)switch(this.#cd=i,this.#Mo){case"draggingTime":Y.Wn(this,"currenttime-preview",s),this.#La("inputCurrentTime",s);break;case"draggingLoopBody":{const t=Math.max(-this.#ud,i),s=this.#ud+t,e=this.#dd+t,n=`${s}-${e}`;n!==Y.Kn(this,"loop")&&(Y.Wn(this,"loop",n),this.#La("inputLoop",s,e))}break;case"draggingLoopHandleA":case"draggingLoopHandleB":{const t="draggingLoopHandleA"===this.#Mo,s=t?Math.max(-this.#ud,i):i,e=this.#ud+(t?s:0),n=this.#dd+(t?0:s),a=Math.min(e,n),h=Math.max(e,n),o=`${a}-${h}`;e>n&&(t?(this.#xd("draggingLoopHandleB"),this.#ud=this.#dd):(this.#xd("draggingLoopHandleA"),this.#dd=this.#ud),this.#ld=this.#ud),o!==Y.Kn(this,"loop")&&(a!==h?(Y.Wn(this,"loop",o),this.#La("inputLoop",a,h)):this.hasAttribute("loop")&&(this.removeAttribute("loop"),this.#La("inputLoop",!1)))}}}#io(){switch(document.removeEventListener("mousemove",this.#qo),document.removeEventListener("mouseup",this.#_o),this.#Mo){case"draggingTime":{const t=Y.Kn(this,"currenttime-preview");this.removeAttribute("currenttime-preview"),this.#La("inputCurrentTimeEnd"),t!==Y.Kn(this,"currenttime")&&(Y.Wn(this,"currenttime",t),this.#La("changeCurrentTime",+t))}break;case"draggingLoopBody":case"draggingLoopHandleA":case"draggingLoopHandleB":this.#La("inputLoopEnd"),Y.Kn(this,"loop")!==this.#hd&&(this.loopA!==this.loopB?this.#La("changeLoop",this.loopA,this.loopB):(this.removeAttribute("loop"),this.#La("changeLoop",!1)))}this.#xd("")}}Object.freeze(Pt),customElements.define("gsui-timeline",Pt),Y.Pa("gsui-timewindow",(()=>[Y.Bn("div",{class:"gsuiTimewindow-panel"},Y.Bn("div",{class:"gsuiTimewindow-panelUp"},Y.Bn("button",{class:"gsuiTimewindow-step"},Y.Bn("span",{class:"gsuiTimewindow-stepValue"}),Y.Bn("i",{class:"gsuiIcon","data-icon":"magnet"}))),Y.Bn("div",{class:"gsuiTimewindow-panelContent"}),Y.Bn("div",{class:"gsuiTimewindow-panelContentDown"},Y.Bn("div",{class:"gsuiTimewindow-panelExtend gsuiTimewindow-panelExtendX"})),Y.Bn("div",{class:"gsuiTimewindow-panelExtend gsuiTimewindow-panelExtendY"})),Y.Bn("div",{class:"gsuiTimewindow-main"},Y.Bn("div",{class:"gsuiTimewindow-time"},Y.Bn("gsui-timeline")),Y.Bn("div",{class:"gsuiTimewindow-mainBody"},Y.Bn("div",{class:"gsuiTimewindow-mainContent"},Y.Bn("gsui-beatlines",{coloredbeats:""}),Y.Bn("div",{class:"gsuiTimewindow-currentTime"}),Y.Bn("div",{class:"gsuiTimewindow-loop gsuiTimewindow-loopA"}),Y.Bn("div",{class:"gsuiTimewindow-loop gsuiTimewindow-loopB"}),Y.Bn("div",{class:"gsuiTimewindow-rows"}))),Y.Bn("div",{class:"gsuiTimewindow-contentDown"},Y.Bn("div",{class:"gsuiTimewindow-panelExtend gsuiTimewindow-panelExtendX"})))]));class Mt extends HTMLElement{#$o=0;#Dd=0;#Cd=0;#Pd=0;#Md=0;#Ad=this.#Td.bind(this);#Bd=this.#jd.bind(this);#Ld=this.#Ed.bind(this);#Ea=Y.En("gsui-timewindow");#fs=Y.Fn(this.#Ea,{main:".gsuiTimewindow-main",down:".gsuiTimewindow-contentDown",panel:".gsuiTimewindow-panel",panelDown:".gsuiTimewindow-panelContentDown",stepBtn:".gsuiTimewindow-step",timeline:"gsui-timeline",beatlines:"gsui-beatlines",loopA:".gsuiTimewindow-loopA",loopB:".gsuiTimewindow-loopB",currentTime:".gsuiTimewindow-currentTime"});constructor(){super(),this.timeline=this.#fs.timeline,Object.seal(this),Y.In(this,{gsuiTimeline:{inputCurrentTime:Y.Sn,changeCurrentTime:t=>(Y.Wn(this,"currenttime",t.args[0]),!0),inputLoop:t=>(Y.Wn(this,"loop",Number.isFinite(t.args[0])&&`${t.args[0]}-${t.args[1]}`),!0),inputLoopEnd:()=>this.style.overflowY="",inputLoopStart:()=>this.style.overflowY="hidden",inputCurrentTimeEnd:()=>this.style.overflowY="",inputCurrentTimeStart:()=>this.style.overflowY="hidden"}}),this.ondragstart=()=>!1,this.#fs.main.onwheel=this.#Ls.bind(this),this.#fs.stepBtn.onclick=this.#eu.bind(this),this.#fs.main.querySelector(".gsuiTimewindow-mainContent").oncontextmenu=t=>t.preventDefault(),this.#fs.panel.querySelector(".gsuiTimewindow-panelContent").onwheel=this.#Wd.bind(this),this.#fs.panel.querySelector(".gsuiTimewindow-panelExtendY").onmousedown=this.#Fd.bind(this,"side")}connectedCallback(){this.firstChild||(this.#fs.panel.style.minWidth=`${Y.ja(this,"panelsize")||100}px`,this.append(...this.#Ea),this.hasAttribute("downpanel")?(this.#fs.panelDown.firstChild.onmousedown=this.#fs.down.firstChild.onmousedown=this.#Fd.bind(this,"down"),this.#fs.panelDown.style.height=this.#fs.down.style.height=`${Y.ja(this,"downpanelsize")||50}px`):(this.#fs.panelDown.remove(),this.#fs.down.remove()),this.#Ea=null,Y.Ia(this,{step:1,pxperbeat:100,lineheight:48,currenttime:0}),new xt({scrolledElem:this,leftShadow:this.#fs.panel,topShadow:[this.querySelector(".gsuiTimewindow-panelUp"),this.querySelector(".gsuiTimewindow-time")]}))}static get observedAttributes(){return["step","timedivision","pxperbeat","lineheight","currenttime","loop"]}attributeChangedCallback(t,s,i){if(s!==i)switch(t){case"step":Y.Wn(this.#fs.timeline,"step",i),this.#fs.stepBtn.firstChild.textContent=this.#ou(+i);break;case"timedivision":Y.Wn(this.#fs.timeline,"timedivision",i),Y.Wn(this.#fs.beatlines,"timedivision",i);break;case"pxperbeat":this.#$o=+i,Y.Wn(this.#fs.timeline,"pxperbeat",i),Y.Wn(this.#fs.beatlines,"pxperbeat",i),this.style.setProperty("--gsuiTimewindow-pxperbeat",`${i}px`),this.#fs.currentTime.style.fontSize=this.#fs.loopA.style.fontSize=this.#fs.loopB.style.fontSize=`${i}px`;break;case"lineheight":this.#Cd=+i,this.style.setProperty("--gsuiTimewindow-lineH",`${i}px`);break;case"currenttime":{const t=Y.ja(this,"currenttimestep");Y.Wn(this.#fs.timeline,"currenttime",i),this.#fs.currentTime.style.left=t?(i/t|0)*t+"em":`${i}em`}break;case"loop":if(i){const[t,s]=i.split("-");this.classList.add("gsuiTimewindow-looping"),Y.Wn(this.#fs.timeline,"loop",i),this.#fs.loopA.style.width=`${t}em`,this.#fs.loopB.style.left=`${s}em`}else this.classList.remove("gsuiTimewindow-looping"),this.#fs.timeline.removeAttribute("loop")}}#ou(t){return t>=1?"1":t>=.5?"1 / 2":t>=.25?"1 / 4":"1 / 8"}#eu(){const t=Y.ja(this,"step"),s=t>=1?.5:t>=.5?.25:t>=.25?.125:1;Y.Wn(this,"step",s)}#Ls(t){if(t.ctrlKey){const s=this.#$o,i=Y.ja(this,"pxperbeatmin")||8,e=Y.ja(this,"pxperbeatmax")||512,n=parseInt(this.#fs.panel.style.minWidth),a=t.pageX-this.getBoundingClientRect().left-n,h=this.scrollLeft/s,o=t.deltaY>0?.9:1.1,r=Math.round(Math.min(Math.max(i,s*o),e));if(t.preventDefault(),r!==s){const t=a/s*(r-s);Y.Wn(this,"pxperbeat",r),this.scrollLeft=h*r+t,Y.Ca(this,"gsuiTimewindow","pxperbeat",r)}}}#Wd(t){if(t.ctrlKey){const s=this.#Cd,i=Y.ja(this,"lineheightmin")||24,e=Y.ja(this,"lineheightmax")||256,n=parseInt(this.#fs.timeline.clientHeight),a=t.pageY-this.getBoundingClientRect().top-n,h=this.scrollTop/s,o=t.deltaY>0?.9:1.1,r=Math.round(Math.min(Math.max(i,s*o),e));if(t.preventDefault(),r!==s){const t=a/s*(r-s);Y.Wn(this,"lineheight",r),this.scrollTop=h*r+t,Y.Ca(this,"gsuiTimewindow","lineheight",r)}}}#Fd(t,s){Y.Fa(),"side"===t?(this.#Dd=this.#fs.panel.clientWidth,this.#Pd=s.pageX,Y.Oa.show("ew-resize"),document.addEventListener("mousemove",this.#Bd)):(this.#Dd=this.#fs.down.clientHeight,this.#Md=s.pageY,Y.Oa.show("ns-resize"),document.addEventListener("mousemove",this.#Ld)),document.addEventListener("mouseup",this.#Ad)}#jd(t){const s=this.#Dd+(t.pageX-this.#Pd),i=Y.ja(this,"panelsizemin")||50,e=Y.ja(this,"panelsizemax")||260,n=Math.max(i,Math.min(s,e));this.#fs.panel.style.minWidth=`${n}px`}#Ed(t){const s=this.#Dd+(this.#Md-t.pageY),i=Y.ja(this,"downpanelsizemin")||50,e=Y.ja(this,"downpanelsizemax")||260,n=Math.max(i,Math.min(s,e));this.#fs.panelDown.style.height=this.#fs.down.style.height=`${n}px`}#Td(){document.removeEventListener("mousemove",this.#Ld),document.removeEventListener("mousemove",this.#Bd),document.removeEventListener("mouseup",this.#Ad),Y.Oa.hide()}}Object.freeze(Mt),customElements.define("gsui-timewindow",Mt),Y.Pa("gsui-libraries",(()=>[Y.Bn("div",{class:"gsuiLibraries-head"},Y.Bn("i",{class:"gsuiLibraries-head-icon gsuiIcon","data-icon":"waveform"}),Y.Bn("span",{class:"gsuiLibraries-head-title"},"library"),Y.Bn("div",{class:"gsuiLibraries-libBtns"},Y.Bn("button",{type:"button",class:"gsuiLibraries-libBtn","data-lib":"default"},"default"),Y.Bn("button",{type:"button",class:"gsuiLibraries-libBtn","data-lib":"local"},"local"))),Y.Bn("div",{class:"gsuiLibraries-body"},Y.Bn("gsui-library",{class:"gsuiLibrary-default"}),Y.Bn("gsui-library",{class:"gsuiLibrary-local"}))]));class At extends HTMLElement{#Ea=Y.En("gsui-libraries");#fs=Y.Fn(this.#Ea,{libBtns:".gsuiLibraries-libBtns",libDef:".gsuiLibrary-default",libLoc:".gsuiLibrary-local"});#Id={default:this.#fs.libDef,local:this.#fs.libLoc};constructor(){super(),Object.seal(this),this.#fs.libBtns.onclick=At.#Kd.bind(null,this),this.#Id.default.setPlaceholder("loading..."),this.#Id.local.setPlaceholder("drag'n drop your own samples in the app, they will appear here")}connectedCallback(){this.#Ea&&(this.append(...this.#Ea),this.#Ea=null,Y.Ia(this,{lib:"default"}))}getLibrary(t){return this.#Id[t]}static#Kd(t,s){s.target.dataset.lib&&Y.Wn(t,"lib",s.target.dataset.lib)}}Object.freeze(At),customElements.define("gsui-libraries",At),Y.Pa("gsui-library",(()=>[Y.Bn("div",{class:"gsuiLibrary-head"}),Y.Bn("div",{class:"gsuiLibrary-body"},Y.Bn("div",{class:"gsuiLibrary-placeholder"},"no sample here..."))])),Y.Pa("gsui-library-sep",(t=>Y.Bn("div",{class:"gsuiLibrary-sep gsuiLibrary-sep-expanded","data-id":t,title:t},Y.Bn("button",{class:"gsuiLibrary-sep-btn",type:"button",tabindex:-1},Y.Bn("i",{class:"gsuiIcon","data-icon":"caret-right"}),Y.Bn("span",null,t))))),Y.Pa("gsui-library-sample",(t=>Y.Bn("div",{class:"gsuiLibrary-sample gsuiLibrary-sample-expanded",draggable:"true","data-id":t.id,"data-name":t.name,title:t.name},Y.Bn("div",{class:"gsuiLibrary-sample-wave"},Y.Aa("svg",{class:"gsuiLibrary-sample-svg",viewBox:"0 0 40 10",preserveAspectRatio:"none"},Y.Aa("polygon",{class:"gsuiLibrary-sample-poly",points:t.points}))))));class Tt extends HTMLElement{#La=Y.Ca.bind(null,this,"gsuiLibrary");#Ea=Y.En("gsui-library");#fs=Y.Fn(this.#Ea,{body:".gsuiLibrary-body",placeholder:".gsuiLibrary-placeholder"});#zd=new Map;#Rd=null;#Nd=null;#Gd=null;#Hd=new Map;constructor(){super(),Object.seal(this),this.#fs.body.onclick=this.#Vd.bind(this),this.#fs.body.ondragstart=this.#Ud.bind(this),this.#fs.body.oncontextmenu=this.#qd.bind(this)}connectedCallback(){this.#Ea&&(this.append(...this.#Ea),this.#Ea=null)}clear(){this.#zd.forEach((t=>t.remove())),this.#zd.clear(),this.#Hd.clear(),this.#fs.body.querySelectorAll(".gsuiLibrary-sep").forEach((t=>t.remove()))}unloadSamples(){this.#zd.forEach((t=>{t.classList.remove("gsuiLibrary-sample-loading","gsuiLibrary-sample-ready"),t.title=t.dataset.name}))}setPlaceholder(t){this.#fs.placeholder.textContent=t}setLibrary(t){let s;const i=Array.from(this.#fs.body.children).findLast((t=>t.classList.contains("gsuiLibrary-sep"))),e=t.map((t=>{if("string"!=typeof t){const s=Y.En("gsui-library-sample",{id:t[0],points:t[1],name:t[2]||t[0]});return this.#Hd.has(t[0])&&s.classList.add("gsuiLibrary-sample-fav"),this.#zd.set(t[0],s),s}return s=Y.En("gsui-library-sep",t)}));this.#fs.body.append(...e),s&&s.dataset.id===i?.dataset.id&&s.remove()}bookmarkSample(t,s){s?this.#Hd.set(t):this.#Hd.delete(t),this.#zd.get(t)?.classList.toggle("gsuiLibrary-sample-fav",s)}loadSample(t){const s=this.#zd.get(t);s.classList.add("gsuiLibrary-sample-loading"),s.title="loading..."}readySample(t){const s=this.#zd.get(t);s.classList.remove("gsuiLibrary-sample-loading"),s.classList.add("gsuiLibrary-sample-ready"),s.title=s.dataset.name}playSample(t,s){const i=this.#zd.get(t);this.stopSample(),this.#Rd=t,this.#Nd=Y.Bn("div",{class:"gsuiLibrary-sample-cursor"}),this.#Nd.style.left="0%",this.#Nd.style.transitionDuration=`${s}s`,i.classList.add("gsuiLibrary-sample-playing"),i.append(this.#Nd),setTimeout((()=>this.#Nd.style.left="100%"),10),this.#Gd=setTimeout(this.stopSample.bind(this),1e3*s)}stopSample(){if(this.#Rd){const t=this.#zd.get(this.#Rd);clearTimeout(this.#Gd),this.#Nd.remove(),t.classList.remove("gsuiLibrary-sample-playing"),this.#Nd=null,this.#Rd=null,this.#Gd=null}}#_d(t){const s=!t.classList.contains("gsuiLibrary-sep-expanded");for(let i=t.nextElementSibling;i&&i.classList.contains("gsuiLibrary-sample");i=i.nextElementSibling)i.classList.toggle("gsuiLibrary-sample-expanded",s);t.classList.toggle("gsuiLibrary-sep-expanded",s)}#Ud(t){const s=t.target.dataset,i=`${s.id}:${s.name}`;t.dataTransfer.setData(`library-buffer:${Y.Kn(this,"name")}`,i)}#Vd(t){const s=t.target,i=s.classList;if(i.contains("gsuiLibrary-sep-btn"))this.#_d(s.parentNode);else if(i.contains("gsuiLibrary-sample")&&!i.contains("gsuiLibrary-sample-loading")){const t=i.contains("gsuiLibrary-sample-ready")?"playSample":"loadSample";this.#La(t,s.dataset.id)}}#qd(t){return t.target.classList.contains("gsuiLibrary-sample")&&this.#La("stopSample"),!1}}Object.freeze(Tt),customElements.define("gsui-library",Tt),Y.Pa("gsui-patterns-infoPopup",(()=>Y.Bn("div",{id:"gsuiPatterns-infoPopupContent"},Y.Bn("fieldset",null,Y.Bn("legend",null,"Type"),Y.Bn("label",null,Y.Bn("input",{type:"radio",name:"type",value:"drum"}),Y.Bn("i",{class:"gsuiIcon","data-icon":"buf-drum"}),Y.Bn("span",null,"drum")),Y.Bn("label",null,Y.Bn("input",{type:"radio",name:"type",value:"fx"}),Y.Bn("i",{class:"gsuiIcon","data-icon":"buf-fx"}),Y.Bn("span",null,"fx")),Y.Bn("label",null,Y.Bn("input",{type:"radio",name:"type",value:"vocal"}),Y.Bn("i",{class:"gsuiIcon","data-icon":"buf-vocal"}),Y.Bn("span",null,"vocal")),Y.Bn("label",null,Y.Bn("input",{type:"radio",name:"type",value:"loop"}),Y.Bn("i",{class:"gsuiIcon","data-icon":"buf-loop"}),Y.Bn("span",null,"loop"),Y.Bn("span",null,"bpm"),Y.Bn("input",{class:"gsuiPopup-inputText",type:"number",name:"bpm",min:1,max:999.99,step:.01}))),Y.Bn("fieldset",null,Y.Bn("legend",null,"Name"),Y.Bn("label",null,Y.Bn("input",{class:"gsuiPopup-inputText",type:"text",name:"name"})))))),Y.Pa("gsui-patterns-pattern",(()=>Y.Bn("div",{class:"gsuiPatterns-pattern",draggable:"true"},Y.Bn("div",{class:"gsuiPatterns-pattern-grip gsuiIcon","data-icon":"grip-v"}),Y.Bn("div",{class:"gsuiPatterns-pattern-head"},Y.Bn("div",{class:"gsuiPatterns-pattern-info"},Y.Bn("button",{class:"gsuiPatterns-pattern-btn gsuiPatterns-pattern-btnInfo gsuiIcon","data-action":"editInfo","data-icon":"buf-undefined",title:"Edit buffer's info"}),Y.Bn("div",{class:"gsuiPatterns-pattern-name"}),Y.Bn("i",{class:"gsuiPatterns-destArrow gsuiIcon","data-icon":"arrow-right"}),Y.Bn("button",{class:"gsuiPatterns-btnSolid gsuiPatterns-pattern-dest","data-action":"redirect",title:"Redirect this pattern"},Y.Bn("i",{class:"gsuiPatterns-btnIcon gsuiIcon","data-icon":"mixer"}),Y.Bn("span",{class:"gsuiPatterns-btnText"}))),Y.Bn("button",{class:"gsuiPatterns-pattern-btn gsuiIcon","data-action":"clone","data-icon":"clone",title:"Clone this pattern"}),Y.Bn("button",{class:"gsuiPatterns-pattern-btn gsuiIcon","data-action":"remove","data-icon":"close",title:"Delete this pattern"})),Y.Bn("div",{class:"gsuiPatterns-pattern-content"}),Y.Bn("div",{class:"gsuiPatterns-pattern-placeholder"},Y.Bn("i",{class:"gsuiPatterns-pattern-placeholderIcon gsuiIcon","data-icon":"file-corrupt"}),Y.Bn("span",{class:"gsuiPatterns-pattern-placeholderText"},"missing data"))))),Y.Pa("gsui-patterns-synth",(()=>Y.Bn("div",{class:"gsuiPatterns-synth"},Y.Bn("div",{class:"gsuiPatterns-synth-head"},Y.Bn("button",{class:"gsuiPatterns-synth-btn gsuiPatterns-synth-expand gsuiIcon","data-action":"expand","data-icon":"caret-right"}),Y.Bn("div",{class:"gsuiPatterns-synth-info"},Y.Bn("div",{class:"gsuiPatterns-synth-name"}),Y.Bn("i",{class:"gsuiPatterns-destArrow gsuiIcon","data-icon":"arrow-right"}),Y.Bn("button",{class:"gsuiPatterns-btnSolid gsuiPatterns-synth-dest","data-action":"redirect",title:"Redirect this synthesizer"},Y.Bn("i",{class:"gsuiPatterns-btnIcon gsuiIcon","data-icon":"mixer"}),Y.Bn("span",{class:"gsuiPatterns-btnText"}))),Y.Bn("button",{class:"gsuiPatterns-synth-btn gsuiIcon","data-action":"newPattern","data-icon":"plus",title:"Create a new pattern with this synthesizer"}),Y.Bn("button",{class:"gsuiPatterns-synth-btn gsuiIcon","data-action":"delete","data-icon":"close",title:"Delete the synthesizer and its patterns"})),Y.Bn("div",{class:"gsuiPatterns-placeholderToCheck gsuiPatterns-synth-patterns"},Y.Bn("div",{class:"gsuiPatterns-placeholder"},Y.Bn("span",null,"this synthesizer has no related pattern")))))),Y.Pa("gsui-patterns",(()=>Y.Bn("gsui-panels",{class:"gsuiPanels-y"},Y.En("gsui-patterns-panel",{class:"Buffers",title:"buffers",icon:"waveform",placeholder:"drag 'n drop raw files here (mp3, ogg, wav)"}),Y.En("gsui-patterns-panel",{class:"Slices",title:"slices",icon:"slices",placeholder:"no slices yet",button:{action:"newSlices",title:"Create a new slices pattern"}}),Y.En("gsui-patterns-panel",{class:"Drums",title:"drums",icon:"drums",placeholder:"no drums yet",button:{action:"newDrums",title:"Create a new drums pattern"}}),Y.En("gsui-patterns-panel",{class:"Keys",title:"keys",icon:"oscillator",placeholder:"no synth yet",button:{action:"newSynth",title:"Create a new synthesizer"}})))),Y.Pa("gsui-patterns-panel",(t=>Y.Bn("div",{class:`gsuiPatterns-panel gsuiPatterns-panel${t.class}`},Y.Bn("div",{class:"gsuiPatterns-panel-menu"},Y.Bn("i",{class:"gsuiPatterns-panel-icon gsuiIcon","data-icon":t.icon}),Y.Bn("span",{class:"gsuiPatterns-panel-title"},t.title),t.button&&Y.Bn("button",{class:"gsuiPatterns-btnSolid","data-action":t.button.action,title:t.button.title},Y.Bn("i",{class:"gsuiPatterns-btnIcon gsuiIcon","data-icon":"plus"}))),Y.Bn("div",{class:"gsuiPatterns-panel-list-wrap"},Y.Bn("div",{class:"gsuiPatterns-placeholderToCheck gsuiPatterns-panel-list"}),Y.Bn("div",{class:"gsuiPatterns-placeholder"},Y.Bn("span",null,t.placeholder))))));class Bt extends HTMLElement{#La=Y.Ca.bind(null,this,"gsuiPatterns");#Yd=Object.freeze({clone:t=>this.onchange("clonePattern",t),remove:t=>this.onchange("removePattern",t),editInfo:(t,s)=>this.#Jd(t,s),undefined:t=>this.onchange("openPattern",t),redirect:(t,s,i)=>this.#Xd("redirectPatternBuffer",t,i.target.dataset.id)});#Qd=Object.freeze({expand:t=>this.expandSynth(t),undefined:t=>this.onchange("openSynth",t),redirect:(t,s)=>this.#Xd("redirectSynth",t,s.target.dataset.id),newPattern:t=>{this.onchange("addPatternKeys",t),this.expandSynth(t,!0)},delete:t=>{this.#fs.lists.synth.children.length>1?this.onchange("removeSynth",t):Y.zn.alert("Error","You have to keep at least one synthesizer")}});#Ea=Y.En("gsui-patterns");#fs=Y.Fn(this.#Ea,{lists:{slices:".gsuiPatterns-panelSlices .gsuiPatterns-panel-list",drums:".gsuiPatterns-panelDrums .gsuiPatterns-panel-list",synth:".gsuiPatterns-panelKeys .gsuiPatterns-panel-list",buffer:".gsuiPatterns-panelBuffers .gsuiPatterns-panel-list"},newSlices:"[data-action='newSlices']",newDrums:"[data-action='newDrums']",newSynth:"[data-action='newSynth']"});#Zd=this.#fs.lists.synth.getElementsByClassName("gsuiPatterns-synth-patterns");static infoPopupContent=Y.En("gsui-patterns-infoPopup");constructor(){super(),this.onchange=this.onpatternDataTransfer=null,Object.seal(this),new ct({rootElement:this.#fs.lists.buffer,direction:"column",dataTransfer:(...t)=>this.onpatternDataTransfer(...t),dataTransferType:"pattern-buffer",itemSelector:".gsuiPatterns-pattern",handleSelector:".gsuiPatterns-pattern-grip",parentSelector:".gsuiPatterns-panel-list",onchange:this.#tp.bind(this,this.#fs.lists.buffer)}),new ct({rootElement:this.#fs.lists.slices,direction:"column",dataTransfer:(...t)=>this.onpatternDataTransfer(...t),dataTransferType:"pattern-slices",itemSelector:".gsuiPatterns-pattern",handleSelector:".gsuiPatterns-pattern-grip",parentSelector:".gsuiPatterns-panel-list",onchange:this.#tp.bind(this,this.#fs.lists.slices)}),new ct({rootElement:this.#fs.lists.drums,direction:"column",dataTransfer:(...t)=>this.onpatternDataTransfer(...t),dataTransferType:"pattern-drums",itemSelector:".gsuiPatterns-pattern",handleSelector:".gsuiPatterns-pattern-grip",parentSelector:".gsuiPatterns-panel-list",onchange:this.#tp.bind(this,this.#fs.lists.drums)}),new ct({rootElement:this.#fs.lists.synth,direction:"column",dataTransfer:(...t)=>this.onpatternDataTransfer(...t),dataTransferType:"pattern-keys",itemSelector:".gsuiPatterns-pattern",handleSelector:".gsuiPatterns-pattern-grip",parentSelector:".gsuiPatterns-synth-patterns",onchange:this.#sp.bind(this)}),this.#fs.lists.buffer.ondrop=t=>{const s=t.dataTransfer.getData("library-buffer:default"),i=t.dataTransfer.getData("library-buffer:local");s?this.#La("libraryBufferDropped","default",s):i&&this.#La("libraryBufferDropped","local",i)},this.#fs.lists.synth.ondragover=t=>{const s=t.target.closest(".gsuiPatterns-synth");s&&this.expandSynth(s.dataset.id,!0)},this.#fs.lists.synth.ondblclick=t=>{t.target.classList.contains("gsuiPatterns-synth-info")&&this.expandSynth(t.target.closest(".gsuiPatterns-synth").dataset.id)},this.#fs.lists.buffer.onclick=this.#fs.lists.slices.onclick=this.#fs.lists.drums.onclick=this.#ip.bind(this),this.#fs.lists.synth.onclick=this.#ep.bind(this),this.#fs.newSlices.onclick=()=>this.onchange("addPatternSlices"),this.#fs.newDrums.onclick=()=>this.onchange("addPatternDrums"),this.#fs.newSynth.onclick=()=>this.onchange("addSynth")}connectedCallback(){this.firstChild||(this.append(this.#Ea),this.#Ea=null)}expandSynth(t,s){const i=this.#np(t),e=i.classList.toggle("gsuiPatterns-synth-expanded",s);i.querySelector(".gsuiPatterns-synth-expand").dataset.icon="caret-"+(e?"down":"right")}reorderPatterns(t){ct.listReorder(this.#fs.lists.buffer,t),ct.listReorder(this.#fs.lists.slices,t),ct.listReorder(this.#fs.lists.drums,t),Array.prototype.forEach.call(this.#Zd,(s=>{ct.listReorder(s,t)}))}#Xd(t,s,i){et.openSelectChannelPopup(i).then((i=>i&&this.onchange(t,s,i)))}#Jd(t,s){const i=Bt.infoPopupContent.querySelector(`[value="${s.dataset.bufferType}"]`);if(i)i.checked=!0;else{const t=Bt.infoPopupContent.querySelector("input:checked");t&&(t.checked=!1)}Bt.infoPopupContent.querySelector("[name='bpm']").value=s.dataset.bufferBpm,Bt.infoPopupContent.querySelector("[name='name']").value=s.dataset.name,Y.zn.custom({title:"Buffer's info",element:Bt.infoPopupContent,submit:s=>{s.bpm=s.bpm||null,this.onchange("changePatternBufferInfo",t,s)}})}updateChannel(t,s){this.querySelectorAll(`.gsuiPatterns-btnSolid[data-id="${t}"] .gsuiPatterns-btnText`).forEach((t=>t.textContent=s))}addSynth(t){const s=Y.En("gsui-patterns-synth");s.dataset.id=t,this.#fs.lists.synth.prepend(s)}changeSynth(t,s,i){const e=this.#np(t);switch(s){case"name":e.querySelector(".gsuiPatterns-synth-name").textContent=i;break;case"dest":e.querySelector(".gsuiPatterns-synth-dest").dataset.id=i;break;case"destName":e.querySelector(".gsuiPatterns-synth-dest .gsuiPatterns-btnText").textContent=i}}deleteSynth(t){this.#np(t).remove()}addPattern(t,{type:s,synth:i}){const e=Y.En("gsui-patterns-pattern");e.dataset.id=t,"buffer"!==s?(e.querySelector(".gsuiPatterns-pattern-btnInfo").remove(),e.querySelector(".gsuiPatterns-destArrow").remove(),e.querySelector(".gsuiPatterns-pattern-dest").remove()):e.querySelector("[data-action='clone']").remove(),this.#ap(s,i).append(e)}changePattern(t,s,i){const e=this.getPattern(t);switch(s){case"data-missing":Y.Wn(e,"data-missing",i);break;case"order":e.dataset.order=i;break;case"name":e.dataset.name=i,e.querySelector(".gsuiPatterns-pattern-name").textContent=i;break;case"dest":e.querySelector(".gsuiPatterns-pattern-dest").dataset.id=i;break;case"destName":e.querySelector(".gsuiPatterns-pattern-dest .gsuiPatterns-btnText").textContent=i;break;case"synth":this.#ap("keys",i).append(e);break;case"bufferType":Y.Wn(e,"data-buffer-type",i),e.querySelector(".gsuiPatterns-pattern-btnInfo").dataset.icon=`buf-${i||"undefined"}`;break;case"bufferBpm":Y.Wn(e,"data-buffer-bpm",i)}}appendPatternSVG(t,s){s.classList.add("gsuiPatterns-pattern-svg"),this.getPattern(t).querySelector(".gsuiPatterns-pattern-content").append(s)}deletePattern(t){const s=this.getPattern(t);s&&s.remove()}selectPattern(t,s){const i=this.#fs.lists["keys"===t?"synth":t];i.querySelector(".gsuiPatterns-pattern-selected")?.classList?.remove("gsuiPatterns-pattern-selected"),this.getPattern(s)?.classList?.add("gsuiPatterns-pattern-selected")}selectSynth(t){this.#fs.lists.synth.querySelector(".gsuiPatterns-synth-selected")?.classList?.remove("gsuiPatterns-synth-selected"),this.#np(t).classList.add("gsuiPatterns-synth-selected")}getPattern(t){return this.querySelector(`.gsuiPatterns-pattern[data-id="${t}"]`)}#np(t){return this.#fs.lists.synth.querySelector(`.gsuiPatterns-synth[data-id="${t}"]`)}#ap(t,s){switch(t){case"slices":case"buffer":case"drums":return this.#fs.lists[t];case"keys":return this.#fs.lists.synth.querySelector(`.gsuiPatterns-synth[data-id="${s}"] .gsuiPatterns-synth-patterns`)}}#tp(t,s){this.onchange("reorderPattern",s.dataset.id,ct.listComputeOrderChange(t,{}))}#sp(t,s,i,e,n){if(e===n)this.#tp(e,t);else{const s=t.dataset.id,i=n.parentNode.dataset.id,a={[s]:{synth:i}};ct.listComputeOrderChange(e,a),ct.listComputeOrderChange(n,a),this.onchange("redirectPatternKeys",s,i,a)}}#ip(t){const s=t.target.closest(".gsuiPatterns-pattern");if(s)return this.#Yd[t.target.dataset.action](s.dataset.id,s,t),!1}#ep(t){if(!1!==this.#ip(t)){const s=t.target.closest(".gsuiPatterns-synth");s&&this.#Qd[t.target.dataset.action](s.dataset.id,t)}}}Object.freeze(Bt),customElements.define("gsui-patterns",Bt);class jt extends HTMLElement{constructor(){super(),Object.seal(this),this.oncontextmenu=()=>!1,this.onmousedown=t=>{if(2===t.button)Y.Ca(this,"gsuiToggle","toggleSolo");else if(0===t.button){const t=null!==Y.Kn(this,"off");Y.Wn(this,"off",!t),Y.Ca(this,"gsuiToggle","toggle",t)}}}connectedCallback(){Y.Wn(this,"tabindex",0)}}Object.freeze(jt),customElements.define("gsui-toggle",jt),Y.Pa("gsui-track",(()=>[Y.Bn("gsui-toggle",{title:"toggle track (right click for solo)"}),Y.Bn("div",{class:"gsuiTrack-nameWrap"},Y.Bn("input",{class:"gsuiTrack-name",type:"text",disabled:!0,spellcheck:"false"}))])),Y.Pa("gsui-track-row",(()=>Y.Bn("div",{class:"gsuiTrack-row gsui-row"},Y.Bn("div"))));class Lt extends HTMLElement{rowElement=Y.En("gsui-track-row");#La=Y.Ca.bind(null,this,"gsuiTrack");#Ea=Y.En("gsui-track");#hp=this.#Ea[1].firstChild;constructor(){super(),Object.seal(this),this.onchange=this.#wi.bind(this),this.onkeydown=this.#Bs.bind(this),this.ondblclick=this.#op.bind(this),this.#hp.onblur=this.#Lu.bind(this),Y.In(this,{gsuiToggle:{toggle:t=>{Y.Wn(this,"mute",!t.args[0]),this.#La("toggle",t.args[0])},toggleSolo:()=>{Y.Wn(this,"mute",!1),this.#La("toggleSolo")}}})}connectedCallback(){this.firstChild||(this.append(...this.#Ea),this.#Ea=null,Y.Ia(this,{name:"",order:0}))}static get observedAttributes(){return["mute","name","order"]}attributeChangedCallback(t,s,i){if(s!==i)switch(t){case"mute":this.rowElement.classList.toggle("gsui-mute",null!==i),Y.Wn(this.firstElementChild,"off",null!==i);break;case"name":this.#hp.value=i;break;case"order":this.dataset.order=i,this.#hp.placeholder="track "+(+i+1)}}#op(t){t.target===this.#hp&&(this.#hp.disabled=!1,this.#hp.select(),this.#hp.focus())}#Bs(t){if(t.target===this.#hp)switch(t.stopPropagation(),t.key){case"Escape":this.#hp.value=Y.Kn(this,"name");case"Enter":this.#hp.blur()}}#wi(){const t=this.#hp.value.trim();this.#hp.disabled=!0,Y.Wn(this,"name",t),this.#La("rename",t)}#Lu(){this.#hp.disabled=!0}}Object.freeze(Lt),customElements.define("gsui-track",Lt);class Et extends HTMLElement{#La=Y.Ca.bind(null,this,"gsuiTracklist");#rp=new Map;constructor(){super(),Object.seal(this),Y.In(this,{gsuiTrack:{rename:(t,s)=>this.#La("renameTrack",s.dataset.id,t.args[0]),toggle:(t,s)=>this.#La("toggleTrack",s.dataset.id),toggleSolo:(t,s)=>this.#La("toggleSoloTrack",s.dataset.id)}})}getTrack(t){return this.#rp.get(t)}addTrack(t){const s=Y.Bn("gsui-track",{"data-id":t});return s.rowElement.dataset.id=t,this.#rp.set(t,s),this.append(s),s}removeTrack(t){const s=this.#rp.get(t);s.remove(),s.rowElement.remove(),this.#rp.delete(t)}}Object.freeze(Et),customElements.define("gsui-tracklist",Et);class Wt extends HTMLElement{#cp=Y.Bn("canvas");#Gi=this.#cp.getContext("2d");constructor(){super(),Object.seal(this)}connectedCallback(){this.firstChild||this.append(this.#cp)}clear(){this.#Gi.clearRect(0,0,this.#cp.width,this.#cp.height)}setResolution(t,s){const i=this.#Gi.getImageData(0,0,this.#cp.width,this.#cp.height);this.#cp.width=t,this.#cp.height=s,this.#Gi.putImageData(i,0,0)}draw(t,s){Wt.#lp(this.#Gi),Wt.#il(this.#Gi,t,s)}static#lp(t){t.putImageData(t.getImageData(0,0,t.canvas.width,t.canvas.height-1),0,1)}static#il(t,s,i){const e=t.canvas.width/2,n=Math.min(e,s.length),a=Ft.draw(t,s,e),h=Ft.draw(t,i,e),o=t.createImageData(n,1);for(let t=0,s=n-1;t<n;++t,--s)Wt.#up(o.data,a.data,4*t,4*s);t.putImageData(o,0,0),t.putImageData(h,e,0)}static#up(t,s,i,e){t[i]=s[e],t[i+1]=s[e+1],t[i+2]=s[e+2],t[i+3]=s[e+3]}}Object.freeze(Wt),customElements.define("gsui-analyser",Wt);class Ft extends HTMLElement{#cp=Y.Bn("canvas");#Gi=this.#cp.getContext("2d");constructor(){super(),Object.seal(this),this.#cp.height=1}connectedCallback(){this.firstChild||this.append(this.#cp)}clear(){this.#Gi.clearRect(0,0,this.#cp.width,1)}setResolution(t){this.#cp.width=t,this.#cp.height=1}draw(t){this.#Gi.putImageData(Ft.draw(this.#Gi,t,this.#cp.width),0,0)}static#dp=[.08,.15,.17,.25,.3,.4,.6,.8,1/0];static#pp=[[5,2,20,.08],[8,5,30,.15],[15,7,50,.17],[75,7,35,.25],[80,0,0,.3],[180,0,0,.4],[200,25,10,.6],[200,128,10,.8],[200,200,20,1]];static draw(t,s,i=s.length){const e=t.createImageData(i,1),n=e.data,a=s.length;let h=-1;for(let t=0;t<i;++t){const e=4*t,o=Math.max(Math.round(a*2**(t/i*11-11)),h+1),r=1-Math.cos(s[o]/255*Math.PI/2);if(h=o,r<.05)n[e]=4+10*r|0,n[e+1]=4+10*r|0,n[e+2]=5+20*r|0;else{const t=Ft.#dp.findIndex((t=>r<t)),s=Ft.#pp[t],i=r/s[3];n[e]=s[0]*i|0,n[e+1]=s[1]*i|0,n[e+2]=s[2]*i|0}n[e+3]=255}return e}}Object.freeze(Ft),customElements.define("gsui-spectrum",Ft);class It{static#gp=0;#mp=`gsuiSVGDefs_${It.#gp++}_`;#bp=Y.Aa("defs");#wp=new Map;#fp=1;#vp=1;constructor(){const t=Y.Aa("svg");this.rootElement=t,Object.freeze(this),t.style.display="none",t.classList.add("gsuiSVGDefs"),t.append(this.#bp),document.body.prepend(t)}setDefaultViewbox(t,s){this.#fp=t,this.#vp=s}empty(){this.#wp.forEach((t=>t.g.remove())),this.#wp.clear()}delete(t){this.#wp.get(t).g.remove(),this.#wp.delete(t)}add(t,s=0,i=0,...e){if(this.#wp.has(t))console.error(`gsuiSVGDefs: ID "${t}" already used`);else{const n=Y.Aa("g");n.id=`${this.#mp}${t}`,n.append(...e),this.#bp.append(n),this.#wp.set(t,{g:n,w:s,h:i})}}update(t,s,i,...e){const n=this.#wp.get(t);n.w=s,n.h=i,Y.Wa(n.g),n.g.append(...e)}createSVG(t){const s=this.#wp.get(t)||{},i=Y.Aa("use"),e=Y.Aa("svg",{preserveAspectRatio:"none",viewBox:`0 0 ${s.w||this.#fp} ${s.h||this.#vp}`},i);return e.dataset.id=t,i.setAttributeNS("http://www.w3.org/1999/xlink","href",`#${this.#mp}${t}`),e}setSVGViewbox(t,s,i){const e=this.#wp.get(t.dataset.id).h;Y.Wn(t,"viewBox",`${s} 0 ${i} ${e}`)}}Object.freeze(It);class Kt{constructor(t){const s=t||Y.Aa("svg"),i=s.querySelector("polygon");this.rootElement=s,this.polygon=i,this.width=this.height=0,Object.seal(this),Y.Wn(s,"preserveAspectRatio","none"),s.classList.add("gsuiWaveform"),i||(this.polygon=Y.Aa("polygon"),s.append(this.polygon))}remove(){this.empty(),this.rootElement.remove()}empty(){this.polygon.removeAttribute("points")}setResolution(t,s){this.width=t,this.height=s,Y.Wn(this.rootElement,"viewBox",`0 0 ${t} ${s}`)}drawBuffer(t,s,i){Kt.drawBuffer(this.polygon,this.width,this.height,t,s,i)}static drawBuffer(t,s,i,e,n,a){const h=e.getChannelData(0),o=e.numberOfChannels>1?e.getChannelData(1):h,r=n||0,c=a||e.duration-r;Kt.draw(t,s,i,h,o,e.duration,r,c)}static draw(t,s,i,e,n,a,h,o){Y.Wn(t,"points",Kt.#yp(s,i,e,n,a,h,o))}static getPointsFromBuffer(t,s,i,e,n){const a=i.getChannelData(0),h=i.numberOfChannels>1?i.getChannelData(1):a,o=e||0,r=n||i.duration-o;return Kt.#yp(t,s,a,h,i.duration,o,r)}static#yp(t,s,i,e,n,a,h){const o=s/2,r=h/n*i.length/t,c=~~(a/n*i.length),l=~~Math.max(1,r/100);let u=`0,${Kt.#kp(o+i[c]*o)}`,d=`0,${Kt.#kp(o+e[c]*o)}`;for(let n=1;n<t;++n){let t=1/0,a=-1/0,h=~~(c+(n-1)*r);const p=h+r;for(;h<p;h+=l)t=Math.min(t,i[h],e[h]),a=Math.max(a,i[h],e[h]);Math.abs(a-t)*o<1&&(a+=1/s,t-=1/s),u+=` ${n},${Kt.#kp(o+t*o)}`,d=`${n},${Kt.#kp(o+a*o)} ${d}`}return`${u} ${d}`}static#kp(t){return t.toFixed(2)}}class zt extends It{#$p=!1;hdMode(t){this.#$p=t}update(t,s){const i=Y.Aa("polygon"),e=this.#$p?260:48*s.duration|0;return Kt.drawBuffer(i,e,48,s),super.update(t,e,48,i)}setSVGViewbox(t,s,i,e){const n=this.#$p?260:48/e;return super.setSVGViewbox(t,s*n,i*n)}}Object.freeze(zt);class Rt extends It{update(t,s,i){return super.update(t,i,1,...Rt.#Xh(s))}static#Xh(t){const s=Object.values(t),{min:i,size:e}=Rt.#Op(s),n=1/(e+1);return s.map((t=>Y.Aa("rect",{x:t.when,y:(e-t.key+i)*n,width:t.duration,height:n})))}static#Op(t){let s=1/0,i=-1/0;return t.forEach((t=>{s=Math.min(s,t.key),i=Math.max(i,t.key)})),s-=s%12,i+=11-i%12,{min:s,size:i-s}}}Object.freeze(Rt);class Nt extends It{update(t,s,i,e,n){return super.update(t,e,1,...Nt.#Xh(s,i,n))}static#Xh(t,s,i){const e=Object.entries(s),n=1/i,a=1/e.length,h=e.sort(((t,s)=>t[1].order-s[1].order)).reduce(((t,[s],i)=>(t[s]=i,t)),{});return Object.values(t).map((t=>("gain"in t?Nt.#xp:Nt.#Sp)(t.when,h[t.row]*a,n,a)))}static#xp(t,s,i,e){return Y.Aa("polygon",{points:[t,s,t,s+.75*e,t+i,s+.75*e/2].join(",")})}static#Sp(t,s,i,e){return Y.Aa("rect",{x:t,y:s+.8*e,width:.9*i,height:.2*e})}}Object.freeze(Nt);class Gt extends It{update(t,s,i){return super.update(t,i,1,...Gt.#Xh(s,i))}static#Xh(t,s){return Object.values(t).map((t=>[Gt.#Dp(t,s,null),Gt.#Dp(t,s,.25)])).flat(1)}static#Dp({x:t,y:s,w:i},e,n){return Y.Aa("rect",{x:e*t,y:s,opacity:n,width:e*(i-.005),height:null===n?.05:1-s})}}Object.freeze(Gt);class Ht extends HTMLElement{#Cp={};#Pp=0;#Mp=null;#Ap=null;#Tp=null;constructor(){super(),this.onopen=this.onclose=null,this._arrWindows=[],this._lowGraphics=!1,Object.seal(this)}lowGraphics(t){this._lowGraphics=t,this.classList.toggle("gsuiWindows-lowGraphics",t)}createWindow(t){const s=Y.Bn("gsui-window");return s.setId(t),s.setParent(this),s.movable(!0),s.addEventListener("focusin",this._onfocusinWin.bind(this,s)),this._arrWindows.push(s),this.#Cp[t]=s,this.append(s),s}window(t){return this.#Cp[t]}_startMousemoving(t,s,i){this.#Mp=this._stopMousemoving.bind(this,i),this.#Ap=s,document.addEventListener("mouseup",this.#Mp),document.addEventListener("mousemove",s),Y.Fa(),Y.Oa.show(t)}_stopMousemoving(t,s){document.removeEventListener("mouseup",this.#Mp),document.removeEventListener("mousemove",this.#Ap),Y.Oa.hide(),this.#Mp=this.#Ap=null,t(s)}_open(t){t.focus(),this._onfocusinWin(t),this.onopen&&this.onopen(t)}_close(t){t===this.#Tp&&(this.#Tp=null),this.onclose&&this.onclose(t)}_onfocusinWin(t,s){if(t!==this.#Tp){const s=t.getZIndex();this._arrWindows.forEach((t=>{t.getZIndex()>s&&t.setZIndex(t.getZIndex()-1)})),t.setZIndex(this._arrWindows.length-1),this.#Tp=t}s&&t.onfocusin&&t.onfocusin(s)}_winMaximized(t){++this.#Pp,this.classList.add("gsuiWindows-maximized"),this.scrollTop=this.scrollLeft=0}_winRestored(t){0==--this.#Pp&&this.classList.remove("gsuiWindows-maximized")}}Object.freeze(Ht),customElements.define("gsui-windows",Ht),Y.Pa("gsui-window",(()=>[Y.Bn("div",{class:"gsuiWindow-handlers"},Y.Bn("div",{class:"gsuiWindow-handler","data-dir":"n"}),Y.Bn("div",{class:"gsuiWindow-handler","data-dir":"e"}),Y.Bn("div",{class:"gsuiWindow-handler","data-dir":"s"}),Y.Bn("div",{class:"gsuiWindow-handler","data-dir":"w"}),Y.Bn("div",{class:"gsuiWindow-handler","data-dir":"nw"}),Y.Bn("div",{class:"gsuiWindow-handler","data-dir":"ne"}),Y.Bn("div",{class:"gsuiWindow-handler","data-dir":"sw"}),Y.Bn("div",{class:"gsuiWindow-handler","data-dir":"se"})),Y.Bn("div",{class:"gsuiWindow-wrap"},Y.Bn("div",{class:"gsuiWindow-head"},Y.Bn("button",{class:"gsuiWindow-icon gsuiIcon",tabindex:-1}),Y.Bn("div",{class:"gsuiWindow-title"}),Y.Bn("div",{class:"gsuiWindow-headContent"}),Y.Bn("div",{class:"gsuiWindow-headBtns"},Y.Bn("button",{class:"gsuiWindow-headBtn gsuiIcon","data-icon":"minimize",title:"Minimize"}),Y.Bn("button",{class:"gsuiWindow-headBtn gsuiIcon","data-icon":"restore",title:"Restore"}),Y.Bn("button",{class:"gsuiWindow-headBtn gsuiIcon","data-icon":"maximize",title:"Maximize"}),Y.Bn("button",{class:"gsuiWindow-headBtn gsuiIcon","data-icon":"close",title:"Close"}))),Y.Bn("div",{class:"gsuiWindow-content"}))]));class Vt extends HTMLElement{#Bp=32;#jp=32;#Lp=!1;#Ep=null;#Wp=!1;#Fp=!1;#Ip=Object.seal({x:0,y:0,w:32,h:32});#Kp=Object.seal({x:0,y:0});#zp=Object.seal({x:0,y:0});#Rp=0;#Ea=Y.En("gsui-window");#fs=Y.Fn(this.#Ea,{icon:".gsuiWindow-icon",wrap:".gsuiWindow-wrap",head:".gsuiWindow-head",title:".gsuiWindow-title",content:".gsuiWindow-content",handlers:".gsuiWindow-handlers",headBtns:".gsuiWindow-headBtns",headContent:".gsuiWindow-headContent"});constructor(){super(),this.rect=Object.seal({x:0,y:0,w:32,h:32}),this.onfocusin=null,Object.seal(this),this.#fs.icon.ondblclick=this.close.bind(this),this.#fs.headBtns.onclick=this.#Kd.bind(this),this.#fs.head.onmousedown=this.#Np.bind(this),this.#fs.title.ondblclick=this.#fs.headContent.ondblclick=this.#Gp.bind(this),this.#fs.handlers.onmousedown=this.#Hp.bind(this)}connectedCallback(){this.firstChild||(Y.Wn(this,"tabindex",0),this.append(...this.#Ea),this.#Ea=null)}isOpen(){return this.#Lp}open(){return this.openToggle(!0)}close(){return this.openToggle(!1)}openToggle(t){t?(this.#Lp=!0,this.#Vp("show",!0),this.#Ep._open(this)):this.onclose&&!1===this.onclose()||(this.#Lp=!1,this.#Vp("show",!1),this.#Ep._close(this))}setParent(t){this.#Ep=t}setId(t){this.dataset.id=t}setTitle(t){this.#fs.title.textContent=t}setTitleIcon(t){this.#fs.icon.dataset.icon=t}empty(){Y.Wa(this.#fs.content),Y.Wa(this.#fs.headContent)}contentAppend(...t){this.#fs.content.append(...t)}headAppend(...t){this.#fs.headContent.append(...t)}focus(){this.contains(document.activeElement)||setTimeout(this.focus.bind(this),50)}maximize(){if(!this.#Fp){const t=this.style;this.#Ip.x=this.rect.x,this.#Ip.y=this.rect.y,this.#Ip.w=this.rect.w,this.#Wp||(this.#Ip.h=this.rect.h),t.top=t.left=t.right=t.bottom=t.width=t.height="",this.#Vp("maximized",!0),this.#Vp("minimized",!1),this.#Fp=!0,this.#Wp=!1,this.focus(),this.#Ep._winMaximized(this.dataset.id)}}minimize(){if(!this.#Wp){const t=this.#Ip;this.#Fp||Object.assign(t,this.rect),this.#Vp("minimized",!0),this.#Vp("maximized",!1),this.#Wp=!0,this.#Fp=!1,this.setSize(t.w,this.#Up()),this.setPosition(t.x,t.y),this.#Ep._winRestored(this.dataset.id)}}restore(){if(this.#Wp||this.#Fp){const t=this.#Ip;this.focus(),this.#Vp("minimized",!1),this.#Vp("maximized",!1),this.#Wp=this.#Fp=!1,this.setSize(t.w,t.h),this.setPosition(t.x,t.y),this.#Ep._winRestored(this.dataset.id)}}movable(t){this.#Vp("movable",t)}getZIndex(){return+this.style.zIndex||0}setZIndex(t){this.style.zIndex=t}setSize(t,s){this.rect.w=t,this.rect.h=s,this.style.width=`${t}px`,this.style.height=`${s}px`}setMinSize(t,s){this.#Bp=t,this.#jp=s}setPosition(t,s){this.rect.x=t,this.rect.y=s,this.style.left=`${t}px`,this.style.top=`${s}px`}#Kd(t){const s=t.target.dataset.icon;s&&this[s]()}#Gp(t){t.target===t.currentTarget&&(this.#Fp?this.restore():this.maximize())}#Np(t){const s=t.target.classList;(s.contains("gsuiWindow-head")||s.contains("gsuiWindow-title")||s.contains("gsuiWindow-headContent"))&&!this.#Fp&&(this.#zp.x=t.clientX,this.#zp.y=t.clientY,this.#Kp.x=this.#Kp.y=0,this.#Vp("dragging",!0),this.#Ep._startMousemoving("move",this.#qp.bind(this),this.#_p.bind(this)))}#Hp(t){const s=t.target.dataset.dir;s&&(this.#zp.x=t.clientX,this.#zp.y=t.clientY,this.#Kp.x=this.#Kp.y=0,this.#Rp=this.#Up(),this.#Vp("dragging",!0),this.#Ep._startMousemoving(`${s}-resize`,this.#Yp.bind(this,s),this.#Jp.bind(this,s)))}#qp(t){const s=t.clientX-this.#zp.x,i=t.clientY-this.#zp.y,e=this.#Kp,n=this.#Xp("nesw",s,i);e.x=s+n.x,e.y=i+n.y,this.#Qp(this.#fs.handlers.style,e.x,e.y),this.#Ep._lowGraphics||this.#Qp(this.#fs.wrap.style,e.x,e.y)}#_p(){const{x:t,y:s}=this.rect,i=this.#Kp;this.#Vp("dragging",!1),this.#Zp(this.#fs.wrap.style),this.#Zp(this.#fs.handlers.style),(i.x||i.y)&&(this.setPosition(t+i.x,s+i.y),this.#Ip.x=this.rect.x,this.#Ip.y=this.rect.y)}#Yp(t,s){const i=this.#Kp,e=s.clientX-this.#zp.x,n=s.clientY-this.#zp.y,a=this.#Xp(t,e,n);i.x=e+a.x,i.y=n+a.y,this.#tg(t,i),this.#sg(this.#fs.handlers.style,t,i),this.#Ep._lowGraphics||this.#sg(this.#fs.wrap.style,t,i)}#Jp(t){const{x:s,y:i,w:e,h:n}=this.rect,a=this.#Kp;if(this.#Vp("dragging",!1),this.#Zp(this.#fs.wrap.style),this.#Zp(this.#fs.handlers.style),a.x||a.y)switch(t){case"e":this.setSize(e+a.x,n);break;case"se":this.setSize(e+a.x,n+a.y);break;case"s":this.setSize(e,n+a.y);break;case"sw":this.setSize(e-a.x,n+a.y),this.setPosition(s+a.x,i);break;case"w":this.setSize(e-a.x,n),this.setPosition(s+a.x,i);break;case"nw":this.setSize(e-a.x,n-a.y),this.setPosition(s+a.x,i+a.y);break;case"n":this.setSize(e,n-a.y),this.setPosition(s,i+a.y);break;case"ne":this.setSize(e+a.x,n-a.y),this.setPosition(s,i+a.y)}}#Vp(t,s){this.classList.toggle(`gsuiWindow-${t}`,s)}#Up(){return this.#fs.head.getBoundingClientRect().height}#Xp(t,s,i){const e=this.rect,n=t.includes("w"),a=t.includes("n"),h=t.includes("e"),o=t.includes("s"),r=n?e.x+s:e.x,c=a?e.y+i:e.y,l=this.#Ep.getBoundingClientRect(),u=[...this.#Ep._arrWindows,{dataset:{},rect:{x:0,y:0,w:l.width-4,h:l.height-4}}];let d=0,p=0;if(h&&n){const t=this.#ig(u,"x",r+e.w,2,0),s=this.#ig(u,"x",r,0,2);(t||s)&&(d=Math.abs(t||1/0)<Math.abs(s||1/0)?t:s)}else d=h?this.#ig(u,"x",r+e.w+s,2,0):this.#ig(u,"x",r,0,2);if(o&&a){const t=this.#ig(u,"y",c+e.h,2,0),s=this.#ig(u,"y",c,0,2);(t||s)&&(p=Math.abs(t||1/0)<Math.abs(s||1/0)?t:s)}else p=o?this.#ig(u,"y",c+e.h+i,2,0):this.#ig(u,"y",c,0,2);return{x:d,y:p}}#ig(t,s,i,e,n){let a=1/0;return t.reduce(((t,h)=>{if(h.dataset.id!==this.dataset.id&&(!h.isOpen||h.isOpen())){const t=h.rect,o=t[s],r=o-e-i,c=o+("x"===s?t.w:t.h)+n-i,l=Math.abs(r),u=Math.abs(c),d=Math.min(l,u);if(d<4&&d<a)return a=d,l<u?r:c}return t}),0)}#Zp(t){t.top=t.left=t.right=t.bottom=0}#Qp(t,s,i){t.top=`${i}px`,t.left=`${s}px`,t.right=-s+"px",t.bottom=-i+"px"}#tg(t,s){const i=this.rect.w-this.#Bp,e=this.rect.h-this.#Rp-this.#jp;switch(t){case"n":e-s.y<0&&(s.y=e);break;case"s":e+s.y<0&&(s.y=-e);break;case"w":i-s.x<0&&(s.x=i);break;case"e":i+s.x<0&&(s.x=-i);break;case"nw":e-s.y<0&&(s.y=e),i-s.x<0&&(s.x=i);break;case"ne":e-s.y<0&&(s.y=e),i+s.x<0&&(s.x=-i);break;case"sw":e+s.y<0&&(s.y=-e),i-s.x<0&&(s.x=i);break;case"se":e+s.y<0&&(s.y=-e),i+s.x<0&&(s.x=-i)}}#sg(t,s,i){switch(s){case"n":t.top=`${i.y}px`;break;case"s":t.bottom=-i.y+"px";break;case"w":t.left=`${i.x}px`;break;case"e":t.right=-i.x+"px";break;case"nw":t.left=`${i.x}px`,t.top=`${i.y}px`;break;case"ne":t.right=-i.x+"px",t.top=`${i.y}px`;break;case"sw":t.left=`${i.x}px`,t.bottom=-i.y+"px";break;case"se":t.right=-i.x+"px",t.bottom=-i.y+"px"}}}Object.freeze(Vt),customElements.define("gsui-window",Vt);class Ut{#eg=null;#ng="";#ag=[];#x=null;#hg=null;#og=null;#rg=this.#cg.bind(this);#lg=this.#ug.bind(this);constructor(t){this.#eg=t,this.#hg=t.querySelectorAll(".TextGlitch-clip"),this.#og=t.querySelectorAll(".TextGlitch-word"),Object.seal(this),this.setTexts(["GridSound","gRIDsOUND","&<:]$+\\#)","6/1)20^?}","9-!>5?nu]"])}on(){this.#x||this.#rg()}off(){clearTimeout(this.#x),this.#x=null,this.#lg()}setTexts([t,...s]){this.#ng=t,this.#ag=s}#cg(){this.#dg(),setTimeout(this.#lg,50+200*Math.random()),this.#x=setTimeout(this.#rg,250+400*Math.random())}#dg(){const t=this.#pg(.2),s=this.#pg(.2);this.#hg.forEach((t=>{const s=this.#pg(.06),i=this.#pg(0);t.style.transform=`translate(${s}em, ${i}em)`})),this.#hg[0].style.clipPath=`inset( 0 0 ${.6+t}em 0 )`,this.#hg[1].style.clipPath=`inset( ${.4-t}em 0 ${.3-s}em 0 )`,this.#hg[2].style.clipPath=`inset( ${.7+s}em 0 -1em 0 )`,this.#gg(this.#mg()),this.#eg.classList.add("TextGlitch-blended")}#ug(){this.#hg.forEach((t=>{t.style.clipPath=t.style.transform=""})),this.#gg(this.#ng),this.#eg.classList.remove("TextGlitch-blended")}#mg(){const t=Array.from(this.#ng);for(let s=0;s<5;++s){const s=this.#bg(this.#ng.length);t[s]=this.#ag[this.#bg(this.#ag.length)][s]}return t.join("")}#pg(t){return Math.random()*t-t/2}#bg(t){return Math.random()*t|0}#gg(t){this.#og.forEach((s=>s.textContent=t))}}document.addEventListener("gsuiEvents",(({detail:t})=>{console.warn(`uncatched gsuiEvent: [${t.component}][${t.eventName}]`,t.args)})),new Promise((t=>{const s=document.querySelector("#splashScreen"),i=document.querySelector("#splashScreen-title"),e=document.querySelector("#splashScreen-start"),n=document.querySelector("#splashScreen-form"),a=document.querySelector("[ name='cookies' ]"),h=new Ut(i);s.classList.add("loaded"),window.CSS&&CSS.supports("clip-path: inset(0 1px 2px 3px)")&&h.on(),a.checked="1"===localStorage.getItem("cookieAccepted"),n.onchange=()=>{e.disabled=!a.checked},e.onclick=()=>{h.off(),s.classList.add("starting"),localStorage.setItem("cookieAccepted","1"),setTimeout(t,100)},n.onchange()})).then((()=>{const t=new k;Y.Wn(t.rootElement,"version",document.querySelector("#splashScreen-version").textContent),t.getDAWCore().ni(),t.newComposition()})).then((()=>{const t=document.querySelector("#splashScreen");t.classList.add("started"),setTimeout((()=>t.remove()),800)}));
</script>
</body>
</html>
